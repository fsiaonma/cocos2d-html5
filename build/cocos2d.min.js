function ClassManager(){return arguments.callee.name||arguments.callee.toString().match(/^function ([^(]+)/)[1]}var cc=cc||{};ClassManager.id=0|Math.random()*998,ClassManager.compileSuper=function(e,t,n){var r=e.toString(),i=r.indexOf("("),s=r.indexOf(")"),o=r.substring(i+1,s);o=o.trim();var u=r.indexOf("{"),a=r.lastIndexOf("}"),r=r.substring(u+1,a);while(r.indexOf("this._super")!=-1){var f=r.indexOf("this._super"),l=r.indexOf("(",f),c=r.indexOf(")",l),h=r.substring(l+1,c);h=h.trim();var p=h?",":"",d=arguments.callee.ClassManager();r=r.substring(0,f)+d+"["+n+"]."+t+".call(this"+p+r.substring(l+1)}return Function(o,r)},ClassManager.compileSuper.ClassManager=ClassManager,ClassManager.getNewID=function(){return this.id++},function(){var e=!1,t=/\b_super\b/,n=document.ccConfig&&document.ccConfig.CLASS_RELEASE_MODE?document.ccConfig.CLASS_RELEASE_MODE:null;n&&console.log("release Mode"),cc.Class=function(){},cc.Class.extend=function(r){function o(){!e&&this.ctor&&this.ctor.apply(this,arguments)}var i=this.prototype;e=!0;var s=new this;e=!1,o.id=ClassManager.getNewID(),ClassManager[o.id]=i;for(var u in r)n&&typeof r[u]=="function"&&typeof i[u]=="function"&&t.test(r[u])?s[u]=ClassManager.compileSuper(r[u],u,o.id):typeof r[u]=="function"&&typeof i[u]=="function"&&t.test(r[u])?s[u]=function(e,t){return function(){var n=this._super;this._super=i[e];var r=t.apply(this,arguments);return this._super=n,r}}(u,r[u]):s[u]=r[u];return s.__pid=o.id,o.prototype=s,o.prototype.constructor=o,o.extend=arguments.callee,o.implement=function(e){for(var t in e)s[t]=e[t]},o}}(),cc.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new n,e.prototype.constructor=e},cc.base=function(e,t,n){var r=arguments.callee.caller;if(r.superClass_)return ret=r.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1)),ret;var i=Array.prototype.slice.call(arguments,2),s=!1;for(var o=e.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[t]===r)s=!0;else if(s)return o.prototype[t].apply(e,i);if(e[t]===r)return e.constructor.prototype[t].apply(e,i);throw Error("cc.base called from a method of one name to a method of a different name")},cc.concatObjectProperties=function(e,t){e||(e={});for(var n in t)e[n]=t[n];return e};cc.create3DContext=function(e,t){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null;for(var i=0;i<n.length;++i){try{r=e.getContext(n[i],t)}catch(s){}if(r)break}return r},cc.Browser={},function(){cc.Browser.ua=navigator.userAgent.toLowerCase(),cc.Browser.platform=navigator.platform.toLowerCase(),cc.Browser.UA=cc.Browser.ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],cc.Browser.mode=cc.Browser.UA[1]=="ie"&&document.documentMode,cc.Browser.type=cc.Browser.UA[1]=="version"?cc.Browser.UA[3]:cc.Browser.UA[1],cc.Browser.isMobile=cc.Browser.ua.indexOf("mobile")!=-1||cc.Browser.ua.indexOf("android")!=-1;var e=document.ccConfig;cc._userRenderMode=parseInt(e.renderMode)||0;if(cc._userRenderMode===1)cc.Browser.supportWebGL=!1;else{cc.Browser.supportWebGL=window.WebGLRenderingContext!=null;var t=document.createElement("Canvas"),n=cc.create3DContext(t,{stencil:!0,preserveDrawingBuffer:!0});cc.Browser.supportWebGL=n!=null}cc._userRenderMode===2&&!cc.Browser.supportWebGL&&(cc.__renderDoesnotSupport=!0)}(),cc.RenderDoesnotSupport=function(){return cc.__renderDoesnotSupport==="undefined"?!1:cc.__renderDoesnotSupport},cc.$=function(e){var t=this==cc?document:this,n=e instanceof HTMLElement?e:t.querySelector(e);return n&&(n.find=n.find||cc.$,n.hasClass=n.hasClass||function(e){return this.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},n.addClass=n.addClass||function(e){return this.hasClass(e)||(this.className&&(this.className+=" "),this.className+=e),this},n.removeClass=n.removeClass||function(e){return this.hasClass(e)&&(this.className=this.className.replace(e,"")),this},n.remove=n.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},n.appendTo=n.appendTo||function(e){return e.appendChild(this),this},n.prependTo=n.prependTo||function(e){return e.childNodes[0]?e.insertBefore(this,e.childNodes[0]):e.appendChild(this),this},n.transforms=n.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},n.position=n.position||{x:0,y:0},n.rotation=n.rotation||0,n.scale=n.scale||{x:1,y:1},n.skew=n.skew||{x:0,y:0},n.translates=function(e,t){return this.position.x=e,this.position.y=t,this.transforms(),this},n.rotate=function(e){return this.rotation=e,this.transforms(),this},n.resize=function(e,t){return this.scale.x=e,this.scale.y=t,this.transforms(),this},n.setSkew=function(e,t){return this.skew.x=e,this.skew.y=t,this.transforms(),this}),n};switch(cc.Browser.type){case"firefox":cc.$.pfx="Moz",cc.$.hd=!0;break;case"chrome":case"safari":cc.$.pfx="webkit",cc.$.hd=!0;break;case"opera":cc.$.pfx="O",cc.$.hd=!1;break;case"ie":cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(e){return"translate3d("+e.x+"px, "+e.y+"px, 0) "}:function(e){return"translate("+e.x+"px, "+e.y+"px) "},cc.$.rotate=cc.$.hd?function(e){return"rotateZ("+e+"deg) "}:function(e){return"rotate("+e+"deg) "},cc.$.scale=function(e){return"scale("+e.x+", "+e.y+") "},cc.$.skew=function(e){return"skewX("+ -e.x+"deg) skewY("+e.y+"deg)"},cc.$new=function(e){return cc.$(document.createElement(e))},cc.$.findpos=function(e){var t=0,n=0;do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}};cc.clone=function(e){var t=e instanceof Array?[]:{};for(var n in e){var r=e[n];r instanceof Array?t[n]=cc.clone(r):typeof r!="object"||r instanceof cc.Node||r instanceof HTMLElement?t[n]=r:t[n]=cc.clone(r)}return t},cc.associateWithNative=function(e,t){},cc.IS_SHOW_DEBUG_ON_PAGE=cc.IS_SHOW_DEBUG_ON_PAGE||!1,cc._logToWebPage=function(e){var t=document.getElementById("logInfoList");if(!t){var n=document.createElement("Div");n.setAttribute("id","logInfoDiv"),cc.canvas.parentNode.appendChild(n),n.setAttribute("width","300"),n.setAttribute("height",cc.canvas.height),n.style.zIndex="99999",n.style.position="absolute",n.style.top="0",n.style.left="0",t=document.createElement("ul"),n.appendChild(t),t.setAttribute("id","logInfoList"),t.style.height="450px",t.style.color="#fff",t.style.textAlign="left",t.style.listStyle="disc outside",t.style.fontSize="12px",t.style.fontFamily="arial",t.style.padding="0 0 0 20px",t.style.margin="0",t.style.textShadow="0 0 3px #000",t.style.zIndex="99998",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.overflowY="hidden";var r=document.createElement("Div");n.appendChild(r),r.style.width="300px",r.style.height=cc.canvas.height+"px",r.style.opacity="0.1",r.style.background="#fff",r.style.border="1px solid #dfdfdf",r.style.borderRadius="8px"}var i=document.createElement("li");i.innerHTML=e,t.childNodes.length==0?t.appendChild(i):t.insertBefore(i,t.childNodes[0])},cc.log=function(e){cc.IS_SHOW_DEBUG_ON_PAGE?cc._logToWebPage(e):console.log(e)},cc.MessageBox=function(e){console.log(e)},cc.Assert=function(e,t){console.assert?console.assert(e,t):e||t&&alert(t)},cc.initDebugSetting=function(){cc.COCOS2D_DEBUG==0?(cc.log=function(){},cc.logINFO=function(){},cc.logERROR=function(){},cc.Assert=function(){}):cc.COCOS2D_DEBUG==1?(cc.logINFO=cc.log,cc.logERROR=function(){}):cc.COCOS2D_DEBUG>1&&(cc.logINFO=cc.log,cc.logERROR=cc.log)},cc.LANGUAGE_ENGLISH=0,cc.LANGUAGE_CHINESE=1,cc.LANGUAGE_FRENCH=2,cc.LANGUAGE_ITALIAN=3,cc.LANGUAGE_GERMAN=4,cc.LANGUAGE_SPANISH=5,cc.LANGUAGE_RUSSIAN=6;cc.Codec={name:"Jacob__Codec"},cc.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.unzipBase64=function(){var e=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[e])},cc.unzipBase64AsArray=function(e,t){t=t||1;var n=this.unzipBase64(e),r=[],i,s,o;for(i=0,o=n.length/t;i<o;i++){r[i]=0;for(s=t-1;s>=0;--s)r[i]+=n.charCodeAt(i*t+s)<<s*8}return r},cc.unzipAsArray=function(e,t){t=t||1;var n=this.unzip(e),r=[],i,s,o;for(i=0,o=n.length/t;i<o;i++){r[i]=0;for(s=t-1;s>=0;--s)r[i]+=n.charCodeAt(i*t+s)<<s*8}return r},cc.StringToArray=function(e){var t=e.split(","),n=[],r;for(r=0;r<t.length;r++)n.push(parseInt(t[r]));return n};cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var n=[],r,i,s,o,u,a,f,l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<t.length)o=this._keyStr.indexOf(t.charAt(l++)),u=this._keyStr.indexOf(t.charAt(l++)),a=this._keyStr.indexOf(t.charAt(l++)),f=this._keyStr.indexOf(t.charAt(l++)),r=o<<2|u>>4,i=(u&15)<<4|a>>2,s=(a&3)<<6|f,n.push(String.fromCharCode(r)),a!=64&&n.push(String.fromCharCode(i)),f!=64&&n.push(String.fromCharCode(s));return n=n.join(""),n},cc.Codec.Base64.decodeAsArray=function(t,n){var r=this.decode(t),i=[],s,o,u;for(s=0,u=r.length/n;s<u;s++){i[s]=0;for(o=n-1;o>=0;--o)i[s]+=r.charCodeAt(s*n+o)<<o*8}return i},cc.uint8ArrayToUint32Array=function(e){if(e.length%4!=0)return null;var t=e.length/4,n=window.Uint32Array?new Uint32Array(t):[];for(var r=0;r<t;r++){var i=r*4;n[r]=e[i]+e[i+1]*256+e[i+2]*65536+e[i+3]*(1<<24)}return n};cc.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=undefined,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=undefined,this.literalTree=new Array(cc.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=undefined,this.fmax=undefined},cc.Codec.GZip.gunzip=function(e){e.constructor!==Array&&e.constructor===String;var t=new cc.Codec.GZip(e);return t.gunzip()[0][0]},cc.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},cc.Codec.GZip.LITERALS=288,cc.Codec.GZip.NAMEMAX=256,cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},cc.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1},cc.Codec.GZip.prototype.readBit=function(){var e;return this.bits++,e=this.bb&1,this.bb>>=1,this.bb==0&&(this.bb=this.readByte(),e=this.bb&1,this.bb=this.bb>>1|128),e},cc.Codec.GZip.prototype.readBits=function(e){var t=0,n=e;while(n--)t=t<<1|this.readBit();return e&&(t=cc.Codec.GZip.bitReverse[t]>>8-e),t},cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},cc.Codec.GZip.prototype.addBuffer=function(e){this.buf32k[this.bIdx++]=e,this.outputArr.push(String.fromCharCode(e)),this.bIdx==32768&&(this.bIdx=0)},cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]==this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},cc.Codec.GZip.prototype.Rec=function(){var e=this.Places[this.treepos],t;if(this.len==17)return-1;this.treepos++,this.len++,t=this.IsPat();if(t>=0)e.b0=t;else{e.b0=32768;if(this.Rec())return-1}t=this.IsPat();if(t>=0)e.b1=t,e.jump=null;else{e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos;if(this.Rec())return-1}return this.len--,0},cc.Codec.GZip.prototype.CreateTree=function(e,t,n,r){var i;this.Places=e,this.treepos=0,this.flens=n,this.fmax=t;for(i=0;i<17;i++)this.fpos[i]=0;return this.len=0,this.Rec()?-1:0},cc.Codec.GZip.prototype.DecodeValue=function(e){var t,n,r=0,i=e[r],s;for(;;){s=this.readBit();if(s){if(!(i.b1&32768))return i.b1;i=i.jump,t=e.length;for(n=0;n<t;n++)if(e[n]===i){r=n;break}}else{if(!(i.b0&32768))return i.b0;r++,i=e[r]}}return-1},cc.Codec.GZip.prototype.DeflateLoop=function(){var e,t,n,r,i;do{e=this.readBit(),n=this.readBits(2);if(n==0){var s,o;this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,o=this.readByte(),o|=this.readByte()<<8,(s^~o)&65535&&document.write("BlockLen checksum mismatch\n");while(s--)t=this.readByte(),this.addBuffer(t)}else if(n==1){var u;for(;;){u=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,u>23?(u=u<<1|this.readBit(),u>199?(u-=128,u=u<<1|this.readBit()):(u-=48,u>143&&(u+=136))):u+=256;if(u<256)this.addBuffer(u);else{if(u==256)break;var i,a;u-=257,i=this.readBits(cc.Codec.GZip.cplext[u])+cc.Codec.GZip.cplens[u],u=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,cc.Codec.GZip.cpdext[u]>8?(a=this.readBits(8),a|=this.readBits(cc.Codec.GZip.cpdext[u]-8)<<8):a=this.readBits(cc.Codec.GZip.cpdext[u]),a+=cc.Codec.GZip.cpdist[u];for(u=0;u<i;u++){var t=this.buf32k[this.bIdx-a&32767];this.addBuffer(t)}}}}else if(n==2){var u,f,l,c,h,p=new Array(320);l=257+this.readBits(5),c=1+this.readBits(5),h=4+this.readBits(4);for(u=0;u<19;u++)p[u]=0;for(u=0;u<h;u++)p[cc.Codec.GZip.border[u]]=this.readBits(3);i=this.distanceTree.length;for(r=0;r<i;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,p,0))return this.flushBuffer(),1;f=l+c,r=0;var d=-1;while(r<f){d++,u=this.DecodeValue(this.distanceTree);if(u<16)p[r++]=u;else if(u==16){var v;u=3+this.readBits(2);if(r+u>f)return this.flushBuffer(),1;v=r?p[r-1]:0;while(u--)p[r++]=v}else{u==17?u=3+this.readBits(3):u=11+this.readBits(7);if(r+u>f)return this.flushBuffer(),1;while(u--)p[r++]=0}}i=this.literalTree.length;for(r=0;r<i;r++)this.literalTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,l,p,0))return this.flushBuffer(),1;i=this.literalTree.length;for(r=0;r<i;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;var m=new Array;for(r=l;r<p.length;r++)m[r-l]=p[r];if(this.CreateTree(this.distanceTree,c,m,0))return this.flushBuffer(),1;for(;;){u=this.DecodeValue(this.literalTree);if(u>=256){var i,a;u-=256;if(u==0)break;u--,i=this.readBits(cc.Codec.GZip.cplext[u])+cc.Codec.GZip.cplens[u],u=this.DecodeValue(this.distanceTree),cc.Codec.GZip.cpdext[u]>8?(a=this.readBits(8),a|=this.readBits(cc.Codec.GZip.cpdext[u]-8)<<8):a=this.readBits(cc.Codec.GZip.cpdext[u]),a+=cc.Codec.GZip.cpdist[u];while(i--){var t=this.buf32k[this.bIdx-a&32767];this.addBuffer(t)}}else this.addBuffer(u)}}}while(!e);return this.flushBuffer(),this.byteAlign(),0},cc.Codec.GZip.prototype.unzipFile=function(e){var t;this.gunzip();for(t=0;t<this.unzipped.length;t++)if(this.unzipped[t][1]==e)return this.unzipped[t][0]},cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var e=[];e[0]=this.readByte(),e[1]=this.readByte(),e[0]==120&&e[1]==218&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),e[0]==31&&e[1]==139&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++);if(e[0]==80&&e[1]==75){this.modeZIP=!0,e[2]=this.readByte(),e[3]=this.readByte();if(e[2]==3&&e[3]==4){e[0]=this.readByte(),e[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var t=this.readByte();t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24;var i=this.readByte();i|=this.readByte()<<8;var s=this.readByte();s|=this.readByte()<<8,u=0,this.nameBuf=[];while(i--){var o=this.readByte();o=="/"|o==":"?u=0:u<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[u++]=String.fromCharCode(o))}this.fileout||(this.fileout=this.nameBuf);var u=0;while(u<s)o=this.readByte(),u++;t==8&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}}},cc.Codec.GZip.prototype.skipdir=function(){var e=[],t,n,r,i,s;this.gpflags&8&&(e[0]=this.readByte(),e[1]=this.readByte(),e[2]=this.readByte(),e[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24),this.modeZIP&&this.nextFile(),e[0]=this.readByte();if(e[0]!=8)return 0;this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),r=this.readByte();if(this.gpflags&4){e[0]=this.readByte(),e[2]=this.readByte(),this.len=e[0]+256*e[1];for(i=0;i<this.len;i++)this.readByte()}if(this.gpflags&8){i=0,this.nameBuf=[];while(s=this.readByte()){if(s=="7"||s==":")i=0;i<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[i++]=s)}}if(this.gpflags&16)while(s=this.readByte());this.gpflags&2&&(this.readByte(),this.readByte()),this.DeflateLoop(),n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24,this.modeZIP&&this.nextFile()};cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.SWAP=function(e,t,n){if(typeof n=="object"&&typeof n.x!="undefined"&&typeof n.y!="undefined"){var r=n[e];n[e]=n[t],n[t]=r}else cc.Assert(!1,"CC_SWAP is being modified from original macro, please check usage")},cc.lerp=function(e,t,n){return e+(t-e)*n},cc.RANDOM_MINUS1_1=function(){return(Math.random()-.5)*2},cc.RANDOM_0_1=function(){return Math.random()},cc.DEGREES_TO_RADIANS=function(e){return e*cc.RAD},cc.RADIANS_TO_DEGREES=function(e){return e*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.BLEND_SRC=cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?1:770,cc.BLEND_DST=771,cc.NODE_DRAW_SETUP=function(e){e._shaderProgram&&(e._shaderProgram.use(),e._shaderProgram.setUniformForModelViewProjectionMatrixWithMat4(e._mvpMatrix))},cc.ENABLE_DEFAULT_GL_STATES=function(){},cc.DISABLE_DEFAULT_GL_STATES=function(){},cc.INCREMENT_GL_DRAWS=function(e){cc.g_NumberOfDraws+=e},cc.FLT_EPSILON=1.192092896e-7,cc.CONTENT_SCALE_FACTOR=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.Director.getInstance().getContentScaleFactor()}:function(){return 1},cc.POINT_POINTS_TO_PIXELS=function(e){return cc.p(e.x*cc.CONTENT_SCALE_FACTOR(),e.y*cc.CONTENT_SCALE_FACTOR())},cc.SIZE_POINTS_TO_PIXELS=function(e){return cc.size(e.width*cc.CONTENT_SCALE_FACTOR(),e.height*cc.CONTENT_SCALE_FACTOR())},cc.SIZE_PIXELS_TO_POINTS=function(e){return cc.size(e.width/cc.CONTENT_SCALE_FACTOR(),e.height/cc.CONTENT_SCALE_FACTOR())},cc.POINT_PIXELS_TO_POINTS=function(e){return cc.p(e.x/cc.CONTENT_SCALE_FACTOR(),e.y/cc.CONTENT_SCALE_FACTOR())},cc.RECT_PIXELS_TO_POINTS=cc.IS_RETINA_DISPLAY_SUPPORTED?function(e){return cc.rect(e.origin.x/cc.CONTENT_SCALE_FACTOR(),e.origin.y/cc.CONTENT_SCALE_FACTOR(),e.size.width/cc.CONTENT_SCALE_FACTOR(),e.size.height/cc.CONTENT_SCALE_FACTOR())}:function(e){return e},cc.RECT_POINTS_TO_PIXELS=cc.IS_RETINA_DISPLAY_SUPPORTED?function(e){return cc.rect(e.origin.x*cc.CONTENT_SCALE_FACTOR(),e.origin.y*cc.CONTENT_SCALE_FACTOR(),e.size.width*cc.CONTENT_SCALE_FACTOR(),e.size.height*cc.CONTENT_SCALE_FACTOR())}:function(e){return e};if(!cc.Browser.supportWebGL){var gl=gl||{};gl.ONE=1,gl.ZERO=0,gl.SRC_ALPHA=770,gl.ONE_MINUS_SRC_ALPHA=771,gl.ONE_MINUS_DST_COLOR=775}cc.CHECK_GL_ERROR_DEBUG=function(){var e=cc.renderContext.getError();e&&cc.log("WebGL error "+e)};cc.SAX_NONE=0,cc.SAX_KEY=1,cc.SAX_DICT=2,cc.SAX_INT=3,cc.SAX_REAL=4,cc.SAX_STRING=5,cc.SAX_ARRAY=6;var Uint8Array=Uint8Array||Array;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var IEBinaryToArray_ByteStr_Script='<!-- IEBinaryToArray_ByteStr -->\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = ""\r\n   End If\r\nEnd Function\r\n',myVBScript=document.createElement("script");myVBScript.type="text/vbscript",myVBScript.textContent=IEBinaryToArray_ByteStr_Script,document.body.appendChild(myVBScript),cc._convertResponseBodyToText=function(e){var t={};for(var n=0;n<256;n++)for(var r=0;r<256;r++)t[String.fromCharCode(n+r*256)]=String.fromCharCode(n)+String.fromCharCode(r);var i=IEBinaryToArray_ByteStr(e),s=IEBinaryToArray_ByteStr_Last(e);return i.replace(/[\s\S]/g,function(e){return t[e]})+s}}cc.FileUtils=cc.Class.extend({_fileDataCache:null,_textFileCache:null,_directory:null,_filenameLookupDict:null,_searchResolutionsOrderArray:null,_searchPathArray:null,ctor:function(){this._fileDataCache={},this._textFileCache={},this._searchPathArray=[],this._searchPathArray.push(""),this._searchResolutionsOrderArray=[],this._searchResolutionsOrderArray.push("")},getByteArrayFromFile:function(e,t,n){return this._fileDataCache.hasOwnProperty(e)?this._fileDataCache[e]:this._loadBinaryFileData(e)},_getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},unloadBinaryFileData:function(e){this._fileDataCache.hasOwnProperty(e)&&delete this._fileDataCache[e]},preloadBinaryFileData:function(e){e=this.fullPathFromRelativePath(e);var t=this,n=this._getXMLHttpRequest();n.open("GET",e,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(n.setRequestHeader("Accept-Charset","x-user-defined"),n.onreadystatechange=function(r){if(n.readyState==4){if(n.status==200){var i=cc._convertResponseBodyToText(n.responseBody);i&&(t._fileDataCache[e]=t._stringConvertToArray(i))}cc.Loader.getInstance().onResLoaded()}}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(r){var i=n.responseText;i&&(cc.Loader.getInstance().onResLoaded(),t._fileDataCache[e]=t._stringConvertToArray(i))}),n.send(null)},_loadBinaryFileData:function(e){var t=this._getXMLHttpRequest();t.open("GET",e,!1);var n=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){t.setRequestHeader("Accept-Charset","x-user-defined"),t.send(null);if(t.status!=200)return null;var r=cc._convertResponseBodyToText(t.responseBody);r&&(n=this._stringConvertToArray(r),this._fileDataCache[e]=n)}else{t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),t.send(null);if(t.status!=200)return null;n=this._stringConvertToArray(t.responseText),this._fileDataCache[e]=n}return n},_stringConvertToArray:function(e){if(!e)return null;var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t},unloadTextFileData:function(e){this._textFileCache.hasOwnProperty(e)&&delete this._textFileCache[e]},preloadTextFileData:function(e){e=this.fullPathFromRelativePath(e);var t=this,n=this._getXMLHttpRequest();n.open("GET",e,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(n.setRequestHeader("Accept-Charset","x-user-defined"),n.onreadystatechange=function(r){if(n.readyState==4){if(n.status==200){var i=cc._convertResponseBodyToText(n.responseBody);i&&(t._textFileCache[e]=i)}cc.Loader.getInstance().onResLoaded()}}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(r){n.responseText&&(cc.Loader.getInstance().onResLoaded(),t._fileDataCache[e]=n.responseText)}),n.send(null)},_loadTextFileData:function(e){var t=this._getXMLHttpRequest();t.open("GET",e,!1);var n=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){t.setRequestHeader("Accept-Charset","x-user-defined"),t.send(null);if(t.status!=200)return null;var r=cc._convertResponseBodyToText(t.responseBody);r&&(n=r,this._textFileCache[e]=r)}else{t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),t.send(null);if(t.status!=200)return null;n=t.responseText,this._textFileCache[e]=n}return n},getTextFileData:function(e){return this._textFileCache.hasOwnProperty(e)?this._textFileCache[e]:this._loadTextFileData(e)},getFileDataFromZip:function(e,t,n){},removeSuffixFromFile:function(e){},popupNotify:!0,fullPathFromRelativePath:function(e){return e},fullPathForFilename:function(e){var t=!1,n=this._getNewFilename(e),r;if(n&&n.length>1&&n.indexOf(":")==1)return n;for(var i=0;i<this._searchPathArray.length;i++){var s=this._searchPathArray[i];for(var o=0;o<this._searchResolutionsOrderArray.length;o++){var u=this._searchResolutionsOrderArray[o];r=this._getPathForFilename(n,u,s);if(r){t=!0;break}}if(t)break}return t?r:n},loadFilenameLookup:function(e){var t=this.fullPathForFilename(e);if(t.length>0){var n=cc.SAXParser.getInstance().parse(t),r=n.metadata,i=parseInt(r.version);if(i!=1){cc.log("cocos2d: ERROR: Invalid filenameLookup dictionary version: "+i+". Filename: "+e);return}this.setFilenameLookupDictionary(n.filenames)}},setFilenameLookupDictionary:function(e){this._filenameLookupDict=e},fullPathFromRelativeFile:function(e,t){var n;return e?(n=t.substring(0,t.lastIndexOf("/")+1),n+e):(n=t.substring(0,t.lastIndexOf(".")),n+=".png",n)},setSearchResolutionsOrder:function(e){this._searchResolutionsOrderArray=e},getSearchResolutionsOrder:function(){return this._searchResolutionsOrderArray},setSearchPath:function(e){this._searchPathArray=e},getSearchPath:function(){return this._searchPathArray},getResourceDirectory:function(){return this._directory},setResourcePath:function(e){},dictionaryWithContentsOfFile:function(e){var t=cc.SAXParser.getInstance();return this.rootDict=t.parse(e),this.rootDict},getStringFromFile:function(e){return cc.SAXParser.getInstance().getList(e)},dictionaryWithContentsOfFileThreadSafe:function(e){var t=new cc.DictMaker;return t.dictionaryWithContentsOfFile(e)},getWriteablePath:function(){return""},setPopupNotify:function(e){cc.popupNotify=e},isPopupNotify:function(){return cc.popupNotify},_resourceRootPath:"",getResourceRootPath:function(){return this._resourceRootPath},setResourceRootPath:function(e){this._resourceRootPath=e},_getNewFilename:function(e){var t=null,n=this._filenameLookupDict?this._filenameLookupDict[e]:null;return!n||n.length===0?t=e:(t=n,cc.log("FOUND NEW FILE NAME: "+t)),t},_getPathForFilename:function(e,t,n){var r,i=this.getResourceRootPath();e&&e.length>0&&(e.indexOf("/")===0||e.indexOf("\\")===0)?r="":i.length>0?(r=i,r[r.length-1]!="\\"&&r[r.length-1]!="/"&&(r+="/")):r=i;var s=e,o="",u=e.lastIndexOf("/");u!=-1&&(o=e.substr(0,u+1),s=e.substr(u+1));var a=n;return a.length>0&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),a+=o,a+=t,a.length>0&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),a+=s,r+=a,r}}),cc.s_SharedFileUtils=null,cc.FileUtils.getInstance=function(){return cc.s_SharedFileUtils==null&&(cc.s_SharedFileUtils=new cc.FileUtils),cc.s_SharedFileUtils},cc.DictMaker=cc.Class.extend({rootDict:[],dictionaryWithContentsOfFile:function(e){var t=cc.SAXParser.getInstance();return this.rootDict=t.parse(e),this.rootDict}});cc.Color3B=function(e,t,n){switch(arguments.length){case 0:this.r=0,this.g=0,this.b=0;break;case 1:e&&e instanceof cc.Color3B?(this.r=0|e.r||0,this.g=0|e.g||0,this.b=0|e.b||0):(this.r=0,this.g=0,this.b=0);break;case 3:this.r=0|e||0,this.g=0|t||0,this.b=0|n||0;break;default:throw"unknown argument type"}},cc.c3b=function(e,t,n){return new cc.Color3B(e,t,n)},cc.integerToColor3B=function(e){e=e||0;var t=255,n=new cc.Color3B;return n.r=e&t,n.g=e>>8&t,n.b=e>>16&t,n},cc.c3=cc.c3b,Object.defineProperties(cc,{WHITE:{get:function(){return cc.c3b(255,255,255)}},YELLOW:{get:function(){return cc.c3b(255,255,0)}},BLUE:{get:function(){return cc.c3b(0,0,255)}},GREEN:{get:function(){return cc.c3b(0,255,0)}},RED:{get:function(){return cc.c3b(255,0,0)}},MAGENTA:{get:function(){return cc.c3b(255,0,255)}},BLACK:{get:function(){return cc.c3b(0,0,0)}},ORANGE:{get:function(){return cc.c3b(255,127,0)}},GRAY:{get:function(){return cc.c3b(166,166,166)}}}),cc.white=function(){return new cc.Color3B(255,255,255)},cc.yellow=function(){return new cc.Color3B(255,255,0)},cc.blue=function(){return new cc.Color3B(0,0,255)},cc.green=function(){return new cc.Color3B(0,255,0)},cc.red=function(){return new cc.Color3B(255,0,0)},cc.magenta=function(){return new cc.Color3B(255,0,255)},cc.black=function(){return new cc.Color3B(0,0,0)},cc.orange=function(){return new cc.Color3B(255,127,0)},cc.gray=function(){return new cc.Color3B(166,166,166)},cc.Color4B=function(e,t,n,r){this.r=0|e,this.g=0|t,this.b=0|n,this.a=0|r},cc.c4b=function(e,t,n,r){return new cc.Color4B(e,t,n,r)},cc.c4=cc.c4b,cc.Color4F=function(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r},cc.c4f=function(e,t,n,r){return new cc.Color4F(e,t,n,r)},cc.c4FFromccc3B=function(e){return new cc.Color4F(e.r/255,e.g/255,e.b/255,1)},cc.c4FFromccc4B=function(e){return new cc.Color4F(e.r/255,e.g/255,e.b/255,e.a/255)},cc.c4BFromccc4F=function(e){return new cc.Color4B(0|e.r*255,0|e.g*255,0|e.b*255,0|e.a*255)},cc.c4FEqual=function(e,t){return e.r==t.r&&e.g==t.g&&e.b==t.b&&e.a==t.a},cc.Vertex2F=function(e,t){this.x=e||0,this.y=t||0},cc.Vertex2=function(e,t){return new cc.Vertex2F(e,t)},cc.Vertex3F=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},cc.vertex3=function(e,t,n){return new cc.Vertex3F(e,t,n)},cc.Tex2F=function(e,t){this.u=e||0,this.v=t||0},cc.tex2=function(e,t){return new cc.Tex2F(e,t)},cc.PointSprite=function(e,t,n){this.pos=e||new cc.Vertex2F(0,0),this.color=t||new cc.Color4B(0,0,0,0),this.size=n||0},cc.Quad2=function(e,t,n,r){this.tl=e||new cc.Vertex2F(0,0),this.tr=t||new cc.Vertex2F(0,0),this.bl=n||new cc.Vertex2F(0,0),this.br=r||new cc.Vertex2F(0,0)},cc.Quad3=function(e,t,n,r){this.bl=e||new cc.Vertex3F(0,0,0),this.br=t||new cc.Vertex3F(0,0,0),this.tl=n||new cc.Vertex3F(0,0,0),this.tr=r||new cc.Vertex3F(0,0,0)},cc.GridSize=function(e,t){this.x=e,this.y=t},cc.g=function(e,t){return new cc.GridSize(e,t)},cc.V2F_C4B_T2F=function(e,t,n){this.vertices=e||new cc.Vertex2F(0,0),this.colors=t||new cc.Color4B(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V2F_C4F_T2F=function(e,t,n){this.vertices=e||new cc.Vertex2F(0,0),this.colors=t||new cc.Color4F(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V3F_C4B_T2F=function(e,t,n){this.vertices=e||new cc.Vertex3F(0,0,0),this.colors=t||new cc.Color4B(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V2F_C4B_T2F_Triangle=function(e,t,n){this.a=e||new cc.V2F_C4B_T2F,this.b=t||new cc.V2F_C4B_T2F,this.c=n||new cc.V2F_C4B_T2F},cc.V2F_C4B_T2F_Quad=function(e,t,n,r){this.bl=e||new cc.V2F_C4B_T2F,this.br=t||new cc.V2F_C4B_T2F,this.tl=n||new cc.V2F_C4B_T2F,this.tr=r||new cc.V2F_C4B_T2F},cc.V2F_C4B_T2F_QuadZero=function(){return new cc.V2F_C4B_T2F_Quad(new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)))},cc.V3F_C4B_T2F_Quad=function(e,t,n,r){this.tl=e||new cc.V3F_C4B_T2F,this.bl=t||new cc.V3F_C4B_T2F,this.tr=n||new cc.V3F_C4B_T2F,this.br=r||new cc.V3F_C4B_T2F},cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad(new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)))},cc.V3F_C4B_T2F_QuadCopy=function(e){return e?new cc.V3F_C4B_T2F_Quad(new cc.V3F_C4B_T2F(new cc.Vertex3F(e.tl.vertices.x,e.tl.vertices.y,e.tl.vertices.z),new cc.Color4B(e.tl.colors.r,e.tl.colors.g,e.tl.colors.b,e.tl.colors.a),new cc.Tex2F(e.tl.texCoords.u,e.tl.texCoords.v)),new cc.V3F_C4B_T2F(new cc.Vertex3F(e.bl.vertices.x,e.bl.vertices.y,e.bl.vertices.z),new cc.Color4B(e.bl.colors.r,e.bl.colors.g,e.bl.colors.b,e.bl.colors.a),new cc.Tex2F(e.bl.texCoords.u,e.bl.texCoords.v)),new cc.V3F_C4B_T2F(new cc.Vertex3F(e.tr.vertices.x,e.tr.vertices.y,e.tr.vertices.z),new cc.Color4B(e.tr.colors.r,e.tr.colors.g,e.tr.colors.b,e.tr.colors.a),new cc.Tex2F(e.tr.texCoords.u,e.tr.texCoords.v)),new cc.V3F_C4B_T2F(new cc.Vertex3F(e.br.vertices.x,e.br.vertices.y,e.br.vertices.z),new cc.Color4B(e.br.colors.r,e.br.colors.g,e.br.colors.b,e.br.colors.a),new cc.Tex2F(e.br.texCoords.u,e.br.texCoords.v))):cc.V3F_C4B_T2F_QuadZero()},cc.V3F_C4B_T2F_QuadsCopy=function(e){if(!e)return[];var t=[];for(var n=0;n<e.length;n++)t.push(cc.V3F_C4B_T2F_QuadCopy(e[n]));return t},cc.V2F_C4F_T2F_Quad=function(e,t,n,r){this.bl=e||new cc.V2F_C4F_T2F,this.br=t||new cc.V2F_C4F_T2F,this.tl=n||new cc.V2F_C4F_T2F,this.tr=r||new cc.V2F_C4F_T2F},cc.BlendFunc=function(e,t){this.src=e,this.dst=t},cc.BlendFuncDisable=function(){return new cc.BlendFunc(gl.ONE,gl.ZERO)},cc.convertColor3BtoHexString=function(e){var t=e.r.toString(16),n=e.g.toString(16),r=e.b.toString(16),i="#"+(e.r<16?"0"+t:t)+(e.g<16?"0"+n:n)+(e.b<16?"0"+r:r);return i},cc.Browser.supportWebGL&&(cc.Color4B=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.Color4B.BYTES_PER_ELEMENT),this._offset=s||0,this._rU8=new Uint8Array(this._arrayBuffer,this._offset,1),this._gU8=new Uint8Array(this._arrayBuffer,this._offset+Uint8Array.BYTES_PER_ELEMENT,1),this._bU8=new Uint8Array(this._arrayBuffer,this._offset+Uint8Array.BYTES_PER_ELEMENT*2,1),this._aU8=new Uint8Array(this._arrayBuffer,this._offset+Uint8Array.BYTES_PER_ELEMENT*3,1),this._rU8[0]=e||0,this._gU8[0]=t||0,this._bU8[0]=n||0,this._aU8[0]=r||0},cc.Color4B.BYTES_PER_ELEMENT=4,Object.defineProperties(cc.Color4B.prototype,{r:{get:function(){return this._rU8[0]},set:function(e){this._rU8[0]=e},enumerable:!0},g:{get:function(){return this._gU8[0]},set:function(e){this._gU8[0]=e},enumerable:!0},b:{get:function(){return this._bU8[0]},set:function(e){this._bU8[0]=e},enumerable:!0},a:{get:function(){return this._aU8[0]},set:function(e){this._aU8[0]=e},enumerable:!0}}),cc.Color4F=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.Color4F.BYTES_PER_ELEMENT),this._offset=s||0,this._rF32=new Float32Array(this._arrayBuffer,this._offset,1),this._rF32[0]=e||0,this._gF32=new Float32Array(this._arrayBuffer,this._offset+Float32Array.BYTES_PER_ELEMENT,1),this._gF32[0]=t||0,this._bF32=new Float32Array(this._arrayBuffer,this._offset+Float32Array.BYTES_PER_ELEMENT*2,1),this._bF32[0]=n||0,this._aF32=new Float32Array(this._arrayBuffer,this._offset+Float32Array.BYTES_PER_ELEMENT*3,1),this._aF32[0]=r||0},cc.Color4F.BYTES_PER_ELEMENT=16,Object.defineProperties(cc.Color4F.prototype,{r:{get:function(){return this._rF32[0]},set:function(e){this._rF32[0]=e},enumerable:!0},g:{get:function(){return this._gF32[0]},set:function(e){this._gF32[0]=e},enumerable:!0},b:{get:function(){return this._bF32[0]},set:function(e){this._bF32[0]=e},enumerable:!0},a:{get:function(){return this._aF32[0]},set:function(e){this._aF32[0]=e},enumerable:!0}}),cc.Vertex2F=function(e,t,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=r||0,this._xF32=new Float32Array(this._arrayBuffer,this._offset,1),this._yF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._xF32[0]=e||0,this._yF32[0]=t||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,Object.defineProperties(cc.Vertex2F.prototype,{x:{get:function(){return this._xF32[0]},set:function(e){this._xF32[0]=e},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(e){this._yF32[0]=e},enumerable:!0}}),cc.Vertex3F=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=i||0,this._xF32=new Float32Array(this._arrayBuffer,this._offset,1),this._xF32[0]=e||0,this._yF32=new Float32Array(this._arrayBuffer,this._offset+Float32Array.BYTES_PER_ELEMENT,1),this._yF32[0]=t||0,this._zF32=new Float32Array(this._arrayBuffer,this._offset+Float32Array.BYTES_PER_ELEMENT*2,1),this._zF32[0]=n||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,Object.defineProperties(cc.Vertex3F.prototype,{x:{get:function(){return this._xF32[0]},set:function(e){this._xF32[0]=e},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(e){this._yF32[0]=e},enumerable:!0},z:{get:function(){return this._zF32[0]},set:function(e){this._zF32[0]=e},enumerable:!0}}),cc.Tex2F=function(e,t,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=r||0,this._uF32=new Float32Array(this._arrayBuffer,this._offset,1),this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._uF32[0]=e||0,this._vF32[0]=t||0},cc.Tex2F.BYTES_PER_ELEMENT=8,Object.defineProperties(cc.Tex2F.prototype,{u:{get:function(){return this._uF32[0]},set:function(e){this._uF32[0]=e},enumerable:!0},v:{get:function(){return this._vF32[0]},set:function(e){this._vF32[0]=e},enumerable:!0}}),cc.Quad2=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=s||0,this._tl=e?new cc.Vertex2F(e.x,e.y,this._arrayBuffer,0):new cc.Vertex2F(0,0,this._arrayBuffer,0),this._tr=t?new cc.Vertex2F(t.x,t.y,this._arrayBuffer,cc.Vertex2F.BYTES_PER_ELEMENT):new cc.Vertex2F(0,0,this._arrayBuffer,cc.Vertex2F.BYTES_PER_ELEMENT),this._bl=n?new cc.Vertex2F(n.x,n.y,this._arrayBuffer,cc.Vertex2F.BYTES_PER_ELEMENT*2):new cc.Vertex2F(0,0,this._arrayBuffer,cc.Vertex2F.BYTES_PER_ELEMENT*2),this._br=r?new cc.Vertex2F(r.x,r.y,this._arrayBuffer,cc.Vertex2F.BYTES_PER_ELEMENT*3):new cc.Vertex2F(0,0,this._arrayBuffer,cc.Vertex2F.BYTES_PER_ELEMENT*3)},cc.Quad2.BYTES_PER_ELEMENT=32,Object.defineProperties(cc.Quad2.prototype,{tl:{get:function(){return this._tl},set:function(e){this._tl.x=e.x,this._tl.y=e.y},enumerable:!0},tr:{get:function(){return this._tr},set:function(e){this._tr.x=e.x,this._tr.y=e.y},enumerable:!0},bl:{get:function(){return this._bl},set:function(e){this._bl.x=e.x,this._bl.y=e.y},enumerable:!0},br:{get:function(){return this._br},set:function(e){this._br.x=e.x,this._br.y=e.y},enumerable:!0}}),cc.V3F_C4B_T2F=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=i||0,this._vertices=e?new cc.Vertex3F(e.x,e.y,e.z,this._arrayBuffer,this._offset):new cc.Vertex3F(0,0,0,this._arrayBuffer,this._offset),this._colors=t?new cc.Color4B(t.r,t.g,t.b,t.a,this._arrayBuffer,this._offset+cc.Vertex3F.BYTES_PER_ELEMENT):new cc.Color4B(0,0,0,0,this._arrayBuffer,this._offset+cc.Vertex3F.BYTES_PER_ELEMENT),this._texCoords=n?new cc.Tex2F(n.u,n.v,this._arrayBuffer,this._offset+cc.Vertex3F.BYTES_PER_ELEMENT+cc.Color4B.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,this._arrayBuffer,this._offset+cc.Vertex3F.BYTES_PER_ELEMENT+cc.Color4B.BYTES_PER_ELEMENT)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,Object.defineProperties(cc.V3F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(e){this._vertices.x=e.x,this._vertices.y=e.y,this._vertices.z=e.z},enumerable:!0},colors:{get:function(){return this._colors},set:function(e){this._colors.r=e.r,this._colors.g=e.g,this._colors.b=e.b,this._colors.a=e.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(e){this._texCoords.u=e.u,this._texCoords.v=e.v},enumerable:!0}}),cc.V3F_C4B_T2F_Quad=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=s||0,this._tl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,this._arrayBuffer,this._offset):new cc.V3F_C4B_T2F(null,null,null,this._arrayBuffer,this._offset),this._bl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,this._arrayBuffer,this._offset+cc.V3F_C4B_T2F.BYTES_PER_ELEMENT):new cc.V3F_C4B_T2F(null,null,null,this._arrayBuffer,this._offset+cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._tr=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,this._arrayBuffer,this._offset+cc.V3F_C4B_T2F.BYTES_PER_ELEMENT*2):new cc.V3F_C4B_T2F(null,null,null,this._arrayBuffer,this._offset+cc.V3F_C4B_T2F.BYTES_PER_ELEMENT*2),this._br=r?new cc.V3F_C4B_T2F(r.vertices,r.colors,r.texCoords,this._arrayBuffer,this._offset+cc.V3F_C4B_T2F.BYTES_PER_ELEMENT*3):new cc.V3F_C4B_T2F(null,null,null,this._arrayBuffer,this._offset+cc.V3F_C4B_T2F.BYTES_PER_ELEMENT*3)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,Object.defineProperties(cc.V3F_C4B_T2F_Quad.prototype,{tl:{get:function(){return this._tl},set:function(e){this._tl.vertices=e.vertices,this._tl.colors=e.colors,this._tl.texCoords=e.texCoords},enumerable:!0},bl:{get:function(){return this._bl},set:function(e){this._bl.vertices=e.vertices,this._bl.colors=e.colors,this._bl.texCoords=e.texCoords},enumerable:!0},tr:{get:function(){return this._tr},set:function(e){this._tr.vertices=e.vertices,this._tr.colors=e.colors,this._tr.texCoords=e.texCoords},enumerable:!0},br:{get:function(){return this._br},set:function(e){this._br.vertices=e.vertices,this._br.colors=e.colors,this._br.texCoords=e.texCoords},enumerable:!0},arrayBuffer:{get:function(){return this._arrayBuffer},enumerable:!0}}),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V2F_C4B_T2F=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=i||0,this._vertices=e?new cc.Vertex2F(e.x,e.y,this._arrayBuffer,this._offset):new cc.Vertex2F(0,0,this._arrayBuffer,this._offset),this._colors=t?new cc.Color4B(t.r,t.g,t.b,t.a,this._arrayBuffer,this._offset+cc.Vertex2F.BYTES_PER_ELEMENT):new cc.Color4B(0,0,0,0,this._arrayBuffer,this._offset+cc.Vertex2F.BYTES_PER_ELEMENT),this._texCoords=n?new cc.Tex2F(n.u,n.v,this._arrayBuffer,this._offset+cc.Vertex2F.BYTES_PER_ELEMENT+cc.Color4B.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,this._arrayBuffer,this._offset+cc.Vertex2F.BYTES_PER_ELEMENT+cc.Color4B.BYTES_PER_ELEMENT)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,Object.defineProperties(cc.V2F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(e){this._vertices.x=e.x,this._vertices.y=e.y},enumerable:!0},colors:{get:function(){return this._colors},set:function(e){this._colors.r=e.r,this._colors.g=e.g,this._colors.b=e.b,this._colors.a=e.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(e){this._texCoords.u=e.u,this._texCoords.v=e.v},enumerable:!0}}),cc.V2F_C4B_T2F_Triangle=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=i||0,this._a=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,this._arrayBuffer,this._offset):new cc.V2F_C4B_T2F(null,null,null,this._arrayBuffer,this._offset),this._b=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,this._arrayBuffer,this._offset+cc.V2F_C4B_T2F.BYTES_PER_ELEMENT):new cc.V2F_C4B_T2F(null,null,null,this._arrayBuffer,this._offset+cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._c=n?new cc.V2F_C4B_T2F(n.vertices,n.colors,n.texCoords,this._arrayBuffer,this._offset+cc.V2F_C4B_T2F.BYTES_PER_ELEMENT*2):new cc.V2F_C4B_T2F(null,null,null,this._arrayBuffer,this._offset+cc.V2F_C4B_T2F.BYTES_PER_ELEMENT*2)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,Object.defineProperties(cc.V2F_C4B_T2F_Triangle.prototype,{a:{get:function(){return this._a},set:function(e){this._a.vertices=e.vertices,this._a.colors=e.colors,this._a.texCoords=e.texCoords},enumerable:!0},b:{get:function(){return this._b},set:function(e){this._b.vertices=e.vertices,this._b.colors=e.colors,this._b.texCoords=e.texCoords},enumerable:!0},c:{get:function(){return this._c},set:function(e){this._c.vertices=e.vertices,this._c.colors=e.colors,this._c.texCoords=e.texCoords},enumerable:!0}})),cc.convertHexNumToColor3B=function(e){var t=e.substr(1).split(""),n=parseInt("0x"+t[0]+t[1]),r=parseInt("0x"+t[2]+t[3]),i=parseInt("0x"+t[4]+t[5]);return new cc.Color3B(n,r,i)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|Math.random()*10)},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(e,t){if(t==null)return;var n=this.__getKey();this._keyMapTb[n]=t,this._valueMapTb[n]=e},objectForKey:function(e){if(e==null)return null;for(var t in this._keyMapTb)if(this._keyMapTb[t]===e)return this._valueMapTb[t];return null},valueForKey:function(e){return this.objectForKey(e)},removeObjectForKey:function(e){if(e==null)return;for(var t in this._keyMapTb)if(this._keyMapTb[t]===e){delete this._valueMapTb[t],delete this._keyMapTb[t];return}},removeObjectsForKeys:function(e){if(e==null)return;for(var t=0;t<e.length;t++)this.removeObjectForKey(e[t])},allKeys:function(){var e=[];for(var t in this._keyMapTb)e.push(this._keyMapTb[t]);return e},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}});cc.UIInterfaceOrientationLandscapeLeft=-90,cc.UIInterfaceOrientationLandscapeRight=90,cc.UIInterfaceOrientationPortraitUpsideDown=180,cc.UIInterfaceOrientationPortrait=0,cc.Acceleration=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.timestamp=r||0},cc.Accelerometer=cc.Class.extend({setDelegate:function(e){cc.AccelerometerDispatcher.getInstance().addDelegate(e)},setAccelerometerInterval:function(e){cc.AccelerometerDispatcher.getInstance().setAccelerometerInterval(e)}}),cc.AccelerometerDispatcher=cc.Class.extend({_delegate:null,_acceleration:null,_deviceEvent:null,_interval:.1,_minus:1,init:function(){this._acceleration=new cc.Acceleration,this._deviceEvent=window.DeviceMotionEvent||window.DeviceOrientationEvent;var e=navigator.userAgent;return/Android/.test(e)&&(this._minus=-1),!0},getDelegate:function(){return this._delegate},addDelegate:function(e){this._delegate=e;var t=this.didAccelerate.bind(this);this._delegate?this._deviceEvent==window.DeviceMotionEvent?window.addEventListener("devicemotion",t,!1):window.addEventListener("deviceorientation",t,!1):this._deviceEvent==window.DeviceMotionEvent?window.removeEventListener("devicemotion",t):window.removeEventListener("deviceorientation",t)},setAccelerometerInterval:function(e){this._interval!==e&&(this._interval=e)},didAccelerate:function(e){if(!this._delegate)return;if(this._deviceEvent==window.DeviceMotionEvent){var t=e.accelerationIncludingGravity;this._acceleration.x=this._minus*t.x*.1,this._acceleration.y=this._minus*t.y*.1,this._acceleration.z=t.z*.1}else this._acceleration.x=e.gamma/90*.981,this._acceleration.y=-(e.beta/90)*.981,this._acceleration.z=e.alpha/90*.981;this._acceleration.timestamp=(new Date).getTime();var n=this._acceleration.x;switch(window.orientation){case cc.UIInterfaceOrientationLandscapeRight:this._acceleration.x=-this._acceleration.y,this._acceleration.y=n;break;case cc.UIInterfaceOrientationLandscapeLeft:this._acceleration.x=this._acceleration.y,this._acceleration.y=-n;break;case cc.UIInterfaceOrientationPortraitUpsideDown:this._acceleration.x=-this._acceleration.x,this._acceleration.y=-this._acceleration.y;break;case cc.UIInterfaceOrientationPortrait:}this._delegate.onAccelerometer(this._acceleration)}}),cc.AccelerometerDispatcher.getInstance=function(){return this._instance||(this._instance=new cc.AccelerometerDispatcher,this._instance.init()),this._instance};(function(){"use strict";function e(e){throw e}function i(e,n){var i=e.split("."),s=r;!(i[0]in s)&&s.execScript&&s.execScript("var "+i[0]);for(var o;i.length&&(o=i.shift());)!i.length&&n!==t?s[o]=n:s=s[o]?s[o]:s[o]={}}function o(e){if("string"==typeof e){var t=e.split(""),n,r;n=0;for(r=t.length;n<r;n++)t[n]=(t[n].charCodeAt(0)&255)>>>0;e=t}for(var i=1,s=0,o=e.length,u,a=0;0<o;){u=1024<o?1024:o,o-=u;do i+=e[a++],s+=i;while(--u);i%=65521,s%=65521}return(s<<16|i)>>>0}function u(t,n){this.index="number"==typeof n?n:0,this.i=0,this.buffer=t instanceof(s?Uint8Array:Array)?t:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function v(e){this.buffer=new(s?Uint16Array:Array)(2*e),this.length=0}function m(e){var t=e.length,n=0,r=Number.POSITIVE_INFINITY,i,o,u,a,f,l,c,h,p;for(h=0;h<t;++h)e[h]>n&&(n=e[h]),e[h]<r&&(r=e[h]);i=1<<n,o=new(s?Uint32Array:Array)(i),u=1,a=0;for(f=2;u<=n;){for(h=0;h<t;++h)if(e[h]===u){l=0,c=a;for(p=0;p<u;++p)l=l<<1|c&1,c>>=1;for(p=l;p<i;p+=f)o[p]=u<<16|h;++a}++u,a<<=1,f<<=1}return[o,n,r]}function g(e,t){this.h=y,this.w=0,this.input=e,this.b=0,t&&(t.lazy&&(this.w=t.lazy),"number"==typeof t.compressionType&&(this.h=t.compressionType),t.outputBuffer&&(this.a=s&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.b=t.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}function S(e,t){this.length=e,this.G=t}function x(){var t=N;switch(n){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}function L(r,i){function o(t,r){var i=t.G,s=[],o=0,u;u=k[t.length],s[o++]=u&65535,s[o++]=u>>16&255,s[o++]=u>>24;var a;switch(n){case 1===i:a=[0,i-1,0];break;case 2===i:a=[1,i-2,0];break;case 3===i:a=[2,i-3,0];break;case 4===i:a=[3,i-4,0];break;case 6>=i:a=[4,i-5,1];break;case 8>=i:a=[5,i-7,1];break;case 12>=i:a=[6,i-9,2];break;case 16>=i:a=[7,i-13,2];break;case 24>=i:a=[8,i-17,3];break;case 32>=i:a=[9,i-25,3];break;case 48>=i:a=[10,i-33,4];break;case 64>=i:a=[11,i-49,4];break;case 96>=i:a=[12,i-65,5];break;case 128>=i:a=[13,i-97,5];break;case 192>=i:a=[14,i-129,6];break;case 256>=i:a=[15,i-193,6];break;case 384>=i:a=[16,i-257,7];break;case 512>=i:a=[17,i-385,7];break;case 768>=i:a=[18,i-513,8];break;case 1024>=i:a=[19,i-769,8];break;case 1536>=i:a=[20,i-1025,9];break;case 2048>=i:a=[21,i-1537,9];break;case 3072>=i:a=[22,i-2049,10];break;case 4096>=i:a=[23,i-3073,10];break;case 6144>=i:a=[24,i-4097,11];break;case 8192>=i:a=[25,i-6145,11];break;case 12288>=i:a=[26,i-8193,12];break;case 16384>=i:a=[27,i-12289,12];break;case 24576>=i:a=[28,i-16385,13];break;case 32768>=i:a=[29,i-24577,13];break;default:e("invalid distance")}u=a,s[o++]=u[0],s[o++]=u[1],s[o++]=u[2];var f,l;f=0;for(l=s.length;f<l;++f)m[g++]=s[f];b[s[0]]++,w[s[3]]++,y=t.length+r-1,v=null}var u,a,f,l,c,h={},p,d,v,m=s?new Uint16Array(2*i.length):[],g=0,y=0,b=new(s?Uint32Array:Array)(286),w=new(s?Uint32Array:Array)(30),E=r.w,x;if(!s){for(f=0;285>=f;)b[f++]=0;for(f=0;29>=f;)w[f++]=0}b[256]=1,u=0;for(a=i.length;u<a;++u){f=c=0;for(l=3;f<l&&u+f!==a;++f)c=c<<8|i[u+f];h[c]===t&&(h[c]=[]),p=h[c];if(!(0<y--)){for(;0<p.length&&32768<u-p[0];)p.shift();if(u+3>=a){v&&o(v,-1),f=0;for(l=a-u;f<l;++f)x=i[u+f],m[g++]=x,++b[x];break}if(0<p.length){var T=t,N=t,C=0,L=t,A=t,O=t,M=t,_=i.length,A=0,M=p.length;e:for(;A<M;A++){T=p[M-A-1],L=3;if(3<C){for(O=C;3<O;O--)if(i[T+O-1]!==i[u+O-1])continue e;L=C}for(;258>L&&u+L<_&&i[T+L]===i[u+L];)++L;L>C&&(N=T,C=L);if(258===L)break}d=new S(C,u-N),v?v.length<d.length?(x=i[u-1],m[g++]=x,++b[x],o(d,0)):o(v,-1):d.length<E?v=d:o(d,0)}else v?o(v,-1):(x=i[u],m[g++]=x,++b[x])}p.push(u)}return m[g++]=256,b[256]++,r.L=b,r.K=w,s?m.subarray(0,g):m}function A(e,t){function n(e){var t=y[e][b[e]];t===h?(n(e+1),n(e+1)):--m[t],++b[e]}var r=e.length,i=new v(572),o=new(s?Uint8Array:Array)(r),u,a,f,l,c;if(!s)for(l=0;l<r;l++)o[l]=0;for(l=0;l<r;++l)0<e[l]&&i.push(l,e[l]);u=Array(i.length/2),a=new(s?Uint32Array:Array)(i.length/2);if(1===u.length)return o[i.pop().index]=1,o;l=0;for(c=i.length/2;l<c;++l)u[l]=i.pop(),a[l]=u[l].value;var h=a.length,p=new(s?Uint16Array:Array)(t),d=new(s?Uint8Array:Array)(t),m=new(s?Uint8Array:Array)(h),g=Array(t),y=Array(t),b=Array(t),w=(1<<t)-h,E=1<<t-1,S,x,T,N,C;p[t-1]=h;for(x=0;x<t;++x)w<E?d[x]=0:(d[x]=1,w-=E),w<<=1,p[t-2-x]=(p[t-1-x]/2|0)+h;p[0]=d[0],g[0]=Array(p[0]),y[0]=Array(p[0]);for(x=1;x<t;++x)p[x]>2*p[x-1]+d[x]&&(p[x]=2*p[x-1]+d[x]),g[x]=Array(p[x]),y[x]=Array(p[x]);for(S=0;S<h;++S)m[S]=t;for(T=0;T<p[t-1];++T)g[t-1][T]=a[T],y[t-1][T]=T;for(S=0;S<t;++S)b[S]=0;1===d[t-1]&&(--m[0],++b[t-1]);for(x=t-2;0<=x;--x){N=S=0,C=b[x+1];for(T=0;T<p[x];T++)N=g[x+1][C]+g[x+1][C+1],N>a[S]?(g[x][T]=N,y[x][T]=h,C+=2):(g[x][T]=a[S],y[x][T]=S,++S);b[x]=0,1===d[x]&&n(x)}f=m,l=0;for(c=u.length;l<c;++l)o[u[l].index]=f[l];return o}function O(t){var n=new(s?Uint16Array:Array)(t.length),r=[],i=[],o=0,u,a,f,l;u=0;for(a=t.length;u<a;u++)r[t[u]]=(r[t[u]]|0)+1;u=1;for(a=16;u<=a;u++)i[u]=o,o+=r[u]|0,o>1<<u&&e("overcommitted"),o<<=1;65536>o&&e("undercommitted"),u=0;for(a=t.length;u<a;u++){o=i[t[u]],i[t[u]]+=1,f=n[u]=0;for(l=t[u];f<l;f++)n[u]=n[u]<<1|o&1,o>>>=1}return n}function M(e,t){this.input=e,this.a=new(s?Uint8Array:Array)(32768),this.h=_.j;var n={},r;(t||!(t={}))&&"number"==typeof t.compressionType&&(this.h=t.compressionType);for(r in t)n[r]=t[r];n.outputBuffer=this.a,this.z=new g(this.input,n)}function D(t,n){this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(t):t,this.s=!1,this.m=H,this.B=!1;if(n||!(n={}))n.index&&(this.c=n.index),n.bufferSize&&(this.l=n.bufferSize),n.bufferType&&(this.m=n.bufferType),n.resize&&(this.B=n.resize);switch(this.m){case P:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.l+258);break;case H:this.b=0,this.a=new(s?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:e(Error("invalid inflate mode"))}}function tt(n,r){for(var i=n.g,s=n.e,o=n.input,u=n.c,a;s<r;)a=o[u++],a===t&&e(Error("input buffer is broken")),i|=a<<s,s+=8;return a=i&(1<<r)-1,n.g=i>>>r,n.e=s-r,n.c=u,a}function nt(n,r){for(var i=n.g,s=n.e,o=n.input,u=n.c,a=r[0],f=r[1],l,c,h;s<f;)l=o[u++],l===t&&e(Error("input buffer is broken")),i|=l<<s,s+=8;return c=a[i&(1<<f)-1],h=c>>>16,n.g=i>>h,n.e=s-h,n.c=u,c&65535}function rt(e){function t(e,t,n){var r,i,s,o;for(o=0;o<e;)switch(r=nt(this,t),r){case 16:for(s=3+tt(this,2);s--;)n[o++]=i;break;case 17:for(s=3+tt(this,3);s--;)n[o++]=0;i=0;break;case 18:for(s=11+tt(this,7);s--;)n[o++]=0;i=0;break;default:i=n[o++]=r}return n}var n=tt(e,5)+257,r=tt(e,5)+1,i=tt(e,4)+4,o=new(s?Uint8Array:Array)(F.length),u,a,f,l;for(l=0;l<i;++l)o[F[l]]=tt(e,3);u=m(o),a=new(s?Uint8Array:Array)(n),f=new(s?Uint8Array:Array)(r),e.o(m(t.call(e,n,u,a)),m(t.call(e,r,u,f)))}function it(t,n){var r,i;this.input=t,this.c=0;if(n||!(n={}))n.index&&(this.c=n.index),n.verify&&(this.M=n.verify);r=t[this.c++],i=t[this.c++];switch(r&15){case mt:this.method=mt;break;default:e(Error("unsupported compression method"))}0!==((r<<8)+i)%31&&e(Error("invalid fcheck flag:"+((r<<8)+i)%31)),i&32&&e(Error("fdict flag is not supported")),this.A=new D(t,{index:this.c,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}var t=void 0,n=!0,r=this,s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;u.prototype.f=function(){var e=this.buffer,t,n=e.length,r=new(s?Uint8Array:Array)(n<<1);if(s)r.set(e);else for(t=0;t<n;++t)r[t]=e[t];return this.buffer=r},u.prototype.d=function(e,t,n){var r=this.buffer,i=this.index,s=this.i,o=r[i],u;n&&1<t&&(e=8<t?(p[e&255]<<24|p[e>>>8&255]<<16|p[e>>>16&255]<<8|p[e>>>24&255])>>32-t:p[e]>>8-t);if(8>t+s)o=o<<t|e,s+=t;else for(u=0;u<t;++u)o=o<<1|e>>t-u-1&1,8===++s&&(s=0,r[i++]=p[o],o=0,i===r.length&&(r=this.f()));r[i]=o,this.buffer=r,this.i=s,this.index=i},u.prototype.finish=function(){var e=this.buffer,t=this.index,n;return 0<this.i&&(e[t]<<=8-this.i,e[t]=p[e[t]],t++),s?n=e.subarray(0,t):(e.length=t,n=e),n};var a=new(s?Uint8Array:Array)(256),f;for(f=0;256>f;++f){for(var l=f,c=l,h=7,l=l>>>1;l;l>>>=1)c<<=1,c|=l&1,--h;a[f]=(c<<h&255)>>>0}var p=a,d=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];s&&new Uint32Array(d),v.prototype.getParent=function(e){return 2*((e-2)/4|0)},v.prototype.push=function(e,t){var n,r,i=this.buffer,s;n=this.length,i[this.length++]=t;for(i[this.length++]=e;0<n;){if(r=this.getParent(n),!(i[n]>i[r]))break;s=i[n],i[n]=i[r],i[r]=s,s=i[n+1],i[n+1]=i[r+1],i[r+1]=s,n=r}return this.length},v.prototype.pop=function(){var e,t,n=this.buffer,r,i,s;t=n[0],e=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1];for(s=0;;){i=2*s+2;if(i>=this.length)break;i+2<this.length&&n[i+2]>n[i]&&(i+=2);if(!(n[i]>n[s]))break;r=n[s],n[s]=n[i],n[i]=r,r=n[s+1],n[s+1]=n[i+1],n[i+1]=r,s=i}return{index:e,value:t,length:this.length}};var y=2,b={NONE:0,r:1,j:y,N:3},w=[],E;for(E=0;288>E;E++)switch(n){case 143>=E:w.push([E+48,8]);break;case 255>=E:w.push([E-144+400,9]);break;case 279>=E:w.push([E-256+0,7]);break;case 287>=E:w.push([E-280+192,8]);break;default:e("invalid literal: "+E)}g.prototype.n=function(){var r,i,o,a,f=this.input;switch(this.h){case 0:o=0;for(a=f.length;o<a;){i=s?f.subarray(o,o+65535):f.slice(o,o+65535),o+=i.length;var l=i,c=o===a,h=t,p=t,d=t,v=t,m=t,g=this.a,b=this.b;if(s){for(g=new Uint8Array(this.a.buffer);g.length<=b+l.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}h=c?1:0,g[b++]=h|0,p=l.length,d=~p+65536&65535,g[b++]=p&255,g[b++]=p>>>8&255,g[b++]=d&255,g[b++]=d>>>8&255;if(s)g.set(l,b),b+=l.length,g=g.subarray(0,b);else{v=0;for(m=l.length;v<m;++v)g[b++]=l[v];g.length=b}this.b=b,this.a=g}break;case 1:var E=new u(new Uint8Array(this.a.buffer),this.b);E.d(1,1,n),E.d(1,2,n);var S=L(this,f),x,T,N;x=0;for(T=S.length;x<T;x++)if(N=S[x],u.prototype.d.apply(E,w[N]),256<N)E.d(S[++x],S[++x],n),E.d(S[++x],5),E.d(S[++x],S[++x],n);else if(256===N)break;this.a=E.finish(),this.b=this.a.length;break;case y:var C=new u(new Uint8Array(this.a),this.b),k,M,_,D,P,H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],B,j,F,I,q,R=Array(19),U,z,W,X,V;k=y,C.d(1,1,n),C.d(k,2,n),M=L(this,f),B=A(this.L,15),j=O(B),F=A(this.K,7),I=O(F);for(_=286;257<_&&0===B[_-1];_--);for(D=30;1<D&&0===F[D-1];D--);var $=_,J=D,K=new(s?Uint32Array:Array)($+J),Q,G,Y,Z,et=new(s?Uint32Array:Array)(316),tt,nt,rt=new(s?Uint8Array:Array)(19);for(Q=G=0;Q<$;Q++)K[G++]=B[Q];for(Q=0;Q<J;Q++)K[G++]=F[Q];if(!s){Q=0;for(Z=rt.length;Q<Z;++Q)rt[Q]=0}Q=tt=0;for(Z=K.length;Q<Z;Q+=G){for(G=1;Q+G<Z&&K[Q+G]===K[Q];++G);Y=G;if(0===K[Q])if(3>Y)for(;0<Y--;)et[tt++]=0,rt[0]++;else for(;0<Y;)nt=138>Y?Y:138,nt>Y-3&&nt<Y&&(nt=Y-3),10>=nt?(et[tt++]=17,et[tt++]=nt-3,rt[17]++):(et[tt++]=18,et[tt++]=nt-11,rt[18]++),Y-=nt;else if(et[tt++]=K[Q],rt[K[Q]]++,Y--,3>Y)for(;0<Y--;)et[tt++]=K[Q],rt[K[Q]]++;else for(;0<Y;)nt=6>Y?Y:6,nt>Y-3&&nt<Y&&(nt=Y-3),et[tt++]=16,et[tt++]=nt-3,rt[16]++,Y-=nt}r=s?et.subarray(0,tt):et.slice(0,tt),q=A(rt,7);for(X=0;19>X;X++)R[X]=q[H[X]];for(P=19;4<P&&0===R[P-1];P--);U=O(q),C.d(_-257,5,n),C.d(D-1,5,n),C.d(P-4,4,n);for(X=0;X<P;X++)C.d(R[X],3,n);X=0;for(V=r.length;X<V;X++)if(z=r[X],C.d(U[z],q[z],n),16<=z){X++;switch(z){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:e("invalid code: "+z)}C.d(r[X],W,n)}var it=[j,B],st=[I,F],ot,ut,at,ft,lt,ct,ht,pt;lt=it[0],ct=it[1],ht=st[0],pt=st[1],ot=0;for(ut=M.length;ot<ut;++ot)if(at=M[ot],C.d(lt[at],ct[at],n),256<at)C.d(M[++ot],M[++ot],n),ft=M[++ot],C.d(ht[ft],pt[ft],n),C.d(M[++ot],M[++ot],n);else if(256===at)break;this.a=C.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var T=[],N,C;for(N=3;258>=N;N++)C=x(),T[N]=C[2]<<24|C[1]<<16|C[0];var k=s?new Uint32Array(T):T,_=b;M.prototype.n=function(){var t,n,r,i,u,a,f,l=0;f=this.a,t=mt;switch(t){case mt:n=Math.LOG2E*Math.log(32768)-8;break;default:e(Error("invalid compression method"))}r=n<<4|t,f[l++]=r;switch(t){case mt:switch(this.h){case _.NONE:u=0;break;case _.r:u=1;break;case _.j:u=2;break;default:e(Error("unsupported compression type"))}break;default:e(Error("invalid compression method"))}return i=u<<6|0,f[l++]=i|31-(256*r+i)%31,a=o(this.input),this.z.b=l,f=this.z.n(),l=f.length,s&&(f=new Uint8Array(f.buffer),f.length<=l+4&&(this.a=new Uint8Array(f.length+4),this.a.set(f),f=this.a),f=f.subarray(0,l+4)),f[l++]=a>>24&255,f[l++]=a>>16&255,f[l++]=a>>8&255,f[l++]=a&255,f},i("Zlib.Deflate",M),i("Zlib.Deflate.compress",function(e,t){return(new M(e,t)).n()}),i("Zlib.Deflate.CompressionType",_),i("Zlib.Deflate.CompressionType.NONE",_.NONE),i("Zlib.Deflate.CompressionType.FIXED",_.r),i("Zlib.Deflate.CompressionType.DYNAMIC",_.j);var P=0,H=1,B={D:P,C:H};D.prototype.p=function(){for(;!this.s;){var r=tt(this,3);r&1&&(this.s=n),r>>>=1;switch(r){case 0:var i=this.input,o=this.c,u=this.a,a=this.b,f=t,l=t,c=t,h=u.length,p=t;this.e=this.g=0,f=i[o++],f===t&&e(Error("invalid uncompressed block header: LEN (first byte)")),l=f,f=i[o++],f===t&&e(Error("invalid uncompressed block header: LEN (second byte)")),l|=f<<8,f=i[o++],f===t&&e(Error("invalid uncompressed block header: NLEN (first byte)")),c=f,f=i[o++],f===t&&e(Error("invalid uncompressed block header: NLEN (second byte)")),c|=f<<8,l===~c&&e(Error("invalid uncompressed block header: length verify")),o+l>i.length&&e(Error("input buffer is broken"));switch(this.m){case P:for(;a+l>u.length;){p=h-a,l-=p;if(s)u.set(i.subarray(o,o+p),a),a+=p,o+=p;else for(;p--;)u[a++]=i[o++];this.b=a,u=this.f(),a=this.b}break;case H:for(;a+l>u.length;)u=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(s)u.set(i.subarray(o,o+l),a),a+=l,o+=l;else for(;l--;)u[a++]=i[o++];this.c=o,this.b=a,this.a=u;break;case 1:this.o(Q,et);break;case 2:rt(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.t()};var j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=s?new Uint16Array(j):j,I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],q=s?new Uint16Array(I):I,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],U=s?new Uint8Array(R):R,z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],W=s?new Uint16Array(z):z,X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],V=s?new Uint8Array(X):X,$=new(s?Uint8Array:Array)(288),J,K;J=0;for(K=$.length;J<K;++J)$[J]=143>=J?8:255>=J?9:279>=J?7:8;var Q=m($),G=new(s?Uint8Array:Array)(30),Y,Z;Y=0;for(Z=G.length;Y<Z;++Y)G[Y]=5;var et=m(G);D.prototype.o=function(e,t){var n=this.a,r=this.b;this.u=e;for(var i=n.length-258,s,o,u,a;256!==(s=nt(this,e));)if(256>s)r>=i&&(this.b=r,n=this.f(),r=this.b),n[r++]=s;else{o=s-257,a=q[o],0<U[o]&&(a+=tt(this,U[o])),s=nt(this,t),u=W[s],0<V[s]&&(u+=tt(this,V[s])),r>=i&&(this.b=r,n=this.f(),r=this.b);for(;a--;)n[r]=n[r++ -u]}for(;8<=this.e;)this.e-=8,this.c--;this.b=r},D.prototype.I=function(e,t){var n=this.a,r=this.b;this.u=e;for(var i=n.length,s,o,u,a;256!==(s=nt(this,e));)if(256>s)r>=i&&(n=this.f(),i=n.length),n[r++]=s;else{o=s-257,a=q[o],0<U[o]&&(a+=tt(this,U[o])),s=nt(this,t),u=W[s],0<V[s]&&(u+=tt(this,V[s])),r+a>i&&(n=this.f(),i=n.length);for(;a--;)n[r]=n[r++ -u]}for(;8<=this.e;)this.e-=8,this.c--;this.b=r},D.prototype.f=function(){var e=new(s?Uint8Array:Array)(this.b-32768),t=this.b-32768,n,r,i=this.a;if(s)e.set(i.subarray(32768,e.length));else{n=0;for(r=e.length;n<r;++n)e[n]=i[n+32768]}this.k.push(e),this.q+=e.length;if(s)i.set(i.subarray(t,t+32768));else for(n=0;32768>n;++n)i[n]=i[t+n];return this.b=32768,i},D.prototype.J=function(e){var t,n=this.input.length/this.c+1|0,r,i,o,u=this.input,a=this.a;return e&&("number"==typeof e.v&&(n=e.v),"number"==typeof e.F&&(n+=e.F)),2>n?(r=(u.length-this.c)/this.u[2],o=258*(r/2)|0,i=o<a.length?a.length+o:a.length<<1):i=a.length*n,s?(t=new Uint8Array(i),t.set(a)):t=a,this.a=t},D.prototype.t=function(){var e=0,t=this.a,n=this.k,r,i=new(s?Uint8Array:Array)(this.q+(this.b-32768)),o,u,a,f;if(0===n.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);o=0;for(u=n.length;o<u;++o){r=n[o],a=0;for(f=r.length;a<f;++a)i[e++]=r[a]}o=32768;for(u=this.b;o<u;++o)i[e++]=t[o];return this.k=[],this.buffer=i},D.prototype.H=function(){var e,t=this.b;return s?this.B?(e=new Uint8Array(t),e.set(this.a.subarray(0,t))):e=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),e=this.a),this.buffer=e},it.prototype.p=function(){var t=this.input,n,r;return n=this.A.p(),this.c=this.A.c,this.M&&(r=(t[this.c++]<<24|t[this.c++]<<16|t[this.c++]<<8|t[this.c++])>>>0,r!==o(n)&&e(Error("invalid adler-32 checksum"))),n},i("Zlib.Inflate",it),i("Zlib.Inflate.BufferType",B),B.ADAPTIVE=B.C,B.BLOCK=B.D,i("Zlib.Inflate.prototype.decompress",it.prototype.p);var st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];s&&new Uint16Array(st);var ot=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];s&&new Uint16Array(ot);var ut=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];s&&new Uint8Array(ut);var at=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];s&&new Uint16Array(at);var ft=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];s&&new Uint8Array(ft);var lt=new(s?Uint8Array:Array)(288),ct,ht;ct=0;for(ht=lt.length;ct<ht;++ct)lt[ct]=143>=ct?8:255>=ct?9:279>=ct?7:8;m(lt);var pt=new(s?Uint8Array:Array)(30),dt,vt;dt=0;for(vt=pt.length;dt<vt;++dt)pt[dt]=5;m(pt);var mt=8}).call(this);cc.RESOLUTION_POLICY={EXACTFIT:0,NOBORDER:1,SHOW_ALL:2,UNKNOWN:3},cc.Touches=[],cc.TouchesIntergerDict={},cc.EGLView=cc.Class.extend({_delegate:null,_screenSize:null,_designResolutionSize:null,_viewPortRect:null,_viewName:"",_scaleX:1,_scaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:cc.RESOLUTION_POLICY.UNKNOWN,_initialize:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,_accelerometerKeyHook:null,_supportTouch:!1,_contentTranslateLeftTop:null,_menu:null,_wndProc:null,_frameZoomFactor:1,ctor:function(){this._viewName="Cocos2dHTML5",this._screenSize=cc.SizeZero(),this._designResolutionSize=cc.SizeZero(),this._viewPortRect=cc.RectZero(),this._delegate=cc.Director.getInstance().getTouchDispatcher(),this._contentTranslateLeftTop={left:0,top:0},this._hDC=cc.canvas,this._hRC=cc.renderContext},initialize:function(){this._initialize=!0,this._adjustSize();var e=this._adjustSize.bind(this);window.addEventListener("resize",e,!1)},_adjustSize:function(){var e=cc.container.parentNode===document.body?document.documentElement:cc.container.parentNode;cc.canvas.width=e.clientWidth,cc.canvas.height=e.clientHeight,"opengl"in sys.capabilities||cc.renderContext.translate(0,cc.canvas.height);var t=document.querySelector("#"+document.ccConfig.tag).parentNode;t&&(t.style.width=cc.canvas.width+"px",t.style.height=cc.canvas.height+"px");var n=document.body;n&&(n.style.padding="0px",n.style.border="0px",n.style.margin="0px"),this._screenSize=cc.size(cc.canvas.width,cc.canvas.height),this.setDesignResolutionSize()},_adjustSizeKeepCanvasSize:function(){"opengl"in sys.capabilities||cc.renderContext.translate(0,cc.canvas.height),this._screenSize=cc.size(cc.canvas.width,cc.canvas.height),this.setDesignResolutionSize()},end:function(){},isOpenGLReady:function(){return this._hDC!=null&&this._hRC!=null},setFrameZoomFactor:function(e){this._frameZoomFactor=e,this.centerWindow(),cc.Director.getInstance().setProjection(cc.Director.getInstance().getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(e){e},setContentScaleFactor:function(e){return cc.Assert(this._resolutionPolicy==cc.RESOLUTION_POLICY.UNKNOWN),this._scaleX=this._scaleY=e,!0},setContentTranslateLeftTop:function(e,t){this._contentTranslateLeftTop={left:e,top:t}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getFrameSize:function(){return this._screenSize},setFrameSize:function(e,t){this._designResolutionSize=this._screenSize=cc.size(e,t),this.centerWindow(),cc.Director.getInstance().setProjection(cc.Director.getInstance().getProjection())},centerWindow:function(){},setAccelerometerKeyHook:function(e){this._accelerometerKeyHook=e},getVisibleSize:function(){return this._resolutionPolicy===cc.RESOLUTION_POLICY.NOBORDER?cc.size(this._screenSize.width/this._scaleX,this._screenSize.height/this._scaleY):this._designResolutionSize},getVisibleOrigin:function(){return this._resolutionPolicy===cc.RESOLUTION_POLICY.NOBORDER?cc.p((this._designResolutionSize.width-this._screenSize.width/this._scaleX)/2,(this._designResolutionSize.height-this._screenSize.height/this._scaleY)/2):cc.p(0,0)},canSetContentScaleFactor:function(){return!0},setDesignResolutionSize:function(e,t,n){cc.Assert(n!==cc.RESOLUTION_POLICY.UNKNOWN,"should set resolutionPolicy"),this._initialize||this.initialize();if(e==0||t==0)return;e!=null&&t!=null&&(this._designResolutionSize=cc.size(e,t)),n!=null&&(this._resolutionPolicy=n),this._scaleX=this._screenSize.width/this._designResolutionSize.width,this._scaleY=this._screenSize.height/this._designResolutionSize.height,this._resolutionPolicy===cc.RESOLUTION_POLICY.NOBORDER&&(this._scaleX=this._scaleY=Math.max(this._scaleX,this._scaleY)),this._resolutionPolicy===cc.RESOLUTION_POLICY.SHOW_ALL&&(this._scaleX=this._scaleY=Math.min(this._scaleX,this._scaleY));var r=this._designResolutionSize.width*this._scaleX,i=this._designResolutionSize.height*this._scaleY;this._viewPortRect=cc.rect((this._screenSize.width-r)/2,(this._screenSize.height-i)/2,r,i);var s=cc.Director.getInstance();s._winSizeInPoints=this.getDesignResolutionSize();if(cc.renderContextType===cc.CANVAS){var e=0,t=0;if(this._resolutionPolicy===cc.RESOLUTION_POLICY.SHOW_ALL){e=(this._screenSize.width-r)/2,t=-(this._screenSize.height-i)/2;var o=cc.renderContext;o.beginPath(),o.rect(e,-i+t,r,i),o.clip(),o.closePath()}cc.renderContext.translate(e,t),cc.renderContext.scale(this._scaleX,this._scaleY)}else cc.Director.getInstance()._createStatsLabel(),cc.Director.getInstance().setGLDefaultValues()},getDesignResolutionSize:function(){return this._designResolutionSize},setTouchDelegate:function(e){this._delegate=e},setViewPortInPoints:function(e,t,n,r){cc.renderContext.viewport(e*this._scaleX*this._frameZoomFactor+this._viewPortRect.origin.x*this._frameZoomFactor,t*this._scaleY*this._frameZoomFactor+this._viewPortRect.origin.y*this._frameZoomFactor,n*this._scaleX*this._frameZoomFactor,r*this._scaleY*this._frameZoomFactor)},setScissorInPoints:function(e,t,n,r){cc.renderContext.scissor(e*this._scaleX*this._frameZoomFactor+this._viewPortRect.origin.x*this._frameZoomFactor,t*this._scaleY*this._frameZoomFactor+this._viewPortRect.origin.y*this._frameZoomFactor,n*this._scaleX*this._frameZoomFactor,r*this._scaleY*this._frameZoomFactor)},setViewName:function(e){e!=null&&e.length>0&&(this._viewName=e)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},convertToLocationInView:function(e,t,n){return{x:e-n.left,y:n.top+n.height-t}},handleTouchesBegin:function(e,t,n,r){var i=[];for(var s=0;s<e;++s){var o=t[s],u=n[s],a=r[s],f=cc.TouchesIntergerDict[o],l=0;if(f==null){l=this._getUnUsedIndex();if(l==-1){cc.log("The touches is more than MAX_TOUCHES, nUnusedIndex = "+l);continue}var c=cc.Touches[l]=new cc.Touch;c.setTouchInfo(l,(u-this._viewPortRect.origin.x)/this._scaleX,(a-this._viewPortRect.origin.y)/this._scaleY);var h=0|l;cc.TouchesIntergerDict[o]=h,i.push(c)}}if(i.length==0)return;this._delegate.touchesBegan(i,null)},handleTouchesMove:function(e,t,n,r){var i=[];for(var s=0;s<e;++s){var o=t[s],u=n[s],a=r[s],f=cc.TouchesIntergerDict[o];if(f==null)continue;var l=cc.Touches[f];if(!l)return;l.setTouchInfo(f,(u-this._viewPortRect.origin.x)/this._scaleX,(a-this._viewPortRect.origin.y)/this._scaleY),i.push(l)}if(i.length==0)return;this._delegate.touchesMoved(i,null)},handleTouchesEnd:function(e,t,n,r){var i=[];this.getSetOfTouchesEndOrCancel(i,e,t,n,r),this._delegate.touchesEnded(i,null)},handleTouchesCancel:function(e,t,n,r){var i=[];this.getSetOfTouchesEndOrCancel(i,e,t,n,r),this._delegate.touchesCancelled(i,null)},getSetOfTouchesEndOrCancel:function(e,t,n,r,i){for(var s=0;s<t;++s){var o=n[s],u=r[s],a=i[s],f=cc.TouchesIntergerDict[o];if(f==null)continue;var l=cc.Touches[f];if(!l)return;l.setTouchInfo(f,(u-this._viewPortRect.origin.x)/this._scaleX,(a-this._viewPortRect.origin.y)/this._scaleY),e.push(l),cc.Touches[f]=null,this._removeUsedIndexBit(f),delete cc.TouchesIntergerDict[o]}},_getUnUsedIndex:function(){var e,t=this._indexBitsUsed;for(e=0;e<this._maxTouches;e++){if(!(t&1))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(e){if(e<0||e>=this._maxTouches)return;var t=1<<e;t=~t,this._indexBitsUsed&=t},touchesBegan:function(e,t){var n=[],r=[],i=[],s=0;for(var o=0;o<e.length;o++)n[s]=o,r[s]=e[o].getLocation().x,i[s]=e[o].getLocation().y,++s;this.handleTouchesBegin(s,n,r,i)},touchesMoved:function(e,t){var n=[],r=[],i=[],s=0;for(var o=0;o<e.length;o++)n[s]=o,r[s]=e[o].getLocation().x,i[s]=e[o].getLocation().y,++s;this.handleTouchesMove(s,n,r,i)},touchesEnded:function(e,t){var n=[],r=[],i=[],s=0;for(var o=0;o<e.length;o++)n[s]=o,r[s]=e[o].getLocation().x,i[s]=e[o].getLocation().y,++s;this.handleTouchesEnd(s,n,r,i)},touchesCancelled:function(e,t){var n=[],r=[],i=[],s=0;for(var o=0;o<e.length;o++)n[s]=o,r[s]=e[o].getLocation().x,i[s]=e[o].getLocation().y,++s;this.handleTouchesCancel(s,n,r,i)}}),cc.EGLView.getInstance=function(){return this._instance||(this._instance=new cc.EGLView),this._instance};cc.Point=function(e,t){this.x=e||0,this.y=t||0},cc.PointMake=function(e,t){return new cc.Point(e,t)},cc.p=function(e,t){return{x:e,y:t}},cc._p=cc.p,cc.PointZero=function(){return cc.p(0,0)},Object.defineProperties(cc,{POINT_ZERO:{get:function(){return cc.p(0,0)}},SIZE_ZERO:{get:function(){return cc.size(0,0)}},RECT_ZERO:{get:function(){return cc.rect(0,0,0,0)}}}),cc.pointEqualToPoint=function(e,t){return!e||!t?!1:e.x==t.x&&e.y==t.y},cc.Point.CCPointEqualToPoint=cc.pointEqualToPoint,cc.Size=function(e,t){this.width=e||0,this.height=t||0},cc.SizeMake=function(e,t){return cc.size(e,t)},cc.size=function(e,t){return{width:e,height:t}},cc._size=cc.size,cc.SizeZero=function(){return cc.size(0,0)},cc.sizeEqualToSize=function(e,t){return!e||!t?!1:e.width==t.width&&e.height==t.height},cc.Size.CCSizeEqualToSize=cc.sizeEqualToSize,cc.Rect=function(e,t,n,r){switch(arguments.length){case 0:this.origin=cc.p(0,0),this.size=cc.size(0,0);break;case 1:var i=e;if(!i)this.origin=cc.p(0,0),this.size=cc.size(0,0);else{if(!(i instanceof cc.Rect))throw"unknown argument type";this.origin=cc.p(i.origin.x,i.origin.y),this.size=cc.size(i.size.width,i.size.height)}break;case 2:this.origin=e?cc.p(e.x,e.y):cc.p(0,0),this.size=t?cc.size(t.width,t.height):cc.size(0,0);break;case 4:this.origin=cc.p(e||0,t||0),this.size=cc.size(n||0,r||0);break;default:throw"unknown argument type"}},cc.RectMake=function(e,t,n,r){return cc.rect(e,t,n,r)},cc.rect=function(e,t,n,r){return new cc.Rect(e,t,n,r)},cc._rect=cc.rect,cc.RectZero=function(){return cc.rect(0,0,0,0)},cc.rectEqualToRect=function(e,t){return!e||!t?!1:cc.Point.CCPointEqualToPoint(e.origin,t.origin)&&cc.Size.CCSizeEqualToSize(e.size,t.size)},cc.rectContainsRect=function(e,t){return!e||!t?!1:e.origin.x>=t.origin.x||e.origin.y>=t.origin.y||e.origin.x+e.size.width<=t.origin.x+t.size.width||e.origin.y+e.size.height<=t.origin.y+t.size.height?!1:!0},cc.rectGetMaxX=function(e){return e.origin.x+e.size.width},cc.rectGetMidX=function(e){return e.origin.x+e.size.width/2},cc.rectGetMinX=function(e){return e.origin.x},cc.rectGetMaxY=function(e){return e.origin.y+e.size.height},cc.rectGetMidY=function(e){return e.origin.y+e.size.height/2},cc.rectGetMinY=function(e){return e.origin.y},cc.rectContainsPoint=function(e,t){var n=!1;return t.x>=cc.Rect.CCRectGetMinX(e)&&t.x<=cc.Rect.CCRectGetMaxX(e)&&t.y>=cc.Rect.CCRectGetMinY(e)&&t.y<=cc.Rect.CCRectGetMaxY(e)&&(n=!0),n},cc.rectIntersectsRect=function(e,t){return!(cc.Rect.CCRectGetMaxX(e)<cc.Rect.CCRectGetMinX(t)||cc.Rect.CCRectGetMaxX(t)<cc.Rect.CCRectGetMinX(e)||cc.Rect.CCRectGetMaxY(e)<cc.Rect.CCRectGetMinY(t)||cc.Rect.CCRectGetMaxY(t)<cc.Rect.CCRectGetMinY(e))},cc.rectOverlapsRect=function(e,t){return e.origin.x+e.size.width<t.origin.x?!1:t.origin.x+t.size.width<e.origin.x?!1:e.origin.y+e.size.height<t.origin.y?!1:t.origin.y+t.size.height<e.origin.y?!1:!0},cc.rectUnion=function(e,t){var n=cc.rect(0,0,0,0);return n.origin.x=Math.min(e.origin.x,t.origin.x),n.origin.y=Math.min(e.origin.y,t.origin.y),n.size.width=Math.max(e.origin.x+e.size.width,t.origin.x+t.size.width)-n.origin.x,n.size.height=Math.max(e.origin.y+e.size.height,t.origin.y+t.size.height)-n.origin.y,n},cc.rectIntersection=function(e,t){var n=cc.rect(Math.max(cc.Rect.CCRectGetMinX(e),cc.Rect.CCRectGetMinX(t)),Math.max(cc.Rect.CCRectGetMinY(e),cc.Rect.CCRectGetMinY(t)),0,0);return n.size.width=Math.min(cc.Rect.CCRectGetMaxX(e),cc.Rect.CCRectGetMaxX(t))-cc.Rect.CCRectGetMinX(n),n.size.height=Math.min(cc.Rect.CCRectGetMaxY(e),cc.Rect.CCRectGetMaxY(t))-cc.Rect.CCRectGetMinY(n),n},cc.Rect.prototype.getX=function(){return this.origin.x},cc.Rect.prototype.setX=function(e){this.origin.x=e},cc.Rect.prototype.getY=function(){return this.origin.y},cc.Rect.prototype.setY=function(e){this.origin.y=e},cc.Rect.prototype.getWidth=function(){return this.size.width},cc.Rect.prototype.setWidth=function(e){this.size.width=e},cc.Rect.prototype.getHeight=function(){return this.size.height},cc.Rect.prototype.setHeight=function(e){this.size.height=e},Object.defineProperties(cc.Rect.prototype,{x:{get:function(){return this.getX()},set:function(e){this.setX(e)},enumerable:!0,configurable:!0},y:{get:function(){return this.getY()},set:function(e){this.setY(e)},enumerable:!0,configurable:!0},width:{get:function(){return this.getWidth()},set:function(e){this.setWidth(e)},enumerable:!0,configurable:!0},height:{get:function(){return this.getHeight()},set:function(e){this.setHeight(e)},enumerable:!0,configurable:!0}}),cc.Rect.CCRectEqualToRect=cc.rectEqualToRect,cc.Rect.CCRectContainsRect=cc.rectContainsRect,cc.Rect.CCRectGetMaxX=cc.rectGetMaxX,cc.Rect.CCRectGetMidX=cc.rectGetMidX,cc.Rect.CCRectGetMinX=cc.rectGetMinX,cc.Rect.CCRectGetMaxY=cc.rectGetMaxY,cc.Rect.CCRectGetMidY=cc.rectGetMidY,cc.Rect.CCRectGetMinY=cc.rectGetMinY,cc.Rect.CCRectContainsPoint=cc.rectContainsPoint,cc.Rect.CCRectIntersectsRect=cc.rectIntersectsRect,cc.Rect.CCRectUnion=cc.rectUnion,cc.Rect.CCRectIntersection=cc.rectIntersection;var sys=sys||{};try{sys.localStorage=window.localStorage}catch(e){e.name==="SECURITY_ERR"&&cc.log("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option"),sys.localStorage=function(){}}Object.defineProperties(sys,{capabilities:{get:function(){var e={canvas:!0};cc.Browser.supportWebGL&&(e.opengl=!0),"ontouchstart"in document.documentElement?e.touches=!0:"onmouseup"in document.documentElement&&(e.mouse=!0),"onkeyup"in document.documentElement&&(e.keyboard=!0);if(window.DeviceMotionEvent||window.DeviceOrientationEvent)e.accelerometer=!0;return e},enumerable:!0,configurable:!0},os:{get:function(){var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?!0:!1,t=navigator.userAgent.match(/android/i)||navigator.platform.match(/android/i)?!0:!1,n=navigator.appVersion;return navigator.appVersion.indexOf("Win")!=-1?n="Windows":navigator.appVersion.indexOf("Mac")!=-1?n="OS X":navigator.appVersion.indexOf("X11")!=-1?n="UNIX":navigator.appVersion.indexOf("Linux")!=-1?n="Linux":e?n="iOS":t&&(n="Android"),n},enumerable:!0,configurable:!0},platform:{get:function(){return"browser"},enumerable:!0,configurable:!0},version:{get:function(){return cc.ENGINE_VERSION},enumerable:!0,configurable:!0}}),sys.garbageCollect=function(){},sys.dumpRoot=function(){},sys.restartVM=function(){};cc.ENGINE_VERSION="Cocos2d-html5-v2.1.3",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.DIRECTOR_STATS_POSITION=cc.p(0,0),cc.DIRECTOR_FPS_INTERVAL=.5,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_ATLAS_USE_VAO=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_SUPPORT=1,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS=1,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.IS_RETINA_DISPLAY_SUPPORTED=1,cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas",cc.config={platform:sys.platform},cc.dumpConfig=function(){for(var e in sys)cc.log(e+" = "+sys[e])},cc.ENABLE_GL_STATE_CACHE=1;cc.FMT_JPG=0,cc.FMT_PNG=1,cc.FMT_TIFF=2,cc.FMT_RAWDATA=3,cc.FMT_UNKNOWN=4,cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17,cc.RGB_PREMULTIPLY_APLHA=function(e,t,n,r){return e*(r+1)>>8|t*(r+1)>>8<<8|n*(r+1)>>8<<16|r<<24},cc.tImageSource=function(e,t,n){this.data=e,this.size=t||0,this.offset=n||0},cc.pngReadCallback=function(e,t,n){var r=new cc.tImageSource;r=cc.png_get_io_ptr(e),r.offset+n<=r.size?(cc.memcpy(t,r.data+r.offset,n),r.offset+=n):cc.png_error(e,"pngReaderCallback failed")},cc.getImageFormatByData=function(e){if(e.length>8&&e[0]==137&&e[1]==80&&e[2]==78&&e[3]==71&&e[4]==13&&e[5]==10&&e[6]==26&&e[7]==10)return cc.FMT_PNG;if(e.length>2)if(e[0]==73&&e[1]==73||e[0]==77&&e[1]==77||e[0]==255&&e[1]==216)return cc.FMT_TIFF;return cc.FMT_UNKNOWN},cc.Image=cc.Class.extend({_width:0,_height:0,_bitsPerComponent:0,_data:0,_hasAlpha:!1,_preMulti:!1,initWithImageFile:function(e,t){var n=cc.FileUtils.getInstance().getFileData(e,"rb"),r=n.length;return n!=null&&n.length>0?this.initWithImageData(n,n.length,t):!1},initWithImageFileThreadSafe:function(e,t){return this.initWithImageFile(e,t)},initWithImageData:function(e,t,n,r,i,s){s=s||8,r=r||0,i=i||0,n=n||cc.FMT_UNKNOWN;if(!e||t<=0)return!1;if(cc.FMT_PNG==n)return this._initWithPngData(e,t);if(cc.FMT_JPG==n)return this._initWithJpgData(e,t);if(cc.FMT_TIFF==n)return this._initWithTiffData(e,t);if(cc.FMT_RAWDATA==n)return this._initWithRawData(e,t,r,i,s);if(t>8&&e[0]==137&&e[1]==80&&e[2]==78&&e[3]==71&&e[4]==13&&e[5]==10&&e[6]==26&&e[7]==10)return this._initWithPngData(e,t);if(t>2){if(e[0]==73&&e[1]==73||e[0]==77&&e[1]==77)return this._initWithTiffData(e,t);if(e[0]==255&&e[1]==216)return this._initWithTiffData(e,t)}return!1},getData:function(){return this._data},getDataLen:function(){return this._width*this._height},hasAlpha:function(){return this._hasAlpha},isPremultipliedAlpha:function(){return this._preMulti},getWidth:function(){return this._width},getHeight:function(){return this._height},getBitsPerComponent:function(){return this._bitsPerComponent},saveToFile:function(e,t){return cc.log("doesn't support saveToFile on Cocos2d-Html5"),!1},_initWithJpgData:function(e,t){return!1},_initWithPngData:function(e,t){return!1},_initWithTiffData:function(e,t){return!1},_initWithRawData:function(e,t,n,r,i){return!1},_saveImageToPNG:function(e,t){return!1},_saveImageToJPG:function(e){return!1},initWithString:function(e,t,n,r,i,s){return!1}});cc.kmScalar=Number,cc.kmBool=Number,cc.kmEnum=Number,cc.KM_FALSE=0,cc.KM_TRUE=1,cc.kmPI=3.141592,cc.kmPIOver180=.017453,cc.kmPIUnder180=57.295779,cc.kmEpsilon=1/64,cc.kmSQR=function(e){return e*e},cc.kmDegreesToRadians=function(e){return e*cc.kmPIOver180},cc.kmRadiansToDegrees=function(e){return e*cc.kmPIUnder180},cc.kmMin=function(e,t){return e<t?e:t},cc.kmMax=function(e,t){return e>t?e:t},cc.kmAlmostEqual=function(e,t){return e+cc.kmEpsilon>t&&e-cc.kmEpsilon<t};cc.kmVec2=function(e,t){this.x=e||0,this.y=t||0},cc.kmVec2Fill=function(e,t,n){return e.x=t,e.y=n,e},cc.kmVec2Length=function(e){return Math.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y))},cc.kmVec2LengthSq=function(e){return cc.kmSQR(e.x)+cc.kmSQR(e.y)},cc.kmVec2Normalize=function(e,t){var n=1/cc.kmVec2Length(t),r=new cc.kmVec2;return r.x=t.x*n,r.y=t.y*n,e.x=r.x,e.y=r.y,e},cc.kmVec2Add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e},cc.kmVec2Dot=function(e,t){return e.x*t.x+e.y*t.y},cc.kmVec2Subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e},cc.kmVec2Transform=function(e,t,n){var r=new cc.kmVec2;return r.x=t.x*n.mat[0]+t.y*n.mat[3]+n.mat[6],r.y=t.x*n.mat[1]+t.y*n.mat[4]+n.mat[7],e.x=r.x,e.y=r.y,e},cc.kmVec2TransformCoord=function(e,t,n){return null},cc.kmVec2Scale=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e},cc.kmVec2AreEqual=function(e,t){return e.x<t.x+cc.kmEpsilon&&e.x>t.x-cc.kmEpsilon&&e.y<t.y+cc.kmEpsilon&&e.y>t.y-cc.kmEpsilon};cc.kmVec3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},cc.kmVec3Fill=function(e,t,n,r){return e?(e.x=t,e.y=n,e.z=r,e):new cc.kmVec3(t,n,r)},cc.kmVec3Length=function(e){return Math.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z))},cc.kmVec3LengthSq=function(e){return cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)},cc.kmVec3Normalize=function(e,t){var n=1/cc.kmVec3Length(t);return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},cc.kmVec3Cross=function(e,t,n){return e.x=t.y*n.z-t.z*n.y,e.y=t.z*n.x-t.x*n.z,e.z=t.x*n.y-t.y*n.x,e},cc.kmVec3Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},cc.kmVec3Add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},cc.kmVec3Subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},cc.kmVec3Transform=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[4]+t.z*n.mat[8]+n.mat[12],e.y=t.x*n.mat[1]+t.y*n.mat[5]+t.z*n.mat[9]+n.mat[13],e.z=t.x*n.mat[2]+t.y*n.mat[6]+t.z*n.mat[10]+n.mat[14],e},cc.kmVec3TransformNormal=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[4]+t.z*n.mat[8],e.y=t.x*n.mat[1]+t.y*n.mat[5]+t.z*n.mat[9],e.z=t.x*n.mat[2]+t.y*n.mat[6]+t.z*n.mat[10],e},cc.kmVec3TransformCoord=function(e,t,n){var r=new cc.kmVec4,i=new cc.kmVec4;return cc.kmVec4Fill(i,t.x,t.y,t.z,1),cc.kmVec4Transform(r,i,n),e.x=r.x/r.w,e.y=r.y/r.w,e.z=r.z/r.w,e},cc.kmVec3Scale=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},cc.kmVec3AreEqual=function(e,t){return e.x<t.x+cc.kmEpsilon&&e.x>t.x-cc.kmEpsilon&&e.y<t.y+cc.kmEpsilon&&e.y>t.y-cc.kmEpsilon&&e.z<t.z+cc.kmEpsilon&&e.z>t.z-cc.kmEpsilon?1:0},cc.kmVec3InverseTransform=function(e,t,n){var r=new cc.kmVec3(t.x-n.mat[12],t.y-n.mat[13],t.z-n.mat[14]);return e.x=r.x*n.mat[0]+r.y*n.mat[1]+r.z*n.mat[2],e.y=r.x*n.mat[4]+r.y*n.mat[5]+r.z*n.mat[6],e.z=r.x*n.mat[8]+r.y*n.mat[9]+r.z*n.mat[10],e},cc.kmVec3InverseTransformNormal=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[1]+t.z*n.mat[2],e.y=t.x*n.mat[4]+t.y*n.mat[5]+t.z*n.mat[6],e.z=t.x*n.mat[8]+t.y*n.mat[9]+t.z*n.mat[10],e},cc.kmVec3Assign=function(e,t){return e==t?e:(e.x=t.x,e.y=t.y,e.z=t.z,e)},cc.kmVec3Zero=function(e){return e.x=0,e.y=0,e.z=0,e},cc.kmVec3ToTypeArray=function(e){if(!e)return null;var t=new Float32Array(3);return t[0]=e.x,t[1]=e.y,t[2]=e.z,t};cc.kmVec4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r||0},cc.kmVec4Fill=function(e,t,n,r,i){return e.x=t,e.y=n,e.z=r,e.w=i,e},cc.kmVec4Add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},cc.kmVec4Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},cc.kmVec4Length=function(e){return Math.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)+cc.kmSQR(e.w))},cc.kmVec4LengthSq=function(e){return cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)+cc.kmSQR(e.w)},cc.kmVec4Lerp=function(e,t,n,r){return e},cc.kmVec4Normalize=function(e,t){var n=1/cc.kmVec4Length(t);return e.x*=n,e.y*=n,e.z*=n,e.w*=n,e},cc.kmVec4Scale=function(e,t,n){return cc.kmVec4Normalize(e,t),e.x*=n,e.y*=n,e.z*=n,e.w*=n,e},cc.kmVec4Subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},cc.kmVec4Transform=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[4]+t.z*n.mat[8]+t.w*n.mat[12],e.y=t.x*n.mat[1]+t.y*n.mat[5]+t.z*n.mat[9]+t.w*n.mat[13],e.z=t.x*n.mat[2]+t.y*n.mat[6]+t.z*n.mat[10]+t.w*n.mat[14],e.w=t.x*n.mat[3]+t.y*n.mat[7]+t.z*n.mat[11]+t.w*n.mat[15],e},cc.kmVec4TransformArray=function(e,t,n,r,i,s){var o=0;while(o<s){var u=n+o*r,a=e+o*t;cc.kmVec4Transform(a,u,i),++o}return e},cc.kmVec4AreEqual=function(e,t){return e.x<t.x+cc.kmEpsilon&&e.x>t.x-cc.kmEpsilon&&e.y<t.y+cc.kmEpsilon&&e.y>t.y-cc.kmEpsilon&&e.z<t.z+cc.kmEpsilon&&e.z>t.z-cc.kmEpsilon&&e.w<t.w+cc.kmEpsilon&&e.w>t.w-cc.kmEpsilon},cc.kmVec4Assign=function(e,t){return cc.Assert(e!=t,"same object!"),e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},cc.kmVec4ToTypeArray=function(e){if(!e)return null;var t=new Float32Array(4);return t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w,t};cc.kmRay2=function(e,t){this.start=e||new cc.kmVec2,this.start=e||new cc.kmVec2},cc.kmRay2Fill=function(e,t,n,r,i){e.start.x=t,e.start.y=n,e.dir.x=r,e.dir.y=i},cc.kmRay2IntersectLineSegment=function(e,t,n,r){var i=e.start.x,s=e.start.y,o=e.start.x+e.dir.x,u=e.start.y+e.dir.y,a=t.x,f=t.y,l=n.x,c=n.y,h=(c-f)*(o-i)-(l-a)*(u-s),p,d,v;return h>-cc.kmEpsilon&&h<cc.kmEpsilon?cc.KM_FALSE:(p=((l-a)*(s-f)-(c-f)*(i-a))/h,d=i+p*(o-i),v=s+p*(u-s),d<cc.kmMin(t.x,n.x)-cc.kmEpsilon||d>cc.kmMax(t.x,n.x)+cc.kmEpsilon||v<cc.kmMin(t.y,n.y)-cc.kmEpsilon||v>cc.kmMax(t.y,n.y)+cc.kmEpsilon?cc.KM_FALSE:d<cc.kmMin(i,o)-cc.kmEpsilon||d>cc.kmMax(i,o)+cc.kmEpsilon||v<cc.kmMin(s,u)-cc.kmEpsilon||v>cc.kmMax(s,u)+cc.kmEpsilon?cc.KM_FALSE:(r.x=d,r.y=v,cc.KM_TRUE))},cc.calculate_line_normal=function(e,t,n){var r=new cc.kmVec2;cc.kmVec2Subtract(r,t,e),n.x=-r.y,n.y=r.x,cc.kmVec2Normalize(n,n)},cc.kmRay2IntersectTriangle=function(e,t,n,r,i,s){var o=new cc.kmVec2,u=new cc.kmVec2,a=new cc.kmVec2,f=1e4,l=cc.KM_FALSE,c,h;return cc.kmRay2IntersectLineSegment(e,t,n,o)&&(c=new cc.kmVec2,l=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(c,o,e.start)),h<f&&(u.x=o.x,u.y=o.y,f=h,cc.calculate_line_normal(t,n,a))),cc.kmRay2IntersectLineSegment(e,n,r,o)&&(c=new cc.kmVec2,l=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(c,o,e.start)),h<f&&(u.x=o.x,u.y=o.y,f=h,cc.calculate_line_normal(n,r,a))),cc.kmRay2IntersectLineSegment(e,r,t,o)&&(c=new cc.kmVec2,l=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(c,o,e.start)),h<f&&(u.x=o.x,u.y=o.y,f=h,cc.calculate_line_normal(r,t,a))),l&&(i.x=u.x,i.y=u.y,s&&(s.x=a.x,s.y=a.y)),l},cc.kmRay2IntersectCircle=function(e,t,n,r){return cc.Assert(0,"Not implemented"),0};var Float32Array=Float32Array||Array;cc.kmMat3=function(){this.mat=new Float32Array([0,0,0,0,0,0,0,0,0])},cc.kmMat3Fill=function(e,t){for(var n=0;n<9;n++)e.mat[n]=t;return e},cc.kmMat3Adjugate=function(e,t){return e.mat[0]=t.mat[4]*t.mat[8]-t.mat[5]*t.mat[7],e.mat[1]=t.mat[2]*t.mat[7]-t.mat[1]*t.mat[8],e.mat[2]=t.mat[1]*t.mat[5]-t.mat[2]*t.mat[4],e.mat[3]=t.mat[5]*t.mat[6]-t.mat[3]*t.mat[8],e.mat[4]=t.mat[0]*t.mat[8]-t.mat[2]*t.mat[6],e.mat[5]=t.mat[2]*t.mat[3]-t.mat[0]*t.mat[5],e.mat[6]=t.mat[3]*t.mat[7]-t.mat[4]*t.mat[6],e.mat[8]=t.mat[0]*t.mat[4]-t.mat[1]*t.mat[3],e},cc.kmMat3Identity=function(e){return e.mat[1]=e.mat[2]=e.mat[3]=e.mat[5]=e.mat[6]=e.mat[7]=0,e.mat[0]=e.mat[4]=e.mat[8]=1,e},cc.kmMat3Inverse=function(e,t,n){var r,i=new cc.kmMat3;return t===0?null:(r=1/t,cc.kmMat3Adjugate(i,n),cc.kmMat3ScalarMultiply(e,i,r),e)},cc.kmMat3._identity=new Float32Array([1,0,0,0,1,0,0,0,1]),cc.kmMat3IsIdentity=function(e){for(var t=0;t<9;t++)if(cc.kmMat3._identity[t]!==e.mat[t])return!1;return!0},cc.kmMat3Transpose=function(e,t){var n,r;for(n=0;n<3;++n)for(r=0;r<3;++r)e.mat[n*3+r]=t.mat[r*3+n];return e},cc.kmMat3Determinant=function(e){var t;return t=e.mat[0]*e.mat[4]*e.mat[8]+e.mat[1]*e.mat[5]*e.mat[6]+e.mat[2]*e.mat[3]*e.mat[7],t-=e.mat[2]*e.mat[4]*e.mat[6]+e.mat[0]*e.mat[5]*e.mat[7]+e.mat[1]*e.mat[3]*e.mat[8],t},cc.kmMat3Multiply=function(e,t,n){var r=t.mat,i=n.mat;return e.mat[0]=r[0]*i[0]+r[3]*i[1]+r[6]*i[2],e.mat[1]=r[1]*i[0]+r[4]*i[1]+r[7]*i[2],e.mat[2]=r[2]*i[0]+r[5]*i[1]+r[8]*i[2],e.mat[3]=r[0]*i[3]+r[3]*i[4]+r[6]*i[5],e.mat[4]=r[1]*i[3]+r[4]*i[4]+r[7]*i[5],e.mat[5]=r[2]*i[3]+r[5]*i[4]+r[8]*i[5],e.mat[6]=r[0]*i[6]+r[3]*i[7]+r[6]*i[8],e.mat[7]=r[1]*i[6]+r[4]*i[7]+r[7]*i[8],e.mat[8]=r[2]*i[6]+r[5]*i[7]+r[8]*i[8],e},cc.kmMat3ScalarMultiply=function(e,t,n){for(var r=0;r<9;r++)e.mat[r]=t.mat[r]*n;return e},cc.kmMat3RotationAxisAngle=function(e,t,n){var r=Math.cos(n),i=Math.sin(n);return e.mat[0]=r+t.x*t.x*(1-r),e.mat[1]=t.z*i+t.y*t.x*(1-r),e.mat[2]=-t.y*i+t.z*t.x*(1-r),e.mat[3]=-t.z*i+t.x*t.y*(1-r),e.mat[4]=r+t.y*t.y*(1-r),e.mat[5]=t.x*i+t.z*t.y*(1-r),e.mat[6]=t.y*i+t.x*t.z*(1-r),e.mat[7]=-t.x*i+t.y*t.z*(1-r),e.mat[8]=r+t.z*t.z*(1-r),e},cc.kmMat3Assign=function(e,t){cc.Assert(e!=t,"Is same object");for(var n=0;n<9;n++)e.mat[n]=t.mat[n];return e},cc.kmMat3AreEqual=function(e,t){if(e==t)return!0;for(var n=0;n<9;++n)if(!(e.mat[n]+cc.kmEpsilon>t.mat[n]&&e.mat[n]-cc.kmEpsilon<t.mat[n]))return!1;return!0},cc.kmMat3RotationX=function(e,t){return e.mat[0]=1,e.mat[1]=0,e.mat[2]=0,e.mat[3]=0,e.mat[4]=Math.cos(t),e.mat[5]=Math.sin(t),e.mat[6]=0,e.mat[7]=-Math.sin(t),e.mat[8]=Math.cos(t),e},cc.kmMat3RotationY=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=0,e.mat[2]=-Math.sin(t),e.mat[3]=0,e.mat[4]=1,e.mat[5]=0,e.mat[6]=Math.sin(t),e.mat[7]=0,e.mat[8]=Math.cos(t),e},cc.kmMat3RotationZ=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=-Math.sin(t),e.mat[2]=0,e.mat[3]=Math.sin(t),e.mat[4]=Math.cos(t),e.mat[5]=0,e.mat[6]=0,e.mat[7]=0,e.mat[8]=1,e},cc.kmMat3Rotation=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=Math.sin(t),e.mat[2]=0,e.mat[3]=-Math.sin(t),e.mat[4]=Math.cos(t),e.mat[5]=0,e.mat[6]=0,e.mat[7]=0,e.mat[8]=1,e},cc.kmMat3Scaling=function(e,t,n){return cc.kmMat3Identity(e),e.mat[0]=t,e.mat[4]=n,e},cc.kmMat3Translation=function(e,t,n){return cc.kmMat3Identity(e),e.mat[6]=t,e.mat[7]=n,e},cc.kmMat3RotationQuaternion=function(e,t){return!t||!e?null:(e.mat[0]=1-2*(t.y*t.y+t.z*t.z),e.mat[1]=2*(t.x*t.y-t.w*t.z),e.mat[2]=2*(t.x*t.z+t.w*t.y),e.mat[3]=2*(t.x*t.y+t.w*t.z),e.mat[4]=1-2*(t.x*t.x+t.z*t.z),e.mat[5]=2*(t.y*t.z-t.w*t.x),e.mat[6]=2*(t.x*t.z-t.w*t.y),e.mat[7]=2*(t.y*t.z+t.w*t.x),e.mat[8]=1-2*(t.x*t.x+t.y*t.y),e)},cc.kmMat3RotationToAxisAngle=function(e,t,n){var r;return cc.kmQuaternionRotationMatrix(r,n),cc.kmQuaternionToAxisAngle(r,e,t),e};cc.kmMat4=function(){this.mat=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},cc.kmMat4Fill=function(e,t){e.mat[0]=e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[5]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[10]=e.mat[11]=e.mat[12]=e.mat[13]=e.mat[14]=e.mat[15]=t},cc.kmMat4Identity=function(e){return e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[11]=e.mat[12]=e.mat[13]=e.mat[14]=0,e.mat[0]=e.mat[5]=e.mat[10]=e.mat[15]=1,e},cc.kmMat4._get=function(e,t,n){return e.mat[t+4*n]},cc.kmMat4._set=function(e,t,n,r){e.mat[t+4*n]=r},cc.kmMat4._swap=function(e,t,n,r,i){var s=cc.kmMat4._get(e,t,n);cc.kmMat4._set(e,t,n,cc.kmMat4._get(e,r,i)),cc.kmMat4._set(e,r,i,s)},cc.kmMat4._gaussj=function(e,t){var n,r=0,i=0,s,o,u,a,f=4,l=4,c,h,p,d=[0,0,0,0],v=[0,0,0,0],m=[0,0,0,0];for(n=0;n<f;n++){c=0;for(s=0;s<f;s++)if(m[s]!=1)for(o=0;o<f;o++)m[o]==0&&Math.abs(cc.kmMat4._get(e,s,o))>=c&&(c=Math.abs(cc.kmMat4._get(e,s,o)),i=s,r=o);++m[r];if(i!=r){for(u=0;u<f;u++)cc.kmMat4._swap(e,i,u,r,u);for(u=0;u<l;u++)cc.kmMat4._swap(t,i,u,r,u)}v[n]=i,d[n]=r;if(cc.kmMat4._get(e,r,r)==0)return cc.KM_FALSE;p=1/cc.kmMat4._get(e,r,r),cc.kmMat4._set(e,r,r,1);for(u=0;u<f;u++)cc.kmMat4._set(e,r,u,cc.kmMat4._get(e,r,u)*p);for(u=0;u<l;u++)cc.kmMat4._set(t,r,u,cc.kmMat4._get(t,r,u)*p);for(a=0;a<f;a++)if(a!=r){h=cc.kmMat4._get(e,a,r),cc.kmMat4._set(e,a,r,0);for(u=0;u<f;u++)cc.kmMat4._set(e,a,u,cc.kmMat4._get(e,a,u)-cc.kmMat4._get(e,r,u)*h);for(u=0;u<l;u++)cc.kmMat4._set(t,a,u,cc.kmMat4._get(e,a,u)-cc.kmMat4._get(t,r,u)*h)}}for(u=f-1;u>=0;u--)if(v[u]!=d[u])for(o=0;o<f;o++)cc.kmMat4._swap(e,o,v[u],o,d[u]);return cc.KM_TRUE},cc.kmMat4._identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),cc.kmMat4Inverse=function(e,t){var n=new cc.kmMat4,r=new cc.kmMat4;return cc.kmMat4Assign(n,t),cc.kmMat4Identity(r),cc.kmMat4._gaussj(n,r)==cc.KM_FALSE?null:(cc.kmMat4Assign(e,n),e)},cc.kmMat4IsIdentity=function(e){for(var t=0;t<16;t++)if(cc.kmMat4._identity[t]!=e.mat[t])return!1;return!0},cc.kmMat4Transpose=function(e,t){var n,r;for(r=0;r<4;++r)for(n=0;n<4;++n)e.mat[r*4+n]=t.mat[n*4+r];return e},cc.kmMat4Multiply=function(e,t,n){var r=t.mat[0],i=t.mat[1],s=t.mat[2],o=t.mat[3],u=t.mat[4],a=t.mat[5],f=t.mat[6],l=t.mat[7],c=t.mat[8],h=t.mat[9],p=t.mat[10],d=t.mat[11],v=t.mat[12],m=t.mat[13],g=t.mat[14],y=t.mat[15],b=n.mat[0],w=n.mat[1],E=n.mat[2],S=n.mat[3],x=n.mat[4],T=n.mat[5],N=n.mat[6],C=n.mat[7],k=n.mat[8],L=n.mat[9],A=n.mat[10],O=n.mat[11],M=n.mat[12],_=n.mat[13],D=n.mat[14],P=n.mat[15];return e.mat[0]=b*r+w*u+E*c+S*v,e.mat[1]=b*i+w*a+E*h+S*m,e.mat[2]=b*s+w*f+E*p+S*g,e.mat[3]=b*o+w*l+E*d+S*y,e.mat[4]=x*r+T*u+N*c+C*v,e.mat[5]=x*i+T*a+N*h+C*m,e.mat[6]=x*s+T*f+N*p+C*g,e.mat[7]=x*o+T*l+N*d+C*y,e.mat[8]=k*r+L*u+A*c+O*v,e.mat[9]=k*i+L*a+A*h+O*m,e.mat[10]=k*s+L*f+A*p+O*g,e.mat[11]=k*o+L*l+A*d+O*y,e.mat[12]=M*r+_*u+D*c+P*v,e.mat[13]=M*i+_*a+D*h+P*m,e.mat[14]=M*s+_*f+D*p+P*g,e.mat[15]=M*o+_*l+D*d+P*y,e},cc.getMat4MultiplyValue=function(e,t){var n=e.mat,r=t.mat,i=new Float32Array(16);return i[0]=n[0]*r[0]+n[4]*r[1]+n[8]*r[2]+n[12]*r[3],i[1]=n[1]*r[0]+n[5]*r[1]+n[9]*r[2]+n[13]*r[3],i[2]=n[2]*r[0]+n[6]*r[1]+n[10]*r[2]+n[14]*r[3],i[3]=n[3]*r[0]+n[7]*r[1]+n[11]*r[2]+n[15]*r[3],i[4]=n[0]*r[4]+n[4]*r[5]+n[8]*r[6]+n[12]*r[7],i[5]=n[1]*r[4]+n[5]*r[5]+n[9]*r[6]+n[13]*r[7],i[6]=n[2]*r[4]+n[6]*r[5]+n[10]*r[6]+n[14]*r[7],i[7]=n[3]*r[4]+n[7]*r[5]+n[11]*r[6]+n[15]*r[7],i[8]=n[0]*r[8]+n[4]*r[9]+n[8]*r[10]+n[12]*r[11],i[9]=n[1]*r[8]+n[5]*r[9]+n[9]*r[10]+n[13]*r[11],i[10]=n[2]*r[8]+n[6]*r[9]+n[10]*r[10]+n[14]*r[11],i[11]=n[3]*r[8]+n[7]*r[9]+n[11]*r[10]+n[15]*r[11],i[12]=n[0]*r[12]+n[4]*r[13]+n[8]*r[14]+n[12]*r[15],i[13]=n[1]*r[12]+n[5]*r[13]+n[9]*r[14]+n[13]*r[15],i[14]=n[2]*r[12]+n[6]*r[13]+n[10]*r[14]+n[14]*r[15],i[15]=n[3]*r[12]+n[7]*r[13]+n[11]*r[14]+n[15]*r[15],i},cc.getMat4MultiplyWithMat4=function(e,t,n){var r=e.mat,i=t.mat,s=n.mat;return s[0]=r[0]*i[0]+r[4]*i[1]+r[8]*i[2]+r[12]*i[3],s[1]=r[1]*i[0]+r[5]*i[1]+r[9]*i[2]+r[13]*i[3],s[2]=r[2]*i[0]+r[6]*i[1]+r[10]*i[2]+r[14]*i[3],s[3]=r[3]*i[0]+r[7]*i[1]+r[11]*i[2]+r[15]*i[3],s[4]=r[0]*i[4]+r[4]*i[5]+r[8]*i[6]+r[12]*i[7],s[5]=r[1]*i[4]+r[5]*i[5]+r[9]*i[6]+r[13]*i[7],s[6]=r[2]*i[4]+r[6]*i[5]+r[10]*i[6]+r[14]*i[7],s[7]=r[3]*i[4]+r[7]*i[5]+r[11]*i[6]+r[15]*i[7],s[8]=r[0]*i[8]+r[4]*i[9]+r[8]*i[10]+r[12]*i[11],s[9]=r[1]*i[8]+r[5]*i[9]+r[9]*i[10]+r[13]*i[11],s[10]=r[2]*i[8]+r[6]*i[9]+r[10]*i[10]+r[14]*i[11],s[11]=r[3]*i[8]+r[7]*i[9]+r[11]*i[10]+r[15]*i[11],s[12]=r[0]*i[12]+r[4]*i[13]+r[8]*i[14]+r[12]*i[15],s[13]=r[1]*i[12]+r[5]*i[13]+r[9]*i[14]+r[13]*i[15],s[14]=r[2]*i[12]+r[6]*i[13]+r[10]*i[14]+r[14]*i[15],s[15]=r[3]*i[12]+r[7]*i[13]+r[11]*i[14]+r[15]*i[15],n.mat},cc.kmMat4Assign=function(e,t){return e.mat[0]=t.mat[0],e.mat[1]=t.mat[1],e.mat[2]=t.mat[2],e.mat[3]=t.mat[3],e.mat[4]=t.mat[4],e.mat[5]=t.mat[5],e.mat[6]=t.mat[6],e.mat[7]=t.mat[7],e.mat[8]=t.mat[8],e.mat[9]=t.mat[9],e.mat[10]=t.mat[10],e.mat[11]=t.mat[11],e.mat[12]=t.mat[12],e.mat[13]=t.mat[13],e.mat[14]=t.mat[14],e.mat[15]=t.mat[15],e},cc.kmMat4AreEqual=function(e,t){cc.Assert(e!=t,"You are comparing the same thing!");for(var n=0;n<16;n++)if(!(e.mat[n]+cc.kmEpsilon>t.mat[n]&&e.mat[n]-cc.kmEpsilon<t.mat[n]))return!1;return!0},cc.kmMat4RotationX=function(e,t){return e.mat[0]=1,e.mat[1]=0,e.mat[2]=0,e.mat[3]=0,e.mat[4]=0,e.mat[5]=Math.cos(t),e.mat[6]=Math.sin(t),e.mat[7]=0,e.mat[8]=0,e.mat[9]=-Math.sin(t),e.mat[10]=Math.cos(t),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationY=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=0,e.mat[2]=-Math.sin(t),e.mat[3]=0,e.mat[4]=0,e.mat[5]=1,e.mat[6]=0,e.mat[7]=0,e.mat[8]=Math.sin(t),e.mat[9]=0,e.mat[10]=Math.cos(t),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationZ=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=Math.sin(t),e.mat[2]=0,e.mat[3]=0,e.mat[4]=-Math.sin(t),e.mat[5]=Math.cos(t),e.mat[6]=0,e.mat[7]=0,e.mat[8]=0,e.mat[9]=0,e.mat[10]=1,e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationPitchYawRoll=function(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(n),u=Math.sin(n),a=Math.cos(r),f=Math.sin(r),l=s*u,c=i*u;return e.mat[0]=o*a,e.mat[4]=o*f,e.mat[8]=-u,e.mat[1]=l*a-i*f,e.mat[5]=l*f+i*a,e.mat[9]=s*o,e.mat[2]=c*a+s*f,e.mat[6]=c*f-s*a,e.mat[10]=i*o,e.mat[3]=e.mat[7]=e.mat[11]=0,e.mat[15]=1,e},cc.kmMat4RotationQuaternion=function(e,t){return e.mat[0]=1-2*(t.y*t.y+t.z*t.z),e.mat[1]=2*(t.x*t.y+t.z*t.w),e.mat[2]=2*(t.x*t.z-t.y*t.w),e.mat[3]=0,e.mat[4]=2*(t.x*t.y-t.z*t.w),e.mat[5]=1-2*(t.x*t.x+t.z*t.z),e.mat[6]=2*(t.z*t.y+t.x*t.w),e.mat[7]=0,e.mat[8]=2*(t.x*t.z+t.y*t.w),e.mat[9]=2*(t.y*t.z-t.x*t.w),e.mat[10]=1-2*(t.x*t.x+t.y*t.y),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationTranslation=function(e,t,n){return e.mat[0]=t.mat[0],e.mat[1]=t.mat[1],e.mat[2]=t.mat[2],e.mat[3]=0,e.mat[4]=t.mat[3],e.mat[5]=t.mat[4],e.mat[6]=t.mat[5],e.mat[7]=0,e.mat[8]=t.mat[6],e.mat[9]=t.mat[7],e.mat[10]=t.mat[8],e.mat[11]=0,e.mat[12]=n.x,e.mat[13]=n.y,e.mat[14]=n.z,e.mat[15]=1,e},cc.kmMat4Scaling=function(e,t,n,r){return e.mat[0]=t,e.mat[5]=n,e.mat[10]=r,e.mat[15]=1,e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[11]=e.mat[12]=e.mat[13]=e.mat[14]=0,e},cc.kmMat4Translation=function(e,t,n,r){return e.mat[0]=e.mat[5]=e.mat[10]=e.mat[15]=1,e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[11]=0,e.mat[12]=t,e.mat[13]=n,e.mat[14]=r,e},cc.kmMat4GetUpVec3=function(e,t){return e.x=t.mat[4],e.y=t.mat[5],e.z=t.mat[6],cc.kmVec3Normalize(e,e),e},cc.kmMat4GetRightVec3=function(e,t){return e.x=t.mat[0],e.y=t.mat[1],e.z=t.mat[2],cc.kmVec3Normalize(e,e),e},cc.kmMat4GetForwardVec3=function(e,t){return e.x=t.mat[8],e.y=t.mat[9],e.z=t.mat[10],cc.kmVec3Normalize(e,e),e},cc.kmMat4PerspectiveProjection=function(e,t,n,r,i){var s=cc.kmDegreesToRadians(t/2),o=i-r,u=Math.sin(s);if(o==0||u==0||n==0)return null;var a=Math.cos(s)/u;return cc.kmMat4Identity(e),e.mat[0]=a/n,e.mat[5]=a,e.mat[10]=-(i+r)/o,e.mat[11]=-1,e.mat[14]=-2*r*i/o,e.mat[15]=0,e},cc.kmMat4OrthographicProjection=function(e,t,n,r,i,s,o){return cc.kmMat4Identity(e),e.mat[0]=2/(n-t),e.mat[5]=2/(i-r),e.mat[10]=-2/(o-s),e.mat[12]=-((n+t)/(n-t)),e.mat[13]=-((i+r)/(i-r)),e.mat[14]=-((o+s)/(o-s)),e},cc.kmMat4LookAt=function(e,t,n,r){var i=new cc.kmVec3,s=new cc.kmVec3,o=new cc.kmVec3,u=new cc.kmVec3,a=new cc.kmMat4;return cc.kmVec3Subtract(i,n,t),cc.kmVec3Normalize(i,i),cc.kmVec3Assign(s,r),cc.kmVec3Normalize(s,s),cc.kmVec3Cross(o,i,s),cc.kmVec3Normalize(o,o),cc.kmVec3Cross(u,o,i),cc.kmVec3Normalize(o,o),cc.kmMat4Identity(e),e.mat[0]=o.x,e.mat[4]=o.y,e.mat[8]=o.z,e.mat[1]=u.x,e.mat[5]=u.y,e.mat[9]=u.z,e.mat[2]=-i.x,e.mat[6]=-i.y,e.mat[10]=-i.z,cc.kmMat4Translation(a,-t.x,-t.y,-t.z),cc.kmMat4Multiply(e,e,a),e},cc.kmMat4RotationAxisAngle=function(e,t,n){var r=Math.cos(n),i=Math.sin(n),s=new cc.kmVec3;return cc.kmVec3Normalize(s,t),e.mat[0]=r+s.x*s.x*(1-r),e.mat[1]=s.z*i+s.y*s.x*(1-r),e.mat[2]=-s.y*i+s.z*s.x*(1-r),e.mat[3]=0,e.mat[4]=-s.z*i+s.x*s.y*(1-r),e.mat[5]=r+s.y*s.y*(1-r),e.mat[6]=s.x*i+s.z*s.y*(1-r),e.mat[7]=0,e.mat[8]=s.y*i+s.x*s.z*(1-r),e.mat[9]=-s.x*i+s.y*s.z*(1-r),e.mat[10]=r+s.z*s.z*(1-r),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4ExtractRotation=function(e,t){return e.mat[0]=t.mat[0],e.mat[1]=t.mat[1],e.mat[2]=t.mat[2],e.mat[3]=t.mat[4],e.mat[4]=t.mat[5],e.mat[5]=t.mat[6],e.mat[6]=t.mat[8],e.mat[7]=t.mat[9],e.mat[8]=t.mat[10],e},cc.kmMat4ExtractPlane=function(e,t,n){switch(n){case cc.KM_PLANE_RIGHT:e.a=t.mat[3]-t.mat[0],e.b=t.mat[7]-t.mat[4],e.c=t.mat[11]-t.mat[8],e.d=t.mat[15]-t.mat[12];break;case cc.KM_PLANE_LEFT:e.a=t.mat[3]+t.mat[0],e.b=t.mat[7]+t.mat[4],e.c=t.mat[11]+t.mat[8],e.d=t.mat[15]+t.mat[12];break;case cc.KM_PLANE_BOTTOM:e.a=t.mat[3]+t.mat[1],e.b=t.mat[7]+t.mat[5],e.c=t.mat[11]+t.mat[9],e.d=t.mat[15]+t.mat[13];break;case cc.KM_PLANE_TOP:e.a=t.mat[3]-t.mat[1],e.b=t.mat[7]-t.mat[5],e.c=t.mat[11]-t.mat[9],e.d=t.mat[15]-t.mat[13];break;case cc.KM_PLANE_FAR:e.a=t.mat[3]-t.mat[2],e.b=t.mat[7]-t.mat[6],e.c=t.mat[11]-t.mat[10],e.d=t.mat[15]-t.mat[14];break;case cc.KM_PLANE_NEAR:e.a=t.mat[3]+t.mat[2],e.b=t.mat[7]+t.mat[6],e.c=t.mat[11]+t.mat[10],e.d=t.mat[15]+t.mat[14];break;default:cc.Assert(0,"Invalid plane index")}var r=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=r,e.b/=r,e.c/=r,e.d/=r,e},cc.kmMat4RotationToAxisAngle=function(e,t,n){var r=new cc.kmQuaternion,i=new cc.kmMat3;return cc.kmMat4ExtractRotation(i,n),cc.kmQuaternionRotationMatrix(r,i),cc.kmQuaternionToAxisAngle(r,e,t),e};cc.KM_PLANE_LEFT=0,cc.KM_PLANE_RIGHT=1,cc.KM_PLANE_BOTTOM=2,cc.KM_PLANE_TOP=3,cc.KM_PLANE_NEAR=4,cc.KM_PLANE_FAR=5,cc.kmPlane=function(e,t,n,r){this.a=e||0,this.b=t||0,this.c=n||0,this.d=r||0},cc.POINT_INFRONT_OF_PLANE=0,cc.POINT_BEHIND_PLANE=1,cc.POINT_ON_PLANE=2,cc.kmPlaneDot=function(e,t){return e.a*t.x+e.b*t.y+e.c*t.z+e.d*t.w},cc.kmPlaneDotCoord=function(e,t){return e.a*t.x+e.b*t.y+e.c*t.z+e.d},cc.kmPlaneDotNormal=function(e,t){return e.a*t.x+e.b*t.y+e.c*t.z},cc.kmPlaneFromPointNormal=function(e,t,n){return e.a=n.x,e.b=n.y,e.c=n.z,e.d=-cc.kmVec3Dot(n,t),e},cc.kmPlaneFromPoints=function(e,t,n,r){var i=new cc.kmVec3,s=new cc.kmVec3,o=new cc.kmVec3;return cc.kmVec3Subtract(s,n,t),cc.kmVec3Subtract(o,r,t),cc.kmVec3Cross(i,s,o),cc.kmVec3Normalize(i,i),e.a=i.x,e.b=i.y,e.c=i.z,e.d=cc.kmVec3Dot(cc.kmVec3Scale(i,i,-1),t),e},cc.kmPlaneIntersectLine=function(e,t,n,r){var i=new cc.kmVec3;return cc.Assert(0,"Not implemented"),cc.kmVec3Subtract(i,r,n),null},cc.kmPlaneNormalize=function(e,t){var n=new cc.kmVec3;n.x=t.a,n.y=t.b,n.z=t.c;var r=1/cc.kmVec3Length(n);return cc.kmVec3Normalize(n,n),e.a=n.x,e.b=n.y,e.c=n.z,e.d=t.d*r,e},cc.kmPlaneScale=function(e,t,n){return cc.Assert(0,"Not implemented"),null},cc.kmPlaneClassifyPoint=function(e,t){var n=e.a*t.x+e.b*t.y+e.c*t.z+e.d;return n>.001?cc.POINT_INFRONT_OF_PLANE:n<-0.001?cc.POINT_BEHIND_PLANE:cc.POINT_ON_PLANE};cc.kmQuaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r||0},cc.kmQuaternionConjugate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},cc.kmQuaternionDot=function(e,t){return e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z},cc.kmQuaternionExp=function(e,t){return e},cc.kmQuaternionIdentity=function(e){return e.x=0,e.y=0,e.z=0,e.w=1,e},cc.kmQuaternionInverse=function(e,t){var n=cc.kmQuaternionLength(t),r=new cc.kmQuaternion;return Math.abs(n)>cc.kmEpsilon?(e.x=0,e.y=0,e.z=0,e.w=0,e):(cc.kmQuaternionScale(e,cc.kmQuaternionConjugate(r,t),1/n),e)},cc.kmQuaternionIsIdentity=function(e){return e.x==0&&e.y==0&&e.z==0&&e.w==1},cc.kmQuaternionLength=function(e){return Math.sqrt(cc.kmQuaternionLengthSq(e))},cc.kmQuaternionLengthSq=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},cc.kmQuaternionLn=function(e,t){return e},cc.kmQuaternionMultiply=function(e,t,n){return e.w=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z,e.x=t.w*n.x+t.x*n.w+t.y*n.z-t.z*n.y,e.y=t.w*n.y+t.y*n.w+t.z*n.x-t.x*n.z,e.z=t.w*n.z+t.z*n.w+t.x*n.y-t.y*n.x,e},cc.kmQuaternionNormalize=function(e,t){var n=cc.kmQuaternionLength(t);return cc.Assert(Math.abs(n)>cc.kmEpsilon,""),cc.kmQuaternionScale(e,t,1/n),e},cc.kmQuaternionRotationAxis=function(e,t,n){var r=n*.5,i=Math.sin(r);return e.w=Math.cos(r),e.x=t.x*i,e.y=t.y*i,e.z=t.z*i,e},cc.kmQuaternionRotationMatrix=function(e,t){var n,r,i,s,o=[],u=0,a=0;if(!t)return null;o[0]=t.mat[0],o[1]=t.mat[3],o[2]=t.mat[6],o[4]=t.mat[1],o[5]=t.mat[4],o[6]=t.mat[7],o[8]=t.mat[2],o[9]=t.mat[5],o[10]=t.mat[8],o[15]=1;var f=o[0];return a=f[0]+f[5]+f[10]+1,a>cc.kmEpsilon?(u=Math.sqrt(a)*2,n=(f[9]-f[6])/u,r=(f[2]-f[8])/u,i=(f[4]-f[1])/u,s=.25*u):f[0]>f[5]&&f[0]>f[10]?(u=Math.sqrt(1+f[0]-f[5]-f[10])*2,n=.25*u,r=(f[4]+f[1])/u,i=(f[2]+f[8])/u,s=(f[9]-f[6])/u):f[5]>f[10]?(u=Math.sqrt(1+f[5]-f[0]-f[10])*2,n=(f[4]+f[1])/u,r=.25*u,i=(f[9]+f[6])/u,s=(f[2]-f[8])/u):(u=Math.sqrt(1+f[10]-f[0]-f[5])*2,n=(f[2]+f[8])/u,r=(f[9]+f[6])/u,i=.25*u,s=(f[4]-f[1])/u),e.x=n,e.y=r,e.z=i,e.w=s,e},cc.kmQuaternionRotationYawPitchRoll=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d;return i=cc.kmDegreesToRadians(n)/2,s=cc.kmDegreesToRadians(t)/2,o=cc.kmDegreesToRadians(r)/2,u=Math.cos(i),a=Math.cos(s),f=Math.cos(o),l=Math.sin(i),c=Math.sin(s),h=Math.sin(o),p=a*f,d=c*h,e.w=u*p+l*d,e.x=l*p-u*d,e.y=u*c*f+l*a*h,e.z=u*a*h-l*c*f,cc.kmQuaternionNormalize(e,e),e},cc.kmQuaternionSlerp=function(e,t,n,r){if(t.x==n.x&&t.y==n.y&&t.z==n.z&&t.w==n.w)return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e;var i=cc.kmQuaternionDot(t,n),s=Math.acos(i),o=Math.sqrt(1-cc.kmSQR(i)),u=Math.sin(r*s)/o,a=Math.sin((1-r)*s)/o,f=new cc.kmQuaternion,l=new cc.kmQuaternion;return cc.kmQuaternionScale(f,t,a),cc.kmQuaternionScale(l,n,u),cc.kmQuaternionAdd(e,f,l),e},cc.kmQuaternionToAxisAngle=function(e,t,n){var r,i;r=Math.acos(e.w),i=Math.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)),i>-cc.kmEpsilon&&i<cc.kmEpsilon||i<2*cc.kmPI+cc.kmEpsilon&&i>2*cc.kmPI-cc.kmEpsilon?(n=0,t.x=0,t.y=0,t.z=1):(n=r*2,t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,cc.kmVec3Normalize(t,t))},cc.kmQuaternionScale=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},cc.kmQuaternionAssign=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},cc.kmQuaternionAdd=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},cc.kmQuaternionRotationBetweenVec3=function(e,t,n,r){var i=new cc.kmVec3,s=new cc.kmVec3,o;cc.kmVec3Assign(i,t),cc.kmVec3Assign(s,n),cc.kmVec3Normalize(i,i),cc.kmVec3Normalize(s,s),o=cc.kmVec3Dot(i,s);if(o>=1)return cc.kmQuaternionIdentity(e),e;if(o<1e-6-1)if(Math.abs(cc.kmVec3LengthSq(r))<cc.kmEpsilon)cc.kmQuaternionRotationAxis(e,r,cc.kmPI);else{var u=new cc.kmVec3,a=new cc.kmVec3;a.x=1,a.y=0,a.z=0,cc.kmVec3Cross(u,a,t);if(Math.abs(cc.kmVec3LengthSq(u))<cc.kmEpsilon){var f=new cc.kmVec3;f.x=0,f.y=1,f.z=0,cc.kmVec3Cross(u,f,t)}cc.kmVec3Normalize(u,u),cc.kmQuaternionRotationAxis(e,u,cc.kmPI)}else{var l=Math.sqrt((1+o)*2),c=1/l,h=new cc.kmVec3;cc.kmVec3Cross(h,i,s),e.x=h.x*c,e.y=h.y*c,e.z=h.z*c,e.w=l*.5,cc.kmQuaternionNormalize(e,e)}return e},cc.kmQuaternionMultiplyVec3=function(e,t,n){var r=new cc.kmVec3,i=new cc.kmVec3,s=new cc.kmVec3;return s.x=t.x,s.y=t.y,s.z=t.z,cc.kmVec3Cross(r,s,n),cc.kmVec3Cross(i,s,r),cc.kmVec3Scale(r,r,2*t.w),cc.kmVec3Scale(i,i,2),cc.kmVec3Add(e,n,r),cc.kmVec3Add(e,e,i),e};cc.kmAABB=function(e,t){this.min=e||new cc.kmVec3,this.max=t||new cc.kmVec3},cc.kmAABBContainsPoint=function(e,t){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y&&e.z>=t.min.z&&e.z<=t.max.z?cc.KM_TRUE:cc.KM_FALSE},cc.kmAABBAssign=function(e,t){return cc.kmVec3Assign(e.min,t.min),cc.kmVec3Assign(e.max,t.max),e},cc.kmAABBScale=function(e,t,n){return cc.Assert(0,"Not implemented"),0};cc.km_mat4_stack=function(e,t,n,r){this.top=n,this.stack=r},cc.km_mat4_stack.INITIAL_SIZE=30,cc.km_mat4_stack_initialize=function(e){e.stack=[],e.top=null},cc.km_mat4_stack_push=function(e,t){e.stack.push(e.top),e.top=new cc.kmMat4,cc.kmMat4Assign(e.top,t)},cc.km_mat4_stack_pop=function(e,t){e.top=e.stack.pop()},cc.km_mat4_stack_release=function(e){e.stack=null,e.top=null,e=null};cc.KM_GL_MODELVIEW=5888,cc.KM_GL_PROJECTION=5889,cc.KM_GL_TEXTURE=5890,cc.modelview_matrix_stack=new cc.km_mat4_stack,cc.projection_matrix_stack=new cc.km_mat4_stack,cc.texture_matrix_stack=new cc.km_mat4_stack,cc.current_stack=null,cc.initialized=!1,cc.lazyInitialize=function(){if(!cc.initialized){var e=new cc.kmMat4;cc.km_mat4_stack_initialize(cc.modelview_matrix_stack),cc.km_mat4_stack_initialize(cc.projection_matrix_stack),cc.km_mat4_stack_initialize(cc.texture_matrix_stack),cc.current_stack=cc.modelview_matrix_stack,cc.initialized=!0,cc.kmMat4Identity(e),cc.km_mat4_stack_push(cc.modelview_matrix_stack,e),cc.km_mat4_stack_push(cc.projection_matrix_stack,e),cc.km_mat4_stack_push(cc.texture_matrix_stack,e)}},cc.lazyInitialize(),cc.kmGLFreeAll=function(){cc.km_mat4_stack_release(cc.modelview_matrix_stack),cc.km_mat4_stack_release(cc.projection_matrix_stack),cc.km_mat4_stack_release(cc.texture_matrix_stack),cc.initialized=!1,cc.current_stack=null},cc.kmGLPushMatrix=function(){cc.km_mat4_stack_push(cc.current_stack,cc.current_stack.top)},cc.kmGLPushMatrixWitMat4=function(e){cc.current_stack.stack.push(cc.current_stack.top),cc.kmMat4Assign(e,cc.current_stack.top),cc.current_stack.top=e},cc.kmGLPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop()},cc.kmGLMatrixMode=function(e){switch(e){case cc.KM_GL_MODELVIEW:cc.current_stack=cc.modelview_matrix_stack;break;case cc.KM_GL_PROJECTION:cc.current_stack=cc.projection_matrix_stack;break;case cc.KM_GL_TEXTURE:cc.current_stack=cc.texture_matrix_stack;break;default:cc.Assert(0,"Invalid matrix mode specified")}},cc.kmGLLoadIdentity=function(){cc.kmMat4Identity(cc.current_stack.top)},cc.kmGLLoadMatrix=function(e){cc.kmMat4Assign(cc.current_stack.top,e)},cc.kmGLMultMatrix=function(e){cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,e)},cc.kmGLTranslatef=function(e,t,n){var r=new cc.kmMat4;cc.kmMat4Translation(r,e,t,n),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,r)},cc.kmGLRotatef=function(e,t,n,r){var i=new cc.kmVec3(t,n,r),s=new cc.kmMat4;cc.kmMat4RotationAxisAngle(s,i,cc.kmDegreesToRadians(e)),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,s)},cc.kmGLScalef=function(e,t,n){var r=new cc.kmMat4;cc.kmMat4Scaling(r,e,t,n),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,r)},cc.kmGLGetMatrix=function(e,t){switch(e){case cc.KM_GL_MODELVIEW:cc.kmMat4Assign(t,cc.modelview_matrix_stack.top);break;case cc.KM_GL_PROJECTION:cc.kmMat4Assign(t,cc.projection_matrix_stack.top);break;case cc.KM_GL_TEXTURE:cc.kmMat4Assign(t,cc.texture_matrix_stack.top);break;default:cc.Assert(1,"Invalid matrix mode specified")}};cc.Set=cc.Class.extend({ctor:function(e){e?this._set=[].concat(e._set):this._set=[]},copy:function(){return new cc.Set(this)},mutableCopy:function(){return this.copy()},count:function(){return this._set.length},addObject:function(e){if(cc.ArrayContainsObject(this._set,e))return;this._set.push(e),this._set.sort(function(e,t){return e-t})},removeObject:function(e){var t=0;for(var n=0,r=0;n<this._set.length;n++)this._set[n]!=e&&(this._set[r++]=this._set[n],t++);this._set.length=t},begin:function(){return this._set&&this._set.length>0?this._set[0]:null},end:function(){return this._set&&this._set.length>0?this._set[this._set.length-1]:null},containsObject:function(e){return cc.ArrayContainsObject(this._set,e)},anyObject:function(){return this._set&&this._set.length>0?this._set[0]:null},_set:null}),cc.NSMutableSet=cc.Set;cc.splitWithForm=function(e,t){do{if(!e)break;if(e.length==0)break;var n=e.indexOf("{"),r=e.indexOf("}");if(n==-1||r==-1)break;if(n>r)break;var i=e.substr(n+1,r-n-1);if(i.length==0)break;var s=i.indexOf("{"),o=i.indexOf("}");if(s!=-1||o!=-1)break;t=i.split(",");if(t.length!=2||t[0]!=null||t[1]!=null)break}while(0);return t},cc.RectFromString=function(e){var t=cc.RectZero();do{if(!e)break;var n=e.indexOf("{")+1,r=e.lastIndexOf("}",e.length);if(n==-1||r==-1)break;e=e.substring(n,r);var i=e.indexOf("}");if(i==-1)break;i=e.indexOf(",",i);if(i==-1)break;var s=e.substr(0,i),o=e.substr(i+1,e.length-i),u=cc.splitWithForm(s),a=cc.splitWithForm(o),f=parseFloat(u[0]),l=parseFloat(u[1]),c=parseFloat(a[0]),h=parseFloat(a[1]);t=cc.rect(f,l,c,h)}while(0);return t},cc.PointFromString=function(e){var t=cc.PointZero();try{if(e=="")return t;var n=cc.splitWithForm(e),r=parseFloat(n[0]),i=parseFloat(n[1]);t=cc.p(r,i)}catch(s){}return t},cc.SizeFromString=function(e){var t=cc.SizeZero();try{if(e=="")return t;var n=cc.splitWithForm(e),r=parseFloat(n[0]),i=parseFloat(n[1]);t=cc.size(r,i)}catch(s){}return t};cc.AffineTransform=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.d=r,this.tx=i,this.ty=s},cc.__AffineTransformMake=function(e,t,n,r,i,s){return{a:e,b:t,c:n,d:r,tx:i,ty:s}},cc.AffineTransformMake=function(e,t,n,r,i,s){return{a:e,b:t,c:n,d:r,tx:i,ty:s}},cc.__PointApplyAffineTransform=function(e,t){return{x:t.a*e.x+t.c*e.y+t.tx,y:t.b*e.x+t.d*e.y+t.ty}},cc.PointApplyAffineTransform=function(e,t){return{x:t.a*e.x+t.c*e.y+t.tx,y:t.b*e.x+t.d*e.y+t.ty}},cc.__SizeApplyAffineTransform=function(e,t){return{width:t.a*e.width+t.c*e.height,height:t.b*e.width+t.d*e.height}},cc.SizeApplyAffineTransform=function(e,t){return{width:t.a*e.width+t.c*e.height,height:t.b*e.width+t.d*e.height}},cc.AffineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.AffineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.RectApplyAffineTransform=function(e,t){var n=cc.Rect.CCRectGetMinY(e),r=cc.Rect.CCRectGetMinX(e),i=cc.Rect.CCRectGetMaxX(e),s=cc.Rect.CCRectGetMaxY(e),o=cc.PointApplyAffineTransform(cc.p(r,n),t),u=cc.PointApplyAffineTransform(cc.p(i,n),t),a=cc.PointApplyAffineTransform(cc.p(r,s),t),f=cc.PointApplyAffineTransform(cc.p(i,s),t),l=Math.min(Math.min(o.x,u.x),Math.min(a.x,f.x)),c=Math.max(Math.max(o.x,u.x),Math.max(a.x,f.x)),h=Math.min(Math.min(o.y,u.y),Math.min(a.y,f.y)),p=Math.max(Math.max(o.y,u.y),Math.max(a.y,f.y));return cc.rect(l,h,c-l,p-h)},cc.AffineTransformTranslate=function(e,t,n){return{a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx+e.a*t+e.c*n,ty:e.ty+e.b*t+e.d*n}},cc.AffineTransformScale=function(e,t,n){return{a:e.a*t,b:e.b*t,c:e.c*n,d:e.d*n,tx:e.tx,ty:e.ty}},cc.AffineTransformRotate=function(e,t){var n=Math.sin(t),r=Math.cos(t);return{a:e.a*r+e.c*n,b:e.b*r+e.d*n,c:e.c*r-e.a*n,d:e.d*r-e.b*n,tx:e.tx,ty:e.ty}},cc.AffineTransformConcat=function(e,t){return{a:e.a*t.a+e.b*t.c,b:e.a*t.b+e.b*t.d,c:e.c*t.a+e.d*t.c,d:e.c*t.b+e.d*t.d,tx:e.tx*t.a+e.ty*t.c+t.tx,ty:e.tx*t.b+e.ty*t.d+t.ty}},cc.AffineTransformEqualToTransform=function(e,t){return e.a===t.a&&e.b===t.b&&e.c===t.c&&e.d===t.d&&e.tx===t.tx&&e.ty===t.ty},cc.AffineTransformInvert=function(e){var t=1/(e.a*e.d-e.b*e.c);return{a:t*e.d,b:-t*e.b,c:-t*e.c,d:t*e.a,tx:t*(e.c*e.ty-e.d*e.tx),ty:t*(e.b*e.tx-e.a*e.ty)}};cc.POINT_EPSILON=parseFloat("1.192092896e-07F"),cc.pNeg=function(e){return cc.p(-e.x,-e.y)},cc.pAdd=function(e,t){return cc.p(e.x+t.x,e.y+t.y)},cc.pSub=function(e,t){return cc.p(e.x-t.x,e.y-t.y)},cc.pMult=function(e,t){return cc.p(e.x*t,e.y*t)},cc.pMidpoint=function(e,t){return cc.pMult(cc.pAdd(e,t),.5)},cc.pDot=function(e,t){return e.x*t.x+e.y*t.y},cc.pCross=function(e,t){return e.x*t.y-e.y*t.x},cc.pPerp=function(e){return cc.p(-e.y,e.x)},cc.pRPerp=function(e){return cc.p(e.y,-e.x)},cc.pProject=function(e,t){return cc.pMult(t,cc.pDot(e,t)/cc.pDot(t,t))},cc.pRotate=function(e,t){return cc.p(e.x*t.x-e.y*t.y,e.x*t.y+e.y*t.x)},cc.pUnrotate=function(e,t){return cc.p(e.x*t.x+e.y*t.y,e.y*t.x-e.x*t.y)},cc.pLengthSQ=function(e){return cc.pDot(e,e)},cc.pDistanceSQ=function(e,t){return cc.pLengthSQ(cc.pSub(e,t))},cc.pLength=function(e){return Math.sqrt(cc.pLengthSQ(e))},cc.pDistance=function(e,t){return cc.pLength(cc.pSub(e,t))},cc.pNormalize=function(e){return cc.pMult(e,1/cc.pLength(e))},cc.pForAngle=function(e){return cc.p(Math.cos(e),Math.sin(e))},cc.pToAngle=function(e){return Math.atan2(e.y,e.x)},cc.clampf=function(e,t,n){if(t>n){var r=t;t=n,n=r}return e<t?t:e<n?e:n},cc.pClamp=function(e,t,n){return cc.p(cc.clampf(e.x,t.x,n.x),cc.clampf(e.y,t.y,n.y))},cc.pFromSize=function(e){return cc.p(e.width,e.height)},cc.pCompOp=function(e,t){return cc.p(t(e.x),t(e.y))},cc.pLerp=function(e,t,n){return cc.pAdd(cc.pMult(e,1-n),cc.pMult(t,n))},cc.pFuzzyEqual=function(e,t,n){return e.x-n<=t.x&&t.x<=e.x+n&&e.y-n<=t.y&&t.y<=e.y+n?!0:!1},cc.pCompMult=function(e,t){return cc.p(e.x*t.x,e.y*t.y)},cc.pAngleSigned=function(e,t){var n=cc.pNormalize(e),r=cc.pNormalize(t),i=Math.atan2(n.x*r.y-n.y*r.x,cc.pDot(n,r));return Math.abs(i)<cc.POINT_EPSILON?0:i},cc.pAngle=function(e,t){var n=Math.acos(cc.pDot(cc.pNormalize(e),cc.pNormalize(t)));return Math.abs(n)<cc.POINT_EPSILON?0:n},cc.pRotateByAngle=function(e,t,n){var r=cc.pSub(e,t),i=Math.cos(n),s=Math.sin(n),o=r.x;return r.x=o*i-r.y*s+t.x,r.y=o*s+r.y*i+t.y,r},cc.pLineIntersect=function(e,t,n,r,i){if(e.x==t.x&&e.y==t.y||n.x==r.x&&n.y==r.y)return!1;var s=t.x-e.x,o=t.y-e.y,u=r.x-n.x,a=r.y-n.y,f=e.x-n.x,l=e.y-n.y,c=a*s-u*o;return i.x=u*l-a*f,i.y=s*l-o*f,c==0?i.x==0||i.y==0?!0:!1:(i.x=i.x/c,i.y=i.y/c,!0)},cc.pSegmentIntersect=function(e,t,n,r){var i=cc.p(0,0);return cc.pLineIntersect(e,t,n,r,i)&&i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1?!0:!1},cc.pIntersectPoint=function(e,t,n,r){var i=cc.p(0,0);if(cc.pLineIntersect(e,t,n,r,i)){var s=cc.p(0,0);return s.x=e.x+i.x*(t.x-e.x),s.y=e.y+i.x*(t.y-e.y),s}return cc.PointZero()},cc.pSameAs=function(e,t){return e!=null&&t!=null?e.x==t.x&&e.y==t.y:!1};cc.UserDefault=cc.Class.extend({_db:null,init:function(){return this._db=this._getLocalStorage(),!0},_getLocalStorage:function(){try{if(!!sys.localStorage)return sys.localStorage}catch(e){return undefined}},_getWebSqlDatabase:function(){},getBoolForKey:function(e,t){var n=this._getValueForKey(e),r=t||!1;return n=="true"?!0:n=="false"?!1:n?Boolean(n):r},getIntegerForKey:function(e,t){var n=this._getValueForKey(e),r=t||0;return n?parseInt(n):r},getFloatForKey:function(e,t){var n=this._getValueForKey(e),r=t||0;return n?parseFloat(n):r},getDoubleForKey:function(e,t){return this.getFloatForKey(e,t)},getStringForKey:function(e,t){var n=this._getValueForKey(e),r=t||"";return n?String(n):r},_getValueForKey:function(e){var t;return this._db&&(t=this._db.getItem(e)),t},setBoolForKey:function(e,t){this.setStringForKey(e,String(t))},setIntegerForKey:function(e,t){if(!e)return;this._setValueForKey(e,parseInt(t))},setFloatForKey:function(e,t){if(!e)return;this._setValueForKey(e,parseFloat(t))},setDoubleForKey:function(e,t){return this.setFloatForKey(e,t)},setStringForKey:function(e,t){if(!e)return;this._setValueForKey(e,String(t))},_setValueForKey:function(e,t){this._db&&this._db.setItem(e,t)}}),cc.UserDefault.getInstance=function(){return this._sUserDefault||(this._sUserDefault=new cc.UserDefault,this._sUserDefault.init()),this._sUserDefault},cc.UserDefault.purgeInstanceUserDefault=function(){cc.hasOwnProperty("Browser")&&this._db&&this._db.clear()},cc.UserDefault._sUserDefault=null,cc.UserDefault._isFilePathInitialized=!1;cc.vertexLineToPolygon=function(e,t,n,r,i){i+=r;if(i<=1)return;t*=.5;var s,o=i-1;for(var u=r;u<i;u++){s=u*2;var a=cc.p(e[u*2],e[u*2+1]),f;if(u===0)f=cc.pPerp(cc.pNormalize(cc.pSub(a,cc.p(e[(u+1)*2],e[(u+1)*2+1]))));else if(u===o)f=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(e[(u-1)*2],e[(u-1)*2+1]),a)));else{var l=cc.p(e[(u-1)*2],e[(u-1)*2+1]),c=cc.p(e[(u+1)*2],e[(u+1)*2+1]),h=cc.pNormalize(cc.pSub(c,a)),p=cc.pNormalize(cc.pSub(l,a)),d=Math.acos(cc.pDot(h,p));d<cc.DEGREES_TO_RADIANS(70)?f=cc.pPerp(cc.pNormalize(cc.pMidpoint(h,p))):d<cc.DEGREES_TO_RADIANS(170)?f=cc.pNormalize(cc.pMidpoint(h,p)):f=cc.pPerp(cc.pNormalize(cc.pSub(c,l)))}f=cc.pMult(f,t),n[s*2]=a.x+f.x,n[s*2+1]=a.y+f.y,n[(s+1)*2]=a.x-f.x,n[(s+1)*2+1]=a.y-f.y}r=r==0?0:r-1;for(u=r;u<o;u++){s=u*2;var v=s+2,m=cc.Vertex2(n[s*2],n[s*2+1]),g=cc.Vertex2(n[(s+1)*2],n[(s+1)*2+1]),y=cc.Vertex2(n[v*2],n[v*2]),b=cc.Vertex2(n[(v+1)*2],n[(v+1)*2+1]),w=!cc.vertexLineIntersect(m.x,m.y,b.x,b.y,g.x,g.y,y.x,y.y);!w.isSuccess&&(w.value<0||w.value>1)&&(w.isSuccess=!0),w.isSuccess&&(n[v*2]=b.x,n[v*2+1]=b.y,n[(v+1)*2]=y.x,n[(v+1)*2+1]=y.y)}},cc.vertexLineIntersect=function(e,t,n,r,i,s,o,u){var a,f,l,c;if(e==n&&t==r||i==o&&s==u)return{isSuccess:!1,value:0};n-=e,r-=t,i-=e,s-=t,o-=e,u-=t,a=Math.sqrt(n*n+r*r),f=n/a,l=r/a,c=i*f+s*l,s=s*f-i*l,i=c,c=o*f+u*l,u=u*f-o*l,o=c;if(s==u)return{isSuccess:!1,value:0};var h=(o+(i-o)*u/(u-s))/a;return{isSuccess:!0,value:h}};cc.CGAffineToGL=function(e,t){t[2]=t[3]=t[6]=t[7]=t[8]=t[9]=t[11]=t[14]=0,t[10]=t[15]=1,t[0]=e.a,t[4]=e.c,t[12]=e.tx,t[1]=e.b,t[5]=e.d,t[13]=e.ty},cc.GLToCGAffine=function(e,t){t.a=e[0],t.c=e[4],t.tx=e[12],t.b=e[1],t.d=e[5],t.ty=e[13]};cc.TGA_OK=0,cc.TGA_ERROR_FILE_OPEN=1,cc.TGA_ERROR_READING_FILE=2,cc.TGA_ERROR_INDEXED_COLOR=3,cc.TGA_ERROR_MEMORY=4,cc.TGA_ERROR_COMPRESSED_FILE=5,cc.ImageTGA=function(e,t,n,r,i,s,o){this.status=e||0,this.type=t||0,this.pixelDepth=n||0,this.width=r||0,this.height=i||0,this.imageData=s||[],this.flipped=o||0},cc.tgaLoadHeader=function(e,t,n){var r=2;if(r+1>t)return!1;var i=new cc.BinaryStreamReader(e);i.setOffset(r),n.type=i.readByte(),r+=10;if(r+4+1>t)return!1;i.setOffset(r),n.width=i.readUnsignedShort(),n.height=i.readUnsignedInteger(),n.pixelDepth=i.readByte(),r+=5;if(r+1>t)return!1;var s=i.readByte();return n.flipped=0,s&32&&(n.flipped=1),!0},cc.tgaLoadImageData=function(e,t,n){var r,i,s,o,u=18;r=0|n.pixelDepth/2,i=n.height*n.width*r;if(u+i>t)return!1;n.imageData=cc.__getSubArray(e,u,u+i);if(r>=3)for(s=0;s<i;s+=r)o=n.imageData[s],n.imageData[s]=n.imageData[s+2],n.imageData[s+2]=o;return!0},cc.tgaLoad=function(e){var t=cc.FileUtils.getInstance().getFileData(e,"rb"),n=t.length;if(t==null)return null;var r=new cc.ImageTGA;if(!cc.tgaLoadHeader(t,n,r))return r.status=cc.TGA_ERROR_MEMORY,r;if(r.type===1)return r.status=cc.TGA_ERROR_INDEXED_COLOR,r;if(r.type!=2&&r.type!=3&&r.type!=10)return r.status=cc.TGA_ERROR_COMPRESSED_FILE,r;var i=!1;return r.type==10?i=cc.tgaLoadRLEImageData(t,n,r):i=cc.tgaLoadImageData(t,n,r),i?(r.status=cc.TGA_OK,r.flipped&&(cc.tgaFlipImage(r),r.flipped&&(r.status=cc.TGA_ERROR_MEMORY)),t=null,r):(r.status=cc.TGA_ERROR_READING_FILE,r)},cc.tgaRGBtogreyscale=function(e){var t,n;if(e.pixelDepth===8)return;var r=e.pixelDepth/8,i=new Uint8Array(e.height*e.width);if(i===null)return;for(t=0,n=0;n<e.width*e.height;t+=r,n++)i[n]=.3*e.imageData[t]+.59*e.imageData[t+1]+.11*e.imageData[t+2];e.pixelDepth=8,e.type=3,e.imageData=i},cc.tgaDestroy=function(e){if(!e)return;e.imageData=null,e=null},cc.tgaLoadRLEImageData=function(e,t,n){var r,i,s,o=0,u=0,a=0,f=[],l=0,c=18;r=n.pixelDepth/8,i=n.height*n.width;for(s=0;s<i;s++){if(l!=0)l--,u=a!=0;else{if(c+1>t)break;l=e[c],c+=1,a=l&128,a&&(l-=128),u=0}if(!u){if(c+r>t)break;f=cc.__getSubArray(e,c,c+r),c+=r;if(r>=3){var h=f[0];f[0]=f[2],f[2]=h}}for(var p=0;p<r;p++)n.imageData[o+p]=f[p];o+=r}return!0},cc.tgaFlipImage=function(e){var t=e.pixelDepth/8,n=e.width*t;for(var r=0;r<e.height/2;r++){var i=cc.__getSubArray(e.imageData,r*n,r*n+n);cc.__setDataToArray(cc.__getSubArray(e.imageData,(e.height-(r+1))*n,n),e.imageData,r*n),cc.__setDataToArray(i,e.imageData,(e.height-(r+1))*n)}e.flipped=0},cc.__getSubArray=function(e,t,n){return e instanceof Array?e.slice(t,n):e.subarray(t,n)},cc.__setDataToArray=function(e,t,n){for(var r=0;r<e.length;r++)t[n+r]=e[r]},cc.BinaryStreamReader=cc.Class.extend({_binaryData:null,_offset:0,ctor:function(e){this._binaryData=e},setBinaryData:function(e){this._binaryData=e,this._offset=0},getBinaryData:function(){return this._binaryData},_checkSize:function(e){if(!(this._offset+Math.ceil(e/8)<this._data.length))throw new Error("Index out of bound")},_decodeFloat:function(e,t){var n=e+t+1,r=n>>3;this._checkSize(n);var i=Math.pow(2,t-1)-1,s=this._readBits(e+t,1,r),o=this._readBits(e,t,r),u=0,a=2,f=0;do{var l=this._readByte(++f,r),c=e%8||8,h=1<<c;while(h>>=1)l&h&&(u+=1/a),a*=2}while(e-=c);return this._offset+=r,o==(i<<1)+1?u?NaN:s?-Infinity:+Infinity:(1+s*-2)*(o||u?o?Math.pow(2,o-i)*(1+u):Math.pow(2,-i+1)*u:0)},_readByte:function(e,t){return this._data[this._offset+t-e-1]},_decodeInt:function(e,t){var n=this._readBits(0,e,e/8),r=Math.pow(2,e),i=t&&n>=r/2?n-r:n;return this._offset+=e/8,i},_shl:function(e,t){for(++t;--t;e=((e%=2147483647+1)&1073741824)==1073741824?e*2:(e-1073741824)*2+2147483647+1);return e},_readBits:function(e,t,n){var r=(e+t)%8,i=e%8,s=n-(e>>3)-1,o=n+(-(e+t)>>3),u=s-o,a=this._readByte(s,n)>>i&(1<<(u?8-i:t))-1;u&&r&&(a+=(this._readByte(o++,n)&(1<<r)-1)<<(u--<<3)-i);while(u)a+=this._shl(this._readByte(o++,n),(u--<<3)-i);return a},readInteger:function(){return this._decodeInt(32,!0)},readUnsignedInteger:function(){return this._decodeInt(32,!1)},readSingle:function(){return this._decodeFloat(23,8)},readShort:function(){return this._decodeInt(16,!0)},readUnsignedShort:function(){return this._decodeInt(16,!1)},readByte:function(){var e=this._data[this._offset];return this._offset+=1,e},readData:function(e,t){return this._binaryData instanceof Array?this._binaryData.slice(e,t):this._binaryData.subarray(e,t)},setOffset:function(e){this._offset=e},getOffset:function(){return this._offset}});cc.PNGReader=cc.Class.extend({ctor:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},s=null;for(;;){t=this.readUInt32(),f=function(){var e,t;t=[];for(o=e=0;e<4;o=++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("");switch(f){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":s&&this.animation.frames.push(s),this.pos+=4,s={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},i=this.readUInt16(),r=this.readUInt16()||100,s.delay=1e3*i/r,s.disposeOp=this.data[this.pos++],s.blendOp=this.data[this.pos++],s.data=[];break;case"IDAT":case"fdAT":f==="fdAT"&&(this.pos+=4,t-=4),e=(s!=null?s.data:void 0)||this.imgData;for(o=h=0;0<=t?h<t:h>t;o=0<=t?++h:--h)e.push(this.data[this.pos++]);break;case"tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(t),l=255-this.transparency.indexed.length;if(l>0)for(o=p=0;0<=l?p<l:p>l;o=0<=l?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":c=this.read(t),u=c.indexOf(0),a=String.fromCharCode.apply(String,c.slice(0,u)),this.text[a]=String.fromCharCode.apply(String,c.slice(u+1));break;case"IEND":s&&this.animation.frames.push(s),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(d=this.colorType)===4||d===6,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData));return;default:this.pos+=t}this.pos+=4;if(this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(e){var t,n,r;r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)r.push(this.data[this.pos++]);return r},readUInt32:function(){var e,t,n,r;return e=this.data[this.pos++]<<24,t=this.data[this.pos++]<<16,n=this.data[this.pos++]<<8,r=this.data[this.pos++],e|t|n|r},readUInt16:function(){var e,t;return e=this.data[this.pos++]<<8,t=this.data[this.pos++],e|t},decodePixels:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;e==null&&(e=this.imgData);if(e.length===0)return new Uint8Array(0);var T=new Zlib.Inflate(e,{index:0,verify:!1});e=T.decompress(),h=this.pixelBitlength/8,m=h*this.width,p=new Uint8Array(m*this.height),o=e.length,v=0,d=0,n=0;while(d<o){switch(e[d++]){case 0:for(i=b=0;b<m;i=b+=1)p[n++]=e[d++];break;case 1:for(i=w=0;w<m;i=w+=1)t=e[d++],s=i<h?0:p[n-h],p[n++]=(t+s)%256;break;case 2:for(i=E=0;E<m;i=E+=1)t=e[d++],r=(i-i%h)/h,g=v&&p[(v-1)*m+r*h+i%h],p[n++]=(g+t)%256;break;case 3:for(i=S=0;S<m;i=S+=1)t=e[d++],r=(i-i%h)/h,s=i<h?0:p[n-h],g=v&&p[(v-1)*m+r*h+i%h],p[n++]=(t+Math.floor((s+g)/2))%256;break;case 4:for(i=x=0;x<m;i=x+=1)t=e[d++],r=(i-i%h)/h,s=i<h?0:p[n-h],v===0?g=y=0:(g=p[(v-1)*m+r*h+i%h],y=r&&p[(v-1)*m+(r-1)*h+i%h]),u=s+g-y,a=Math.abs(u-s),l=Math.abs(u-g),c=Math.abs(u-y),a<=l&&a<=c?f=s:l<=c?f=g:f=y,p[n++]=(t+f)%256;break;default:throw new Error("Invalid filter algorithm: "+e[d-1])}v++}return p},copyToImageData:function(e,t){var n,r,i,s,o,u,a,f,l,c,h;r=this.colors,l=null,n=this.hasAlphaChannel,this.palette.length&&(l=(h=this._decodedPalette)!=null?h:this._decodedPalette=this.decodePalette(),r=4,n=!0),i=e.data||e,f=i.length,o=l||t,s=u=0;if(r===1)while(s<f)a=l?t[s/4]*4:u,c=o[a++],i[s++]=c,i[s++]=c,i[s++]=c,i[s++]=n?o[a++]:255,u=a;else while(s<f)a=l?t[s/4]*4:u,i[s++]=o[a++],i[s++]=o[a++],i[s++]=o[a++],i[s++]=n?o[a++]:255,u=a},decodePalette:function(){var e,t,n,r,i,s,o,u,a;n=this.palette,s=this.transparency.indexed||[],i=new Uint8Array((s.length||0)+n.length),r=0,e=0;for(t=o=0,u=n.length;o<u;t=o+=3)i[r++]=n[t],i[r++]=n[t+1],i[r++]=n[t+2],i[r++]=(a=s[e++])!=null?a:255;return i},render:function(e){var t,n;return e.width=this.width,e.height=this.height,t=e.getContext("2d"),n=t.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0)}});cc.TIFFReader=cc.Class.extend({_littleEndian:!1,_tiffData:null,_fileDirectories:null,ctor:function(){this._fileDirectories=[]},getUint8:function(e){return this._tiffData[e]},getUint16:function(e){return this._littleEndian?this._tiffData[e+1]<<8|this._tiffData[e]:this._tiffData[e]<<8|this._tiffData[e+1]},getUint32:function(e){var t=this._tiffData;return this._littleEndian?t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]:t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]},checkLittleEndian:function(){var e=this.getUint16(0);if(e===18761)this.littleEndian=!0;else{if(e!==19789)throw console.log(e),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(this.getUint16(2)!==42)throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(e){var t=this.fieldTypeNames;return e in t?t[e]:null},getFieldTagName:function(e){var t=this.fieldTagNames;return e in t?t[e]:(console.log("Unknown Field Tag:",e),"Tag"+e)},getFieldTypeLength:function(e){return["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(e)!==-1?1:["SHORT","SSHORT"].indexOf(e)!==-1?2:["LONG","SLONG","FLOAT"].indexOf(e)!==-1?4:["RATIONAL","SRATIONAL","DOUBLE"].indexOf(e)!==-1?8:null},getFieldValues:function(e,t,n,r){var i=[],s=this.getFieldTypeLength(t),o=s*n;if(o<=4)this.littleEndian===!1?i.push(r>>>(4-s)*8):i.push(r);else for(var u=0;u<n;u++){var a=s*u;s>=8?["RATIONAL","SRATIONAL"].indexOf(t)!==-1?(i.push(this.getUint32(r+a)),i.push(this.getUint32(r+a+4))):cc.log("Can't handle this field type or size"):i.push(this.getBytes(s,r+a))}return t==="ASCII"&&i.forEach(function(e,t,n){n[t]=String.fromCharCode(e)}),i},getBytes:function(e,t){if(e<=0)cc.log("No bytes requested");else{if(e<=1)return this.getUint8(t);if(e<=2)return this.getUint16(t);if(e<=3)return this.getUint32(t)>>>8;if(e<=4)return this.getUint32(t);cc.log("Too many bytes requested")}},getBits:function(e,t,n){n=n||0;var r=Math.floor(n/8),i=t+r,s=n+e,o=32-e,u,a;return s<=0?console.log("No bits requested"):s<=8?(u=24+n,a=this.getUint8(i)):s<=16?(u=16+n,a=this.getUint16(i)):s<=32?(u=n,a=this.getUint32(i)):console.log("Too many bits requested"),{bits:a<<u>>>o,byteOffset:i+Math.floor(s/8),bitOffset:s%8}},parseFileDirectory:function(e){var t=this.getUint16(e),n=[];for(var r=e+2,i=0;i<t;r+=12,i++){var s=this.getUint16(r),o=this.getUint16(r+2),u=this.getUint32(r+4),a=this.getUint32(r+8),f=this.getFieldTagName(s),l=this.getFieldTypeName(o),c=this.getFieldValues(f,l,u,a);n[f]={type:l,values:c}}this.fileDirectories.push(n);var h=this.getUint32(r);h!==0&&this.parseFileDirectory(h)},clampColorSample:function(e,t){var n=Math.pow(2,8-t);return Math.floor(e*n+(n-1))},parseTIFF:function(e,t){t=t||document.createElement("canvas"),this._tiffData=e,this.canvas=t,this.checkLittleEndian();if(!this.hasTowel())return;var n=this.getUint32(4);this.fileDirectories=[],this.parseFileDirectory(n);var r=this.fileDirectories[0],i=r.ImageWidth.values[0],s=r.ImageLength.values[0];this.canvas.width=i,this.canvas.height=s;var o=[],u=r.Compression?r.Compression.values[0]:1,a=r.SamplesPerPixel.values[0],f=[],l=0,c=!1;r.BitsPerSample.values.forEach(function(e,t,n){f[t]={bitsPerSample:e,hasBytesPerSample:!1,bytesPerSample:undefined},e%8===0&&(f[t].hasBytesPerSample=!0,f[t].bytesPerSample=e/8),l+=e},this);if(l%8===0){c=!0;var h=l/8}var p=r.StripOffsets.values,d=p.length;if(r.StripByteCounts)var v=r.StripByteCounts.values;else{cc.log("Missing StripByteCounts!");if(d!==1)throw Error("Cannot recover from missing StripByteCounts");var v=[Math.ceil(i*s*l/8)]}for(var m=0;m<d;m++){var g=p[m];o[m]=[];var y=v[m];for(var b=0,w=0,E=1,S=!0,x=[],T=0,N=0,C=0;b<y;b+=E)switch(u){case 1:for(var k=0,x=[];k<a;k++){if(!f[k].hasBytesPerSample){var A=this.getBits(f[k].bitsPerSample,g+b,w);throw x.push(A.bits),b=A.byteOffset-g,w=A.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}var L=f[k].bytesPerSample*k;x.push(this.getBytes(f[k].bytesPerSample,g+b+L))}o[m].push(x);if(!c)throw E=0,RangeError("Cannot handle sub-byte bits per pixel");E=h;break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 32773:if(S){S=!1;var O=1,M=1,_=this.getInt8(g+b);_>=0&&_<=127?O=_+1:_>=-127&&_<=-1?M=-_+1:S=!0}else{var D=this.getUint8(g+b);for(var k=0;k<M;k++){if(!f[N].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");C=C<<8*T|D,T++,T===f[N].bytesPerSample&&(x.push(C),C=T=0,N++),N===a&&(o[m].push(x),x=[],N=0)}O--,O===0&&(S=!0)}E=1;break;default:}}if(t.getContext){var P=this.canvas.getContext("2d");P.fillStyle="rgba(255, 255, 255, 0)";var H=r.RowsPerStrip?r.RowsPerStrip.values[0]:s,B=o.length,j=s%H,F=j===0?H:j,I=H,q=0,R=r.PhotometricInterpretation.values[0],U=[],z=0;r.ExtraSamples&&(U=r.ExtraSamples.values,z=U.length);if(r.ColorMap)var W=r.ColorMap.values,X=Math.pow(2,f[0].bitsPerSample);for(var m=0;m<B;m++){m+1===B&&(I=F);var V=o[m].length,$=q*m;for(var J=0,K=0;J<I,K<V;J++)for(var Q=0;Q<i;Q++,K++){var G=o[m][K],Y=0,Z=0,et=0,tt=1;if(z>0)for(var nt=0;nt<z;nt++)if(U[nt]===1||U[nt]===2){tt=G[3+nt]/256;break}switch(R){case 0:if(f[0].hasBytesPerSample)var rt=Math.pow(16,f[0].bytesPerSample*2);G.forEach(function(e,t,n){n[t]=rt-e});case 1:Y=Z=et=this.clampColorSample(G[0],f[0].bitsPerSample);break;case 2:Y=this.clampColorSample(G[0],f[0].bitsPerSample),Z=this.clampColorSample(G[1],f[1].bitsPerSample),et=this.clampColorSample(G[2],f[2].bitsPerSample);break;case 3:if(W===undefined)throw Error("Palette image missing color map");var it=G[0];Y=this.clampColorSample(W[it],16),Z=this.clampColorSample(W[X+it],16),et=this.clampColorSample(W[2*X+it],16);break;default:throw RangeError("Unknown Photometric Interpretation:",R)}P.fillStyle="rgba("+Y+", "+Z+", "+et+", "+tt+")",P.fillRect(Q,$+J,1,1)}q=I}}return this.canvas},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}}),cc.TIFFReader.__instance=null,cc.TIFFReader.getInstance=function(){return cc.TIFFReader.__instance||(cc.TIFFReader.__instance=new cc.TIFFReader),cc.TIFFReader.__instance};cc.SHADER_POSITION_UCOLOR_FRAG="                                           \nprecision lowp float;                    \n                                         \nvarying vec4 v_fragmentColor;            \n                                         \nvoid main()                              \n{                                        \n    gl_FragColor = v_fragmentColor;      \n}                                        \n",cc.SHADER_POSITION_UCOLOR_VERT="                                               \nattribute vec4 a_position;               \nuniform    vec4 u_color;                 \nuniform float u_pointSize;               \n                                         \nvarying lowp vec4 v_fragmentColor;       \n                                         \nvoid main(void)                          \n{                                        \n    gl_Position = CC_MVPMatrix * a_position; \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",cc.SHADER_POSITION_COLOR_FRAG="                                        \nprecision lowp float;                 \nvarying vec4 v_fragmentColor;         \n                                      \nvoid main()                           \n{                                     \n     gl_FragColor = v_fragmentColor;       \n} ",cc.SHADER_POSITION_COLOR_VERT="                                                \nattribute vec4 a_position;                \nattribute vec4 a_color;                   \n                                          \nvarying lowp vec4 v_fragmentColor;        \n                                          \nvoid main()                               \n{                                         \n   gl_Position = CC_MVPMatrix * a_position; \n    v_fragmentColor = a_color;             \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="                                               \n// #extension GL_OES_standard_derivatives : enable																			\n\nvarying mediump vec4 v_color;																								\nvarying mediump vec2 v_texcoord;																							    \n\nvoid main()																													\n{																															\n// #if defined GL_OES_standard_derivatives																					\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord));							    \n// #else																														\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord));														        \n// #endif																													\n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="																	        \nattribute mediump vec4 a_position;									\nattribute mediump vec2 a_texcoord;									\nattribute mediump vec4 a_color;										\n\nvarying mediump vec4 v_color;										\nvarying mediump vec2 v_texcoord;									    \n\nvoid main()															\n{																	\n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a);				\n     v_texcoord = a_texcoord;										\n																        \n     gl_Position = CC_MVPMatrix * a_position;						\n}",cc.SHADER_POSITION_TEXTURE_FRAG="                                             \nprecision lowp float;                      \n                                           \nvarying vec2 v_texCoord;                   \nuniform sampler2D CC_Texture0;             \n                                           \nvoid main()                                \n{                                          \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",cc.SHADER_POSITION_TEXTURE_VERT="                                                   \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                  \n                                            \nvarying mediump vec2 v_texCoord;           \n                                           \nvoid main()                                \n{                                          \n    gl_Position = CC_MVPMatrix * a_position; \n    v_texCoord = a_texCoord;               \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="                                                \nprecision lowp float;                        \n                                             \nuniform vec4 u_color;                        \nvarying vec2 v_texCoord;                     \n                                             \nuniform sampler2D CC_Texture0;               \n                                             \nvoid main()                                  \n{                                            \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="                                               \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                   \n                                             \nvarying mediump vec2 v_texCoord;             \n                                             \nvoid main()                                  \n{                                            \n    gl_Position = CC_MVPMatrix * a_position;  \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="                                               \nprecision lowp float;                        \n                                             \nvarying vec4 v_fragmentColor;                \nvarying vec2 v_texCoord;                     \nuniform sampler2D CC_Texture0;                 \n                                             \nvoid main()                                  \n{                                            \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    );                                       \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="                                               \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                   \nattribute vec4 a_color;                      \n                                             \nvarying lowp vec4 v_fragmentColor;           \nvarying mediump vec2 v_texCoord;             \n                                             \nvoid main()                                  \n{                                            \n    gl_Position = CC_MVPMatrix * a_position; \n    v_fragmentColor = a_color;               \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="                                               \nprecision lowp float;                        \n                                             \nvarying vec4 v_fragmentColor;                \nvarying vec2 v_texCoord;                     \nuniform sampler2D CC_Texture0;               \n                                             \nvoid main()                                  \n{                                            \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);         \n}",cc.SHADER_POSITION_TEXTURE_COLOR_VERT="                                               \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                   \nattribute vec4 a_color;                      \n                                             \nvarying lowp vec4 v_fragmentColor;           \nvarying mediump vec2 v_texCoord;             \n                                             \nvoid main()                                  \n{                                            \n    gl_Position = CC_MVPMatrix * a_position;  \n    v_fragmentColor = a_color;               \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="                                                  \nprecision lowp float;                           \n                                                \nvarying vec4 v_fragmentColor;                   \nvarying vec2 v_texCoord;                        \nuniform sampler2D CC_Texture0;                  \nuniform float CC_alpha_value;                   \n                                                \nvoid main()                                     \n{                                               \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);          \n                                                \n    // mimic: glAlphaFunc(GL_GREATER)           \n    //pass if ( incoming_pixel >= CC_alpha_value ) => fail if incoming_pixel < CC_alpha_value         \n                                                \n    if ( texColor.a <= CC_alpha_value )          \n        discard;                                \n                                                \n    gl_FragColor = texColor * v_fragmentColor;  \n}",cc.SHADEREX_SWITCHMASK_FRAG="                                                   \nprecision lowp float;                            \n                                                 \nvarying vec4 v_fragmentColor;                    \nvarying vec2 v_texCoord;                         \nuniform sampler2D u_texture;                     \nuniform sampler2D   u_mask;                      \n                                                 \nvoid main()                                      \n{                                                \n    vec4 texColor   = texture2D(u_texture, v_texCoord);          \n    vec4 maskColor  = texture2D(u_mask, v_texCoord);             \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor;              \n}";cc.SHADERTYPE_POSITION_TEXTURECOLOR=0,cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST=1,cc.SHADERTYPE_POSITION_COLOR=2,cc.SHADERTYPE_POSITION_TEXTURE=3,cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR=4,cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR=5,cc.SHADERTYPE_POSITION_UCOLOR=6,cc.SHADERTYPE_POSITION_LENGTH_TEXTURECOLOR=7,cc.SHADERTYPE_MAX=8,cc._sharedShaderCache=null,cc.ShaderCache=cc.Class.extend({_programs:null,_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(e,t){switch(t){case cc.SHADERTYPE_POSITION_TEXTURECOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_COLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADERTYPE_POSITION_TEXTURE:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_UCOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG),e.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case cc.SHADERTYPE_POSITION_LENGTH_TEXTURECOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:cc.log("cocos2d: cc.ShaderCache._loadDefaultShader, error shader type");return}e.link(),e.updateUniforms()},ctor:function(){this._programs={}},loadDefaultShaders:function(){var e=new cc.GLProgram;this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_TEXTURECOLOR]=e,this._programs.ShaderPositionTextureColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[cc.SHADER_POSITION_TEXTURECOLORALPHATEST]=e,this._programs.ShaderPositionTextureColorAlphaTest=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_COLOR),this._programs[cc.SHADER_POSITION_COLOR]=e,this._programs.ShaderPositionColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE),this._programs[cc.SHADER_POSITION_TEXTURE]=e,this._programs.ShaderPositionTexture=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR),this._programs[cc.SHADER_POSITION_TEXTURE_UCOLOR]=e,this._programs.ShaderPositionTextureUColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR),this._programs[cc.SHADER_POSITION_TEXTUREA8COLOR]=e,this._programs.ShaderPositionTextureA8Color=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_UCOLOR),this._programs[cc.SHADER_POSITION_UCOLOR]=e,this._programs.ShaderPositionUColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_LENGTHTEXTURECOLOR]=e,this._programs.ShaderPositionLengthTextureColor=e},reloadDefaultShaders:function(){var e=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR),e=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST),e=this.programForKey(cc.SHADER_POSITION_COLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_COLOR),e=this.programForKey(cc.SHADER_POSITION_TEXTURE),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE),e=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR),e=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR),e=this.programForKey(cc.SHADER_POSITION_UCOLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_UCOLOR)},programForKey:function(e){return this._programs[e]},getProgram:function(e){return this._programs[e]},addProgram:function(e,t){this._programs[t]=e}}),cc.ShaderCache.getInstance=function(){return cc._sharedShaderCache||(cc._sharedShaderCache=new cc.ShaderCache,cc._sharedShaderCache._init()),cc._sharedShaderCache},cc.ShaderCache.purgeSharedShaderCache=function(){cc._sharedShaderCache=null};cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=3,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.HashUniformEntry=function(e,t,n){this.value=e,this.location=t,this.hh=n||{}},cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(e,t,n){if(e==null)return!1;var r=!0,i=null;for(var s=0;s<this._hashForUniforms.length;s++)this._hashForUniforms[s].location==e&&(i=this._hashForUniforms[s]);return i?i.value==t?r=!1:i.value=t:(i=new cc.HashUniformEntry,i.location=e,i.value=t,this._hashForUniforms.push(i)),r},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(e,t,n){if(!n||!e)return!1;var r=t==this._glContext.VERTEX_SHADER?"precision highp float;\n":"precision mediump float;\n";n=r+"uniform mat4 CC_PMatrix;          \n"+"uniform mat4 CC_MVMatrix;        \n"+"uniform mat4 CC_MVPMatrix;       \n"+"uniform vec4 CC_Time;            \n"+"uniform vec4 CC_SinTime;         \n"+"uniform vec4 CC_CosTime;         \n"+"uniform vec4 CC_Random01;        \n"+"//CC INCLUDES END                \n  \n"+n,this._glContext.shaderSource(e,n),this._glContext.compileShader(e);var i=this._glContext.getShaderParameter(e,this._glContext.COMPILE_STATUS);return i||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(e)),t==this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),i==1},ctor:function(e){this._programObj=null,this._vertShader=null,this._fragShader=null,this._uniforms=[],this._hashForUniforms=[],this._glContext=e||cc.renderContext},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(e,t){return this._programObj=cc.renderContext.createProgram(),this._vertShader=null,this._fragShader=null,e&&(this._vertShader=this._glContext.createShader(this._glContext.VERTEX_SHADER),this._compileShader(this._vertShader,this._glContext.VERTEX_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),t&&(this._fragShader=this._glContext.createShader(this._glContext.FRAGMENT_SHADER),this._compileShader(this._fragShader,this._glContext.FRAGMENT_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&this._glContext.attachShader(this._programObj,this._vertShader),cc.CHECK_GL_ERROR_DEBUG(),this._fragShader&&this._glContext.attachShader(this._programObj,this._fragShader),this._hashForUniforms=[],cc.CHECK_GL_ERROR_DEBUG(),!0},initWithString:function(e,t){return this.initWithVertexShaderByteArray(e,t)},initWithVertexShaderFilename:function(e,t){var n=cc.FileUtils.getInstance().getTextFileData(e),r=cc.FileUtils.getInstance().getTextFileData(t);return this.initWithVertexShaderByteArray(n,r)},init:function(e,t){return this.initWithVertexShaderFilename(e,t)},addAttribute:function(e,t){this._glContext.bindAttribLocation(this._programObj,t,e)},link:function(){cc.Assert(this._programObj!=null,"Cannot link invalid program"),this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null;if(cc.COCOS2D_DEBUG){var e=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!e)return cc.log("cocos2d: ERROR: Failed to link program: "+this._programObj),cc.glDeleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S),this._uniforms[cc.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S),this._uniforms[cc.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S),this._uniforms[cc.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S),this._uniforms[cc.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S),this._uniforms[cc.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S),this._usesTime=this._uniforms[cc.UNIFORM_TIME]!=null||this._uniforms[cc.UNIFORM_SINTIME]!=null||this._uniforms[cc.UNIFORM_COSTIME]!=null,this._uniforms[cc.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S),this._uniforms[cc.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER],0)},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(e,t){var n=this._updateUniformLocation(e,t);n&&this._glContext.uniform1i(e,t)},setUniformLocationI32:function(e,t){this.setUniformLocationWith1i(arguments[0],arguments[1])},setUniformLocationWith1f:function(e,t){var n=this._updateUniformLocation(e,t);n&&this._glContext.uniform1f(e,t)},setUniformLocationWith2f:function(e,t,n){var r=[t,n],i=this._updateUniformLocation(e,r);i&&this._glContext.uniform2f(e,t,n)},setUniformLocationWith3f:function(e,t,n,r){var i=[t,n,r],s=this._updateUniformLocation(e,i);s&&this._glContext.uniform3f(e,t,n,r)},setUniformLocationWith4f:function(e,t,n,r,i){var s=[t,n,r,i],o=this._updateUniformLocation(e,s);o&&this._glContext.uniform4f(e,t,n,r,i)},setUniformLocationWith2fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform2fv(e,t)},setUniformLocationWith3fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform3fv(e,t)},setUniformLocationWith4fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform4fv(e,t)},setUniformLocationWithMatrix4fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniformMatrix4fv(e,!1,t)},setUniformLocationF32:function(){if(arguments.length<2)return;switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var e=new cc.kmMat4,t=new cc.kmMat4,n=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,e),cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,t),cc.kmMat4Multiply(n,e,t),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],n.mat,1);if(this._usesTime){var r=cc.Director.getInstance(),i=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME],i/10,i,i*2,i*4),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME],i/8,i/4,i/2,Math.sin(i)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME],i/8,i/4,i/2,Math.cos(i))}this._uniforms[cc.UNIFORM_RANDOM01]!=-1&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],!1,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(e){cc.kmMat4Multiply(e,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],!1,e.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms=[],this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var e=0;e<this._hashForUniforms.length;e++)this._hashForUniforms[e].value=null,this._hashForUniforms[e]=null;this._hashForUniforms=[]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram.create=function(e,t){var n=new cc.GLProgram;return n.init(e,t)?n:null};cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEXCOORDS=4,cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEXCOORDS,cc.GL_ALL=0,cc._currentProjectionMatrix=-1,cc._vertexAttribPosition=!1,cc._vertexAttribColor=!1,cc._vertexAttribTexCoords=!1,cc.ENABLE_GL_STATE_CACHE&&(cc.MAX_ACTIVETEXTURE=16,cc._currentShaderProgram=-1,cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0,cc._uVAO=0),cc.glInvalidateStateCache=function(){cc.kmGLFreeAll(),cc._currentProjectionMatrix=-1,cc._vertexAttribPosition=!1,cc._vertexAttribColor=!1,cc._vertexAttribTexCoords=!1;if(cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var e=0;e<cc.MAX_ACTIVETEXTURE;e++)cc._currentBoundTexture[e]=-1;cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0}},cc.glUseProgram=function(e){e!==cc._currentShaderProgram&&(cc._currentShaderProgram=e,cc.renderContext.useProgram(e))},cc.ENABLE_GL_STATE_CACHE||(cc.glUseProgram=function(e){cc.renderContext.useProgram(e)}),cc.glDeleteProgram=function(e){cc.ENABLE_GL_STATE_CACHE&&e===cc._currentShaderProgram&&(cc._currentShaderProgram=-1),cc.renderContext.deleteProgram(e)},cc.glBlendFunc=function(e,t){if(e!==cc._blendingSource||t!==cc._blendingDest)cc._blendingSource=e,cc._blendingDest=t,cc.setBlending(e,t)},cc.setBlending=function(e,t){e===cc.renderContext.ONE&&t===cc.renderContext.ZERO?cc.renderContext.disable(cc.renderContext.BLEND):(cc.renderContext.enable(cc.renderContext.BLEND),cc.renderContext.blendFuncSeparate(gl.SRC_ALPHA,t,e,t))},cc.ENABLE_GL_STATE_CACHE&&(cc.glBlendFunc=cc.setBlending),cc.glBlendResetToCache=function(){cc.renderContext.blendEquation(cc.renderContext.FUNC_ADD),cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(cc.renderContext.BLEND_SRC,cc.renderContext.BLEND_DST)},cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1},cc.glEnableVertexAttribs=function(e){var t=e&cc.VERTEX_ATTRIB_FLAG_POSITION;t!==cc._vertexAttribPosition&&(t?cc.renderContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION):cc.renderContext.disableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),cc._vertexAttribPosition=t);var n=e&cc.VERTEX_ATTRIB_FLAG_COLOR;n!==cc._vertexAttribColor&&(n?cc.renderContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR):cc.renderContext.disableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc._vertexAttribColor=n);var r=e&cc.VERTEX_ATTRIB_FLAG_TEXCOORDS;r!==cc._vertexAttribTexCoords&&(r?cc.renderContext.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS):cc.renderContext.disableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),cc._vertexAttribTexCoords=r)},cc.glBindTexture2D=function(e){cc.glBindTexture2DN(0,e)},cc.glBindTexture2DN=function(e,t){if(cc._currentBoundTexture[e]===t)return;cc._currentBoundTexture[e]=t,cc.renderContext.activeTexture(cc.renderContext.TEXTURE0+e),t?cc.renderContext.bindTexture(cc.renderContext.TEXTURE_2D,t._webTextureObj):cc.renderContext.bindTexture(cc.renderContext.TEXTURE_2D,null)},cc.ENABLE_GL_STATE_CACHE||(cc.glBindTexture2DN=function(e,t){cc.renderContext.activeTexture(cc.renderContext.TEXTURE0+e),t?cc.renderContext.bindTexture(cc.renderContext.TEXTURE_2D,t._webTextureObj):cc.renderContext.bindTexture(cc.renderContext.TEXTURE_2D,null)}),cc.glDeleteTexture=function(e){cc.glDeleteTextureN(0,e)},cc.glDeleteTextureN=function(e,t){cc.ENABLE_GL_STATE_CACHE&&t==cc._currentBoundTexture[e]&&(cc._currentBoundTexture[e]=-1),cc.renderContext.deleteTexture(t)},cc.glBindVAO=function(e){if(!cc.TEXTURE_ATLAS_USE_VAO)return;cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!=e&&(cc._uVAO=e)},cc.glEnable=function(e){cc.ENABLE_GL_STATE_CACHE};cc.NODE_TAG_INVALID=-1,cc.NODE_ON_ENTER=null,cc.NODE_ON_EXIT=null,cc.s_globalOrderOfArrival=1,cc.NodeWebGL=cc.Class.extend({_zOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_anchorPointInPoints:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,_tag:cc.NODE_TAG_INVALID,_userData:null,_userObject:null,_transformDirty:!0,_inverseDirty:!0,_cacheDirty:!0,_transformGLDirty:null,_transform:null,_inverse:null,_reorderChildDirty:!1,_shaderProgram:null,_orderOfArrival:0,_actionManager:null,_scheduler:null,_initializedNode:!1,_additionalTransformDirty:!1,_additionalTransform:null,_initNode:function(){this._anchorPoint=cc.p(0,0),this._anchorPointInPoints=cc.p(0,0),this._contentSize=cc.size(0,0),this._position=cc.p(0,0);var e=cc.Director.getInstance();this._actionManager=e.getActionManager(),this.getActionManager=function(){return this._actionManager},this._scheduler=e.getScheduler(),this.getScheduler=function(){return this._scheduler},this._initializedNode=!0,this._additionalTransform=cc.AffineTransformMakeIdentity(),this._additionalTransformDirty=!1},init:function(){return this._initializedNode===!1&&this._initNode(),!0},_arrayMakeObjectsPerformSelector:function(e,t){if(!e||e.length==0)return;var n;switch(t){case cc.Node.StateCallbackType.onEnter:for(n=0;n<e.length;n++)e[n]&&e[n].onEnter();break;case cc.Node.StateCallbackType.onExit:for(n=0;n<e.length;n++)e[n]&&e[n].onExit();break;case cc.Node.StateCallbackType.onEnterTransitionDidFinish:for(n=0;n<e.length;n++)e[n]&&e[n].onEnterTransitionDidFinish();break;case cc.Node.StateCallbackType.cleanup:for(n=0;n<e.length;n++)e[n]&&e[n].cleanup();break;case cc.Node.StateCallbackType.updateTransform:for(n=0;n<e.length;n++)e[n]&&e[n].updateTransform();break;case cc.Node.StateCallbackType.onExitTransitionDidStart:for(n=0;n<e.length;n++)e[n]&&e[n].onExitTransitionDidStart();break;case cc.Node.StateCallbackType.sortAllChildren:for(n=0;n<e.length;n++)e[n]&&e[n].sortAllChildren();break;default:throw"Unknown callback function"}},setNodeDirty:function(){this._transformDirty=this._inverseDirty=!0},getSkewX:function(){return this._skewX},setSkewX:function(e){this._skewX=e,this.setNodeDirty()},getSkewY:function(){return this._skewY},setSkewY:function(e){this._skewY=e,this.setNodeDirty()},getZOrder:function(){return this._zOrder},_setZOrder:function(e){this._zOrder=e},setZOrder:function(e){this._setZOrder(e),this._parent&&this._parent.reorderChild(this,e)},getVertexZ:function(){return this._vertexZ},setVertexZ:function(e){this._vertexZ=e},getRotation:function(){return cc.Assert(this._rotationX==this._rotationY,"CCNode#rotation. RotationX != RotationY. Don't know which one to return"),this._rotationX},_rotationRadiansX:0,_rotationRadiansY:0,setRotation:function(e){this._rotationX=this._rotationY=e,this._rotationRadiansX=this._rotationX*(Math.PI/180),this._rotationRadiansY=this._rotationY*(Math.PI/180),this.setNodeDirty()},getRotationX:function(){return this._rotationX},setRotationX:function(e){this._rotationX=e,this._rotationRadiansX=this._rotationX*(Math.PI/180),this.setNodeDirty()},getRotationY:function(){return this._rotationY},setRotationY:function(e){this._rotationY=e,this._rotationRadiansY=this._rotationY*(Math.PI/180),this.setNodeDirty()},getScale:function(){return cc.Assert(this._scaleX==this._scaleY,"cc.Node#scale. ScaleX != ScaleY. Don't know which one to return"),this._scaleX},setScale:function(e,t){this._scaleX=e,this._scaleY=t||e,this.setNodeDirty()},getScaleX:function(){return this._scaleX},setScaleX:function(e){this._scaleX=e,this.setNodeDirty()},getScaleY:function(){return this._scaleY},setScaleY:function(e){this._scaleY=e,this.setNodeDirty()},setPosition:function(e,t){arguments.length==2?this._position=new cc.Point(e,t):arguments.length==1&&(this._position=new cc.Point(e.x,e.y)),this.setNodeDirty()},_setPositionByValue:function(e,t){arguments.length==2?(this._position.x=e,this._position.y=t):arguments.length==1&&(this._position.x=e.x,this._position.y=e.y),this.setNodeDirty()},getPosition:function(){return cc.p(this._position.x,this._position.y)},getPositionX:function(){return this._position.x},setPositionX:function(e){this._position.x=e,this.setNodeDirty()},getPositionY:function(){return this._position.y},setPositionY:function(e){this._position.y=e,this.setNodeDirty()},getChildrenCount:function(){return this._children?this._children.length:0},getChildren:function(){return this._children||(this._children=[]),this._children},isVisible:function(){return this._visible},setVisible:function(e){this._visible=e,this.setNodeDirty()},getAnchorPoint:function(){return cc.p(this._anchorPoint.x,this._anchorPoint.y)},setAnchorPoint:function(e){cc.Point.CCPointEqualToPoint(e,this._anchorPoint)||(this._anchorPoint=new cc.Point(e.x,e.y),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y),this.setNodeDirty())},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints.x,this._anchorPointInPoints.y)},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(e){cc.Size.CCSizeEqualToSize(e,this._contentSize)||(this._contentSize=new cc.Size(e.width,e.height),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y),this.setNodeDirty())},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(e){this._parent=e},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(e){e!=this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=e,this.setNodeDirty())},getTag:function(){return this._tag},setTag:function(e){this._tag=e},getUserData:function(){return this._userData},setUserData:function(e){this._userData=e},getUserObject:function(){return this._userObject},setUserObject:function(e){this._userObject!=e&&(this._userObject=e)},getOrderOfArrival:function(){return this._orderOfArrival},setOrderOfArrival:function(e){this._orderOfArrival=e},getActionManager:function(){return this._actionManager||(this._actionManager=cc.Director.getInstance().getActionManager(),this.getActionManager=function(){return this._actionManager}),this._actionManager},setActionManager:function(e){this._actionManager!=e&&(this.stopAllActions(),this._actionManager=e)},getScheduler:function(){return this._scheduler||(this._scheduler=cc.Director.getInstance().getScheduler(),this.getScheduler=function(){return this._scheduler}),this._scheduler},setScheduler:function(e){this._scheduler!=e&&(this.unscheduleAllCallbacks(),this._scheduler=e)},getBoundingBox:function(){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.RectApplyAffineTransform(e,this.nodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup)},description:function(){return"<cc.Node | Tag ="+this._tag+">"},_childrenAlloc:function(){this._children=[]},getChildByTag:function(e){if(this._children!=null)for(var t=0;t<this._children.length;t++){var n=this._children[t];if(n&&n._tag==e)return n}return null},addChild:function(e,t,n){if(e===this){console.warn("cc.Node.addChild: An Node can't be added as a child of itself.");return}cc.Assert(e!=null,"Argument must be non-nil");if(e._parent!==null){cc.Assert(e._parent===null,"child already added. It can't be added again");return}var r=t!=null?t:e.getZOrder(),i=n!=null?n:e.getTag();e.setTag(i),this._children||this._childrenAlloc(),this._insertChild(e,r),e.setParent(this),this._running&&(e.onEnter(),e.onEnterTransitionDidFinish())},removeFromParent:function(e){this._parent&&(e==null&&(e=!0),this._parent.removeChild(this,e))},removeFromParentAndCleanup:function(e){cc.log("removeFromParentAndCleanup is deprecated. Use removeFromParent instead"),this.removeFromParent(e)},removeChild:function(e,t){if(this._children==null)return;t==null&&(t=!0),this._children.indexOf(e)>-1&&this._detachChild(e,t),this.setNodeDirty()},removeChildByTag:function(e,t){cc.Assert(e!=cc.NODE_TAG_INVALID,"Invalid tag");var n=this.getChildByTag(e);n==null?cc.log("cocos2d: removeChildByTag: child not found!"):this.removeChild(n,t)},removeAllChildrenWithCleanup:function(e){cc.log("removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead"),this.removeAllChildren(e)},removeAllChildren:function(e){if(this._children!=null){e==null&&(e=!0);for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&(this._running&&(n.onExitTransitionDidStart(),n.onExit()),e&&n.cleanup(),n.setParent(null))}this._children.length=0}},_detachChild:function(e,t){this._running&&(e.onExitTransitionDidStart(),e.onExit()),t&&e.cleanup(),e.setParent(null),cc.ArrayRemoveObject(this._children,e)},_insertChild:function(e,t){this._reorderChildDirty=!0;var n=this._children[this._children.length-1];if(!n||n.getZOrder()<=t)this._children.push(e);else for(var r=0;r<this._children.length;r++){var i=this._children[r];if(i&&i.getZOrder()>t){this._children=cc.ArrayAppendObjectToIndex(this._children,e,r);break}}e._setZOrder(t)},reorderChild:function(e,t){cc.Assert(e!=null,"Child must be non-nil"),this._reorderChildDirty=!0,e.setOrderOfArrival(cc.s_globalOrderOfArrival++),e._setZOrder(t),this.setNodeDirty()},sortAllChildren:function(){if(this._reorderChildDirty){var e,t,n=this._children.length;for(e=0;e<n;e++){var r=this._children[e];t=e-1;while(t>=0&&(r._zOrder<this._children[t]._zOrder||r._zOrder==this._children[t]._zOrder&&r._orderOfArrival<this._children[t]._orderOfArrival))this._children[t+1]=this._children[t],t-=1;this._children[t+1]=r}this._reorderChildDirty=!1}},draw:function(e){},transformAncestors:function(){this._parent!=null&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnter),this.resumeSchedulerAndActions()},onEnterTransitionDidFinish:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pauseSchedulerAndActions(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExit)},runAction:function(e){return cc.Assert(e!=null,"Argument must be non-nil"),this.getActionManager().addAction(e,this,!this._running),e},stopAllActions:function(){this.getActionManager().removeAllActionsFromTarget(this)},stopAction:function(e){this.getActionManager().removeAction(e)},stopActionByTag:function(e){cc.Assert(e!=cc.ACTION_TAG_INVALID,"Invalid tag"),this.getActionManager().removeActionByTag(e,this)},getActionByTag:function(e){return cc.Assert(e!=cc.ACTION_TAG_INVALID,"Invalid tag"),this.getActionManager().getActionByTag(e,this)},numberOfRunningActions:function(){return this.getActionManager().numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(e){this.getScheduler().scheduleUpdateForTarget(this,e,!this._running)},unscheduleUpdate:function(){this.getScheduler().unscheduleUpdateForTarget(this)},schedule:function(e,t,n,r){t=t||0,cc.Assert(e,"Argument must be non-nil"),cc.Assert(t>=0,"Argument must be positive"),n=n==null?cc.REPEAT_FOREVER:n,r=r||0,this.getScheduler().scheduleCallbackForTarget(this,e,t,n,r,!this._running)},scheduleOnce:function(e,t){this.schedule(e,0,0,t)},unschedule:function(e){if(!e)return;this.getScheduler().unscheduleCallbackForTarget(this,e)},unscheduleAllCallbacks:function(){this.getScheduler().unscheduleAllCallbacksForTarget(this)},resumeSchedulerAndActions:function(){this.getScheduler().resumeTarget(this),this.getActionManager().resumeTarget(this)},pauseSchedulerAndActions:function(){this.getScheduler().pauseTarget(this),this.getActionManager().pauseTarget(this)},setAdditionalTransform:function(e){this._additionalTransform=e,this._transformDirty=!0,this._additionalTransformDirty=!0},parentToNodeTransform:function(){return this._inverseDirty&&(this._inverse=cc.AffineTransformInvert(this.nodeToParentTransform()),this._inverseDirty=!1),this._inverse},nodeToWorldTransform:function(){var e=this.nodeToParentTransform();for(var t=this._parent;t!=null;t=t.getParent())e=cc.AffineTransformConcat(e,t.nodeToParentTransform());return e},worldToNodeTransform:function(){return cc.AffineTransformInvert(this.nodeToWorldTransform())},convertToNodeSpace:function(e){return cc.PointApplyAffineTransform(e,this.worldToNodeTransform())},convertToWorldSpace:function(e){return cc.PointApplyAffineTransform(e,this.nodeToWorldTransform())},convertToNodeSpaceAR:function(e){return cc.pSub(this.convertToNodeSpace(e),this._anchorPointInPoints)},convertToWorldSpaceAR:function(e){var t=cc.pAdd(e,this._anchorPointInPoints);return this.convertToWorldSpace(t)},_convertToWindowSpace:function(e){var t=this.convertToWorldSpace(e);return cc.Director.getInstance().convertToUI(t)},convertTouchToNodeSpace:function(e){var t=e.getLocation();return this.convertToNodeSpace(t)},convertTouchToNodeSpaceAR:function(e){var t=e.getLocation();return t=cc.Director.getInstance().convertToGL(t),this.convertToNodeSpaceAR(t)},update:function(e){},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},retain:function(){},release:function(){},_transform4x4:null,_mvpMatrix:null,_stackMatrix:null,_glServerState:null,_camera:null,_grid:null,ctor:function(){this._initNode(),this._transform4x4=new cc.kmMat4,this._glServerState=0,this._mvpMatrix=new cc.kmMat4,this._stackMatrix=new cc.kmMat4},visit:function(e){if(!this._visible)return;var t=e||cc.renderContext,n;this._stackMatrix=this._stackMatrix||new cc.kmMat4,cc.kmGLPushMatrixWitMat4(this._stackMatrix),this._grid&&this._grid._active&&this._grid.beforeDraw(),this.transform();if(this._children&&this._children.length>0){this.sortAllChildren();for(n=0;n<this._children.length;n++){if(!(this._children[n]&&this._children[n]._zOrder<0))break;this._children[n].visit(t)}this.draw(t);for(;n<this._children.length;n++)this._children[n]&&this._children[n].visit(t)}else this.draw(t);this._orderOfArrival=0,this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),cc.kmGLPopMatrix()},transform:function(){this._transform4x4=this._transform4x4||new cc.kmMat4,cc.CGAffineToGL(this.nodeToParentTransform(),this._transform4x4.mat),this._transform4x4.mat[14]=this._vertexZ,cc.kmGLMultMatrix(this._transform4x4);if(this._camera!=null&&(this._grid==null||!this._grid.isActive())){var e=this._anchorPointInPoints.x!=0||this._anchorPointInPoints.y!=0;e&&cc.kmGLTranslatef(cc.RENDER_IN_SUBPIXEL(this._anchorPointInPoints.x),cc.RENDER_IN_SUBPIXEL(this._anchorPointInPoints.y),0),this._camera.locate(),e&&cc.kmGLTranslatef(cc.RENDER_IN_SUBPIXEL(-this._anchorPointInPoints.x),cc.RENDER_IN_SUBPIXEL(-this._anchorPointInPoints.y),0)}},nodeToParentTransform:function(){if(this._transformDirty){var e=this._position.x,t=this._position.y;this._ignoreAnchorPointForPosition&&(e+=this._anchorPointInPoints.x,t+=this._anchorPointInPoints.y);var n=1,r=0,i=1,s=0;if(this._rotationX!==0||this._rotationY!==0)n=Math.cos(-this._rotationRadiansX),r=Math.sin(-this._rotationRadiansX),i=Math.cos(-this._rotationRadiansY),s=Math.sin(-this._rotationRadiansY);var o=this._skewX||this._skewY;!o&&(this._anchorPointInPoints.x!==0||this._anchorPointInPoints.y!==0)&&(e+=i*-this._anchorPointInPoints.x*this._scaleX+ -r*-this._anchorPointInPoints.y*this._scaleY,t+=s*-this._anchorPointInPoints.x*this._scaleX+n*-this._anchorPointInPoints.y*this._scaleY),this._transform={a:i*this._scaleX,b:s*this._scaleX,c:-r*this._scaleY,d:n*this._scaleY,tx:e,ty:t};if(o){var u={a:1,b:Math.tan(cc.DEGREES_TO_RADIANS(this._skewY)),c:Math.tan(cc.DEGREES_TO_RADIANS(this._skewX)),d:1,tx:0,ty:0};this._transform=cc.AffineTransformConcat(u,this._transform);if(this._anchorPointInPoints.x!==0||this._anchorPointInPoints.y!==0)this._transform=cc.AffineTransformTranslate(this._transform,-this._anchorPointInPoints.x,-this._anchorPointInPoints.y)}this._additionalTransformDirty&&(this._transform=cc.AffineTransformConcat(this._transform,this._additionalTransform),this._additionalTransformDirty=!1),this._transformDirty=!1}return this._transform},setNodeDirty:function(){this._transformDirty=this._inverseDirty=!0},getCamera:function(){return this._camera||(this._camera=new cc.Camera),this._camera},getGrid:function(){return this._grid},setGrid:function(e){this._grid=e},getShaderProgram:function(){return this._shaderProgram},setShaderProgram:function(e){this._shaderProgram=e},getGLServerState:function(){return this._glServerState},setGLServerState:function(e){this._glServerState=e}}),cc.NodeWebGL.StateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},cc.NodeWebGL.create=function(){return new cc.NodeWebGL},cc.NodeCanvas=cc.Class.extend({_zOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_anchorPointInPoints:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,_tag:cc.NODE_TAG_INVALID,_userData:null,_userObject:null,_transformDirty:!0,_inverseDirty:!0,_cacheDirty:!0,_transformGLDirty:null,_transform:null,_inverse:null,_reorderChildDirty:!1,_shaderProgram:null,_orderOfArrival:0,_actionManager:null,_scheduler:null,_initializedNode:!1,_additionalTransformDirty:!1,_additionalTransform:null,_initNode:function(){this._anchorPoint=cc.p(0,0),this._anchorPointInPoints=cc.p(0,0),this._contentSize=cc.size(0,0),this._position=cc.p(0,0);var e=cc.Director.getInstance();this._actionManager=e.getActionManager(),this.getActionManager=function(){return this._actionManager},this._scheduler=e.getScheduler(),this.getScheduler=function(){return this._scheduler},this._initializedNode=!0,this._additionalTransform=cc.AffineTransformMakeIdentity(),this._additionalTransformDirty=!1},init:function(){return this._initializedNode===!1&&this._initNode(),!0},_arrayMakeObjectsPerformSelector:function(e,t){if(!e||e.length==0)return;var n;switch(t){case cc.Node.StateCallbackType.onEnter:for(n=0;n<e.length;n++)e[n]&&e[n].onEnter();break;case cc.Node.StateCallbackType.onExit:for(n=0;n<e.length;n++)e[n]&&e[n].onExit();break;case cc.Node.StateCallbackType.onEnterTransitionDidFinish:for(n=0;n<e.length;n++)e[n]&&e[n].onEnterTransitionDidFinish();break;case cc.Node.StateCallbackType.cleanup:for(n=0;n<e.length;n++)e[n]&&e[n].cleanup();break;case cc.Node.StateCallbackType.updateTransform:for(n=0;n<e.length;n++)e[n]&&e[n].updateTransform();break;case cc.Node.StateCallbackType.onExitTransitionDidStart:for(n=0;n<e.length;n++)e[n]&&e[n].onExitTransitionDidStart();break;case cc.Node.StateCallbackType.sortAllChildren:for(n=0;n<e.length;n++)e[n]&&e[n].sortAllChildren();break;default:throw"Unknown callback function"}},setNodeDirty:function(){this._transformDirty=this._inverseDirty=!0},getSkewX:function(){return this._skewX},setSkewX:function(e){this._skewX=e,this.setNodeDirty()},getSkewY:function(){return this._skewY},setSkewY:function(e){this._skewY=e,this.setNodeDirty()},getZOrder:function(){return this._zOrder},_setZOrder:function(e){this._zOrder=e},setZOrder:function(e){this._setZOrder(e),this._parent&&this._parent.reorderChild(this,e)},getVertexZ:function(){return this._vertexZ},setVertexZ:function(e){this._vertexZ=e},getRotation:function(){return cc.Assert(this._rotationX==this._rotationY,"CCNode#rotation. RotationX != RotationY. Don't know which one to return"),this._rotationX},_rotationRadiansX:0,_rotationRadiansY:0,setRotation:function(e){this._rotationX=this._rotationY=e,this._rotationRadiansX=this._rotationX*.017453292519943295,this._rotationRadiansY=this._rotationY*.017453292519943295,this.setNodeDirty()},getRotationX:function(){return this._rotationX},setRotationX:function(e){this._rotationX=e,this._rotationRadiansX=this._rotationX*.017453292519943295,this.setNodeDirty()},getRotationY:function(){return this._rotationY},setRotationY:function(e){this._rotationY=e,this._rotationRadiansY=this._rotationY*.017453292519943295,this.setNodeDirty()},getScale:function(){return cc.Assert(this._scaleX==this._scaleY,"cc.Node#scale. ScaleX != ScaleY. Don't know which one to return"),this._scaleX},setScale:function(e,t){this._scaleX=e,this._scaleY=t||e,this.setNodeDirty()},getScaleX:function(){return this._scaleX},setScaleX:function(e){this._scaleX=e,this.setNodeDirty()},getScaleY:function(){return this._scaleY},setScaleY:function(e){this._scaleY=e,this.setNodeDirty()},setPosition:function(e,t){arguments.length===2?this._position=new cc.Point(e,t):arguments.length===1&&(this._position=new cc.Point(e.x,e.y)),this.setNodeDirty()},_setPositionByValue:function(e,t){arguments.length===2?(this._position.x=e,this._position.y=t):arguments.length===1&&(this._position.x=e.x,this._position.y=e.y),this.setNodeDirty()},getPosition:function(){return cc.p(this._position.x,this._position.y)},getPositionX:function(){return this._position.x},setPositionX:function(e){this._position.x=e,this.setNodeDirty()},getPositionY:function(){return this._position.y},setPositionY:function(e){this._position.y=e,this.setNodeDirty()},getChildrenCount:function(){return this._children?this._children.length:0},getChildren:function(){return this._children||(this._children=[]),this._children},isVisible:function(){return this._visible},setVisible:function(e){this._visible=e,this.setNodeDirty()},getAnchorPoint:function(){return cc.p(this._anchorPoint.x,this._anchorPoint.y)},setAnchorPoint:function(e){cc.Point.CCPointEqualToPoint(e,this._anchorPoint)||(this._anchorPoint=new cc.Point(e.x,e.y),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y),this.setNodeDirty())},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints.x,this._anchorPointInPoints.y)},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(e){cc.Size.CCSizeEqualToSize(e,this._contentSize)||(this._contentSize=new cc.Size(e.width,e.height),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y),this.setNodeDirty())},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(e){this._parent=e},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(e){e!=this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=e,this.setNodeDirty())},getTag:function(){return this._tag},setTag:function(e){this._tag=e},getUserData:function(){return this._userData},setUserData:function(e){this._userData=e},getUserObject:function(){return this._userObject},setUserObject:function(e){this._userObject!=e&&(this._userObject=e)},getOrderOfArrival:function(){return this._orderOfArrival},setOrderOfArrival:function(e){this._orderOfArrival=e},getActionManager:function(){return this._actionManager||(this._actionManager=cc.Director.getInstance().getActionManager(),this.getActionManager=function(){return this._actionManager}),this._actionManager},setActionManager:function(e){this._actionManager!=e&&(this.stopAllActions(),this._actionManager=e)},getScheduler:function(){return this._scheduler||(this._scheduler=cc.Director.getInstance().getScheduler(),this.getScheduler=function(){return this._scheduler}),this._scheduler},setScheduler:function(e){this._scheduler!=e&&(this.unscheduleAllCallbacks(),this._scheduler=e)},getBoundingBox:function(){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.RectApplyAffineTransform(e,this.nodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup)},description:function(){return"<cc.Node | Tag ="+this._tag+">"},_childrenAlloc:function(){this._children=[]},getChildByTag:function(e){if(this._children!=null)for(var t=0;t<this._children.length;t++){var n=this._children[t];if(n&&n._tag==e)return n}return null},addChild:function(e,t,n){if(e===this){console.warn("cc.Node.addChild: An Node can't be added as a child of itself.");return}cc.Assert(e!=null,"Argument must be non-nil");if(e._parent!==null){cc.Assert(e._parent===null,"child already added. It can't be added again");return}var r=t!=null?t:e.getZOrder(),i=n!=null?n:e.getTag();e.setTag(i),this._children||this._childrenAlloc(),this._insertChild(e,r),e.setParent(this),this._running&&(e.onEnter(),e.onEnterTransitionDidFinish())},removeFromParent:function(e){this._parent&&(e==null&&(e=!0),this._parent.removeChild(this,e))},removeFromParentAndCleanup:function(e){cc.log("removeFromParentAndCleanup is deprecated. Use removeFromParent instead"),this.removeFromParent(e)},removeChild:function(e,t){if(this._children==null)return;t==null&&(t=!0),this._children.indexOf(e)>-1&&this._detachChild(e,t),this.setNodeDirty()},removeChildByTag:function(e,t){cc.Assert(e!=cc.NODE_TAG_INVALID,"Invalid tag");var n=this.getChildByTag(e);n==null?cc.log("cocos2d: removeChildByTag: child not found!"):this.removeChild(n,t)},removeAllChildrenWithCleanup:function(e){cc.log("removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead"),this.removeAllChildren(e)},removeAllChildren:function(e){if(this._children!=null){e==null&&(e=!0);for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&(this._running&&(n.onExitTransitionDidStart(),n.onExit()),e&&n.cleanup(),n.setParent(null))}this._children.length=0}},_detachChild:function(e,t){this._running&&(e.onExitTransitionDidStart(),e.onExit()),t&&e.cleanup(),e.setParent(null),cc.ArrayRemoveObject(this._children,e)},_insertChild:function(e,t){this._reorderChildDirty=!0;var n=this._children[this._children.length-1];if(!n||n.getZOrder()<=t)this._children.push(e);else for(var r=0;r<this._children.length;r++){var i=this._children[r];if(i&&i.getZOrder()>t){this._children=cc.ArrayAppendObjectToIndex(this._children,e,r);break}}e._setZOrder(t)},reorderChild:function(e,t){cc.Assert(e!=null,"Child must be non-nil"),this._reorderChildDirty=!0,e.setOrderOfArrival(cc.s_globalOrderOfArrival++),e._setZOrder(t),this.setNodeDirty()},sortAllChildren:function(){if(this._reorderChildDirty){var e,t,n=this._children.length;for(e=0;e<n;e++){var r=this._children[e];t=e-1;while(t>=0&&(r._zOrder<this._children[t]._zOrder||r._zOrder==this._children[t]._zOrder&&r._orderOfArrival<this._children[t]._orderOfArrival))this._children[t+1]=this._children[t],t-=1;this._children[t+1]=r}this._reorderChildDirty=!1}},draw:function(e){},transformAncestors:function(){this._parent!=null&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnter),this.resumeSchedulerAndActions()},onEnterTransitionDidFinish:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pauseSchedulerAndActions(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExit)},runAction:function(e){return cc.Assert(e!=null,"Argument must be non-nil"),this.getActionManager().addAction(e,this,!this._running),e},stopAllActions:function(){this.getActionManager().removeAllActionsFromTarget(this)},stopAction:function(e){this.getActionManager().removeAction(e)},stopActionByTag:function(e){cc.Assert(e!=cc.ACTION_TAG_INVALID,"Invalid tag"),this.getActionManager().removeActionByTag(e,this)},getActionByTag:function(e){return cc.Assert(e!=cc.ACTION_TAG_INVALID,"Invalid tag"),this.getActionManager().getActionByTag(e,this)},numberOfRunningActions:function(){return this.getActionManager().numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(e){this.getScheduler().scheduleUpdateForTarget(this,e,!this._running)},unscheduleUpdate:function(){this.getScheduler().unscheduleUpdateForTarget(this)},schedule:function(e,t,n,r){t=t||0,cc.Assert(e,"Argument must be non-nil"),cc.Assert(t>=0,"Argument must be positive"),n=n==null?cc.REPEAT_FOREVER:n,r=r||0,this.getScheduler().scheduleCallbackForTarget(this,e,t,n,r,!this._running)},scheduleOnce:function(e,t){this.schedule(e,0,0,t)},unschedule:function(e){if(!e)return;this.getScheduler().unscheduleCallbackForTarget(this,e)},unscheduleAllCallbacks:function(){this.getScheduler().unscheduleAllCallbacksForTarget(this)},resumeSchedulerAndActions:function(){this.getScheduler().resumeTarget(this),this.getActionManager().resumeTarget(this)},pauseSchedulerAndActions:function(){this.getScheduler().pauseTarget(this),this.getActionManager().pauseTarget(this)},setAdditionalTransform:function(e){this._additionalTransform=e,this._transformDirty=!0,this._additionalTransformDirty=!0},parentToNodeTransform:function(){return this._inverseDirty&&(this._inverse=cc.AffineTransformInvert(this.nodeToParentTransform()),this._inverseDirty=!1),this._inverse},nodeToWorldTransform:function(){var e=this.nodeToParentTransform();for(var t=this._parent;t!=null;t=t.getParent())e=cc.AffineTransformConcat(e,t.nodeToParentTransform());return e},worldToNodeTransform:function(){return cc.AffineTransformInvert(this.nodeToWorldTransform())},convertToNodeSpace:function(e){return cc.PointApplyAffineTransform(e,this.worldToNodeTransform())},convertToWorldSpace:function(e){return cc.PointApplyAffineTransform(e,this.nodeToWorldTransform())},convertToNodeSpaceAR:function(e){return cc.pSub(this.convertToNodeSpace(e),this._anchorPointInPoints)},convertToWorldSpaceAR:function(e){var t=cc.pAdd(e,this._anchorPointInPoints);return this.convertToWorldSpace(t)},_convertToWindowSpace:function(e){var t=this.convertToWorldSpace(e);return cc.Director.getInstance().convertToUI(t)},convertTouchToNodeSpace:function(e){var t=e.getLocation();return this.convertToNodeSpace(t)},convertTouchToNodeSpaceAR:function(e){var t=e.getLocation();return t=cc.Director.getInstance().convertToGL(t),this.convertToNodeSpaceAR(t)},update:function(e){},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},retain:function(){},release:function(){},ctor:function(){this._initNode()},visit:function(e){if(!this._visible)return;var t=e||cc.renderContext,n;t.save(),this.transform(t);if(this._children&&this._children.length>0){this.sortAllChildren();for(n=0;n<this._children.length;n++){if(!(this._children[n]&&this._children[n]._zOrder<0))break;this._children[n].visit(t)}this.draw(t);for(;n<this._children.length;n++)this._children[n]&&this._children[n]._zOrder>=0&&this._children[n].visit(t)}else this.draw(t);this._orderOfArrival=0,t.restore()},transform:function(e){var t=e||cc.renderContext,n=this.nodeToParentTransform();t.transform(n.a,n.b,n.c,n.d,n.tx,-n.ty)},nodeToParentTransform:function(){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0});if(this._transformDirty){var e=this._transform;e.tx=this._position.x,e.ty=this._position.y;var t=1,n=0;this._rotationX&&(t=Math.cos(this._rotationRadiansX),n=Math.sin(this._rotationRadiansX)),e.a=e.d=t,e.c=-n,e.b=n;var r=this._scaleX<1e-6&&this._scaleX>-0.000001?1e-6:this._scaleX,i=this._scaleY<1e-6&&this._scaleY>-0.000001?1e-6:this._scaleY;if(this._skewX||this._skewY){var s=Math.tan(-this._skewX*Math.PI/180),o=Math.tan(-this._skewY*Math.PI/180),u=this._anchorPointInPoints.y*s*r,a=this._anchorPointInPoints.x*o*i;e.a=t+ -n*o,e.c=t*s+ -n,e.b=n+t*o,e.d=n*s+t,e.tx+=t*u+ -n*a,e.ty+=n*u+t*a}if(this._scaleX!==1||this._scaleY!==1)e.a*=r,e.b*=r,e.c*=i,e.d*=i;e.tx+=t*-this._anchorPointInPoints.x*r+ -n*this._anchorPointInPoints.y*i,e.ty-=n*-this._anchorPointInPoints.x*r+t*this._anchorPointInPoints.y*i,this._ignoreAnchorPointForPosition&&(e.tx+=this._anchorPointInPoints.x,e.ty+=this._anchorPointInPoints.y),this._additionalTransformDirty&&(this._transform=cc.AffineTransformConcat(this._transform,this._additionalTransform),this._transform.b*=-1,this._transform.c*=-1,this._additionalTransformDirty=!1),e.tx=e.tx|0,e.ty=e.ty|0,this._transformDirty=!1}return this._transform},setNodeDirty:function(){this._setNodeDirtyForCache(),this._transformDirty=this._inverseDirty=!0},_setNodeDirtyForCache:function(){this._cacheDirty=!0,this._parent&&this._parent._setNodeDirtyForCache()},getBoundingBoxToWorld:function(){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);e=cc.RectApplyAffineTransform(e,this.nodeToWorldTransform()),e=cc.rect(0|e.origin.x-4,0|e.origin.y-4,0|e.size.width+8,0|e.size.height+8);if(!this._children)return e;for(var t=0;t<this._children.length;t++){var n=this._children[t];if(n&&n._visible){var r=n.getBoundingBoxToWorld();r&&(e=cc.Rect.CCRectUnion(e,r))}}return e}}),cc.NodeCanvas.StateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},cc.NodeCanvas.create=function(){return new cc.NodeCanvas},cc.Node=cc.Browser.supportWebGL?cc.NodeWebGL:cc.NodeCanvas,cc.NodeRGBA=cc.Node.extend({RGBAProtocol:!0,_displayedOpacity:0,_realOpacity:0,_displayedColor:null,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,ctor:function(){this._super(),this._displayedOpacity=255,this._realOpacity=255,this._displayedColor=cc.WHITE,this._realColor=cc.WHITE,this._cascadeColorEnabled=!1,this._cascadeOpacityEnabled=!1},init:function(){return this._super()?(this._displayedOpacity=this._realOpacity=255,this._displayedColor=cc.WHITE,this._realColor=cc.WHITE,this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1,!0):!1},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(e){this._displayedOpacity=this._realOpacity=e;if(this._cascadeOpacityEnabled){var t=255;this._parent&&this._parent.RGBAProtocol&&this._parent.isCascadeOpacityEnabled()&&(t=this._parent.getDisplayedOpacity()),this.updateDisplayedOpacity(t)}},updateDisplayedOpacity:function(e){this._displayedOpacity=this._realOpacity*e/255;if(this._cascadeOpacityEnabled){var t=this._children;for(var n=0;n<t.length;n++){var r=t[n];r&&r.RGBAProtocol&&r.updateDisplayedOpacity(this._displayedOpacity)}}},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(e){this._cascadeOpacityEnabled=e},getColor:function(){return this._realColor},getDisplayedColor:function(){return this._displayedColor},setColor:function(e){this._displayedColor=this._realColor=e;if(this._cascadeColorEnabled){var t=cc.WHITE;this._parent&&this._parent.RGBAProtocol&&this._parent.isCascadeColorEnabled()&&(t=this._parent.getDisplayedColor()),this.updateDisplayedColor(t)}},updateDisplayedColor:function(e){this._displayedColor.r=this._realColor.r*e.r/255,this._displayedColor.g=this._realColor.g*e.g/255,this._displayedColor.b=this._realColor.b*e.b/255;if(this._cascadeColorEnabled){var t=this._children;for(var n=0;n<t.length;n++){var r=t[n];r&&r.RGBAProtocol&&r.updateDisplayedColor(this._displayedColor)}}},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(e){this._cascadeColorEnabled=e},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1}});cc.AtlasNodeCanvas=cc.Node.extend({RGBAProtocol:!0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_colorUnmodified:null,_textureAtlas:null,_opacityModifyRGB:!1,_blendFunc:null,_opacity:0,_color:null,_quadsToDraw:0,ctor:function(){this._super(),this._colorUnmodified=cc.WHITE,this._color=cc.white(),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._opacity=255},updateAtlasValues:function(){cc.Assert(!1,"cc.AtlasNode:Abstract updateAtlasValue not overridden")},getColor:function(){return this._opacityModifyRGB?this._colorUnmodified:this._color},getOpacity:function(){return this._opacity},setOpacityModifyRGB:function(e){var t=this.getColor();this._opacityModifyRGB=e,this.setColor(t)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t}},setTextureAtlas:function(e){this._textureAtlas=e},getTextureAtlas:function(){return this._textureAtlas},getQuadsToDraw:function(){return this._quadsToDraw},setQuadsToDraw:function(e){this._quadsToDraw=e},_textureForCanvas:null,_originalTexture:null,_colorF32Array:null,initWithTileFile:function(e,t,n,r){return cc.Assert(e!=null,"title should not be null"),this._itemWidth=t,this._itemHeight=n,this._opacityModifyRGB=!0,this._originalTexture=cc.TextureCache.getInstance().addImage(e),this._originalTexture?(this._textureForCanvas=this._originalTexture,this._calculateMaxItems(),this._quadsToDraw=r,!0):(cc.log("cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."),!1)},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=this._colorUnmodified=e;if(this.getTexture()){var t=cc.TextureCache.getInstance().getTextureColors(this._originalTexture);if(t){var n=this._originalTexture,r=cc.rect(0,0,n.width,n.height),i=cc.generateTintImage(n,t,this._color,r);this.setTexture(i)}}this._opacityModifyRGB&&(this._color.r=e.r*this._opacity/255,this._color.g=e.g*this._opacity/255,this._color.b=e.b*this._opacity/255)},setOpacity:function(e){this._opacity=e,this._opacityModifyRGB&&this.setColor(this._colorUnmodified)},getTexture:function(){return this._textureForCanvas},setTexture:function(e){this._textureForCanvas=e},_calculateMaxItems:function(){var e=this.getTexture(),t=cc.size(e.width,e.height);this._itemsPerColumn=0|t.height/this._itemHeight,this._itemsPerRow=0|t.width/this._itemWidth}}),cc.AtlasNodeCanvas.create=function(e,t,n,r){var i=new cc.AtlasNodeCanvas;return i.initWithTileFile(e,t,n,r)?i:null},cc.AtlasNodeWebGL=cc.Node.extend({RGBAProtocol:!0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_colorUnmodified:null,_textureAtlas:null,_opacityModifyRGB:!1,_blendFunc:null,_opacity:0,_color:null,_quadsToDraw:0,ctor:function(){this._super(),this._colorUnmodified=cc.WHITE,this._color=cc.white(),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._opacity=255},updateAtlasValues:function(){cc.Assert(!1,"cc.AtlasNode:Abstract updateAtlasValue not overridden")},getColor:function(){return this._opacityModifyRGB?this._colorUnmodified:this._color},getOpacity:function(){return this._opacity},setOpacityModifyRGB:function(e){var t=this.getColor();this._opacityModifyRGB=e,this.setColor(t)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t}},setTextureAtlas:function(e){this._textureAtlas=e},getTextureAtlas:function(){return this._textureAtlas},getQuadsToDraw:function(){return this._quadsToDraw},setQuadsToDraw:function(e){this._quadsToDraw=e},_uniformColor:null,initWithTileFile:function(e,t,n,r){cc.Assert(e!=null,"title should not be null"),this._itemWidth=t,this._itemHeight=n,this._opacityModifyRGB=!0,this._colorF32Array=new Float32Array([this._color.r/255,this._color.g/255,this._color.b/255,this._opacity/255]);var i=new cc.TextureAtlas;return i.initWithFile(e,r),this.setTextureAtlas(i),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),this._quadsToDraw=r,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR)),this._uniformColor=cc.renderContext.getUniformLocation(this.getShaderProgram().getProgram(),"u_color"),!0):(cc.log("cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."),!1)},draw:function(e){var t=e||cc.renderContext;cc.NODE_DRAW_SETUP(this),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),t.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(this._quadsToDraw,0)},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=this._colorUnmodified=e,this._opacityModifyRGB&&(this._color.r=e.r*this._opacity/255,this._color.g=e.g*this._opacity/255,this._color.b=e.b*this._opacity/255),this._colorF32Array=new Float32Array([this._color.r/255,this._color.g/255,this._color.b/255,this._opacity/255])},setOpacity:function(e){this._opacity=e,this._opacityModifyRGB?this.setColor(this._colorUnmodified):this._colorF32Array=new Float32Array([this._color.r/255,this._color.g/255,this._color.b/255,this._opacity/255])},getTexture:function(){return this._textureAtlas.getTexture()},setTexture:function(e){this._textureAtlas.setTexture(e),this._updateBlendFunc(),this._updateOpacityModifyRGB()},_calculateMaxItems:function(){var e=this.getTexture(),t=e.getContentSize();this._itemsPerColumn=0|t.height/this._itemHeight,this._itemsPerRow=0|t.width/this._itemWidth},_updateBlendFunc:function(){this._textureAtlas.getTexture().hasPremultipliedAlpha()||(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA)},_updateOpacityModifyRGB:function(){this._opacityModifyRGB=this._textureAtlas.getTexture().hasPremultipliedAlpha()}}),cc.AtlasNodeWebGL.create=function(e,t,n,r){var i=new cc.AtlasNodeWebGL;return i.initWithTileFile(e,t,n,r)?i:null},cc.AtlasNode=cc.Browser.supportWebGL?cc.AtlasNodeWebGL:cc.AtlasNodeCanvas;cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888=0,cc.TEXTURE_2D_PIXEL_FORMAT_RGB888=1,cc.TEXTURE_2D_PIXEL_FORMAT_RGB565=2,cc.TEXTURE_2D_PIXEL_FORMAT_A8=3,cc.TEXTURE_2D_PIXEL_FORMAT_I8=4,cc.TEXTURE_2D_PIXEL_FORMAT_AI88=5,cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444=6,cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1=7,cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC4=8,cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC2=9,cc.TEXTURE_2D_PIXEL_FORMAT_DEFAULT=cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,cc._defaultAlphaPixelFormat=cc.TEXTURE_2D_PIXEL_FORMAT_DEFAULT,cc.PVRHaveAlphaPremultiplied_=!1,cc._texParams=function(e,t,n,r){this.minFilter=e||0,this.magFilter=t||0,this.wrapS=n||0,this.wrapT=r||0},cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:null,_pixelFormat:null,_pixelsWide:null,_pixelsHigh:null,_name:null,_contentSize:null,_maxS:null,_maxT:null,_hasPremultipliedAlpha:null,_hasMipmaps:!1,_shaderProgram:null,_isLoaded:!1,_htmlElementObj:null,_webTextureObj:null,ctor:function(){this._pixelsWide=0,this._pixelsWide=0,this._name="",this._maxS=0,this._maxT=0,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._pVRHaveAlphaPremultiplied=!0,this._pixelFormat=cc.Texture2D.defaultAlphaPixelFormat()},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.CONTENT_SCALE_FACTOR(),this._contentSize.height/cc.CONTENT_SCALE_FACTOR())},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this._maxS},setMaxS:function(e){this._maxS=e},getMaxT:function(){return this._maxT},setMaxT:function(e){this._maxT=e},getShaderProgram:function(){return this._shaderProgram},setShaderProgram:function(e){this._shaderProgram=e},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){return"<cc.Texture2D | Name = "+this._name+" | Dimensions = "+this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates = ("+this._maxS+", "+this._maxT+")>"},releaseData:function(e){e=null},keepData:function(e,t){return e},initWithData:function(e,t,n,r,i){var s=cc.renderContext;t===cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888||cc.NextPOT(n)==n&&cc.NextPOT(r)==r?s.pixelStorei(s.UNPACK_ALIGNMENT,4):s.pixelStorei(s.UNPACK_ALIGNMENT,1),this._webTextureObj=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this._webTextureObj),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);switch(t){case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888:s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:s.texImage2D(s.TEXTURE_2D,0,s.RGB,n,r,0,s.RGB,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444:s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_SHORT_4_4_4_4,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1:s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_SHORT_5_5_5_1,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB565:s.texImage2D(s.TEXTURE_2D,0,s.RGB,n,r,0,s.RGB,s.UNSIGNED_SHORT_5_6_5,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_AI88:s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE_ALPHA,n,r,0,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_A8:s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,n,r,0,s.ALPHA,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_I8:s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,n,r,0,s.LUMINANCE,s.UNSIGNED_BYTE,e);break;default:cc.Assert(0,"NSInternalInconsistencyException")}return this._contentSize=i,this._pixelsWide=n,this._pixelsHigh=r,this._pixelFormat=t,this._maxS=i.width/n,this._maxT=i.height/r,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE)),this._isLoaded=!0,!0},drawAtPoint:function(e){var t=[0,this._maxT,this._maxS,this._maxT,0,0,this._maxS,0],n=this._pixelsWide*this._maxS,r=this._pixelsHigh*this._maxT,i=[e.x,e.y,0,n+e.x,e.y,0,e.x,r+e.y,0,n+e.x,r+e.y,0];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEXCOORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this);var s=cc.renderContext;s.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,s.FLOAT,!1,0,i),s.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,s.FLOAT,!1,0,t),s.drawArrays(s.TRIANGLE_STRIP,0,4)},drawInRect:function(e){var t=[0,this._maxT,this._maxS,this._maxT,0,0,this._maxS,0],n=[e.origin.x,e.origin.y,e.origin.x+e.size.width,e.origin.y,e.origin.x,e.origin.y+e.size.height,e.origin.x+e.size.width,e.origin.y+e.size.height];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEXCOORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this);var r=cc.renderContext;r.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,n),r.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,r.FLOAT,!1,0,t),r.drawArrays(r.TRIANGLE_STRIP,0,4)},initWithImage:function(e){if(e==null)return cc.log("cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil"),!1;var t=e.getWidth(),n=e.getHeight(),r=cc.Configuration.getInstance(),i=r.getMaxTextureSize();return t>i||n>i?(cc.log("cocos2d: WARNING: Image ("+t+" x "+n+") is bigger than the supported "+i+" x "+i),!1):(this._isLoaded=!0,this._initPremultipliedATextureWithImage(e,t,n))},initWithElement:function(e){if(!e)return;this._webTextureObj=cc.renderContext.createTexture(),this._htmlElementObj=e},isLoaded:function(){return this._isLoaded},handleLoadedTexture:function(){this._isLoaded=!0;var e=cc.renderContext,t=this._htmlElementObj.width,n=this._htmlElementObj.height;cc.glBindTexture2D(this),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._htmlElementObj),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this._contentSize=new cc.Size(t,n),this._pixelsWide=t,this._pixelsHigh=n,this._pixelFormat=cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,this._maxS=1,this._maxT=1,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE)),e.bindTexture(e.TEXTURE_2D,null)},initWithString:function(e,t,n,r,i,s){arguments.length==3&&(t=arguments[1],n=arguments[2],r=cc.size(0,0),i=cc.TEXT_ALIGNMENT_CENTER,s=cc.VERTICAL_TEXT_ALIGNMENT_TOP);var o=new cc.Image,u;return cc.VERTICAL_TEXT_ALIGNMENT_TOP===s?u=cc.TEXT_ALIGNMENT_CENTER===i?cc.ALIGN_TOP:cc.TEXT_ALIGNMENT_LEFT===i?cc.ALIGN_TOP_LEFT:cc.ALIGN_TOP_RIGHT:cc.VERTICAL_TEXT_ALIGNMENT_CENTER===s?u=cc.TEXT_ALIGNMENT_CENTER===i?cc.ALIGN_CENTER:cc.TEXT_ALIGNMENT_LEFT===i?cc.ALIGN_LEFT:cc.ALIGN_RIGHT:cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM===s?u=cc.TEXT_ALIGNMENT_CENTER===i?cc.ALIGN_BOTTOM:cc.TEXT_ALIGNMENT_LEFT===i?cc.ALIGN_BOTTOM_LEFT:cc.ALIGN_BOTTOM_RIGHT:cc.Assert(!1,"Not supported alignment format!"),o.initWithString(e,r.width,r.height,u,t,n)?this.initWithImage(o):!1},initWithPVRFile:function(e){var t=!1,n=new cc.TexturePVR;return t=n.initWithContentsOfFile(e),t?(n.setRetainName(!0),this._name=n.getName(),this._maxS=1,this._maxT=1,this._pixelsWide=n.getWidth(),this._pixelsHigh=n.getHeight(),this._contentSize=cc.size(this._pixelsWide,this._pixelsHigh),this._hasPremultipliedAlpha=cc.PVRHaveAlphaPremultiplied_,this._pixelFormat=n.getFormat(),this.setAntiAliasTexParameters()):cc.log("cocos2d: Couldn't load PVR image "+e),t},initWithPVRTCData:function(e,t,n,r,i,s){if(!cc.Configuration.getInstance().supportsPVRTC())return cc.log("cocos2d: WARNING: PVRTC images is not supported."),!1;var o=cc.renderContext;this._webTextureObj=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this._webTextureObj),this.setAntiAliasTexParameters();var u,a=i*i*n/8;return r?u=n==4?o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:u=n==4?o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,a<32&&(a=32),o.compressedTexImage2D(o.TEXTURE_2D,t,u,i,i,0,a,e),this._contentSize=cc.size(i,i),this._pixelsWide=i,this._pixelsHigh=i,this._maxS=1,this._maxT=1,this._hasPremultipliedAlpha=cc.PVRHaveAlphaPremultiplied_,this._pixelFormat=s,!0},setTexParameters:function(e){var t=cc.renderContext;cc.Assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&this._pixelsHigh==cc.NextPOT(this._pixelsHigh)||e.wrapS==t.CLAMP_TO_EDGE&&e.wrapT==t.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(this),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.wrapT)},setAntiAliasTexParameters:function(){var e=cc.renderContext;cc.glBindTexture2D(this),this._hasMipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)},setAliasTexParameters:function(){var e=cc.renderContext;cc.glBindTexture2D(this),this._hasMipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)},generateMipmap:function(){cc.Assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&this._pixelsHigh==cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(this),cc.renderContext.generateMipmap(cc.renderContext.TEXTURE_2D),this._hasMipmaps=!0},stringForFormat:function(){switch(this._pixelFormat){case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888:return"RGBA8888";case cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:return"RGB888";case cc.TEXTURE_2D_PIXEL_FORMAT_RGB565:return"RGB565";case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444:return"RGBA4444";case cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1:return"RGB5A1";case cc.TEXTURE_2D_PIXEL_FORMAT_AI88:return"AI88";case cc.TEXTURE_2D_PIXEL_FORMAT_A8:return"A8";case cc.TEXTURE_2D_PIXEL_FORMAT_I8:return"I8";case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC4:return"PVRTC4";case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC2:return"PVRTC2";default:cc.Assert(!1,"unrecognized pixel format"),cc.log("stringForFormat: "+this._pixelFormat+", cannot give useful result")}return""},bitsPerPixelForFormat:function(e){e=e||this._pixelFormat;switch(e){case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888:return 32;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:return 32;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB565:return 16;case cc.TEXTURE_2D_PIXEL_FORMAT_A8:return 8;case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444:return 16;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1:return 16;case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC4:return 4;case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC2:return 2;case cc.TEXTURE_2D_PIXEL_FORMAT_I8:return 8;case cc.TEXTURE_2D_PIXEL_FORMAT_AI88:return 16;default:return cc.Assert(!1,"illegal pixel format"),cc.log("bitsPerPixelForFormat: "+this._pixelFormat+", cannot give useful result"),-1}},_initPremultipliedATextureWithImage:function(e,t,n){var r=e.getData(),i=null,s=null,o=null,u=e.hasAlpha(),a=cc.size(e.getWidth(),e.getHeight()),f=cc.TEXTURE_2D_PIXEL_FORMAT_DEFAULT,l=e.getBitsPerComponent(),c;u||(l>=8?f=cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:(cc.log("cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha"),f=cc.TEXTURE_2D_PIXEL_FORMAT_RGB565));var h=t*n;if(f==cc.TEXTURE_2D_PIXEL_FORMAT_RGB565)if(u){r=new Uint16Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=(i[c]>>0&255)>>3<<11|(i[c]>>8&255)>>2<<5|(i[c]>>16&255)>>3<<0}else{r=new Uint16Array(t*n),s=e.getData();for(c=0;c<h;++c)r[c]=(s[c]&255)>>3<<11|(s[c]&255)>>2<<5|(s[c]&255)>>3<<0}else if(f==cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444){r=new Uint16Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=(i[c]>>0&255)>>4<<12|(i[c]>>8&255)>>4<<8|(i[c]>>16&255)>>4<<4|(i[c]>>24&255)>>4<<0}else if(f==cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1){r=new Uint16Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=(i[c]>>0&255)>>3<<11|(i[c]>>8&255)>>3<<6|(i[c]>>16&255)>>3<<1|(i[c]>>24&255)>>7<<0}else if(f==cc.TEXTURE_2D_PIXEL_FORMAT_A8){r=new Uint8Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=i>>24&255}if(u&&f==cc.TEXTURE_2D_PIXEL_FORMAT_RGB888){i=e.getData(),r=new Uint8Array(t*n*3);for(c=0;c<h;++c)r[c*3]=i>>0&255,r[c*3+1]=i>>8&255,r[c*3+2]=i>>16&255}return this.initWithData(r,f,t,n,a),r!=e.getData()&&(r=null),this._hasPremultipliedAlpha=e.isPremultipliedAlpha(),!0}}),cc.Texture2D.setDefaultAlphaPixelFormat=function(e){cc._defaultAlphaPixelFormat=e},cc.Texture2D.defaultAlphaPixelFormat=function(){return cc._defaultAlphaPixelFormat},cc.Texture2D.getDefaultAlphaPixelFormat=function(){return cc._defaultAlphaPixelFormat},cc.Texture2D.PVRImagesHavePremultipliedAlpha=function(e){cc.PVRHaveAlphaPremultiplied_=e};cc.g_sharedTextureCache=null,cc.loadImage=function(e){var t=cc.computeImageFormatType(e);if(t==cc.FMT_UNKNOWN){cc.log("unsupported format:"+e);return}var n=new Image;n.src=e,n.onLoad=function(t){cc.TextureCache.getInstance().cacheImage(e,n)}},cc.computeImageFormatType=function(e){return e.toLowerCase().indexOf(".jpg")>0||e.toLowerCase().indexOf(".jpeg")>0?cc.FMT_JPG:e.toLowerCase().indexOf(".png")>0?cc.FMT_PNG:cc.FMT_UNKNOWN},cc.TextureCacheCanvas=cc.Class.extend({_textures:null,_textureColorsCache:null,_textureKeySeq:1e3,ctor:function(){cc.Assert(cc.g_sharedTextureCache==null,"Attempted to allocate a second instance of a singleton."),this._textureKeySeq+=0|Math.random()*1e3,this._textures={},this._textureColorsCache={}},_addImageAsyncCallBack:function(e,t){e&&typeof t=="string"?e[t]():e&&typeof t=="function"&&t.call(e)},addPVRTCImage:function(){cc.Assert(0,"TextureCache:addPVRTCImage does not support")},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(e){return this._textures.hasOwnProperty(e)?this._textures[e]:null},getKeyByTexture:function(e){for(var t in this._textures)if(this._textures[t]==e)return t;return null},_generalTextureKey:function(){return this._textureKeySeq++,"_textureKey_"+this._textureKeySeq},getTextureColors:function(e){var t=this.getKeyByTexture(e);return t||(e instanceof HTMLImageElement?t=e.src:t=this._generalTextureKey()),this._textureColorsCache.hasOwnProperty(t)||(this._textureColorsCache[t]=cc.generateTextureCacheForColor(e)),this._textureColorsCache[t]},removeAllTextures:function(){this._textures={}},removeTexture:function(e){if(!e)return;for(var t in this._textures)if(this._textures[t]==e){delete this._textures[t];return}},removeTextureForKey:function(e){if(e==null)return;this._textures[e]&&delete this._textures[e]},addPVRImage:function(e){cc.Assert(e!=null,"TextureCache: file image MUST not be null"),e=cc.FileUtils.getInstance().fullPathFromRelativePath(e);var t=e;if(this._textures[t]!=null)return this._textures[t];var n=new cc.Texture2D;return n.initWithPVRFile(t)?this._textures[t]=n:cc.log("cocos2d: Couldn't add PVRImage:"+t+" in TextureCache"),n},addImageAsync:function(e,t,n){cc.Assert(e!=null,"TextureCache: path MUST not be null"),e=cc.FileUtils.getInstance().fullPathFromRelativePath(e);var r=this._textures[e];if(r)this._addImageAsyncCallBack(t,n);else{r=new Image,r.crossOrigin="Anonymous";var i=this;r.addEventListener("load",function(){i._addImageAsyncCallBack(t,n)}),r.addEventListener("error",function(){cc.Loader.getInstance().onResLoadingErr(e),i._textures.hasOwnProperty(e)&&delete i._textures[e]}),r.src=e,this._textures[e]=r}return this._textures[e]},addImage:function(e){cc.Assert(e!=null,"TextureCache: path MUST not be null"),e=cc.FileUtils.getInstance().fullPathForFilename(e);var t=this._textures[e];if(t)cc.Loader.getInstance().onResLoaded();else{t=new Image,t.crossOrigin="Anonymous";var n=this;isXC?t.onload=function(){cc.Loader.getInstance().onResLoaded()}:(t.addEventListener("load",function(){cc.Loader.getInstance().onResLoaded()}),t.addEventListener("error",function(){cc.Loader.getInstance().onResLoadingErr(e),n._textures.hasOwnProperty(e)&&delete n._textures[e]})),t.src=e,this._textures[e]=t}return this._textures[e]},cacheImage:function(e,t){this._textures[e]=t},addUIImage:function(e,t){return cc.Assert(e!=null,"TextureCache: image MUST not be nulll"),t&&this._textures.hasOwnProperty(t)&&this._textures[t]?this._textures[t]:(t!=null&&e!=null?this._textures[t]=e:cc.log("cocos2d: Couldn't add UIImage in TextureCache"),e)},dumpCachedTextureInfo:function(){var e=0,t=0;for(var n in this._textures){var r=this._textures[n];e++,r instanceof HTMLImageElement?cc.log("cocos2d: '"+n+"' id="+r.src+" "+r.width+" x "+r.height):(cc.log("cocos2d: '"+n+"' id= HTMLCanvasElement "+r.width+" x "+r.height),t+=r.width*r.height*4)}for(n in this._textureColorsCache){var i=this._textureColorsCache[n];e++,cc.log("cocos2d: '"+n+"' id= HTMLCanvasElement "+i.width+" x "+i.height),t+=i.width*i.height*4}cc.log("cocos2d: TextureCache dumpDebugInfo: "+e+" textures, HTMLCanvasElement for "+t/1024+" KB ("+(t/1048576).toFixed(2)+" MB)")}}),cc.TextureCacheCanvas.getInstance=function(){return cc.g_sharedTextureCache||(cc.g_sharedTextureCache=new cc.TextureCacheCanvas),cc.g_sharedTextureCache},cc.TextureCacheCanvas.purgeSharedTextureCache=function(){cc.g_sharedTextureCache=null},cc.TextureCacheWebGL=cc.Class.extend({_textures:null,_textureColorsCache:null,_textureKeySeq:1e3,_rendererInitialized:!1,_loadedTexturesBefore:null,_loadingTexturesBefore:null,ctor:function(){cc.Assert(cc.g_sharedTextureCache==null,"Attempted to allocate a second instance of a singleton."),this._textureKeySeq+=0|Math.random()*1e3,this._textures={},this._textureColorsCache={},this._loadedTexturesBefore={},this._loadingTexturesBefore={}},_addImageAsyncCallBack:function(e,t){e&&typeof t=="string"?e[t]():e&&typeof t=="function"&&t.call(e)},_initializingRenderer:function(){this._rendererInitialized=!0;var e;for(e in this._loadedTexturesBefore){var t=this._loadedTexturesBefore[e],n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this._textures[e]=n}this._loadedTexturesBefore={};for(e in this._loadedTexturesBefore)this.addImage(e);this._loadedTexturesBefore={}},addPVRTCImage:function(){cc.Assert(0,"TextureCache:addPVRTCImage does not support")},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(e){return this._textures.hasOwnProperty(e)?this._textures[e]:null},getKeyByTexture:function(e){for(var t in this._textures)if(this._textures[t]==e)return t;return null},_generalTextureKey:function(){return this._textureKeySeq++,"_textureKey_"+this._textureKeySeq},getTextureColors:function(e){var t=this.getKeyByTexture(e);return t||(e instanceof HTMLImageElement?t=e.src:t=this._generalTextureKey()),this._textureColorsCache.hasOwnProperty(t)||(this._textureColorsCache[t]=cc.generateTextureCacheForColor(e)),this._textureColorsCache[t]},removeAllTextures:function(){this._textures={}},removeTexture:function(e){if(!e)return;for(var t in this._textures)if(this._textures[t]==e){delete this._textures[t];return}},removeTextureForKey:function(e){if(e==null)return;this._textures[e]&&delete this._textures[e]},addPVRImage:function(e){cc.Assert(e!=null,"TextureCache: file image MUST not be null"),e=cc.FileUtils.getInstance().fullPathFromRelativePath(e);var t=e;if(this._textures[t]!=null)return this._textures[t];var n=new cc.Texture2D;return n.initWithPVRFile(t)?this._textures[t]=n:cc.log("cocos2d: Couldn't add PVRImage:"+t+" in TextureCache"),n},addImageAsync:function(e,t,n){cc.Assert(e!=null,"TextureCache: path MUST not be null"),e=cc.FileUtils.getInstance().fullPathFromRelativePath(e);var r=this._textures[e];if(r)this._addImageAsyncCallBack(t,n);else{r=new Image,r.crossOrigin="Anonymous";var i=this;r.addEventListener("load",function(){i._textures.hasOwnProperty(e)&&i._textures[e].handleLoadedTexture(),i._addImageAsyncCallBack(t,n)}),r.addEventListener("error",function(){cc.Loader.getInstance().onResLoadingErr(e),i._textures.hasOwnProperty(e)&&delete i._textures[e]}),r.src=e;var s=new cc.Texture2D;s.initWithElement(r),this._textures[e]=s}return this._textures[e]},_addImageBeforeRenderer:function(e){var t=new Image;t.crossOrigin="Anonymous";var n=this;t.addEventListener("load",function(){cc.Loader.getInstance().onResLoaded(),n._loadedTexturesBefore[e]=t,delete n._loadingTexturesBefore[e]}),t.addEventListener("error",function(){cc.Loader.getInstance().onResLoadingErr(e),delete n._loadingTexturesBefore[e]}),t.src=e,this._loadingTexturesBefore[e]=t},addImage:function(e){cc.Assert(e!=null,"TextureCache: path MUST not be null");if(!this._rendererInitialized)return this._addImageBeforeRenderer(e);e=cc.FileUtils.getInstance().fullPathForFilename(e);var t=this._textures[e];if(t)cc.Loader.getInstance().onResLoaded();else{t=new Image,t.crossOrigin="Anonymous";var n=this;t.addEventListener("load",function(){cc.Loader.getInstance().onResLoaded(),n._textures.hasOwnProperty(e)&&n._textures[e].handleLoadedTexture()}),t.addEventListener("error",function(){cc.Loader.getInstance().onResLoadingErr(e),n._textures.hasOwnProperty(e)&&delete n._textures[e]}),t.src=e;var r=new cc.Texture2D;r.initWithElement(t),this._textures[e]=r}return this._textures[e]},cacheImage:function(e,t){if(t instanceof cc.Texture2D){this._textures[e]=t;return}var n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this._textures[e]=n},addUIImage:function(e,t){cc.Assert(e!=null,"TextureCache: image MUST not be nulll");if(t&&this._textures.hasOwnProperty(t)&&this._textures[t])return this._textures[t];var n=new cc.Texture2D;return n.initWithImage(e),t!=null&&n!=null?this._textures[t]=n:cc.log("cocos2d: Couldn't add UIImage in TextureCache"),n},dumpCachedTextureInfo:function(){var e=0,t=0;for(var n in this._textures){var r=this._textures[n],i=r.bitsPerPixelForFormat(),s=r.getPixelsWide()*r.getPixelsHigh()*i/8;t+=s,e++,cc.log("cocos2d: Texture URL="+r._htmlElementObj.src+" "+r.getPixelsWide()+" x "+r.getPixelsHigh()+" @ "+i+" bpp => "+s/1024+" KB")}cc.log("cocos2d: TextureCache dumpDebugInfo: "+e+" textures, for "+t/1024+" KB ("+(t/1048576).toFixed(2)+" MB)")}}),cc.TextureCacheWebGL.getInstance=function(){return cc.g_sharedTextureCache||(cc.g_sharedTextureCache=new cc.TextureCacheWebGL),cc.g_sharedTextureCache},cc.TextureCacheWebGL.purgeSharedTextureCache=function(){cc.g_sharedTextureCache=null},cc.TextureCache=cc.Browser.supportWebGL?cc.TextureCacheWebGL:cc.TextureCacheCanvas;cc.TextureAtlas=cc.Class.extend({_indices:null,_buffersVBO:null,_dirty:!1,_capacity:0,_texture:null,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(){this._buffersVBO=[]},getTotalQuads:function(){return this._quads.length},getCapacity:function(){return this._capacity},getTexture:function(){return this._texture},setTexture:function(e){this._texture=e},setDirty:function(e){this._dirty=e},getDirty:function(){return this._dirty},getQuads:function(){return this._quads},setQuads:function(e){this._quads=e,this._resetQuadsToTypeArray(0)},_resetQuadsToTypeArray:function(e){if(this._quads.length>this._capacity)throw"out capacity";if(e>this._quads.length)throw"out length";for(var t=e;t<this._quads.length;t++)this._setQuadToArray(this._quads[t],t);this._dirty=!0},_setQuadToArray:function(e,t){if(!this._quads[t]){this._quads[t]=new cc.V3F_C4B_T2F_Quad(e.tl,e.bl,e.tr,e.br,this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);return}this._quads[t].bl=e.bl,this._quads[t].br=e.br,this._quads[t].tl=e.tl,this._quads[t].tr=e.tr},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(this._capacity===0)return;for(var e=0;e<this._capacity;e++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(this._indices[e*6+0]=e*4+0,this._indices[e*6+1]=e*4+0,this._indices[e*6+2]=e*4+2,this._indices[e*6+3]=e*4+1,this._indices[e*6+4]=e*4+3,this._indices[e*6+5]=e*4+3):(this._indices[e*6+0]=e*4+0,this._indices[e*6+1]=e*4+1,this._indices[e*6+2]=e*4+2,this._indices[e*6+3]=e*4+3,this._indices[e*6+4]=e*4+2,this._indices[e*6+5]=e*4+1)},_setupVBO:function(){var e=cc.renderContext;this._buffersVBO[0]=e.createBuffer(),this._buffersVBO[1]=e.createBuffer(),this._quadsWebBuffer=e.createBuffer(),this._mapBuffers()},_mapBuffers:function(){var e=cc.renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._quadsWebBuffer),e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)},initWithFile:function(e,t){var n=cc.TextureCache.getInstance().addImage(e);return n?this.initWithTexture(n,t):(cc.log("cocos2d: Could not open file: "+e),!1)},initWithTexture:function(e,t){return this._capacity=0|t,this._totalQuads=0,this._texture=e,cc.Assert(this._quads==null&&this._indices==null,"TextureAtlas.initWithTexture():_quads and _indices should not be null"),this._quads=[],this._indices=new Uint16Array(this._capacity*6),this._quadsArrayBuffer=new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT*this._capacity),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&this._capacity>0?!1:(this._setupIndices(),this._setupVBO(),this._dirty=!0,!0)},updateQuad:function(e,t){this._totalQuads=Math.max(t+1,this._totalQuads),this._setQuadToArray(e,t),this._dirty=!0},insertQuad:function(e,t){cc.Assert(t<this._capacity,"insertQuadWithTexture: Invalid index"),this._totalQuads++,cc.Assert(this._totalQuads<=this._capacity,"invalid totalQuads");var n=this._totalQuads-1-t,r=t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=n*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._quadsReader.set(this._quadsReader.subarray(r,r+i),r+cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._setQuadToArray(e,t),this._dirty=!0},insertQuads:function(e,t,n){n=n||e.length,cc.Assert(t+n<=this._capacity,"insertQuadWithTexture: Invalid index + amount"),this._totalQuads+=n,cc.Assert(this._totalQuads<=this._capacity,"invalid totalQuads");var r=this._totalQuads-1-t-n,i=t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=r*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,o=this._totalQuads-1-n,u;for(u=0;u<n;u++)this._quads[o+u]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);this._quadsReader.set(this._quadsReader.subarray(i,i+s),i+cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT*n);for(u=0;u<n;u++)this._setQuadToArray(e[u],t+u);this._dirty=!0},insertQuadFromIndex:function(e,t){cc.Assert(t>=0&&t<this._totalQuads,"insertQuadFromIndex:atIndex: Invalid index"),cc.Assert(e>=0&&e<this._totalQuads,"insertQuadFromIndex:atIndex: Invalid index");if(e===t)return;var n=this._quadsReader.subarray(e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),r,i;e>t?(r=t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=(e-t)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this._quadsReader.set(this._quadsReader.subarray(r,r+i),r+cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._quadsReader.set(n,r)):(r=(e+1)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=(t-e)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this._quadsReader.set(this._quadsReader.subarray(r,r+i),r-cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._quadsReader.set(n,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)),this._dirty=!0},removeQuadAtIndex:function(e){cc.Assert(e<this._totalQuads,"removeQuadAtIndex: Invalid index"),this._totalQuads--,this._quads.length=this._totalQuads;if(e!==this._totalQuads){var t=(e+1)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(this._totalQuads-e)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsReader.set(this._quadsReader.subarray(t,t+n),t-cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)}this._dirty=!0},removeQuadsAtIndex:function(e,t){cc.Assert(e+t<=this._totalQuads,"removeQuadAtIndex: index + amount out of bounds"),this._totalQuads-=t;if(e!==this._totalQuads){var n=(e+t)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=(this._totalQuads-e)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsReader.set(this._quadsReader.subarray(n,n+r),i)}this._dirty=!0},removeAllQuads:function(){this._totalQuads=0},resizeCapacity:function(e){if(e==this._capacity)return!0;var t=this._capacity;this._totalQuads=Math.min(this._totalQuads,e),this._capacity=0|e;var n;if(this._quads==null)this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT*this._capacity),this._quadsReader=new Uint8Array(this._quadsArrayBuffer);else{var r,i;if(this._capacity>t){r=[],i=new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT*this._capacity);for(n=0;n<this._totalQuads;n++)r[n]=new cc.V3F_C4B_T2F_Quad(this._quads[n].tl,this._quads[n].bl,this._quads[n].tr,this._quads[n].br,i,n*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);this._quadsReader=new Uint8Array(i),this._quads=r,this._quadsArrayBuffer=i}else{var s=Math.max(this._totalQuads,this._capacity);r=[],i=new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT*this._capacity);for(n=0;n<s;n++)r[n]=new cc.V3F_C4B_T2F_Quad(this._quads[n].tl,this._quads[n].bl,this._quads[n].tr,this._quads[n].br,i,n*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);this._quadsReader=new Uint8Array(i),this._quads=r,this._quadsArrayBuffer=i}}if(this._indices==null)this._indices=new Uint16Array(this._capacity*6);else if(this._capacity>t){var o=new Uint16Array(this._capacity*6);o.set(this._indices,0),this._indices=o}else this._indices=this._indices.subarray(0,this._capacity*6);return this._setupIndices(),this._mapBuffers(),this._dirty=!0,!0},increaseTotalQuadsWith:function(e){this._totalQuads+=e},moveQuadsFromIndex:function(e,t,n){arguments.length==2&&(n=t,t=this._totalQuads-e),cc.Assert(n+t<=this._totalQuads,"moveQuadsFromIndex:newIndex: Invalid index"),cc.Assert(e<this._totalQuads,"moveQuadsFromIndex:oldIndex: Invalid index");if(e==n)return;var r=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=this._quadsReader.subarray(r,r+i),o=n*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,u,a;n<e?(u=(e-n)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,a=n*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this._quadsReader.set(this._quadsReader.subarray(a,a+u),a+i)):(u=(n-e)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,a=(e+t)*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this._quadsReader.set(this._quadsReader.subarray(a,a+u),r)),this._quadsReader.set(s,o),this._dirty=!0},fillWithEmptyQuadsFromIndex:function(e,t){var n=t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=new Uint8Array(this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n);for(var i=0;i<n;i++)r[i]=0},drawNumberOfQuads:function(e,t){t=t||0;if(0===e||!this._texture||!this._texture.isLoaded())return;var n=cc.renderContext;cc.glBindTexture2D(this._texture),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX),n.bindBuffer(n.ARRAY_BUFFER,this._quadsWebBuffer),this._dirty&&n.bufferData(n.ARRAY_BUFFER,this._quadsArrayBuffer,n.DYNAMIC_DRAW),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),this._dirty&&(this._dirty=!1),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?n.drawElements(n.TRIANGLE_STRIP,e*6,n.UNSIGNED_SHORT,t*6*this._indices.BYTES_PER_ELEMENT):n.drawElements(n.TRIANGLES,e*6,n.UNSIGNED_SHORT,t*6*this._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)}}),cc.TextureAtlas.create=function(e,t){var n=new cc.TextureAtlas;return n&&n.initWithFile(e,t)?n:null},cc.TextureAtlas.createWithTexture=function(e,t){var n=new cc.TextureAtlas;return n&&n.initWithTexture(e,t)?n:null};cc.IMAGE_FORMAT_JPEG=0,cc.IMAGE_FORMAT_PNG=1,cc.IMAGE_FORMAT_RAWDATA=2,cc.NextPOT=function(e){return e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1},cc.RenderTexture=cc.Node.extend({canvas:null,context:null,_fBO:0,_depthRenderBuffer:0,_oldFBO:0,_texture:null,_textureCopy:null,_uITextureImage:null,_pixelFormat:cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,_sprite:null,_clearFlags:0,_clearColor:null,_clearDepth:0,_clearStencil:0,_autoDraw:!1,ctor:function(){this._super(),cc.renderContextType===cc.CANVAS?(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.setAnchorPoint(cc.p(0,0))):this._clearColor=cc.c4f(0,0,0,0)},destroyRenderTexture:function(){if(cc.renderContextType===cc.WEBGL){this._sprite=null,this._textureCopy=null;var e=cc.renderContext;e.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&e.deleteRenderbuffer(this._depthRenderBuffer),this._uITextureImage=null}},getSprite:function(){return this._sprite},setSprite:function(e){this._sprite=e},getCanvas:function(){return this.canvas},setContentSize:function(e){if(!e)return;this._super(e),cc.renderContextType===cc.CANVAS&&(this.canvas.width=e.width*1.5,this.canvas.height=e.height*1.5,this.context.translate(0,this.canvas.height))},initWithWidthAndHeight:function(e,t,n,r){if(cc.renderContextType===cc.CANVAS)return this.canvas.width=e||10,this.canvas.height=t||10,this.context.translate(0,this.canvas.height),this._sprite=cc.Sprite.createWithTexture(this.canvas),!0;cc.Assert(this._pixelFormat!=cc.TEXTURE_2D_PIXEL_FORMAT_A8,"only RGB and RGBA formats are valid for a render texture");var i=cc.renderContext;e=0|e*cc.CONTENT_SCALE_FACTOR(),t=0|t*cc.CONTENT_SCALE_FACTOR(),this._oldFBO=i.getParameter(i.FRAMEBUFFER_BINDING);var s,o;cc.Configuration.getInstance().supportsNPOT()?(s=e,o=t):(s=cc.NextPOT(e),o=cc.NextPOT(t));var u=s*o*4,a=new Uint8Array(u);for(var f=0;f<s*o*4;f++)a[f]=0;this._pixelFormat=n,this._texture=new cc.Texture2D;if(!this._texture)return!1;this._texture.initWithData(a,this._pixelFormat,s,o,cc.size(e,t));var l=i.getParameter(i.RENDERBUFFER_BINDING);if(cc.Configuration.getInstance().checkForGLExtension("GL_QCOM")){this._textureCopy=new cc.Texture2D;if(!this._textureCopy)return!1;this._textureCopy.initWithData(a,this._pixelFormat,s,o,cc.size(e,t))}return this._fBO=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._fBO),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._texture._webTextureObj,0),this._depthRenderBuffer!=0&&(this._depthRenderBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._depthRenderBuffer),i.renderbufferStorage(i.RENDERBUFFER,r,s,o),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this._depthRenderBuffer)),cc.Assert(i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE,"Could not attach texture to framebuffer"),this._texture.setAliasTexParameters(),this._sprite=cc.Sprite.createWithTexture(this._texture),this._sprite.setScaleY(-1),this._sprite.setBlendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.bindRenderbuffer(i.RENDERBUFFER,l),i.bindFramebuffer(i.FRAMEBUFFER,this._oldFBO),this._autoDraw=!1,this.addChild(this._sprite),!0},begin:function(){if(cc.renderContextType===cc.CANVAS)return;cc.kmGLPushMatrix();var e=this._texture.getContentSizeInPixels(),t=cc.Director.getInstance().getWinSizeInPixels(),n=t.width/e.width,r=t.height/e.height,i=cc.renderContext;i.viewport(0,0,e.width,e.height);var s=new cc.kmMat4;cc.kmMat4OrthographicProjection(s,-1/n,1/n,-1/r,1/r,-1,1),cc.kmGLMultMatrix(s),this._oldFBO=i.getParameter(i.FRAMEBUFFER_BINDING),i.bindFramebuffer(i.FRAMEBUFFER,this._fBO),cc.Configuration.getInstance().checkForGLExtension("GL_QCOM")&&(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._textureCopy._webTextureObj,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._texture._webTextureObj,0))},beginWithClear:function(e,t,n,r,i,s){var o=cc.renderContext;i=i||o.COLOR_BUFFER_BIT,s=s||o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT,this._beginWithClear(e,t,n,r,i,s,o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT)},_beginWithClear:function(e,t,n,r,i,s,o){if(cc.renderContextType===cc.CANVAS)return;this.begin();var u=cc.renderContext,a=[0,0,0,0],f=0,l=0;o&u.COLOR_BUFFER_BIT&&(a=u.getParameter(u.COLOR_CLEAR_VALUE),u.clearColor(e,t,n,r)),o&u.DEPTH_BUFFER_BIT&&(f=u.getParameter(u.DEPTH_CLEAR_VALUE),u.clearDepth(i)),o&u.STENCIL_BUFFER_BIT&&(l=u.getParameter(u.STENCIL_CLEAR_VALUE),u.clearStencil(s)),u.clear(o),o&u.COLOR_BUFFER_BIT&&u.clearColor(a[0],a[1],a[2],a[3]),o&u.DEPTH_BUFFER_BIT&&u.clearDepth(f),o&u.STENCIL_BUFFER_BIT&&u.clearStencil(l)},end:function(){if(cc.renderContextType===cc.CANVAS)return;var e=cc.renderContext;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),cc.kmGLPopMatrix();var t=cc.Director.getInstance(),n=t.getWinSizeInPixels();e.viewport(0,0,n.width*cc.CONTENT_SCALE_FACTOR(),n.height*cc.CONTENT_SCALE_FACTOR()),t.getProjection()==cc.DIRECTOR_PROJECTION_3D&&cc.CONTENT_SCALE_FACTOR()!=1&&e.viewport(-n.width/2,-n.height/2,n.width*cc.CONTENT_SCALE_FACTOR(),n.height*cc.CONTENT_SCALE_FACTOR()),t.setProjection(t.getProjection())},clear:function(e,t,n,r){if(cc.renderContextType===cc.CANVAS){var i=e;i?this.context.clearRect(i.origin.x,i.origin.y,i.size.width,i.size.height):this.context.clearRect(0,0,this.canvas.width,-this.canvas.height)}else this.beginWithClear(e,t,n,r),this.end()},clearDepth:function(e){if(cc.renderContextType===cc.CANVAS)return;this.begin();var t=cc.renderContext,n=t.getParameter(t.DEPTH_CLEAR_VALUE);t.clearDepth(e),t.clear(t.DEPTH_BUFFER_BIT),t.clearDepth(n),this.end()},clearStencil:function(e){if(cc.renderContextType===cc.CANVAS)return;var t=cc.renderContext,n=t.getParameter(t.STENCIL_CLEAR_VALUE);t.clearStencil(e),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(n)},visit:function(e){if(cc.renderContextType===cc.CANVAS){this._super(e);return}if(!this._visible)return;cc.kmGLPushMatrix(),this._grid&&this._grid.isActive()&&(this._grid.beforeDraw(),this.transformAncestors()),this.transform(e),this._sprite.visit(),this.draw(e),this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),cc.kmGLPopMatrix(),this._orderOfArrival=0},draw:function(e){if(cc.renderContextType===cc.CANVAS){this._super(e);return}var t=cc.renderContext;if(this._autoDraw){this.begin();if(this._clearFlags){var n=[0,0,0,0],r=0,i=0;this._clearFlags&t.COLOR_BUFFER_BIT&&(n=t.getParameter(t.COLOR_CLEAR_VALUE),t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a)),this._clearFlags&t.DEPTH_BUFFER_BIT&&(r=t.getParameter(t.DEPTH_CLEAR_VALUE),t.clearDepth(this._clearDepth)),this._clearFlags&t.STENCIL_BUFFER_BIT&&(i=t.getParameter(t.STENCIL_CLEAR_VALUE),t.clearStencil(this._clearStencil)),t.clear(this._clearFlags),this._clearFlags&t.COLOR_BUFFER_BIT&&t.clearColor(n[0],n[1],n[2],n[3]),this._clearFlags&t.DEPTH_BUFFER_BIT&&t.clearDepth(r),this._clearFlags&t.STENCIL_BUFFER_BIT&&t.clearStencil(i)}this.sortAllChildren();for(var s=0;s<this._children.length;s++){var o=this._children[s];o!=this._sprite&&o.visit()}this.end()}},newCCImage:function(e){e===null&&(e=!0),cc.Assert(this._pixelFormat==cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,"only RGBA8888 can be saved as image");if(!this._texture)return null;var t=this._texture.getContentSizeInPixels(),n=t.width,r=t.height,i=new cc.Image,s=cc.renderContext,o=new Uint8Array(n*r*4);if(!o)return i;var u=new Uint8Array(n*r*4);if(!u)return null;this.begin(),s.pixelStorei(s.PACK_ALIGNMENT,1),s.readPixels(0,0,n,r,s.RGBA,s.UNSIGNED_BYTE,u),this.end();for(var a=0;a<r;++a)this._memcpy(o,a*n*4,u,(r-a-1)*n*4,n*4);return i.initWithImageData(o,n*r*4,cc.FMT_RAWDATA,n,r,8),o=null,u=null,i},_memcpy:function(e,t,n,r,i){for(var s=0;s<i;s++)e[t+s]=n[r+s]},saveToFile:function(e,t){cc.log("saveToFile is NoSupported on Cocos2d-Html5")},listenToBackground:function(e){cc.log("listenToBackground is NoSupported on Cocos2d-Html5")},listenToForeground:function(e){cc.log("listenToForeground is NoSupported on Cocos2d-Html5")},getClearFlags:function(){return this._clearFlags},setClearFlags:function(e){this._clearFlags=e},getClearColor:function(){return this._clearColor},setClearColor:function(e){this._clearColor=cc.c4f(e.r,e.g,e.b,e.a)},getClearDepth:function(){return this._clearDepth},setClearDepth:function(e){this._clearDepth=e},getClearStencil:function(){return this._clearStencil},setClearStencil:function(e){this._clearStencil=e},isAutoDraw:function(){return this._autoDraw},setAutoDraw:function(e){this._autoDraw=e}}),cc.RenderTexture.create=function(e,t,n,r){n=n||cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,r=r||0;var i=new cc.RenderTexture;return i&&i.initWithWidthAndHeight(e,t,n,r)?i:null};cc.PROGRESS_TIMER_TYPE_RADIAL=0,cc.PROGRESS_TIMER_TYPE_BAR=1,cc.PROGRESS_TEXTURE_COORDS_COUNT=4,cc.PROGRESS_TEXTURE_COORDS=75,cc.ProgressTimerCanvas=cc.Node.extend({RGBAProtocol:!0,_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,ctor:function(){this._super(),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1},getMidpoint:function(){return this._midPoint},setMidpoint:function(e){this._midPoint=cc.pClamp(e,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return this._barChangeRate},setBarChangeRate:function(e){this._barChangeRate=cc.pClamp(e,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(e){this._percentage!=e&&(this._percentage=cc.clampf(e,0,100),this._updateProgress())},getColor:function(){return this._sprite.getColor()},getOpacity:function(){return this._sprite.getOpacity()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},_boundaryTexCoord:function(e){return e<cc.PROGRESS_TEXTURE_COORDS_COUNT?this._reverseDirection?cc.p(cc.PROGRESS_TEXTURE_COORDS>>7-(e<<1)&1,cc.PROGRESS_TEXTURE_COORDS>>7-((e<<1)+1)&1):cc.p(cc.PROGRESS_TEXTURE_COORDS>>(e<<1)+1&1,cc.PROGRESS_TEXTURE_COORDS>>(e<<1)&1):cc.PointZero()},setReverseProgress:function(e){this._reverseDirection!==e&&(this._reverseDirection=e)},setSprite:function(e){this._sprite!=e&&(this._sprite=e,this.setContentSize(this._sprite.getContentSize()))},setType:function(e){e!==this._type&&(this._type=e)},setColor:function(e){this._sprite.setColor(e)},setOpacity:function(e){this._sprite.setOpacity(e)},setReverseDirection:function(e){this._reverseDirection!==e&&(this._reverseDirection=e)},initWithSprite:function(e){return this.setPercentage(0),this.setAnchorPoint(cc.p(.5,.5)),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._reverseDirection=!1,this.setMidpoint(cc.p(.5,.5)),this.setBarChangeRate(cc.p(1,1)),this.setSprite(e),!0},draw:function(e){var t=e||cc.renderContext;t.globalAlpha=this._sprite._opacity/255;var n,r=0,i=0,s=this._sprite._contentSize,o=this._sprite._anchorPointInPoints;this._sprite._flipX&&(n=cc.p(s.width*.5,s.height*.5),r=0|n.x-o.x,t.translate(r,0),t.scale(-1,1)),this._sprite._flipY&&(n=cc.p(s.width*.5,s.height*.5),i=-(0|n.y-o.y),t.translate(0,i),t.scale(1,-1)),t.translate(o.x,-o.y);var u;if(this._type==cc.PROGRESS_TIMER_TYPE_BAR)u=cc.p(-o.x+this._sprite._offsetPosition.x+this._drawPosition.x,-o.y+this._sprite._offsetPosition.y+this._drawPosition.y),this._sprite._texture instanceof HTMLImageElement?this._originSize.width!=0&&this._originSize.height!=0&&t.drawImage(this._sprite._texture,this._sprite._rect.origin.x+this._origin.x,this._sprite._rect.origin.y+this._origin.y,this._originSize.width,this._originSize.height,u.x,-(u.y+this._drawSize.height),this._originSize.width,this._originSize.height):this._sprite._texture instanceof HTMLCanvasElement&&this._originSize.width!=0&&this._originSize.height!=0&&t.drawImage(this._sprite._texture,this._origin.x,this._origin.y,this._originSize.width,this._originSize.height,u.x,-(u.y+this._drawSize.height),this._originSize.width,this._originSize.height);else{t.beginPath(),t.arc(this._origin.x,this._origin.y,this._radius,Math.PI/180*this._startAngle,Math.PI/180*this._endAngle,!1),t.lineTo(this._origin.x,this._origin.y),t.clip(),t.closePath();var a=this._sprite._offsetPosition;u=cc.p(0|-o.x+a.x,0|-o.y+a.y),this._sprite._texture instanceof HTMLImageElement?t.drawImage(this._sprite._texture,this._sprite._rect.origin.x,this._sprite._rect.origin.y,this._sprite._rect.size.width,this._sprite._rect.size.height,u.x,-(u.y+this._sprite._rect.size.height),this._sprite._rect.size.width,this._sprite._rect.size.height):this._sprite._texture instanceof HTMLCanvasElement&&t.drawImage(this._sprite._texture,0,0,this._sprite._rect.size.width,this._sprite._rect.size.height,u.x,-(u.y+this._sprite._rect.size.height),this._sprite._rect.size.width,this._sprite._rect.size.height)}cc.INCREMENT_GL_DRAWS(1)},_origin:cc.PointZero(),_originSize:cc.SizeZero(),_drawSize:cc.SizeZero(),_drawPosition:cc.PointZero(),_startAngle:270,_endAngle:270,_radius:0,_updateProgress:function(){var e=this._sprite.getContentSize(),t=this._sprite.getTextureRect().size;if(this._type==cc.PROGRESS_TIMER_TYPE_RADIAL)this._origin=cc.p(-(e.width*(.5-this._midPoint.x)),-(e.height*(.5-this._midPoint.y))),this._radius=Math.round(Math.sqrt(e.width*e.width+e.height*e.height)),this._reverseDirection?this._startAngle=270-3.6*this._percentage:this._endAngle=270+3.6*this._percentage;else{this._origin=cc.p(0,0),this._drawPosition=cc.p(0,0);var n=this._percentage/100,r=cc.p(e.width*this._midPoint.x,e.height*this._midPoint.y),i=cc.p(t.width*this._midPoint.x,t.height*this._midPoint.y),s=cc.size(e.width*(1-this._barChangeRate.x),e.height*(1-this._barChangeRate.y)),o=cc.size((e.width-s.width)*n,(e.height-s.height)*n);this._drawSize=cc.size(s.width+o.width,s.height+o.height);var u=cc.size(t.width*(1-this._barChangeRate.x),t.height*(1-this._barChangeRate.y)),a=cc.size((t.width-u.width)*n,(t.height-u.height)*n);this._originSize=cc.size(u.width+a.width,u.height+a.height);var f=r.x*n,l=i.x*n;e.width==this._drawSize.width?(this._origin.x=0,this._drawPosition.x=0):(this._origin.x=i.x-l,this._drawPosition.x=r.x-f);var c=(t.height-i.y)*n;e.height==this._drawSize.height?(this._origin.y=0,this._drawPosition.y=0):(this._origin.y=t.height-i.y-c,this._drawPosition.y=r.y-r.y*n)}}}),cc.ProgressTimerCanvas.create=function(e){var t=new cc.ProgressTimerCanvas;return t.initWithSprite(e)?t:null},cc.ProgressTimerWebGL=cc.Node.extend({RGBAProtocol:!0,_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,ctor:function(){this._super(),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1},getMidpoint:function(){return this._midPoint},setMidpoint:function(e){this._midPoint=cc.pClamp(e,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return this._barChangeRate},setBarChangeRate:function(e){this._barChangeRate=cc.pClamp(e,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(e){this._percentage!=e&&(this._percentage=cc.clampf(e,0,100),this._updateProgress())},getColor:function(){return this._sprite.getColor()},getOpacity:function(){return this._sprite.getOpacity()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},_boundaryTexCoord:function(e){return e<cc.PROGRESS_TEXTURE_COORDS_COUNT?this._reverseDirection?cc.p(cc.PROGRESS_TEXTURE_COORDS>>7-(e<<1)&1,cc.PROGRESS_TEXTURE_COORDS>>7-((e<<1)+1)&1):cc.p(cc.PROGRESS_TEXTURE_COORDS>>(e<<1)+1&1,cc.PROGRESS_TEXTURE_COORDS>>(e<<1)&1):cc.PointZero()},_vertexDataCount:0,_vertexData:null,_verticesFloat32Buffer:null,_textureCoordsFloat32Buffer:null,_colorsUint8Buffer:null,setReverseProgress:function(e){this._reverseDirection!==e&&(this._reverseDirection=e,this._vertexData=null,this._vertexDataCount=0)},setSprite:function(e){this._sprite!=e&&(this._sprite=e,this.setContentSize(this._sprite.getContentSize()),this._vertexData&&(this._vertexData=null,this._vertexDataCount=0))},setType:function(e){e!==this._type&&(this._vertexData&&(this._vertexData=null,this._vertexDataCount=0),this._type=e)},setColor:function(e){this._sprite.setColor(e),this._updateColor()},setOpacity:function(e){this._sprite.setOpacity(e),this._updateColor()},setReverseDirection:function(e){this._reverseDirection!==e&&(this._reverseDirection=e,this._vertexData=null,this._vertexDataCount=0)},_textureCoordFromAlphaPoint:function(e){if(!this._sprite)return new cc.Tex2F(0,0);var t=this._sprite.getQuad(),n=cc.p(t.bl.texCoords.u,t.bl.texCoords.v),r=cc.p(t.tr.texCoords.u,t.tr.texCoords.v);if(this._sprite.isTextureRectRotated()){var i=e.x;e.x=e.y,e.y=i}return new cc.Tex2F(n.x*(1-e.x)+r.x*e.x,n.y*(1-e.y)+r.y*e.y)},_vertexFromAlphaPoint:function(e){var t=new cc.Tex2F(0,0);if(!this._sprite)return t;var n=this._sprite.getQuad(),r=cc.p(n.bl.vertices.x,n.bl.vertices.y),i=cc.p(n.tr.vertices.x,n.tr.vertices.y);return t.x=r.x*(1-e.x)+i.x*e.x,t.y=r.y*(1-e.y)+i.y*e.y,t},initWithSprite:function(e){return this.setPercentage(0),this._vertexData=null,this._vertexDataCount=0,this.setAnchorPoint(cc.p(.5,.5)),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._reverseDirection=!1,this.setMidpoint(cc.p(.5,.5)),this.setBarChangeRate(cc.p(1,1)),this.setSprite(e),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),!0},_getProgressTimerVertexArray:function(){var e=cc.renderContext.createBuffer();cc.renderContext.bindBuffer(cc.renderContext.ARRAY_BUFFER,e);var t=new Float32Array(2*this._vertexDataCount);for(var n=0;n<this._vertexDataCount;n++)t[n*2]=this._vertexData[n].vertices.x,t[n*2+1]=this._vertexData[n].vertices.y;return cc.renderContext.bufferData(cc.renderContext.ARRAY_BUFFER,t,cc.renderContext.STATIC_DRAW),e},_getProgressTimerColorArray:function(){var e=cc.renderContext.createBuffer();cc.renderContext.bindBuffer(cc.renderContext.ARRAY_BUFFER,e);var t=new Uint8Array(4*this._vertexDataCount);for(var n=0;n<this._vertexDataCount;n++)t[n*4]=this._vertexData[n].colors.r,t[n*4+1]=this._vertexData[n].colors.g,t[n*4+2]=this._vertexData[n].colors.b,t[n*4+3]=this._vertexData[n].colors.a;return cc.renderContext.bufferData(cc.renderContext.ARRAY_BUFFER,t,cc.renderContext.STATIC_DRAW),e},_getProgressTimerTexCoodsArray:function(){var e=cc.renderContext.createBuffer();cc.renderContext.bindBuffer(cc.renderContext.ARRAY_BUFFER,e);var t=new Float32Array(2*this._vertexDataCount);for(var n=0;n<this._vertexDataCount;n++)t[n*2]=this._vertexData[n].texCoords.u,t[n*2+1]=this._vertexData[n].texCoords.v;return cc.renderContext.bufferData(cc.renderContext.ARRAY_BUFFER,t,cc.renderContext.STATIC_DRAW),e},draw:function(e){var t=e||cc.renderContext;if(!this._vertexData||!this._sprite)return;cc.NODE_DRAW_SETUP(this),cc.glBlendFunc(this._sprite.getBlendFunc().src,this._sprite.getBlendFunc().dst),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX),this._sprite.getTexture()?cc.glBindTexture2D(this._sprite.getTexture()):cc.glBindTexture2D(null),t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._textureCoordsFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),this._type===cc.PROGRESS_TIMER_TYPE_RADIAL?t.drawArrays(t.TRIANGLE_FAN,0,this._vertexDataCount):this._type==cc.PROGRESS_TIMER_TYPE_BAR&&(this._reverseDirection?(t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount/2),t.drawArrays(t.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.INCREMENT_GL_DRAWS(1)):t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount)),cc.INCREMENT_GL_DRAWS(1)},_updateColor:function(){if(!this._sprite||!this._vertexData)return;var e=this._sprite.getQuad().tl.colors;for(var t=0;t<this._vertexDataCount;++t)this._vertexData[t].colors=e;this._colorsUint8Buffer=this._getProgressTimerColorArray()},_updateRadial:function(){if(!this._sprite)return;var e,t=this._percentage/100,n=2*cc.PI*(this._reverseDirection?t:1-t),r=cc.p(this._midPoint.x,1),i=cc.pRotateByAngle(r,this._midPoint,n),s=0,o;if(t==0)o=r,s=0;else if(t==1)o=r,s=4;else{var u=cc.FLT_MAX;for(e=0;e<=cc.PROGRESS_TEXTURE_COORDS_COUNT;++e){var a=(e+(cc.PROGRESS_TEXTURE_COORDS_COUNT-1))%cc.PROGRESS_TEXTURE_COORDS_COUNT,f=this._boundaryTexCoord(e%cc.PROGRESS_TEXTURE_COORDS_COUNT),l=this._boundaryTexCoord(a);e==0?l=cc.pLerp(f,l,1-this._midPoint.x):e==4&&(f=cc.pLerp(f,l,1-this._midPoint.x));var c=cc.p(0,0);if(cc.pLineIntersect(f,l,this._midPoint,i,c)){if(e==0||e==4)if(!(0<=c.x&&c.x<=1))continue;c.y>=0&&c.y<u&&(u=c.y,s=e)}}o=cc.pAdd(this._midPoint,cc.pMult(cc.pSub(i,this._midPoint),u))}var h=!0;this._vertexDataCount!=s+3&&(h=!1,this._vertexData=null,this._vertexDataCount=0);if(!this._vertexData){this._vertexDataCount=s+3,this._vertexData=[];for(e=0;e<this._vertexDataCount;e++)this._vertexData[e]=new cc.V2F_C4B_T2F;cc.Assert(this._vertexData,"cc.ProgressTimer. Not enough memory")}if(!h){this._vertexData[0].texCoords=this._textureCoordFromAlphaPoint(this._midPoint),this._vertexData[0].vertices=this._vertexFromAlphaPoint(this._midPoint),this._vertexData[1].texCoords=this._textureCoordFromAlphaPoint(r),this._vertexData[1].vertices=this._vertexFromAlphaPoint(r);for(e=0;e<s;e++){var p=this._boundaryTexCoord(e);this._vertexData[e+2].texCoords=this._textureCoordFromAlphaPoint(p),this._vertexData[e+2].vertices=this._vertexFromAlphaPoint(p)}}this._vertexData[this._vertexDataCount-1].texCoords=this._textureCoordFromAlphaPoint(o),this._vertexData[this._vertexDataCount-1].vertices=this._vertexFromAlphaPoint(o),this._verticesFloat32Buffer=this._getProgressTimerVertexArray(),this._textureCoordsFloat32Buffer=this._getProgressTimerTexCoodsArray(),this._updateColor()},_updateBar:function(){if(!this._sprite)return;var e,t=this._percentage/100,n=cc.pMult(cc.p(1-this._barChangeRate.x+t*this._barChangeRate.x,1-this._barChangeRate.y+t*this._barChangeRate.y),.5),r=cc.pSub(this._midPoint,n),i=cc.pAdd(this._midPoint,n);r.x<0&&(i.x+=-r.x,r.x=0),i.x>1&&(r.x-=i.x-1,i.x=1),r.y<0&&(i.y+=-r.y,r.y=0),i.y>1&&(r.y-=i.y-1,i.y=1);if(!this._reverseDirection){if(!this._vertexData){this._vertexDataCount=4,this._vertexData=[];for(e=0;e<this._vertexDataCount;e++)this._vertexData[e]=new cc.V2F_C4B_T2F;cc.Assert(this._vertexData,"cc.ProgressTimer. Not enough memory")}this._vertexData[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(r.x,i.y)),this._vertexData[0].vertices=this._vertexFromAlphaPoint(cc.p(r.x,i.y)),this._vertexData[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(r.x,r.y)),this._vertexData[1].vertices=this._vertexFromAlphaPoint(cc.p(r.x,r.y)),this._vertexData[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,i.y)),this._vertexData[2].vertices=this._vertexFromAlphaPoint(cc.p(i.x,i.y)),this._vertexData[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,r.y)),this._vertexData[3].vertices=this._vertexFromAlphaPoint(cc.p(i.x,r.y))}else{if(!this._vertexData){this._vertexData=8,this._vertexData=[];for(e=0;e<this._vertexDataCount;e++)this._vertexData[e]=new cc.V2F_C4B_T2F;cc.Assert(this._vertexData,"cc.ProgressTimer. Not enough memory"),this._vertexData[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,1)),this._vertexData[0].vertices=this._vertexFromAlphaPoint(cc.p(0,1)),this._vertexData[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,0)),this._vertexData[1].vertices=this._vertexFromAlphaPoint(cc.p(0,0)),this._vertexData[6].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,1)),this._vertexData[6].vertices=this._vertexFromAlphaPoint(cc.p(1,1)),this._vertexData[7].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,0)),this._vertexData[7].vertices=this._vertexFromAlphaPoint(cc.p(1,0))}this._vertexData[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(r.x,i.y)),this._vertexData[2].vertices=this._vertexFromAlphaPoint(cc.p(r.x,i.y)),this._vertexData[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(r.x,r.y)),this._vertexData[3].vertices=this._vertexFromAlphaPoint(cc.p(r.x,r.y)),this._vertexData[4].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,i.y)),this._vertexData[4].vertices=this._vertexFromAlphaPoint(cc.p(i.x,i.y)),this._vertexData[5].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,r.y)),this._vertexData[5].vertices=this._vertexFromAlphaPoint(cc.p(i.x,r.y))}this._verticesFloat32Buffer=this._getProgressTimerVertexArray(),this._textureCoordsFloat32Buffer=this._getProgressTimerTexCoodsArray(),this._updateColor()},_updateProgress:function(){switch(this._type){case cc.PROGRESS_TIMER_TYPE_RADIAL:this._updateRadial();break;case cc.PROGRESS_TIMER_TYPE_BAR:this._updateBar();break;default:}}}),cc.ProgressTimerWebGL.create=function(e){var t=new cc.ProgressTimerWebGL;return t.initWithSprite(e)?t:null},cc.ProgressTimer=cc.Browser.supportWebGL?cc.ProgressTimerWebGL:cc.ProgressTimerCanvas;cc.MotionStreak=cc.Node.extend({_fastMode:!1,_startingPositionInitialized:!1,_texture:null,_blendFunc:null,_positionR:null,_color:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,getTexture:function(){return this._texture},setTexture:function(e){this._texture!=e&&(this._texture=e)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:arguments.length==2&&(this._blendFunc.src=e,this._blendFunc.dst=t)},setColor:function(e){this._color=e},getColor:function(){return this._color},getOpacity:function(){return cc.Assert(!1,"Opacity no supported"),0},setOpacity:function(e){cc.Assert(!1,"Set opacity no supported")},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},ctor:function(){this._super(),this._positionR=cc.PointZero(),this._color=cc.c3(0,0,0),this._blendFunc=new cc.BlendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)},isFastMode:function(){return this._fastMode},setFastMode:function(e){this._fastMode=e},isStartingPositionInitialized:function(){return this._startingPositionInitialized},setStartingPositionInitialized:function(e){this._startingPositionInitialized=e},initWithFade:function(e,t,n,r,i){cc.Assert(i!=null,"Invalid filename or texture"),typeof i=="string"&&(i=cc.TextureCache.getInstance().addImage(i)),cc.Node.prototype.setPosition.call(this,cc.PointZero()),this.setAnchorPoint(cc.PointZero()),this.ignoreAnchorPointForPosition(!0),this._startingPositionInitialized=!1,this._positionR=cc.PointZero(),this._fastMode=!0,this._minSeg=t==-1?n/5:t,this._minSeg*=this._minSeg,this._stroke=n,this._fadeDelta=1/e,this._maxPoints=(0|e*60)+2,this._nuPoints=0,this._pointState=new Float32Array(this._maxPoints),this._pointVertexes=new Float32Array(this._maxPoints*2),this._vertices=new Float32Array(this._maxPoints*4),this._texCoords=new Float32Array(this._maxPoints*4),this._colorPointer=new Uint8Array(this._maxPoints*8);var s=cc.renderContext;return this._verticesBuffer=s.createBuffer(),this._texCoordsBuffer=s.createBuffer(),this._colorPointerBuffer=s.createBuffer(),this._blendFunc.src=s.SRC_ALPHA,this._blendFunc.dst=s.ONE_MINUS_SRC_ALPHA,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),this.setTexture(i),this.setColor(r),this.scheduleUpdate(),s.bindBuffer(s.ARRAY_BUFFER,this._verticesBuffer),s.bufferData(s.ARRAY_BUFFER,this._vertices,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,this._texCoordsBuffer),s.bufferData(s.ARRAY_BUFFER,this._texCoords,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,this._colorPointerBuffer),s.bufferData(s.ARRAY_BUFFER,this._colorPointer,s.DYNAMIC_DRAW),this._isDirty=!0,!0},tintWithColor:function(e){this.setColor(e);for(var t=0;t<this._nuPoints*2;t++)this._colorPointer[t*4]=e.r,this._colorPointer[t*4+1]=e.g,this._colorPointer[t*4+2]=e.b;this._isDirty=!0},reset:function(){this._nuPoints=0},setPosition:function(e){this._startingPositionInitialized=!0,this._positionR=cc.p(e.x,e.y)},draw:function(e){if(this._nuPoints<=1)return;this._texture&&this._texture.isLoaded()&&(e=e||cc.renderContext,cc.NODE_DRAW_SETUP(this),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(this._texture),e.bindBuffer(e.ARRAY_BUFFER,this._verticesBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertices,e.DYNAMIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._texCoordsBuffer),e.bufferData(e.ARRAY_BUFFER,this._texCoords,e.DYNAMIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorPointerBuffer),e.bufferData(e.ARRAY_BUFFER,this._colorPointer,e.DYNAMIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._nuPoints*2),cc.INCREMENT_GL_DRAWS(1))},update:function(e){if(!this._startingPositionInitialized)return;e*=this._fadeDelta;var t,n,r,i,s=0;for(r=0;r<this._nuPoints;r++){this._pointState[r]-=e;if(this._pointState[r]<=0)s++;else{t=r-s,s>0?(this._pointState[t]=this._pointState[r],this._pointVertexes[t*2]=this._pointVertexes[r*2],this._pointVertexes[t*2+1]=this._pointVertexes[r*2+1],i=r*2,n=t*2,this._vertices[n*2]=this._vertices[i*2],this._vertices[n*2+1]=this._vertices[i*2+1],this._vertices[(n+1)*2]=this._vertices[(i+1)*2],this._vertices[(n+1)*2+1]=this._vertices[(i+1)*2+1],i*=4,n*=4,this._colorPointer[n+0]=this._colorPointer[i+0],this._colorPointer[n+1]=this._colorPointer[i+1],this._colorPointer[n+2]=this._colorPointer[i+2],this._colorPointer[n+4]=this._colorPointer[i+4],this._colorPointer[n+5]=this._colorPointer[i+5],this._colorPointer[n+6]=this._colorPointer[i+6]):n=t*8;var o=this._pointState[t]*255;this._colorPointer[n+3]=o,this._colorPointer[n+7]=o}}this._nuPoints-=s;var u=!0;if(this._nuPoints>=this._maxPoints)u=!1;else if(this._nuPoints>0){var a=cc.pDistanceSQ(cc.p(this._pointVertexes[(this._nuPoints-1)*2],this._pointVertexes[(this._nuPoints-1)*2+1]),this._positionR)<this._minSeg,f=this._nuPoints==1?!1:cc.pDistanceSQ(cc.p(this._pointVertexes[(this._nuPoints-2)*2],this._pointVertexes[(this._nuPoints-2)*2+1]),this._positionR)<this._minSeg*2;if(a||f)u=!1}if(u){this._pointVertexes[this._nuPoints*2]=this._positionR.x,this._pointVertexes[this._nuPoints*2+1]=this._positionR.y,this._pointState[this._nuPoints]=1;var l=this._nuPoints*8;this._colorPointer[l]=this._color.r,this._colorPointer[l+1]=this._color.g,this._colorPointer[l+2]=this._color.b,this._colorPointer[l+4]=this._color.r,this._colorPointer[l+5]=this._color.g,this._colorPointer[l+6]=this._color.b,this._colorPointer[l+3]=255,this._colorPointer[l+7]=255,this._nuPoints>0&&this._fastMode&&(this._nuPoints>1?cc.vertexLineToPolygon(this._pointVertexes,this._stroke,this._vertices,this._nuPoints,1):cc.vertexLineToPolygon(this._pointVertexes,this._stroke,this._vertices,0,2)),this._nuPoints++}this._fastMode||cc.vertexLineToPolygon(this._pointVertexes,this._stroke,this._vertices,0,this._nuPoints);if(this._nuPoints&&this._previousNuPoints!=this._nuPoints){var c=1/this._nuPoints;for(r=0;r<this._nuPoints;r++)this._texCoords[r*4]=0,this._texCoords[r*4+1]=c*r,this._texCoords[(r*2+1)*2]=1,this._texCoords[(r*2+1)*2+1]=c*r;this._previousNuPoints=this._nuPoints}}}),cc.MotionStreak.create=function(e,t,n,r,i){var s=new cc.MotionStreak;return s&&s.initWithFade(e,t,n,r,i)?s:null};cc.stencilBits=-1,cc.setProgram=function(e,t){e.setShaderProgram(t);var n=e.getChildren();if(!n)return;for(var r=0;r<n.length;r++)cc.setProgram(n[r],t)},cc.ClippingNode=cc.Node.extend({_stencil:null,_alphaThreshold:0,_inverted:!1,init:function(e){return this._stencil=e,this._alphaThreshold=1,this._inverted=!1,cc.ClippingNode._init_once=!0,cc.ClippingNode._init_once&&(cc.stencilBits=cc.renderContext.getParameter(cc.renderContext.STENCIL_BITS),cc.stencilBits<=0&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode._init_once=!1),!0},onEnter:function(){this._super(),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){this._super(),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),this._super()},onExit:function(){this._stencil.onExit(),this._super()},visit:function(e){var t=e||cc.renderContext;if(cc.stencilBits<1){this._super(e);return}if(!this._stencil||!this._stencil.isVisible()){this._inverted&&this._super(e);return}cc.ClippingNode._layer=-1;if(cc.ClippingNode._layer+1==cc.stencilBits){cc.ClippingNode._visit_once=!0,cc.ClippingNode._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),cc.ClippingNode._visit_once=!1),this._super();return}cc.ClippingNode._layer++;var n=1<<cc.ClippingNode._layer,r=n-1,i=n|r,s=t.isEnabled(t.STENCIL_TEST),o=t.getParameter(t.STENCIL_WRITEMASK),u=t.getParameter(t.STENCIL_FUNC),a=t.getParameter(t.STENCIL_REF),f=t.getParameter(t.STENCIL_VALUE_MASK),l=t.getParameter(t.STENCIL_FAIL),c=t.getParameter(t.STENCIL_PASS_DEPTH_FAIL),h=t.getParameter(t.STENCIL_PASS_DEPTH_PASS);t.enable(t.STENCIL_TEST),t.stencilMask(n);var p=t.getParameter(t.DEPTH_WRITEMASK);t.depthMask(!1),t.stencilFunc(t.NEVER,n,n),t.stencilOp(this._inverted?t.REPLACE:t.ZERO,t.KEEP,t.KEEP),cc.drawingUtil.drawSolidRect(cc.PointZero(),cc.pFromSize(cc.Director.getInstance().getWinSize()),cc.c4f(1,1,1,1)),t.stencilFunc(t.NEVER,n,n),t.stencilOp(this._inverted?t.ZERO:t.REPLACE,t.KEEP,t.KEEP);if(this._alphaThreshold<1){var d=cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),v=t.getUniformLocation(d.getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S);cc.glUseProgram(d.getProgram()),d.setUniformLocationWith1f(v,this._alphaThreshold),cc.setProgram(this._stencil,d)}cc.kmGLPushMatrix(),this.transform(),this._stencil.visit(),cc.kmGLPopMatrix(),t.depthMask(p),t.stencilFunc(t.EQUAL,i,i),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),this._super(),t.stencilFunc(u,a,f),t.stencilOp(l,c,h),t.stencilMask(o),s||t.disable(t.STENCIL_TEST),cc.ClippingNode._layer--},getStencil:function(){return this._stencil},setStencil:function(e){this._stencil=e},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(e){this._alphaThreshold=e},isInverted:function(){return this._inverted},setInverted:function(e){this._inverted=e}}),cc.ClippingNode._init_once=null,cc.ClippingNode._visit_once=null,cc.ClippingNode._layer=null,cc.ClippingNode.create=function(e){var t=new cc.ClippingNode;return t.init(e),t};cc.GridBase=cc.Class.extend({_active:!1,_reuseGrid:0,_gridSize:null,_texture:null,_step:null,_grabber:null,_isTextureFlipped:!1,_shaderProgram:null,_directorProjection:0,_dirty:!1,ctor:function(){this._step=cc.p(0,0)},isActive:function(){return this._active},setActive:function(e){this._active=e;if(!e){var t=cc.Director.getInstance(),n=t.getProjection();t.setProjection(n)}},getReuseGrid:function(){return this._reuseGrid},setReuseGrid:function(e){this._reuseGrid=e},getGridSize:function(){return this._gridSize},setGridSize:function(e){this._gridSize.width=parseInt(e.width),this._gridSize.height=parseInt(e.height)},getStep:function(){return this._step},setStep:function(e){this._step=e},isTextureFlipped:function(){return this._isTextureFlipped},setTextureFlipped:function(e){this._isTextureFlipped!=e&&(this._isTextureFlipped=e,this.calculateVertexPoints())},initWithSize:function(e,t,n){if(!t){var r=cc.Director.getInstance(),i=r.getWinSizeInPixels(),s=cc.NextPOT(i.width),o=cc.NextPOT(i.height),u=new Uint8Array(s*o*4);if(!u)return cc.log("cocos2d: CCGrid: not enough memory."),!1;t=new cc.Texture2D,t.initWithData(u,cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,s,o,i);if(!t)return cc.log("cocos2d: CCGrid: error creating texture"),!1}n=n||!1,this._active=!1,this._reuseGrid=0,this._gridSize=e,this._texture=t,this._isTextureFlipped=n;var a=this._texture.getContentSize();return this._step.x=a.width/this._gridSize.width,this._step.y=a.height/this._gridSize.height,this._grabber=new cc.Grabber,this._grabber?(this._grabber.grab(this._texture),this._shaderProgram=cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE),this.calculateVertexPoints(),!0):!1},beforeDraw:function(){this._directorProjection=cc.Director.getInstance().getProjection(),this.set2DProjection(),this._grabber.beforeRender(this._texture)},afterDraw:function(e){this._grabber.afterRender(this._texture),cc.Director.getInstance().setProjection(this._directorProjection);if(e.getCamera().isDirty()){var t=e.getAnchorPointInPoints();cc.kmGLTranslatef(t.x,t.y,0),e.getCamera().locate(),cc.kmGLTranslatef(-t.x,-t.y,0)}cc.glBindTexture2D(this._texture),this.blit()},blit:function(){cc.Assert(0,"")},reuse:function(){cc.Assert(0,"")},calculateVertexPoints:function(){cc.Assert(0,"")},set2DProjection:function(){var e=cc.Director.getInstance().getWinSizeInPixels(),t=cc.renderContext;t.viewport(0,0,e.width*cc.CONTENT_SCALE_FACTOR(),e.height*cc.CONTENT_SCALE_FACTOR()),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var n=new cc.kmMat4;cc.kmMat4OrthographicProjection(n,0,e.width*cc.CONTENT_SCALE_FACTOR(),0,e.height*cc.CONTENT_SCALE_FACTOR(),-1,1),cc.kmGLMultMatrix(n),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity(),cc.setProjectionMatrixDirty()}}),cc.GridBase.create=function(e,t,n){var r=new cc.GridBase;return r&&r.initWithSize(e,t,n)?r:null},cc.Grid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(){this._super()},vertex:function(e){var t=0|(e.x*(this._gridSize.height+1)+e.y)*3;return new cc.Vertex3F(this._vertices[t],this._vertices[t+1],this._vertices[t+2])},originalVertex:function(e){var t=0|(e.x*(this._gridSize.height+1)+e.y)*3;return new cc.Vertex3F(this._originalVertices[t],this._originalVertices[t+1],this._originalVertices[t+2])},setVertex:function(e,t){var n=0|(e.x*(this._gridSize.height+1)+e.y)*3,r=this._vertices;r[n]=t.x,r[n+1]=t.y,r[n+2]=t.z,this._dirty=!0},blit:function(){var e=this._gridSize.width*this._gridSize.height;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEXCOORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins();var t=cc.renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),this._dirty&&t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),this._dirty&&t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),this._dirty&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,e*6,t.UNSIGNED_SHORT,0),this._dirty&&(this._dirty=!1),cc.INCREMENT_GL_DRAWS(1)},reuse:function(){if(this._reuseGrid>0){for(var e=0;e<this._vertices.length;e++)this._originalVertices[e]=this._vertices[e];--this._reuseGrid}},calculateVertexPoints:function(){var e=cc.renderContext,t=this._texture.getPixelsWide(),n=this._texture.getPixelsHigh(),r=this._texture.getContentSizeInPixels().height,i=(this._gridSize.width+1)*(this._gridSize.height+1);this._vertices=new Float32Array(i*3),this._texCoordinates=new Float32Array(i*2),this._indices=new Uint16Array(this._gridSize.width*this._gridSize.height*6),this._verticesBuffer=e.createBuffer(),this._texCoordinateBuffer=e.createBuffer(),this._indicesBuffer=e.createBuffer();var s,o,u;for(s=0;s<this._gridSize.width;++s)for(o=0;o<this._gridSize.height;++o){var a=o*this._gridSize.width+s,f=s*this._step.x,l=f+this._step.x,c=o*this._step.y,h=c+this._step.y,p=s*(this._gridSize.height+1)+o,d=(s+1)*(this._gridSize.height+1)+o,v=(s+1)*(this._gridSize.height+1)+(o+1),m=s*(this._gridSize.height+1)+(o+1);this._indices[a*6]=p,this._indices[a*6+1]=d,this._indices[a*6+2]=m,this._indices[a*6+3]=d,this._indices[a*6+4]=v,this._indices[a*6+5]=m;var g=[p*3,d*3,v*3,m*3],y=new cc.Vertex3F(f,c,0),b=new cc.Vertex3F(l,c,0),w=new cc.Vertex3F(l,h,0),E=new cc.Vertex3F(f,h,0),S=[y,b,w,E],x=[p*2,d*2,v*2,m*2],T=[cc.p(f,c),cc.p(l,c),cc.p(l,h),cc.p(f,h)];for(u=0;u<4;++u)this._vertices[g[u]]=S[u].x,this._vertices[g[u]+1]=S[u].y,this._vertices[g[u]+2]=S[u].z,this._texCoordinates[x[u]]=T[u].x/t,this._isTextureFlipped?this._texCoordinates[x[u]+1]=(r-T[u].y)/n:this._texCoordinates[x[u]+1]=T[u].y/n}this._originalVertices=new Float32Array(this._vertices),e.bindBuffer(e.ARRAY_BUFFER,this._verticesBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._texCoordinateBuffer),e.bufferData(e.ARRAY_BUFFER,this._texCoordinates,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW),this._dirty=!0}}),cc.Grid3D.create=function(e,t,n){var r=new cc.Grid3D;return r&&r.initWithSize(e,t,n)?r:null},cc.TiledGrid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(){this._super()},tile:function(e){var t=(this._gridSize.height*e.x+e.y)*4*3;return new cc.Quad3(new cc.Vertex3F(this._vertices[t],this._vertices[t+1],this._vertices[t+2]),new cc.Vertex3F(this._vertices[t+3],this._vertices[t+4],this._vertices[t+5]),new cc.Vertex3F(this._vertices[t+6],this._vertices[t+7],this._vertices[t+8]),new cc.Vertex3F(this._vertices[t+9],this._vertices[t+10],this._vertices[t+11]))},originalTile:function(e){var t=(this._gridSize.height*e.x+e.y)*4*3;return new cc.Quad3(new cc.Vertex3F(this._originalVertices[t],this._originalVertices[t+1],this._originalVertices[t+2]),new cc.Vertex3F(this._originalVertices[t+3],this._originalVertices[t+4],this._originalVertices[t+5]),new cc.Vertex3F(this._originalVertices[t+6],this._originalVertices[t+7],this._originalVertices[t+8]),new cc.Vertex3F(this._originalVertices[t+9],this._originalVertices[t+10],this._originalVertices[t+11]))},setTile:function(e,t){var n=(this._gridSize.height*e.x+e.y)*12;this._vertices[n]=t.bl.x,this._vertices[n+1]=t.bl.y,this._vertices[n+2]=t.bl.z,this._vertices[n+3]=t.br.x,this._vertices[n+4]=t.br.y,this._vertices[n+5]=t.br.z,this._vertices[n+6]=t.tl.x,this._vertices[n+7]=t.tl.y,this._vertices[n+8]=t.tl.z,this._vertices[n+9]=t.tr.x,this._vertices[n+10]=t.tr.y,this._vertices[n+11]=t.tr.z,this._dirty=!0},blit:function(){var e=this._gridSize.width*this._gridSize.height;this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins();var t=cc.renderContext;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEXCOORDS),t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),this._dirty&&t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,this._vertices),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),this._dirty&&t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,this._texCoordinates),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),this._dirty&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,e*6,t.UNSIGNED_SHORT,0),this._dirty&&(this._dirty=!1),cc.INCREMENT_GL_DRAWS(1)},reuse:function(){if(this._reuseGrid>0){for(var e=0;e<this._vertices.length;e++)this._originalVertices[e]=this._vertices[e];--this._reuseGrid}},calculateVertexPoints:function(){var e=this._texture.getPixelsWide(),t=this._texture.getPixelsHigh(),n=this._texture.getContentSizeInPixels().height,r=this._gridSize.width*this._gridSize.height;this._vertices=new Float32Array(r*12),this._texCoordinates=new Float32Array(r*8),this._indices=new Uint16Array(r*6);var i=cc.renderContext;this._verticesBuffer=i.createBuffer(),this._texCoordinateBuffer=i.createBuffer(),this._indicesBuffer=i.createBuffer();var s,o,u=0;for(s=0;s<this._gridSize.width;s++)for(o=0;o<this._gridSize.height;o++){var a=s*this._step.x,f=a+this._step.x,l=o*this._step.y,c=l+this._step.y;this._vertices[u*12]=a,this._vertices[u*12+1]=l,this._vertices[u*12+2]=0,this._vertices[u*12+3]=f,this._vertices[u*12+4]=l,this._vertices[u*12+5]=0,this._vertices[u*12+6]=a,this._vertices[u*12+7]=c,this._vertices[u*12+8]=0,this._vertices[u*12+9]=f,this._vertices[u*12+10]=c,this._vertices[u*12+11]=0;var h=l,p=c;this._isTextureFlipped&&(h=n-l,p=n-c),this._texCoordinates[u*8]=a/e,this._texCoordinates[u*8+1]=h/t,this._texCoordinates[u*8+2]=f/e,this._texCoordinates[u*8+3]=h/t,this._texCoordinates[u*8+4]=a/e,this._texCoordinates[u*8+5]=p/t,this._texCoordinates[u*8+6]=f/e,this._texCoordinates[u*8+7]=p/t,u++}for(s=0;s<r;s++)this._indices[s*6+0]=s*4+0,this._indices[s*6+1]=s*4+1,this._indices[s*6+2]=s*4+2,this._indices[s*6+3]=s*4+1,this._indices[s*6+4]=s*4+2,this._indices[s*6+5]=s*4+3;this._originalVertices=new Float32Array(this._vertices),i.bindBuffer(i.ARRAY_BUFFER,this._verticesBuffer),i.bufferData(i.ARRAY_BUFFER,this._vertices,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this._texCoordinateBuffer),i.bufferData(i.ARRAY_BUFFER,this._texCoordinates,i.DYNAMIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this._indices,i.DYNAMIC_DRAW),this._dirty=!0}}),cc.TiledGrid3D.create=function(e,t,n){var r=new cc.TiledGrid3D;return r.initWithSize(e,t,n),r};cc.Grabber=cc.Class.extend({_fbo:null,_oldFBO:null,_oldClearColor:null,_gl:null,ctor:function(){this._gl=cc.renderContext,this._oldClearColor=[0,0,0,0],this._fbo=this._gl.createFramebuffer()},grab:function(e){this._oldFBO=this._gl.getParameter(this._gl.FRAMEBUFFER_BINDING),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,e._webTextureObj,0);var t=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);t!=this._gl.FRAMEBUFFER_COMPLETE&&cc.log("Frame Grabber: could not attach texture to frmaebuffer"),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._oldFBO)},beforeRender:function(e){this._oldFBO=this._gl.getParameter(this._gl.FRAMEBUFFER_BINDING),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._oldClearColor=this._gl.getParameter(this._gl.COLOR_CLEAR_VALUE),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT)},afterRender:function(e){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._oldFBO),this._gl.colorMask(!0,!0,!0,!0)},destroy:function(){this._gl.deleteFramebuffer(this._fbo)}});cc.v2fzero=function(){return{x:0,y:0}},cc.v2f=function(e,t){return{x:e,y:t}},cc.v2fadd=function(e,t){return cc.v2f(e.x+t.x,e.y+t.y)},cc.v2fsub=function(e,t){return cc.v2f(e.x-t.x,e.y-t.y)},cc.v2fmult=function(e,t){return cc.v2f(e.x*t,e.y*t)},cc.v2fperp=function(e){return cc.v2f(-e.y,e.x)},cc.v2fneg=function(e){return cc.v2f(-e.x,-e.y)},cc.v2fdot=function(e,t){return e.x*t.x+e.y*t.y},cc.v2fforangle=function(e){return cc.v2f(Math.cos(e),Math.sin(e))},cc.v2fnormalize=function(e){var t=cc.pNormalize(cc.p(e.x,e.y));return cc.v2f(t.x,t.y)},cc.__v2f=function(e){return cc.v2f(e.x,e.y)},cc.__t=function(e){return{u:e.x,v:e.y}},cc.DrawNodeCanvas=cc.Node.extend({_buffer:null,_blendFunc:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},ctor:function(){this._super(),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST)},draw:function(e){var t=e||cc.renderContext;this._blendFunc&&this._blendFunc.src==gl.SRC_ALPHA&&this._blendFunc.dst==gl.ONE&&(t.globalCompositeOperation="lighter");for(var n=0;n<this._buffer.length;n++){var r=this._buffer[n];r.type===cc.DRAWNODE_TYPE_DOT&&(t.fillStyle="rgba("+(0|r.color.r*255)+","+(0|r.color.g*255)+","+(0|r.color.b*255)+","+r.color.a+")",cc.drawingUtil.drawPoint(r.position,r.radius)),r.type===cc.DRAWNODE_TYPE_SEGMENT&&(t.strokeStyle="rgba("+(0|r.color.r*255)+","+(0|r.color.g*255)+","+(0|r.color.b*255)+","+r.color.a+")",t.lineWidth=r.radius*2,t.lineCap="round",cc.drawingUtil.drawLine(r.from,r.to)),r.type===cc.DRAWNODE_TYPE_POLY&&(t.fillStyle="rgba("+(0|r.fillColor.r*255)+","+(0|r.fillColor.g*255)+","+(0|r.fillColor.b*255)+","+r.fillColor.a+")",cc.drawingUtil.drawPoly(r.verts,r.count,!1,!0),t.lineWidth=r.borderWidth*2,t.lineCap="round",t.strokeStyle="rgba("+(0|r.borderColor.r*255)+","+(0|r.borderColor.g*255)+","+(0|r.borderColor.b*255)+","+r.borderColor.a+")",cc.drawingUtil.drawPoly(r.verts,r.count,!0,!1))}},drawDot:function(e,t,n){var r=new cc._DrawNodeElement(cc.DRAWNODE_TYPE_DOT);r.position=e,r.radius=t,r.color=n,this._buffer.push(r)},drawSegment:function(e,t,n,r){var i=new cc._DrawNodeElement(cc.DRAWNODE_TYPE_SEGMENT);i.from=e,i.to=t,i.radius=n,i.color=r,this._buffer.push(i)},drawPoly:function(e,t,n,r){var i=new cc._DrawNodeElement(cc.DRAWNODE_TYPE_POLY);i.verts=e,i.count=e.length,i.fillColor=t,i.borderWidth=n,i.borderColor=r,this._buffer.push(i)},clear:function(){this._buffer.length=0}}),cc.DrawNodeCanvas.create=function(){var e=new cc.DrawNodeCanvas;return e&&e.init()?e:null},cc.DrawNodeWebGL=cc.Node.extend({_bufferCapacity:0,_buffer:null,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_blendFunc:null,_dirty:!1,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},ctor:function(){this._super(),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST)},init:function(){return this._super()?(this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR)),this._ensureCapacity(512),this._trianglesWebBuffer=cc.renderContext.createBuffer(),this._dirty=!0,!0):!1},_render:function(){var e=cc.renderContext;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX),e.bindBuffer(e.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(e.bufferData(e.ARRAY_BUFFER,this._trianglesArrayBuffer,e.STREAM_DRAW),this._dirty=!1);var t=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,t,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,t,8),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,t,12),e.drawArrays(e.TRIANGLES,0,this._buffer.length*3),cc.INCREMENT_GL_DRAWS(1)},_ensureCapacity:function(e){if(this._buffer.length+e>this._bufferCapacity){this._bufferCapacity+=Math.max(this._bufferCapacity,e);if(this._buffer==null||this._buffer.length===0)this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer);else{var t=[],n=new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT*this._bufferCapacity);for(var r=0;r<this._buffer.length;r++)t[r]=new cc.V2F_C4B_T2F_Triangle(this._buffer[r].a,this._buffer[r].b,this._buffer[r].c,n,r*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT);this._trianglesReader=new Uint8Array(n),this._buffer=t,this._trianglesArrayBuffer=n}}},draw:function(){cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),this._render()},drawDot:function(e,t,n){var r={r:0|n.r*255,g:0|n.g*255,b:0|n.b*255,a:0|n.a*255},i={vertices:{x:e.x-t,y:e.y-t},colors:r,texCoords:{u:-1,v:-1}},s={vertices:{x:e.x-t,y:e.y+t},colors:r,texCoords:{u:-1,v:1}},o={vertices:{x:e.x+t,y:e.y+t},colors:r,texCoords:{u:1,v:1}},u={vertices:{x:e.x+t,y:e.y-t},colors:r,texCoords:{u:1,v:-1}};this._buffer.push(new cc.V2F_C4B_T2F_Triangle(i,s,o,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(i,o,u,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawSegment:function(e,t,n,r){var i=18;this._ensureCapacity(i);var s={r:0|r.r*255,g:0|r.g*255,b:0|r.b*255,a:0|r.a*255},o=cc.__v2f(e),u=cc.__v2f(t),a=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(u,o))),f=cc.v2fperp(a),l=cc.v2fmult(a,n),c=cc.v2fmult(f,n),h=cc.v2fsub(u,cc.v2fadd(l,c)),p=cc.v2fadd(u,cc.v2fsub(l,c)),d=cc.v2fsub(u,l),v=cc.v2fadd(u,l),m=cc.v2fsub(o,l),g=cc.v2fadd(o,l),y=cc.v2fsub(o,cc.v2fsub(l,c)),b=cc.v2fadd(o,cc.v2fadd(l,c));this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:h,colors:s,texCoords:cc.__t(cc.v2fneg(cc.v2fadd(a,f)))},{vertices:p,colors:s,texCoords:cc.__t(cc.v2fsub(a,f))},{vertices:d,colors:s,texCoords:cc.__t(cc.v2fneg(a))},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(a)},{vertices:p,colors:s,texCoords:cc.__t(cc.v2fsub(a,f))},{vertices:d,colors:s,texCoords:cc.__t(cc.v2fneg(a))},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(a)},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(a))},{vertices:d,colors:s,texCoords:cc.__t(cc.v2fneg(a))},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(a)},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(a))},{vertices:g,colors:s,texCoords:cc.__t(a)},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:y,colors:s,texCoords:cc.__t(cc.v2fsub(f,a))},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(a))},{vertices:g,colors:s,texCoords:cc.__t(a)},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:y,colors:s,texCoords:cc.__t(cc.v2fsub(f,a))},{vertices:b,colors:s,texCoords:cc.__t(cc.v2fadd(a,f))},{vertices:g,colors:s,texCoords:cc.__t(a)},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawPoly:function(e,t,n,r){var i={r:0|t.r*255,g:0|t.g*255,b:0|t.b*255,a:0|t.a*255},s={r:0|r.r*255,g:0|r.g*255,b:0|r.b*255,a:0|r.a*255},o=[],u,a,f,l,c=e.length;for(u=0;u<c;u++){a=cc.__v2f(e[(u-1+c)%c]),f=cc.__v2f(e[u]),l=cc.__v2f(e[(u+1)%c]);var h=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(f,a))),p=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(l,f))),d=cc.v2fmult(cc.v2fadd(h,p),1/(cc.v2fdot(h,p)+1));o[u]={offset:d,n:p}}var v=t.a>0&&n>0,m=3*c-2,g=3*m;this._ensureCapacity(g);var y=v==0?.5:0;for(u=0;u<c-2;u++)a=cc.v2fsub(cc.__v2f(e[0]),cc.v2fmult(o[0].offset,y)),f=cc.v2fsub(cc.__v2f(e[u+1]),cc.v2fmult(o[u+1].offset,y)),l=cc.v2fsub(cc.__v2f(e[u+2]),cc.v2fmult(o[u+2].offset,y)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:a,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:f,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:l,colors:i,texCoords:cc.__t(cc.v2fzero())},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT));for(u=0;u<c;u++){var b=(u+1)%c;a=cc.__v2f(e[u]),f=cc.__v2f(e[b]);var w=o[u].n,E=o[u].offset,S=o[b].offset,x=v?cc.v2fsub(a,cc.v2fmult(E,n)):cc.v2fsub(a,cc.v2fmult(E,.5)),T=v?cc.v2fsub(f,cc.v2fmult(S,n)):cc.v2fsub(f,cc.v2fmult(S,.5)),N=v?cc.v2fadd(a,cc.v2fmult(E,n)):cc.v2fadd(a,cc.v2fmult(E,.5)),C=v?cc.v2fadd(f,cc.v2fmult(S,n)):cc.v2fadd(f,cc.v2fmult(S,.5));v?(this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:s,texCoords:cc.__t(cc.v2fneg(w))},{vertices:T,colors:s,texCoords:cc.__t(cc.v2fneg(w))},{vertices:C,colors:s,texCoords:cc.__t(w)},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:s,texCoords:cc.__t(cc.v2fneg(w))},{vertices:N,colors:s,texCoords:cc.__t(w)},{vertices:C,colors:s,texCoords:cc.__t(w)},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT))):(this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:T,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:C,colors:i,texCoords:cc.__t(w)},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:x,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:N,colors:i,texCoords:cc.__t(w)},{vertices:C,colors:i,texCoords:cc.__t(w)},this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)))}o=null,this._dirty=!0},clear:function(){this._buffer.length=0,this._dirty=!0}}),cc.DrawNodeWebGL.create=function(){var e=new cc.DrawNodeWebGL;return e&&e.init()?e:null},cc.DrawNode=cc.Browser.supportWebGL?cc.DrawNodeWebGL:cc.DrawNodeCanvas,cc._DrawNodeElement=function(e){this.type=e},cc.DRAWNODE_TYPE_DOT=0,cc.DRAWNODE_TYPE_SEGMENT=1,cc.DRAWNODE_TYPE_POLY=2;cc.ACTION_TAG_INVALID=-1,cc.Action=cc.Class.extend({_originalTarget:null,_target:null,_tag:cc.ACTION_TAG_INVALID,description:function(){return"<cc.Action | Tag = "+this._tag+">"},copyWithZone:function(e){return this.copy()},copy:function(){return cc.clone(this)},isDone:function(){return!0},startWithTarget:function(e){this._originalTarget=e,this._target=e},stop:function(){this._target=null},step:function(e){cc.log("[Action step]. override me")},update:function(e){cc.log("[Action update]. override me")},getTarget:function(){return this._target},setTarget:function(e){this._target=e},getOriginalTarget:function(){return this._originalTarget},setOriginalTarget:function(e){this._originalTarget=e},getTag:function(){return this._tag},setTag:function(e){this._tag=e},retain:function(){},release:function(){}}),cc.Action.create=function(){return new cc.Action},cc.FiniteTimeAction=cc.Action.extend({_duration:0,getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,getSpeed:function(){return this._speed},setSpeed:function(e){this._speed=e},initWithAction:function(e,t){return cc.Assert(e!=null,""),this._innerAction=e,this._speed=t,!0},startWithTarget:function(e){cc.Action.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(e){this._innerAction.step(e*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return cc.Speed.create(this._innerAction.reverse(),this._speed)},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.Speed.create=function(e,t){var n=new cc.Speed;return n&&n.initWithAction(e,t)?n:null},cc.Follow=cc.Action.extend({isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(e){this._boundarySet=e},initWithTarget:function(e,t){cc.Assert(e!=null,""),t=t||cc.RectZero(),this._followedNode=e,this._boundarySet=!cc.Rect.CCRectEqualToRect(t,cc.RectZero()),this._boundaryFullyCovered=!1;var n=cc.Director.getInstance().getWinSize();return this._fullScreenSize=cc.p(n.width,n.height),this._halfScreenSize=cc.pMult(this._fullScreenSize,.5),this._boundarySet&&(this.leftBoundary=-(t.origin.x+t.size.width-this._fullScreenSize.x),this.rightBoundary=-t.origin.x,this.topBoundary=-t.origin.y,this.bottomBoundary=-(t.origin.y+t.size.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary==this.bottomBoundary&&this.leftBoundary==this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(e){if(this._boundarySet){if(this._boundaryFullyCovered)return;var t=cc.pSub(this._halfScreenSize,this._followedNode.getPosition());this._target.setPosition(cc.p(cc.clampf(t.x,this.leftBoundary,this.rightBoundary),cc.clampf(t.y,this.bottomBoundary,this.topBoundary)))}else this._target.setPosition(cc.pSub(this._halfScreenSize,this._followedNode.getPosition()))},isDone:function(){return!this._followedNode.isRunning()},stop:function(){this._target=null,cc.Action.prototype.stop.call(this)},_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0}),cc.Follow.create=function(e,t){t=t||new cc.RectZero;var n=new cc.Follow;return t!=null&&n&&n.initWithTarget(e,t)?n:n&&n.initWithTarget(e)?n:null};cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,getElapsed:function(){return this._elapsed},initWithDuration:function(e){return this._duration=e===0?cc.FLT_EPSILON:e,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},step:function(e){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=e;var t=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);t=1>t?t:1,this.update(t>0?t:0)},startWithTarget:function(e){cc.Action.prototype.startWithTarget.call(this,e),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.Assert(!1,"cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(e){cc.Assert(0,"Actioninterval setAmplitudeRate")},getAmplitudeRate:function(){return cc.Assert(0,"Actioninterval getAmplitudeRate"),0}}),cc.ActionInterval.create=function(e){var t=new cc.ActionInterval;return t.initWithDuration(e),t},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(){this._actions=[]},initOneTwo:function(e,t){cc.Assert(e!=null,"Sequence.initOneTwo"),cc.Assert(t!=null,"Sequence.initOneTwo");var n=e.getDuration(),r=t.getDuration(),i=e.getDuration()+t.getDuration();return this.initWithDuration(i),this._actions[0]=e,this._actions[1]=t,!0},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._split=this._actions[0].getDuration()/this._duration,this._last=-1},stop:function(){this._last!=-1&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(e){var t,n=0;e<this._split?t=this._split?e/this._split:1:(n=1,t=this._split===1?1:(e-this._split)/(1-this._split),this._last===-1&&(this._actions[0].startWithTarget(this._target),this._actions[0].update(1),this._actions[0].stop()),this._last||(this._actions[0].update(1),this._actions[0].stop()));if(this._last===n&&this._actions[n].isDone())return;this._last!=n&&this._actions[n].startWithTarget(this._target),this._actions[n].update(t),this._last=n},reverse:function(){return cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse())},copy:function(){return cc.Sequence._actionOneTwo(this._actions[0].copy(),this._actions[1].copy())}}),cc.Sequence.create=function(e){var t=e instanceof Array?e:arguments,n=t[0];for(var r=1;r<t.length;r++)t[r]&&(n=cc.Sequence._actionOneTwo(n,t[r]));return n},cc.Sequence._actionOneTwo=function(e,t){var n=new cc.Sequence;return n.initOneTwo(e,t),n},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,initWithAction:function(e,t){var n=e.getDuration()*t;return this.initWithDuration(n)?(this._times=t,this._innerAction=e,e instanceof cc.ActionInstant&&(this._times-=1),this._total=0,!0):!1},startWithTarget:function(e){this._total=0,this._nextDt=this._innerAction.getDuration()/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(e){if(e>=this._nextDt){while(e>this._nextDt&&this._total<this._times)this._innerAction.update(1),this._total++,this._innerAction.stop(),this._innerAction.startWithTarget(this._target),this._nextDt+=this._innerAction.getDuration()/this._duration;e>=1&&this._total<this._times&&this._total++,this._actionInstant&&(this._total==this._times?(this._innerAction.update(1),this._innerAction.stop()):this._innerAction.update(e-(this._nextDt-this._innerAction.getDuration()/this._duration)))}else this._innerAction.update(e*this._times%1)},isDone:function(){return this._total==this._times},reverse:function(){return cc.Repeat.create(this._innerAction.reverse(),this._times)},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.Repeat.create=function(e,t){var n=new cc.Repeat;return n.initWithAction(e,t),n},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,initWithAction:function(e){return cc.Assert(e!=null,""),this._innerAction=e,!0},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},step:function(e){this._innerAction.step(e),this._innerAction.isDone()&&(this._innerAction.startWithTarget(this._target),this._innerAction.step(this._innerAction.getElapsed()-this._innerAction.getDuration()))},isDone:function(){return!1},reverse:function(){return cc.RepeatForever.create(this._innerAction.reverse())},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.RepeatForever.create=function(e){var t=new cc.RepeatForever;return t&&t.initWithAction(e)?t:null},cc.Spawn=cc.ActionInterval.extend({initOneTwo:function(e,t){cc.Assert(e!=null,"no action1"),cc.Assert(t!=null,"no action2");var n=!1,r=e.getDuration(),i=t.getDuration();return this.initWithDuration(Math.max(r,i))&&(this._one=e,this._two=t,r>i?this._two=cc.Sequence._actionOneTwo(t,cc.DelayTime.create(r-i)):r<i&&(this._one=cc.Sequence._actionOneTwo(e,cc.DelayTime.create(i-r))),n=!0),n},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._one.startWithTarget(e),this._two.startWithTarget(e)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(e){this._one&&this._one.update(e),this._two&&this._two.update(e)},reverse:function(){return cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse())},_one:null,_two:null}),cc.Spawn.create=function(e){var t=e instanceof Array?e:arguments,n=t[0];for(var r=1;r<t.length;r++)t[r]!=null&&(n=this._actionOneTwo(n,t[r]));return n},cc.Spawn._actionOneTwo=function(e,t){var n=new cc.Spawn;return n.initOneTwo(e,t),n},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,initWithDuration:function(e,t,n){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._dstAngleX=t||0,this._dstAngleY=n||this._dstAngleX,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._startAngleX=e.getRotationX(),this._startAngleX=this._startAngleX%360,this._diffAngleX=this._dstAngleX-this._startAngleX,this._diffAngleX>180&&(this._diffAngleX-=360),this._diffAngleX<-180&&(this._diffAngleX+=360),this._startAngleY=e.getRotationY(),this._startAngleY=this._startAngleY%360,this._diffAngleY=this._dstAngleY-this._startAngleY,this._diffAngleY>180&&(this._diffAngleY-=360),this._diffAngleY<-180&&(this._diffAngleY+=360)},reverse:function(){cc.Assert(0,"RotateTo reverse not implemented")},update:function(e){this._target&&(this._target.setRotationX(this._startAngleX+this._diffAngleX*e),this._target.setRotationY(this._startAngleY+this._diffAngleY*e))}}),cc.RotateTo.create=function(e,t,n){var r=new cc.RotateTo;return r.initWithDuration(e,t,n),r},cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,initWithDuration:function(e,t,n){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._angleX=t||0,this._angleY=n||this._angleX,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._startAngleX=e.getRotationX(),this._startAngleY=e.getRotationY()},update:function(e){this._target&&(this._target.setRotationX(this._startAngleX+this._angleX*e),this._target.setRotationY(this._startAngleY+this._angleY*e))},reverse:function(){return cc.RotateBy.create(this._duration,-this._angleX,-this._angleY)}}),cc.RotateBy.create=function(e,t,n){var r=new cc.RotateBy;return r.initWithDuration(e,t,n),r},cc.MoveTo=cc.ActionInterval.extend({initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._endPosition=t,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._previousPosition=this._startPosition=e.getPosition(),this._delta=cc.pSub(this._endPosition,this._startPosition)},update:function(e){if(this._target){var t=this._target.getPosition(),n=cc.pSub(t,this._previousPosition);this._startPosition=cc.pAdd(this._startPosition,n);var r=cc.p(this._startPosition.x+this._delta.x*e,this._startPosition.y+this._delta.y*e);this._target.setPosition(r),this._previousPosition=r}},reverse:function(){cc.Assert(0,"moveto reverse is not implemented")},_endPosition:cc.p(0,0),_startPosition:cc.p(0,0),_delta:cc.p(0,0)}),cc.MoveTo.create=function(e,t){var n=new cc.MoveTo;return n.initWithDuration(e,t),n},cc.MoveBy=cc.MoveTo.extend({initWithDuration:function(e,t){return cc.MoveTo.prototype.initWithDuration.call(this,e,t)?(this._delta=t,!0):!1},startWithTarget:function(e){var t=this._delta;cc.MoveTo.prototype.startWithTarget.call(this,e),this._delta=t},reverse:function(){return cc.MoveBy.create(this._duration,cc.p(-this._delta.x,-this._delta.y))}}),cc.MoveBy.create=function(e,t){var n=new cc.MoveBy;return n.initWithDuration(e,t),n},cc.SkewTo=cc.ActionInterval.extend({initWithDuration:function(e,t,n){var r=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,e)&&(this._endSkewX=t,this._endSkewY=n,r=!0),r},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._startSkewX=e.getSkewX(),this._startSkewX>0?this._startSkewX=this._startSkewX%180:this._startSkewX=this._startSkewX%-180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=e.getSkewY(),this._startSkewY>0?this._startSkewY=this._startSkewY%360:this._startSkewY=this._startSkewY%-360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(e){this._target.setSkewX(this._startSkewX+this._deltaX*e),this._target.setSkewY(this._startSkewY+this._deltaY*e)},_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0}),cc.SkewTo.create=function(e,t,n){var r=new cc.SkewTo;return r&&r.initWithDuration(e,t,n),r},cc.SkewBy=cc.SkewTo.extend({initWithDuration:function(e,t,n){var r=!1;return cc.SkewTo.prototype.initWithDuration.call(this,e,t,n)&&(this._skewX=t,this._skewY=n,r=!0),r},startWithTarget:function(e){cc.SkewTo.prototype.startWithTarget.call(this,e),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){return cc.SkewBy.create(this._duration,-this._skewX,-this._skewY)}}),cc.SkewBy.create=function(e,t,n){var r=new cc.SkewBy;return r&&r.initWithDuration(e,t,n),r},cc.JumpBy=cc.ActionInterval.extend({initWithDuration:function(e,t,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._delta=t,this._height=n,this._jumps=r,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._previousPosition=this._startPosition=e.getPosition()},update:function(e){if(this._target){var t=e*this._jumps%1,n=this._height*4*t*(1-t);n+=this._delta.y*e;var r=this._delta.x*e,i=this._target.getPosition(),s=cc.pSub(i,this._previousPosition);this._startPosition=cc.pAdd(s,this._startPosition);var o=cc.pAdd(this._startPosition,cc.p(r,n));this._target.setPosition(o),this._previousPosition=o}},reverse:function(){return cc.JumpBy.create(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps)},_startPosition:cc.p(0,0),_delta:cc.p(0,0),_height:0,_jumps:0}),cc.JumpBy.create=function(e,t,n,r){var i=new cc.JumpBy;return i.initWithDuration(e,t,n,r),i},cc.JumpTo=cc.JumpBy.extend({startWithTarget:function(e){cc.JumpBy.prototype.startWithTarget.call(this,e),this._delta=cc.p(this._delta.x-this._startPosition.x,this._delta.y-this._startPosition.y)}}),cc.JumpTo.create=function(e,t,n,r){var i=new cc.JumpTo;return i.initWithDuration(e,t,n,r),i},cc.bezierat=function(e,t,n,r,i){return Math.pow(1-i,3)*e+3*i*Math.pow(1-i,2)*t+3*Math.pow(i,2)*(1-i)*n+Math.pow(i,3)*r},cc.BezierBy=cc.ActionInterval.extend({initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._config=t,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._previousPosition=this._startPosition=e.getPosition()},update:function(e){if(this._target){var t=0,n=this._config[0].x,r=this._config[1].x,i=this._config[2].x,s=0,o=this._config[0].y,u=this._config[1].y,a=this._config[2].y,f=cc.bezierat(t,n,r,i,e),l=cc.bezierat(s,o,u,a,e),c=this._target.getPosition(),h=cc.pSub(c,this._previousPosition);this._startPosition=cc.pAdd(this._startPosition,h);var p=cc.pAdd(this._startPosition,cc.p(f,l));this._target.setPosition(p),this._previousPosition=p}},reverse:function(){var e=[cc.pAdd(this._config[1],cc.pNeg(this._config[2])),cc.pAdd(this._config[0],cc.pNeg(this._config[2])),cc.pNeg(this._config[2])];return cc.BezierBy.create(this._duration,e)},ctor:function(){this._config=[],this._startPosition=cc.p(0,0)}}),cc.BezierBy.create=function(e,t){var n=new cc.BezierBy;return n.initWithDuration(e,t),n},cc.BezierTo=cc.BezierBy.extend({_toConfig:null,initWithDuration:function(e,t){return cc.BezierBy.prototype.initWithDuration.call(this,e,t)?(this._toConfig=[],this._toConfig[0]=cc.p(t[0].x,t[0].y),this._toConfig[1]=cc.p(t[1].x,t[1].y),this._toConfig[2]=cc.p(t[2].x,t[2].y),!0):!1},startWithTarget:function(e){cc.BezierBy.prototype.startWithTarget.call(this,e),this._config[0]=cc.pSub(this._toConfig[0],this._startPosition),this._config[1]=cc.pSub(this._toConfig[1],this._startPosition),this._config[2]=cc.pSub(this._toConfig[2],this._startPosition)}}),cc.BezierTo.create=function(e,t){var n=new cc.BezierTo;return n.initWithDuration(e,t),n},cc.ScaleTo=cc.ActionInterval.extend({initWithDuration:function(e,t,n){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._endScaleX=t,this._endScaleY=n!=null?n:t,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._startScaleX=e.getScaleX(),this._startScaleY=e.getScaleY(),this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(e){this._target&&this._target.setScale(this._startScaleX+this._deltaX*e,this._startScaleY+this._deltaY*e)},_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0}),cc.ScaleTo.create=function(e,t,n){var r=new cc.ScaleTo;return n?r.initWithDuration(e,t,n):r.initWithDuration(e,t),r},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(e){cc.ScaleTo.prototype.startWithTarget.call(this,e),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){return cc.ScaleBy.create(this._duration,1/this._endScaleX,1/this._endScaleY)}}),cc.ScaleBy.create=function(e,t,n){var r=new cc.ScaleBy;return arguments.length==3?r.initWithDuration(e,t,n):r.initWithDuration(e,t),r},cc.Blink=cc.ActionInterval.extend({initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._times=t,!0):!1},update:function(e){if(this._target&&!this.isDone()){var t=1/this._times,n=e%t;this._target.setVisible(n>t/2?!0:!1)}},startWithTarget:function(e){this._super(e),this._originalState=e.isVisible()},stop:function(){this._target.setVisible(this._originalState),this._super()},reverse:function(){return cc.Blink.create(this._duration,this._times)},_times:0,_originalState:!1}),cc.Blink.create=function(e,t){var n=new cc.Blink;return n.initWithDuration(e,t),n},cc.FadeIn=cc.ActionInterval.extend({update:function(e){this._target.setOpacity(255*e)},reverse:function(){return cc.FadeOut.create(this._duration)}}),cc.FadeIn.create=function(e){var t=new cc.FadeIn;return t.initWithDuration(e),t},cc.FadeOut=cc.ActionInterval.extend({update:function(e){this._target.setOpacity(255*(1-e))},reverse:function(){return cc.FadeIn.create(this._duration)}}),cc.FadeOut.create=function(e){var t=new cc.FadeOut;return t.initWithDuration(e),t},cc.FadeTo=cc.ActionInterval.extend({initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._toOpacity=t,!0):!1},update:function(e){this._target.setOpacity(this._fromOpacity+(this._toOpacity-this._fromOpacity)*e)},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._fromOpacity=e.getOpacity()},_toOpacity:"",_fromOpacity:""}),cc.FadeTo.create=function(e,t){var n=new cc.FadeTo;return n.initWithDuration(e,t),n},cc.TintTo=cc.ActionInterval.extend({initWithDuration:function(e,t,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._to=cc.c3b(t,n,r),!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._from=this._target.getColor()},update:function(e){this._target.setColor(cc.c3b(this._from.r+(this._to.r-this._from.r)*e,this._from.g+(this._to.g-this._from.g)*e,this._from.b+(this._to.b-this._from.b)*e))},_to:new cc.Color3B,_from:new cc.Color3B}),cc.TintTo.create=function(e,t,n,r){var i=new cc.TintTo;return i.initWithDuration(e,t,n,r),i},cc.TintBy=cc.ActionInterval.extend({initWithDuration:function(e,t,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._deltaR=t,this._deltaG=n,this._deltaB=r,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);if(e.RGBAProtocol){var t=e.getColor();this._fromR=t.r,this._fromG=t.g,this._fromB=t.b}},update:function(e){this._target.RGBAProtocol&&this._target.setColor(cc.c3b(this._fromR+this._deltaR*e,this._fromG+this._deltaG*e,this._fromB+this._deltaB*e))},reverse:function(){return cc.TintBy.create(this._duration,-this._deltaR,-this._deltaG,-this._deltaB)},_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0}),cc.TintBy.create=function(e,t,n,r){var i=new cc.TintBy;return i.initWithDuration(e,t,n,r),i},cc.DelayTime=cc.ActionInterval.extend({update:function(e){},reverse:function(){return cc.DelayTime.create(this._duration)}}),cc.DelayTime.create=function(e){var t=new cc.DelayTime;return t.initWithDuration(e),t},cc.ReverseTime=cc.ActionInterval.extend({initWithAction:function(e){return cc.Assert(e!=null,""),cc.Assert(e!=this._other,""),cc.ActionInterval.prototype.initWithDuration.call(this,e.getDuration())?(this._other=e,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._other.startWithTarget(e)},update:function(e){this._other&&this._other.update(1-e)},reverse:function(){return this._other.copy()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)},_other:null}),cc.ReverseTime.create=function(e){var t=new cc.ReverseTime;return t.initWithAction(e),t},cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,getAnimation:function(){return this._animation},setAnimation:function(e){this._animation=e},initWithAnimation:function(e){cc.Assert(e!=null,"Animate: argument Animation must be non-NULL");var t=e.getDuration();if(this.initWithDuration(t*e.getLoops())){this._nextFrame=0,this.setAnimation(e),this._origFrame=null,this._executedLoops=0,this._splitTimes=[];var n=0,r=t/e.getTotalDelayUnits(),i=e.getFrames();cc.ArrayVerifyType(i,cc.AnimationFrame);for(var s=0;s<i.length;s++){var o=i[s],u=n*r/t;n+=o.getDelayUnits(),this._splitTimes.push(u)}return!0}return!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._animation.getRestoreOriginalFrame()&&(this._origFrame=e.displayFrame()),this._nextFrame=0,this._executedLoops=0},update:function(e){if(e<1){e*=this._animation.getLoops();var t=0|e;t>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),e%=1}var n=this._animation.getFrames(),r=n.length;for(var i=this._nextFrame;i<r;i++)if(this._splitTimes[i]<=e){this._target.setDisplayFrame(n[i].getSpriteFrame()),this._nextFrame=i+1;break}},reverse:function(){var e=this._animation.getFrames(),t=[];cc.ArrayVerifyType(e,cc.AnimationFrame);if(e.length>0)for(var n=e.length-1;n>=0;n--){var r=e[n];if(!r)break;t.push(r.copy())}var i=cc.Animation.createWithAnimationFrames(t,this._animation.getDelayPerUnit(),this._animation.getLoops());return i.setRestoreOriginalFrame(this._animation.getRestoreOriginalFrame()),cc.Animate.create(i)},copy:function(){return cc.Animate.create(this._animation.copy())},stop:function(){this._animation.getRestoreOriginalFrame()&&this._target&&this._target.setDisplayFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.Animate.create=function(e){var t=new cc.Animate;return t.initWithAnimation(e),t},cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,initWithTarget:function(e,t){return this.initWithDuration(t.getDuration())?(this._forcedTarget=e,this._action=t,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,this._forcedTarget),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(e){this._action.update(e)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(e){this._forcedTarget!=e&&(this._forcedTarget=e)}}),cc.TargetedAction.create=function(e,t){var n=new cc.TargetedAction;return n.initWithTarget(e,t),n};cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(e){this.update(1)},update:function(e){}}),cc.Show=cc.ActionInstant.extend({update:function(e){this._target.setVisible(!0)},reverse:function(){return cc.Hide.create.call(this)}}),cc.Show.create=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({update:function(e){this._target.setVisible(!1)},reverse:function(){return cc.Show.create.call(this)}}),cc.Hide.create=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({update:function(e){this._target.setVisible(!this._target.isVisible())},reverse:function(){return new cc.ToggleVisibility}}),cc.ToggleVisibility.create=function(){return new cc.ToggleVisibility},cc.FlipX=cc.ActionInstant.extend({initWithFlipX:function(e){return this._flipX=e,!0},update:function(e){this._target.setFlipX(this._flipX)},reverse:function(){return cc.FlipX.create(!this._flipX)},_flipX:!1}),cc.FlipX.create=function(e){var t=new cc.FlipX;return t.initWithFlipX(e)?t:null},cc.FlipY=cc.ActionInstant.extend({initWithFlipY:function(e){return this._flipY=e,!0},update:function(e){this._target.setFlipY(this._flipY)},reverse:function(){return cc.FlipY.create(!this._flipY)},_flipY:!1}),cc.FlipY.create=function(e){var t=new cc.FlipY;return t.initWithFlipY(e)?t:null},cc.Place=cc.ActionInstant.extend({initWithPosition:function(e){return this._position=e,!0},update:function(e){this._target.setPosition(this._position)}}),cc.Place.create=function(e){var t=new cc.Place;return t.initWithPosition(e),t},cc.CallFunc=cc.ActionInstant.extend({initWithTarget:function(e,t,n){return this._data=n,this._callFunc=e,this._selectorTarget=t,!0},execute:function(){this._callFunc!=null&&this._callFunc.call(this._selectorTarget,this._target,this._data)},update:function(e){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(e){e!=this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=e)},copy:function(){var e=new cc.CallFunc;return e.initWithTarget(this._callFunc,this._selectorTarget,this._data),e},_selectorTarget:null,_callFunc:null}),cc.CallFunc.create=function(e,t,n){var r=new cc.CallFunc;return r&&r.initWithTarget(e,t,n)?(r._callFunc=e,r):null};cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[]}}),cc.ActionManager=cc.Class.extend({_targets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(e,t){for(var n=0;n<e.length;n++)if(t==e[n].target)return e[n];return null},ctor:function(){this._targets=[]},addAction:function(e,t,n){cc.Assert(e!=null,"no action"),cc.Assert(t!=null,"");var r=this._searchElementByTarget(this._targets,t);r||(r=new cc.HashElement,r.paused=n,r.target=t,this._targets.push(r)),this._actionAllocWithHashElement(r),r.actions.push(e),e.startWithTarget(t)},removeAllActions:function(){for(var e=0;e<this._targets.length;e++){var t=this._targets[e];t&&this.removeAllActionsFromTarget(t.target)}},removeAllActionsFromTarget:function(e){if(e==null)return;var t=this._searchElementByTarget(this._targets,e);t&&(t.currentAction in t.actions&&!t.currentActionSalvaged&&(t.currentActionSalvaged=!0),t.actions=[],this._currentTarget==t?this._currentTargetSalvaged=!0:this._deleteHashElement(t))},removeAction:function(e){if(e==null)return;var t=e.getOriginalTarget(),n=this._searchElementByTarget(this._targets,t);if(n){for(var r=0;r<n.actions.length;r++)if(n.actions[r]==e){n.actions.splice(r,1);break}}else cc.log("cocos2d: removeAction: Target not found")},removeActionByTag:function(e,t){cc.Assert(e!=cc.ACTION_TAG_INVALID,""),cc.Assert(t!=null,"");var n=this._searchElementByTarget(this._targets,t);if(n){var r=n.actions.length;for(var i=0;i<r;++i){var s=n.actions[i];if(s&&s.getTag()==e&&s.getOriginalTarget()==t){this._removeActionAtIndex(i,n);break}}}},getActionByTag:function(e,t){cc.Assert(e!=cc.ACTION_TAG_INVALID,"");var n=this._searchElementByTarget(this._targets,t);if(n&&n.actions!=null)for(var r=0;r<n.actions.length;++r){var i=n.actions[r];if(i&&i.getTag()==e)return i}return null},numberOfRunningActionsInTarget:function(e){var t=this._searchElementByTarget(this._targets,e);return t?t.actions?t.actions.length:0:0},pauseTarget:function(e){var t=this._searchElementByTarget(this._targets,e);t&&(t.paused=!0)},resumeTarget:function(e){var t=this._searchElementByTarget(this._targets,e);t&&(t.paused=!1)},pauseAllRunningActions:function(){var e=[];for(var t=0;t<this._targets.length;t++){var n=this._targets[t];n&&!n.paused&&(n.paused=!0,e.push(n.target))}return e},resumeTargets:function(e){if(!e)return;for(var t=0;t<e.length;t++)e[t]&&this.resumeTarget(e[t])},purgeSharedManager:function(){cc.Director.getInstance().getScheduler().unscheduleUpdateForTarget(this)},_removeActionAtIndex:function(e,t){var n=t.actions[e];n==t.currentAction&&!t.currentActionSalvaged&&(t.currentActionSalvaged=!0),cc.ArrayRemoveObjectAtIndex(t.actions,e),t.actionIndex>=e&&t.actionIndex--,t.actions.length==0&&(this._currentTarget==t?this._currentTargetSalvaged=!0:this._deleteHashElement(t))},_deleteHashElement:function(e){cc.ArrayRemoveObject(this._targets,e),e&&(e.actions=null,e.target=null)},_actionAllocWithHashElement:function(e){e.actions==null&&(e.actions=[])},update:function(e){for(var t=0;t<this._targets.length;t++){this._currentTarget=this._targets[t],this._currentTargetSalvaged=!1;if(!this._currentTarget.paused)for(this._currentTarget.actionIndex=0;this._currentTarget.actionIndex<this._currentTarget.actions.length;this._currentTarget.actionIndex++){this._currentTarget.currentAction=this._currentTarget.actions[this._currentTarget.actionIndex];if(!this._currentTarget.currentAction)continue;this._currentTarget.currentActionSalvaged=!1,this._currentTarget.currentAction.step(e);if(this._currentTarget.currentActionSalvaged)this._currentTarget.currentAction=null;else if(this._currentTarget.currentAction.isDone()){this._currentTarget.currentAction.stop();var n=this._currentTarget.currentAction;this._currentTarget.currentAction=null,this.removeAction(n)}this._currentTarget.currentAction=null}this._currentTargetSalvaged&&this._currentTarget.actions.length==0&&this._deleteHashElement(this._currentTarget)}}});cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,initWithDuration:function(e,t){return this._super(e)?(this._to=t,!0):!1},startWithTarget:function(e){this._super(e),this._from=e.getPercentage(),this._from==100&&(this._from=0)},update:function(e){this._target instanceof cc.ProgressTimer&&this._target.setPercentage(this._from+(this._to-this._from)*e)}}),cc.ProgressTo.create=function(e,t){var n=new cc.ProgressTo;return n.initWithDuration(e,t),n},cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,initWithDuration:function(e,t,n){return this._super(e)?(this._to=n,this._from=t,!0):!1},reverse:function(){return cc.ProgressFromTo.create(this._duration,this._to,this._from)},startWithTarget:function(e){this._super(e)},update:function(e){this._target instanceof cc.ProgressTimer&&this._target.setPercentage(this._from+(this._to-this._from)*e)}}),cc.ProgressFromTo.create=function(e,t,n){var r=new cc.ProgressFromTo;return r.initWithDuration(e,t,n),r};cc.ActionCamera=cc.ActionInterval.extend({_centerXOrig:0,_centerYOrig:0,_centerZOrig:0,_eyeXOrig:0,_eyeYOrig:0,_eyeZOrig:0,_upXOrig:0,_upYOrig:0,_upZOrig:0,startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=e.getCamera(),n=t.getCenter();this._centerXOrig=n.x,this._centerYOrig=n.y,this._centerZOrig=n.z;var r=t.getEye();this._eyeXOrig=r.x,this._eyeYOrig=r.y,this._eyeZOrig=r.z;var i=t.getUp();this._upXOrig=i.x,this._upYOrig=i.y,this._upZOrig=i.z},reverse:function(){return cc.ReverseTime.create(this)}}),cc.OrbitCamera=cc.ActionCamera.extend({_radius:0,_deltaRadius:0,_angleZ:0,_deltaAngleZ:0,_angleX:0,_deltaAngleX:0,_radZ:0,_radDeltaZ:0,_radX:0,_radDeltaX:0,initWithDuration:function(e,t,n,r,i,s,o){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._radius=t,this._deltaRadius=n,this._angleZ=r,this._deltaAngleZ=i,this._angleX=s,this._deltaAngleX=o,this._radDeltaZ=cc.DEGREES_TO_RADIANS(i),this._radDeltaX=cc.DEGREES_TO_RADIANS(o),!0):!1},sphericalRadius:function(){var e,t,n,r=this._target.getCamera(),i=r.getEye(),s=r.getCenter(),o=i.x-s.x,u=i.y-s.y,a=i.z-s.z,f=Math.sqrt(Math.pow(o,2)+Math.pow(u,2)+Math.pow(a,2)),l=Math.sqrt(Math.pow(o,2)+Math.pow(u,2));return l===0&&(l=cc.FLT_EPSILON),f===0&&(f=cc.FLT_EPSILON),t=Math.acos(a/f),o<0?n=Math.PI-Math.asin(u/l):n=Math.asin(u/l),e=f/cc.Camera.getZEye(),{newRadius:e,zenith:t,azimuth:n}},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=this.sphericalRadius();isNaN(this._radius)&&(this._radius=t.newRadius),isNaN(this._angleZ)&&(this._angleZ=cc.RADIANS_TO_DEGREES(t.zenith)),isNaN(this._angleX)&&(this._angleX=cc.RADIANS_TO_DEGREES(t.azimuth)),this._radZ=cc.DEGREES_TO_RADIANS(this._angleZ),this._radX=cc.DEGREES_TO_RADIANS(this._angleX)},update:function(e){var t=(this._radius+this._deltaRadius*e)*cc.Camera.getZEye(),n=this._radZ+this._radDeltaZ*e,r=this._radX+this._radDeltaX*e,i=Math.sin(n)*Math.cos(r)*t+this._centerXOrig,s=Math.sin(n)*Math.sin(r)*t+this._centerYOrig,o=Math.cos(n)*t+this._centerZOrig;this._target.getCamera().setEye(i,s,o)}}),cc.OrbitCamera.create=function(e,t,n,r,i,s,o){var u=new cc.OrbitCamera;return u.initWithDuration(e,t,n,r,i,s,o)?u:null};cc.ActionEase=cc.ActionInterval.extend({initWithAction:function(e){return cc.Assert(e!=null,""),this.initWithDuration(e.getDuration())?(this._other=e,!0):!1},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._other.startWithTarget(this._target)},stop:function(){this._other.stop(),this._super()},update:function(e){this._other.update(e)},reverse:function(){return cc.ActionEase.create(this._other.reverse())},_other:null}),cc.ActionEase.create=function(e){var t=new cc.ActionEase;return t&&t.initWithAction(e),t},cc.EaseRateAction=cc.ActionEase.extend({setRate:function(e){this._rate=e},getRate:function(){return this._rate},initWithAction:function(e,t){return this._super(e)?(this._rate=t,!0):!1},reverse:function(){return cc.EaseRateAction.create(this._other.reverse(),1/this._rate)},_rate:null}),cc.EaseRateAction.create=function(e,t){var n=new cc.EaseRateAction;return n&&n.initWithAction(e,t),n},cc.EaseIn=cc.EaseRateAction.extend({update:function(e){this._other.update(Math.pow(e,this._rate))},reverse:function(){return cc.EaseIn.create(this._other.reverse(),1/this._rate)}}),cc.EaseIn.create=function(e,t){var n=new cc.EaseIn;return n&&n.initWithAction(e,t),n},cc.EaseOut=cc.EaseRateAction.extend({update:function(e){this._other.update(Math.pow(e,1/this._rate))},reverse:function(){return cc.EaseOut.create(this._other.reverse(),1/this._rate)}}),cc.EaseOut.create=function(e,t){var n=new cc.EaseOut;return n&&n.initWithAction(e,t),n},cc.EaseInOut=cc.EaseRateAction.extend({update:function(e){e*=2,e<1?this._other.update(.5*Math.pow(e,this._rate)):this._other.update(1-.5*Math.pow(2-e,this._rate))},reverse:function(){return cc.EaseInOut.create(this._other.reverse(),this._rate)}}),cc.EaseInOut.create=function(e,t){var n=new cc.EaseInOut;return n&&n.initWithAction(e,t),n},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(e){this._other.update(e===0?0:Math.pow(2,10*(e-1)))},reverse:function(){return cc.EaseExponentialOut.create(this._other.reverse())}}),cc.EaseExponentialIn.create=function(e){var t=new cc.EaseExponentialIn;return t&&t.initWithAction(e),t},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(e){this._other.update(e==1?1:-Math.pow(2,-10*e)+1)},reverse:function(){return cc.EaseExponentialIn.create(this._other.reverse())}}),cc.EaseExponentialOut.create=function(e){var t=new cc.EaseExponentialOut;return t&&t.initWithAction(e),t},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(e){e!=1&&e!==0&&(e*=2,e<1?e=.5*Math.pow(2,10*(e-1)):e=.5*(-Math.pow(2,-10*(e-1))+2)),this._other.update(e)},reverse:function(){return cc.EaseExponentialInOut.create(this._other.reverse())}}),cc.EaseExponentialInOut.create=function(e){var t=new cc.EaseExponentialInOut;return t&&t.initWithAction(e),t},cc.EaseSineIn=cc.ActionEase.extend({update:function(e){e=e===0||e==1?e:-1*Math.cos(e*Math.PI/2)+1,this._other.update(e)},reverse:function(){return cc.EaseSineOut.create(this._other.reverse())}}),cc.EaseSineIn.create=function(e){var t=new cc.EaseSineIn;return t&&t.initWithAction(e),t},cc.EaseSineOut=cc.ActionEase.extend({update:function(e){e=e===0||e==1?e:Math.sin(e*Math.PI/2),this._other.update(e)},reverse:function(){return cc.EaseSineIn.create(this._other.reverse())}}),cc.EaseSineOut.create=function(e){var t=new cc.EaseSineOut;return t&&t.initWithAction(e),t},cc.EaseSineInOut=cc.ActionEase.extend({update:function(e){e=e===0||e==1?e:-0.5*(Math.cos(Math.PI*e)-1),this._other.update(e)},reverse:function(){return cc.EaseSineInOut.create(this._other.reverse())}}),cc.EaseSineInOut.create=function(e){var t=new cc.EaseSineInOut;return t&&t.initWithAction(e),t},cc.EaseElastic=cc.ActionEase.extend({getPeriod:function(){return this._period},setPeriod:function(e){this._period=e},initWithAction:function(e,t){return this._super(e),this._period=t==null?.3:t,!0},reverse:function(){return cc.Assert(0,"Override me"),null},_period:null}),cc.EaseElastic.create=function(e,t){var n=new cc.EaseElastic;return n&&n.initWithAction(e,t)?n:null},cc.EaseElasticIn=cc.EaseElastic.extend({update:function(e){var t=0;if(e===0||e===1)t=e;else{var n=this._period/4;e-=1,t=-Math.pow(2,10*e)*Math.sin((e-n)*Math.PI*2/this._period)}this._other.update(t)},reverse:function(){return cc.EaseElasticOut.create(this._other.reverse(),this._period)}}),cc.EaseElasticIn.create=function(e,t){var n=new cc.EaseElasticIn;return n&&n.initWithAction(e,t)?n:null},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(e){var t=0;if(e===0||e==1)t=e;else{var n=this._period/4;t=Math.pow(2,-10*e)*Math.sin((e-n)*Math.PI*2/this._period)+1}this._other.update(t)},reverse:function(){return cc.EaseElasticIn.create(this._other.reverse(),this._period)}}),cc.EaseElasticOut.create=function(e,t){var n=new cc.EaseElasticOut;return n&&(t==null?n.initWithAction(e):n.initWithAction(e,t)),n},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(e){var t=0;if(e===0||e==1)t=e;else{e*=2,this._period||(this._period=.3*1.5);var n=this._period/4;e-=1,e<0?t=-0.5*Math.pow(2,10*e)*Math.sin((e-n)*Math.PI*2/this._period):t=Math.pow(2,-10*e)*Math.sin((e-n)*Math.PI*2/this._period)*.5+1}this._other.update(t)},reverse:function(){return cc.EaseElasticInOut.create(this._other.reverse(),this._period)}}),cc.EaseElasticInOut.create=function(e,t){var n=new cc.EaseElasticInOut;return n&&(t==null?n.initWithAction(e):n.initWithAction(e,t)),n},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?(e-=1.5/2.75,7.5625*e*e+.75):e<2.5/2.75?(e-=2.25/2.75,7.5625*e*e+.9375):(e-=2.625/2.75,7.5625*e*e+.984375)},reverse:function(){return cc.EaseBounce.create(this._other.reverse())}}),cc.EaseBounce.create=function(e){var t=new cc.EaseBounce;return t&&t.initWithAction(e),t},cc.EaseBounceIn=cc.EaseBounce.extend({update:function(e){var t=1-this.bounceTime(1-e);this._other.update(t)},reverse:function(){return cc.EaseBounceOut.create(this._other.reverse())}}),cc.EaseBounceIn.create=function(e){var t=new cc.EaseBounceIn;return t&&t.initWithAction(e),t},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(e){var t=this.bounceTime(e);this._other.update(t)},reverse:function(){return cc.EaseBounceIn.create(this._other.reverse())}}),cc.EaseBounceOut.create=function(e){var t=new cc.EaseBounceOut;return t&&t.initWithAction(e),t},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(e){var t=0;e<.5?(e*=2,t=(1-this.bounceTime(1-e))*.5):t=this.bounceTime(e*2-1)*.5+.5,this._other.update(t)},reverse:function(){return cc.EaseBounceInOut.create(this._other.reverse())}}),cc.EaseBounceInOut.create=function(e){var t=new cc.EaseBounceInOut;return t&&t.initWithAction(e),t},cc.EaseBackIn=cc.ActionEase.extend({update:function(e){var t=1.70158;e=e===0||e==1?e:e*e*((t+1)*e-t),this._other.update(e)},reverse:function(){return cc.EaseBackOut.create(this._other.reverse())}}),cc.EaseBackIn.create=function(e){var t=new cc.EaseBackIn;return t&&t.initWithAction(e),t},cc.EaseBackOut=cc.ActionEase.extend({update:function(e){var t=1.70158;e-=1,this._other.update(e*e*((t+1)*e+t)+1)},reverse:function(){return cc.EaseBackIn.create(this._other.reverse())}}),cc.EaseBackOut.create=function(e){var t=new cc.EaseBackOut;return t&&t.initWithAction(e),t},cc.EaseBackInOut=cc.ActionEase.extend({update:function(e){var t=2.5949095;e*=2,e<1?this._other.update(e*e*((t+1)*e-t)/2):(e-=2,this._other.update(e*e*((t+1)*e+t)/2+1))},reverse:function(){return cc.EaseBackInOut.create(this._other.reverse())}}),cc.EaseBackInOut.create=function(e){var t=new cc.EaseBackInOut;return t&&t.initWithAction(e),t};cc.GridAction=cc.ActionInterval.extend({_gridSize:null,startWithTarget:function(e){this._super(e);var t=this.getGrid(),n=this._target,r=n.getGrid();r&&r.getReuseGrid()>0?r.isActive()&&r.getGridSize().width==this._gridSize.width&&r.getGridSize().height==this._gridSize.height?r.reuse():cc.Assert(0,""):(r&&r.isActive()&&r.setActive(!1),n.setGrid(t),n.getGrid().setActive(!0))},reverse:function(){return cc.ReverseTime.create(this)},initWithDuration:function(e,t){return this._super(e)?(this._gridSize=t,!0):!1},getGrid:function(){return cc.Assert(0,""),null}}),cc.GridAction.create=function(e,t){var n=new cc.GridAction;return n.initWithDuration(e,t),n},cc.Grid3DAction=cc.GridAction.extend({getGrid:function(){return cc.Grid3D.create(this._gridSize)},vertex:function(e){return this._target.getGrid().vertex(e)},originalVertex:function(e){return this._target.getGrid().originalVertex(e)},setVertex:function(e,t){this._target.getGrid().setVertex(e,t)}}),cc.Grid3DAction.create=function(e,t){return new cc.Grid3DAction},cc.TiledGrid3DAction=cc.GridAction.extend({tile:function(e){return this._target.getGrid().tile(e)},originalTile:function(e){return this._target.getGrid().originalTile(e)},setTile:function(e,t){this._target.getGrid().setTile(e,t)},getGrid:function(){return cc.TiledGrid3D.create(this._gridSize)}}),cc.TiledGrid3DAction.create=function(e,t){var n=new cc.TiledGrid3DAction;return n.initWithDuration(e,t),n},cc.StopGrid=cc.ActionInstant.extend({startWithTarget:function(e){this._super(e);var t=this._target.getGrid();t&&t.isActive()&&t.setActive(!1)}}),cc.StopGrid.create=function(){return new cc.StopGrid},cc.ReuseGrid=cc.ActionInstant.extend({_times:null,initWithTimes:function(e){return this._times=e,!0},startWithTarget:function(e){cc.ActionInstant.prototype.startWithTarget.call(this,e),this._target.getGrid()&&this._target.getGrid().isActive()&&this._target.getGrid().setReuseGrid(this._target.getGrid().getReuseGrid()+this._times)}}),cc.ReuseGrid.create=function(e){return new cc.ReuseGrid};cc.RAND_MAX=16777215,cc.rand=function(){return Math.random()*cc.RAND_MAX},cc.Waves3D=cc.Grid3DAction.extend({_waves:null,_amplitude:null,_amplitudeRate:null,getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){for(var t=0;t<this._gridSize.width+1;++t)for(var n=0;n<this._gridSize.height+1;++n){var r=this.originalVertex(cc.g(t,n));r.z+=Math.sin(Math.PI*e*this._waves*2+(r.y+r.x)*.01)*this._amplitude*this._amplitudeRate,this.setVertex(cc.p(t,n),r)}}}),cc.Waves3D.create=function(e,t,n,r){var i=new cc.Waves3D;return i.initWithDuration(e,t,n,r),i},cc.FlipX3D=cc.Grid3DAction.extend({initWithDuration:function(e){return this._super(e,cc.size(1,1))},initWithSize:function(e,t){return e.width!=1||e.height!=1?(cc.Assert(0,""),!1):cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)},update:function(e){var t=Math.PI*e,n=Math.sin(t);t/=2;var r=Math.cos(t),i=new cc.Vertex3F,s=this.originalVertex(cc.p(1,1)),o=this.originalVertex(cc.p(0,0)),u=s.x,a=o.x,f,l,c,h,p;u>a?(l=cc.p(0,0),c=cc.p(0,1),h=cc.p(1,0),p=cc.p(1,1),f=u):(h=cc.p(0,0),p=cc.p(0,1),l=cc.p(1,0),c=cc.p(1,1),f=a),i.x=f-f*r,i.z=Math.abs(parseFloat(f*n/4));var d=this.originalVertex(l);d.x=i.x,d.z+=i.z,this.setVertex(l,d),d=this.originalVertex(c),d.x=i.x,d.z+=i.z,this.setVertex(c,d),d=this.originalVertex(h),d.x-=i.x,d.z-=i.z,this.setVertex(h,d),d=this.originalVertex(p),d.x-=i.x,d.z-=i.z,this.setVertex(p,d)}}),cc.FlipX3D.create=function(e){var t=new cc.FlipX3D;return t.initWithDuration(e),t},cc.FlipY3D=cc.FlipX3D.extend({update:function(e){var t=Math.PI*e,n=Math.sin(t);t/=2;var r=Math.cos(t),i=new cc.Vertex3F,s=this.originalVertex(cc.p(1,1)),o=this.originalVertex(cc.p(0,0)),u=s.y,a=o.y,f,l,c,h,p;u>a?(l=cc.p(0,0),c=cc.p(0,1),h=cc.p(1,0),p=cc.p(1,1),f=u):(c=cc.p(0,0),l=cc.p(0,1),p=cc.p(1,0),h=cc.p(1,1),f=a),i.y=f-f*r,i.z=Math.abs(parseFloat(f*n)/4);var d=this.originalVertex(l);d.y=i.y,d.z+=i.z,this.setVertex(l,d),d=this.originalVertex(c),d.y-=i.y,d.z-=i.z,this.setVertex(c,d),d=this.originalVertex(h),d.y=i.y,d.z+=i.z,this.setVertex(h,d),d=this.originalVertex(p),d.y-=i.y,d.z-=i.z,this.setVertex(p,d)}}),cc.FlipY3D.create=function(e){var t=new cc.FlipY3D;return t.initWithDuration(e),t},cc.Lens3D=cc.Grid3DAction.extend({_position:null,_radius:0,_lensEffect:0,_dirty:!1,getLensEffect:function(){return this._lensEffect},setLensEffect:function(e){this._lensEffect=e},getPosition:function(){return this._position},setPosition:function(e){cc.Point.CCPointEqualToPoint(e,this._position)||(this._position=e,this._dirty=!0)},initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._position=cc.p(-1,-1),this.setPosition(n),this._radius=r,this._lensEffect=.7,this._dirty=!0,!0):!1},update:function(e){if(this._dirty){for(var t=0;t<this._gridSize.width+1;++t)for(var n=0;n<this._gridSize.height+1;++n){var r=this.originalVertex(cc.p(t,n)),i=cc.pSub(this._position,cc.p(r.x,r.y)),s=cc.pLength(i);if(s<this._radius){s=this._radius-s;var o=s/this._radius;o==0&&(o=.001);var u=Math.log(o)*this._lensEffect,a=Math.exp(u)*this._radius;if(cc.pLength(i)>0){i=cc.pNormalize(i);var f=cc.pMult(i,a);r.z+=cc.pLength(f)*this._lensEffect}}this.setVertex(cc.p(t,n),r)}this._dirty=!1}}}),cc.Lens3D.create=function(e,t,n,r){var i=new cc.Lens3D;return i.initWithDuration(e,t,n,r),i},cc.Ripple3D=cc.Grid3DAction.extend({_position:null,_radius:null,_waves:null,_amplitude:null,_amplitudeRate:null,getPosition:function(){return this._position},setPosition:function(e){this._position=e},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r,i,s){return this._super(e,t)?(this.setPosition(n),this._radius=r,this._waves=i,this._amplitude=s,this._amplitudeRate=1,!0):!1},update:function(e){for(var t=0;t<this._gridSize.width+1;++t)for(var n=0;n<this._gridSize.height+1;++n){var r=this.originalVertex(cc.p(t,n)),i=cc.pSub(this._position,cc.p(r.x,r.y)),s=cc.pLength(i);if(s<this._radius){s=this._radius-s;var o=Math.pow(s/this._radius,2);r.z+=Math.sin(e*Math.PI*this._waves*2+s*.1)*this._amplitude*this._amplitudeRate*o}this.setVertex(cc.p(t,n),r)}}}),cc.Ripple3D.create=function(e,t,n,r,i,s){var o=new cc.Ripple3D;return o.initWithDuration(e,t,n,r,i,s),o},cc.Shaky3D=cc.Grid3DAction.extend({_randRange:null,_shakeZ:null,initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._randRange=n,this._shakeZ=r,!0):!1},update:function(e){for(var t=0;t<this._gridSize.width+1;++t)for(var n=0;n<this._gridSize.height+1;++n){var r=this.originalVertex(cc.p(t,n));r.x+=cc.rand()%(this._randRange*2)-this._randRange,r.y+=cc.rand()%(this._randRange*2)-this._randRange,this._shakeZ&&(r.z+=cc.rand()%(this._randRange*2)-this._randRange),this.setVertex(cc.p(t,n),r)}}}),cc.Shaky3D.create=function(e,t,n,r){var i=new cc.Shaky3D;return i.initWithDuration(e,t,n,r),i},cc.Liquid=cc.Grid3DAction.extend({_waves:null,_amplitude:null,_amplitudeRate:null,getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){for(var t=1;t<this._gridSize.width;++t)for(var n=1;n<this._gridSize.height;++n){var r=this.originalVertex(cc.p(t,n));r.x=r.x+Math.sin(e*Math.PI*this._waves*2+r.x*.01)*this._amplitude*this._amplitudeRate,r.y=r.y+Math.sin(e*Math.PI*this._waves*2+r.y*.01)*this._amplitude*this._amplitudeRate,this.setVertex(cc.p(t,n),r)}}}),cc.Liquid.create=function(e,t,n,r){var i=new cc.Liquid;return i.initWithDuration(e,t,n,r),i},cc.Waves=cc.Grid3DAction.extend({_waves:null,_amplitude:null,_amplitudeRate:null,_vertical:null,_horizontal:null,getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r,i,s){return this._super(e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,this._horizontal=i,this._vertical=s,!0):!1},update:function(e){for(var t=0;t<this._gridSize.width+1;++t)for(var n=0;n<this._gridSize.height+1;++n){var r=this.originalVertex(cc.p(t,n));this._vertical&&(r.x=r.x+Math.sin(e*Math.PI*this._waves*2+r.y*.01)*this._amplitude*this._amplitudeRate),this._horizontal&&(r.y=r.y+Math.sin(e*Math.PI*this._waves*2+r.x*.01)*this._amplitude*this._amplitudeRate),this.setVertex(cc.p(t,n),r)}}}),cc.Waves.create=function(e,t,n,r,i,s){var o=new cc.Waves;return o.initWithDuration(e,t,n,r,i,s),o},cc.Twirl=cc.Grid3DAction.extend({_position:null,_twirls:null,_amplitude:null,_amplitudeRate:null,getPosition:function(){return this._position},setPosition:function(e){this._position=e},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r,i){return this._super(e,t)?(this.setPosition(n),this._twirls=r,this._amplitude=i,this._amplitudeRate=1,!0):!1},update:function(e){var t=this._position;for(var n=0;n<this._gridSize.width+1;++n)for(var r=0;r<this._gridSize.height+1;++r){var i=this.originalVertex(cc.p(n,r)),s=cc.p(n-this._gridSize.width/2,r-this._gridSize.height/2),o=.1*this._amplitude*this._amplitudeRate,u=cc.pLength(s)*Math.cos(Math.PI/2+e*Math.PI*this._twirls*2)*o,a=cc.p(Math.sin(u)*(i.y-t.y)+Math.cos(u)*(i.x-t.x),Math.cos(u)*(i.y-t.y)-Math.sin(u)*(i.x-t.x));i.x=t.x+a.x,i.y=t.y+a.y,this.setVertex(cc.p(n,r),i)}}}),cc.Twirl.create=function(e,t,n,r,i){var s=new cc.Twirl;return s.initWithDuration(e,t,n,r,i),s};cc.ShakyTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_shakeZ:!1,initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._randRange=n,this._shakeZ=r,!0):!1},update:function(e){for(var t=0;t<this._gridSize.width;++t)for(var n=0;n<this._gridSize.height;++n){var r=this.originalTile(cc.p(t,n));r.bl.x+=cc.rand()%(this._randRange*2)-this._randRange,r.br.x+=cc.rand()%(this._randRange*2)-this._randRange,r.tl.x+=cc.rand()%(this._randRange*2)-this._randRange,r.tr.x+=cc.rand()%(this._randRange*2)-this._randRange,r.bl.y+=cc.rand()%(this._randRange*2)-this._randRange,r.br.y+=cc.rand()%(this._randRange*2)-this._randRange,r.tl.y+=cc.rand()%(this._randRange*2)-this._randRange,r.tr.y+=cc.rand()%(this._randRange*2)-this._randRange,this._shakeZ&&(r.bl.z+=cc.rand()%(this._randRange*2)-this._randRange,r.br.z+=cc.rand()%(this._randRange*2)-this._randRange,r.tl.z+=cc.rand()%(this._randRange*2)-this._randRange,r.tr.z+=cc.rand()%(this._randRange*2)-this._randRange),this.setTile(cc.p(t,n),r)}}}),cc.ShakyTiles3D.create=function(e,t,n,r){var i=new cc.ShakyTiles3D;return i.initWithDuration(e,t,n,r),i},cc.ShatteredTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_once:!1,_shatterZ:!1,initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._once=!1,this._randRange=n,this._shatterZ=r,!0):!1},update:function(e){if(this._once===!1){for(var t=0;t<this._gridSize.width;++t)for(var n=0;n<this._gridSize.height;++n){var r=this.originalTile(cc.p(t,n));r.bl.x+=cc.rand()%(this._randRange*2)-this._randRange,r.br.x+=cc.rand()%(this._randRange*2)-this._randRange,r.tl.x+=cc.rand()%(this._randRange*2)-this._randRange,r.tr.x+=cc.rand()%(this._randRange*2)-this._randRange,r.bl.y+=cc.rand()%(this._randRange*2)-this._randRange,r.br.y+=cc.rand()%(this._randRange*2)-this._randRange,r.tl.y+=cc.rand()%(this._randRange*2)-this._randRange,r.tr.y+=cc.rand()%(this._randRange*2)-this._randRange,this._shatterZ&&(r.bl.z+=cc.rand()%(this._randRange*2)-this._randRange,r.br.z+=cc.rand()%(this._randRange*2)-this._randRange,r.tl.z+=cc.rand()%(this._randRange*2)-this._randRange,r.tr.z+=cc.rand()%(this._randRange*2)-this._randRange),this.setTile(cc.p(t,n),r)}this._once=!0}}}),cc.ShatteredTiles3D.create=function(e,t,n,r){var i=new cc.ShatteredTiles3D;return i.initWithDuration(e,t,n,r),i},cc.Tile=function(e,t,n){this.position=e||cc.POINT_ZERO,this.startPosition=t||cc.POINT_ZERO,this.delta=n||cc.POINT_ZERO},cc.ShuffleTiles=cc.TiledGrid3DAction.extend({_seed:0,_tilesCount:0,_tilesOrder:null,_tiles:null,ctor:function(){this._tilesOrder=[],this._tiles=[]},initWithDuration:function(e,t,n){return this._super(e,t)?(this._seed=n,this._tilesOrder=null,this._tiles=null,!0):!1},shuffle:function(e,t){for(var n=t-1;n>=0;n--){var r=0|cc.rand()%(n+1),i=e[n];e[n]=e[r],e[r]=i}},getDelta:function(e){var t=e.width*this._gridSize.height+e.height;return cc.SizeMake(this._tilesOrder[t]/this._gridSize.height-e.width,this._tilesOrder[t]%this._gridSize.height-e.height)},placeTile:function(e,t){var n=this.originalTile(e),r=this._target.getGrid().getStep();n.bl.x+=t.position.x*r.x,n.bl.y+=t.position.y*r.y,n.br.x+=t.position.x*r.x,n.br.y+=t.position.y*r.y,n.tl.x+=t.position.x*r.x,n.tl.y+=t.position.y*r.y,n.tr.x+=t.position.x*r.x,n.tr.y+=t.position.y*r.y,this.setTile(e,n)},startWithTarget:function(e){this._super(e),this._tilesCount=this._gridSize.width*this._gridSize.height,this._tilesOrder=[];for(var t=0;t<this._tilesCount;++t)this._tilesOrder[t]=t;this.shuffle(this._tilesOrder,this._tilesCount),this._tiles=[];var n=0;for(var r=0;r<this._gridSize.width;++r)for(var i=0;i<this._gridSize.height;++i)this._tiles[n]=new cc.Tile,this._tiles[n].position=cc.p(r,i),this._tiles[n].startPosition=cc.p(r,i),this._tiles[n].delta=this.getDelta(cc.SizeMake(r,i)),++n},update:function(e){var t=0;for(var n=0;n<this._gridSize.width;++n)for(var r=0;r<this._gridSize.height;++r){var i=this._tiles[t];i.position=cc.pMult(cc.p(i.delta.width,i.delta.height),e),this.placeTile(cc.p(n,r),i),++t}}}),cc.ShuffleTiles.create=function(e,t,n){var r=new cc.ShuffleTiles;return r.initWithDuration(e,t,n),r},cc.FadeOutTRTiles=cc.TiledGrid3DAction.extend({testFunc:function(e,t){var n=cc.pMult(cc.p(this._gridSize.width,this._gridSize.height),t);return n.x+n.y==0?1:Math.pow((e.width+e.height)/(n.x+n.y),6)},turnOnTile:function(e){this.setTile(e,this.originalTile(e))},turnOffTile:function(e){this.setTile(e,new cc.Quad3)},transformTile:function(e,t){var n=this.originalTile(e),r=this._target.getGrid().getStep();n.bl.x+=r.x/2*(1-t),n.bl.y+=r.y/2*(1-t),n.br.x-=r.x/2*(1-t),n.br.y+=r.y/2*(1-t),n.tl.x+=r.x/2*(1-t),n.tl.y-=r.y/2*(1-t),n.tr.x-=r.x/2*(1-t),n.tr.y-=r.y/2*(1-t),this.setTile(e,n)},update:function(e){for(var t=0;t<this._gridSize.width;++t)for(var n=0;n<this._gridSize.height;++n){var r=this.testFunc(cc.SizeMake(t,n),e);r==0?this.turnOffTile(cc.p(t,n)):r<1?this.transformTile(cc.p(t,n),r):this.turnOnTile(cc.p(t,n))}}}),cc.FadeOutTRTiles.create=function(e,t){var n=new cc.FadeOutTRTiles;return n.initWithDuration(e,t),n},cc.FadeOutBLTiles=cc.FadeOutTRTiles.extend({testFunc:function(e,t){var n=cc.pMult(cc.p(this._gridSize.width,this._gridSize.height),1-t);return e.width+e.height==0?1:Math.pow((n.x+n.y)/(e.width+e.height),6)}}),cc.FadeOutBLTiles.create=function(e,t){var n=new cc.FadeOutBLTiles;return n.initWithDuration(e,t),n},cc.FadeOutUpTiles=cc.FadeOutTRTiles.extend({testFunc:function(e,t){var n=cc.pMult(cc.p(this._gridSize.width,this._gridSize.height),t);return n.y==0?1:Math.pow(e.height/n.y,6)},transformTile:function(e,t){var n=this.originalTile(e),r=this._target.getGrid().getStep();n.bl.y+=r.y/2*(1-t),n.br.y+=r.y/2*(1-t),n.tl.y-=r.y/2*(1-t),n.tr.y-=r.y/2*(1-t),this.setTile(e,n)}}),cc.FadeOutUpTiles.create=function(e,t){var n=new cc.FadeOutUpTiles;return n.initWithDuration(e,t),n},cc.FadeOutDownTiles=cc.FadeOutUpTiles.extend({testFunc:function(e,t){var n=cc.pMult(cc.p(this._gridSize.width,this._gridSize.height),1-t);return e.height==0?1:Math.pow(n.y/e.height,6)}}),cc.FadeOutDownTiles.create=function(e,t){var n=new cc.FadeOutDownTiles;return n.initWithDuration(e,t),n},cc.TurnOffTiles=cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:null,ctor:function(){this._tilesOrder=[]},initWithDuration:function(e,t,n){return this._super(e,t)?(this._seed=n,this._tilesOrder=null,!0):!1},shuffle:function(e,t){for(var n=t-1;n>=0;n--){var r=0|cc.rand()%(n+1),i=e[n];e[n]=e[r],e[r]=i}},turnOnTile:function(e){this.setTile(e,this.originalTile(e))},turnOffTile:function(e){this.setTile(e,new cc.Quad3)},startWithTarget:function(e){this._super(e),this._tilesCount=this._gridSize.width*this._gridSize.height,this._tilesOrder=[];for(var t=0;t<this._tilesCount;++t)this._tilesOrder[t]=t;this.shuffle(this._tilesOrder,this._tilesCount)},update:function(e){var t=0|e*this._tilesCount;for(var n=0;n<this._tilesCount;n++){var r=this._tilesOrder[n],i=cc.p(0|r/this._gridSize.height,r%(0|this._gridSize.height));n<t?this.turnOffTile(i):this.turnOnTile(i)}}}),cc.TurnOffTiles.create=function(e,t,n){n=n||0;var r=new cc.TurnOffTiles;return r.initWithDuration(e,t,n),r},cc.WavesTiles3D=cc.TiledGrid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){for(var t=0;t<this._gridSize.width;t++)for(var n=0;n<this._gridSize.height;n++){var r=this.originalTile(cc.p(t,n));r.bl.z=Math.sin(e*Math.PI*this._waves*2+(r.bl.y+r.bl.x)*.01)*this._amplitude*this._amplitudeRate,r.br.z=r.bl.z,r.tl.z=r.bl.z,r.tr.z=r.bl.z,this.setTile(cc.p(t,n),r)}}}),cc.WavesTiles3D.create=function(e,t,n,r){var i=new cc.WavesTiles3D;return i.initWithDuration(e,t,n,r),i},cc.JumpTiles3D=cc.TiledGrid3DAction.extend({_jumps:0,_amplitude:0,_amplitudeRate:0,getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return this._super(e,t)?(this._jumps=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){var t=Math.sin(Math.PI*e*this._jumps*2)*this._amplitude*this._amplitudeRate,n=Math.sin(Math.PI*(e*this._jumps*2+1))*this._amplitude*this._amplitudeRate;for(var r=0;r<this._gridSize.width;r++)for(var i=0;i<this._gridSize.height;i++){var s=this.originalTile(cc.p(r,i));(r+i)%2==0?(s.bl.z+=t,s.br.z+=t,s.tl.z+=t,s.tr.z+=t):(s.bl.z+=n,s.br.z+=n,s.tl.z+=n,s.tr.z+=n),this.setTile(cc.p(r,i),s)}}}),cc.JumpTiles3D.create=function(e,t,n,r){var i=new cc.JumpTiles3D;return i.initWithDuration(e,t,n,r),i},cc.SplitRows=cc.TiledGrid3DAction.extend({_rows:0,_winSize:null,initWithDuration:function(e,t){return this._rows=t,this._super(e,cc.SizeMake(1,this._rows))},update:function(e){for(var t=0;t<this._gridSize.height;++t){var n=this.originalTile(cc.p(0,t)),r=1;t%2==0&&(r=-1),n.bl.x+=r*this._winSize.width*e,n.br.x+=r*this._winSize.width*e,n.tl.x+=r*this._winSize.width*e,n.tr.x+=r*this._winSize.width*e,this.setTile(cc.p(0,t),n)}},startWithTarget:function(e){this._super(e),this._winSize=cc.Director.getInstance().getWinSizeInPixels()}}),cc.SplitRows.create=function(e,t){var n=new cc.SplitRows;return n.initWithDuration(e,t),n},cc.SplitCols=cc.TiledGrid3DAction.extend({_cols:0,_winSize:null,initWithDuration:function(e,t){return this._cols=t,this._super(e,cc.SizeMake(this._cols,1))},update:function(e){for(var t=0;t<this._gridSize.width;++t){var n=this.originalTile(cc.p(t,0)),r=1;t%2==0&&(r=-1),n.bl.y+=r*this._winSize.height*e,n.br.y+=r*this._winSize.height*e,n.tl.y+=r*this._winSize.height*e,n.tr.y+=r*this._winSize.height*e,this.setTile(cc.p(t,0),n)}},startWithTarget:function(e){this._super(e),this._winSize=cc.Director.getInstance().getWinSizeInPixels()}}),cc.SplitCols.create=function(e,t){var n=new cc.SplitCols;return n.initWithDuration(e,t),n};cc.CardinalSplineAt=function(e,t,n,r,i,s){var o=s*s,u=o*s,a=(1-i)/2,f=a*(-u+2*o-s),l=a*(-u+o)+(2*u-3*o+1),c=a*(u-2*o+s)+(-2*u+3*o),h=a*(u-o),p=e.x*f+t.x*l+n.x*c+r.x*h,d=e.y*f+t.y*l+n.y*c+r.y*h;return cc.p(p,d)},cc.reverseControlPoints=function(e){var t=[];for(var n=e.length-1;n>=0;n--)t.push(cc.p(e[n].x,e[n].y));return t},cc.getControlPointAt=function(e,t){var n=Math.min(e.length-1,Math.max(t,0));return e[n]},cc.reverseControlPointsInline=function(e){var t=e.length,n=0|t/2;for(var r=0;r<n;++r){var i=e[r];e[r]=e[t-r-1],e[t-r-1]=i}},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,ctor:function(){this._points=[]},initWithDuration:function(e,t,n){return cc.Assert(t.length>0,"Invalid configuration. It must at least have one control point"),this._super(e)?(this.setPoints(t),this._tension=n,!0):!1},startWithTarget:function(e){this._super(e),this._deltaT=1/(this._points.length-1),this._previousPosition=this._target.getPosition(),this._accumulatedDiff=cc.p(0,0)},update:function(e){var t,n;e==1?(t=this._points.length-1,n=1):(t=0|e/this._deltaT,n=(e-this._deltaT*t)/this._deltaT);var r=cc.CardinalSplineAt(cc.getControlPointAt(this._points,t-1),cc.getControlPointAt(this._points,t-0),cc.getControlPointAt(this._points,t+1),cc.getControlPointAt(this._points,t+2),this._tension,n),i=this._target,s=cc.pSub(i.getPosition(),this._previousPosition);if(s.x!=0||s.y!=0)this._accumulatedDiff=cc.pAdd(this._accumulatedDiff,s),r=cc.pAdd(r,this._accumulatedDiff);this.updatePosition(r)},reverse:function(){var e=cc.reverseControlPoints(this._points);return cc.CardinalSplineTo.create(this._duration,e,this._tension)},updatePosition:function(e){this._target.setPosition(e),this._previousPosition=e},getPoints:function(){return this._points},setPoints:function(e){this._points=e}}),cc.CardinalSplineTo.create=function(e,t,n){var r=new cc.CardinalSplineTo;return r.initWithDuration(e,t,n)?r:null},cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(){this._startPosition=cc.p(0,0)},startWithTarget:function(e){this._super(e),this._startPosition=e.getPosition()},reverse:function(){var e=this._points.slice(),t,n=e[0];for(var r=1;r<e.length;++r){t=e[r];var i=cc.pSub(t,n);e[r]=i,n=t}var s=cc.reverseControlPoints(e);n=s[s.length-1],s.pop(),n=cc.pNeg(n),s.unshift(n);for(r=1;r<s.length;++r){t=s[r],t=cc.pNeg(t);var o=cc.pAdd(t,n);s[r]=o,n=o}return cc.CardinalSplineBy.create(this._duration,s,this._tension)},updatePosition:function(e){var t=cc.pAdd(e,this._startPosition);this._target.setPosition(t),this._previousPosition=t}}),cc.CardinalSplineBy.create=function(e,t,n){var r=new cc.CardinalSplineBy;return r.initWithDuration(e,t,n)?r:null},cc.CatmullRomTo=cc.CardinalSplineTo.extend({initWithDuration:function(e,t){return this._super(e,t,.5)}}),cc.CatmullRomTo.create=function(e,t){var n=new cc.CatmullRomTo;return n.initWithDuration(e,t)?n:null},cc.CatmullRomBy=cc.CardinalSplineBy.extend({initWithDuration:function(e,t){return this._super(e,t,.5)}}),cc.CatmullRomBy.create=function(e,t){var n=new cc.CatmullRomBy;return n.initWithDuration(e,t)?n:null};cc.PageTurn3D=cc.Grid3DAction.extend({update:function(e){var t=Math.max(0,e-.25),n=t*t*500,r=-100-n,i=-Math.PI/2*Math.sqrt(e),s=+Math.PI/2+i,o=Math.sin(s),u=Math.cos(s);for(var a=0;a<=this._gridSize.width;++a)for(var f=0;f<=this._gridSize.height;++f){var l=this.originalVertex(cc.p(a,f)),c=Math.sqrt(l.x*l.x+(l.y-r)*(l.y-r)),h=c*o,p=Math.asin(l.x/c),d=p/o,v=Math.cos(d);d<=Math.PI?l.x=h*Math.sin(d):l.x=0,l.y=c+r-h*(1-v)*o,l.z=h*(1-v)*u/7,l.z<.5&&(l.z=.5),this.setVertex(cc.p(a,f),l)}}}),cc.PageTurn3D.create=function(e,t){var n=new cc.PageTurn3D;return n.initWithDuration(e,t),n};cc.Scene=cc.Node.extend({ctor:function(){this._super(),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(cc.p(.5,.5)),this.setContentSize(cc.Director.getInstance().getWinSize())}}),cc.Scene.create=function(){var e=new cc.Scene;return e.init(),e};cc.TOUCH_ALL_AT_ONCE=0,cc.TOUCH_ONE_BY_ONE=1,cc.Layer=cc.Node.extend({_isTouchEnabled:!1,_isAccelerometerEnabled:!1,_isKeyboardEnabled:!1,_touchPriority:0,_touchMode:cc.TOUCH_ALL_AT_ONCE,_isMouseEnabled:!1,_mousePriority:0,_initLayer:function(){this.setAnchorPoint(cc.p(.5,.5)),this._ignoreAnchorPointForPosition=!0;var e=cc.Director.getInstance();this.setContentSize(e.getWinSize()),this._isTouchEnabled=!1,this._isAccelerometerEnabled=!1,this._isMouseEnabled=!1,this._touchMode=cc.TOUCH_ALL_AT_ONCE,this._touchPriority=0},init:function(){return this._super(),this._initLayer(),!0},registerWithTouchDispatcher:function(){this._touchMode===cc.TOUCH_ALL_AT_ONCE?cc.Director.getInstance().getTouchDispatcher().addStandardDelegate(this,this._touchPriority):cc.Director.getInstance().getTouchDispatcher().addTargetedDelegate(this,this._touchPriority,!0)},isMouseEnabled:function(){return this._isMouseEnabled},setMouseEnabled:function(e){this._isMouseEnabled!=e&&(this._isMouseEnabled=e,this._running&&(e?cc.Director.getInstance().getMouseDispatcher().addMouseDelegate(this,this._mousePriority):cc.Director.getInstance().getMouseDispatcher().removeMouseDelegate(this)))},setMousePriority:function(e){this._mousePriority!==e&&(this._mousePriority=e,this._isMouseEnabled&&(this.setMouseEnabled(!1),this.setMouseEnabled(!0)))},getMousePriority:function(){return this._mousePriority},isTouchEnabled:function(){return this._isTouchEnabled},setTouchEnabled:function(e){this._isTouchEnabled!==e&&(this._isTouchEnabled=e,this._running&&(e?this.registerWithTouchDispatcher():cc.Director.getInstance().getTouchDispatcher().removeDelegate(this)))},getTouchPriority:function(){return this._touchPriority},setTouchPriority:function(e){this._touchPriority!==e&&(this._touchPriority=e,this._isTouchEnabled&&(this.setTouchEnabled(!1),this.setTouchEnabled(!0)))},getTouchMode:function(){return this._touchMode},setTouchMode:function(e){this._touchMode!==e&&(this._touchMode=e,this._isTouchEnabled&&(this.setTouchEnabled(!1),this.setTouchEnabled(!0)))},isAccelerometerEnabled:function(){return this._isAccelerometerEnabled},setAccelerometerEnabled:function(e){if(e!==this._isAccelerometerEnabled){this._isAccelerometerEnabled=e;if(this._running){var t=cc.Director.getInstance();e?t.getAccelerometer().setDelegate(this):t.getAccelerometer().setDelegate(null)}}},setAccelerometerInterval:function(e){if(this._isAccelerometerEnabled&&this._running){var t=cc.Director.getInstance();t.getAccelerometer().setAccelerometerInterval(e)}},onAccelerometer:function(e){},isKeyboardEnabled:function(){return this._isKeyboardEnabled},setKeyboardEnabled:function(e){if(e!==this._isKeyboardEnabled&&!isXC){this._isKeyboardEnabled=e;if(this._running){var t=cc.Director.getInstance();e?t.getKeyboardDispatcher().addDelegate(this):t.getKeyboardDispatcher().removeDelegate(this)}}},onEnter:function(){var e=cc.Director.getInstance();this._isTouchEnabled&&this.registerWithTouchDispatcher(),this._super(),this._isAccelerometerEnabled&&e.getAccelerometer().setDelegate(this),this._isKeyboardEnabled&&e.getKeyboardDispatcher().addDelegate(this),this._isMouseEnabled&&e.getMouseDispatcher().addMouseDelegate(this,this._mousePriority)},onExit:function(){var e=cc.Director.getInstance();this._isTouchEnabled&&e.getTouchDispatcher().removeDelegate(this),this._isAccelerometerEnabled&&e.getAccelerometer().setDelegate(null),this._isKeyboardEnabled&&e.getKeyboardDispatcher().removeDelegate(this),this._isMouseEnabled&&e.getMouseDispatcher().removeMouseDelegate(this),this._super()},onEnterTransitionDidFinish:function(){this._isAccelerometerEnabled&&cc.Director.getInstance().getAccelerometer().setDelegate(this),this._super()},onTouchBegan:function(e,t){return cc.Assert(!1,"Layer#onTouchBegan override me"),!0},onTouchMoved:function(e,t){},onTouchEnded:function(e,t){},onTouchCancelled:function(e,t){},onTouchesBegan:function(e,t){},onTouchesMoved:function(e,t){},onTouchesEnded:function(e,t){},onTouchesCancelled:function(e,t){},onMouseDown:function(e){return!1},onMouseDragged:function(e){return!1},onMouseMoved:function(e){return!1},onMouseUp:function(e){return!1},onRightMouseDown:function(e){return!1},onRightMouseDragged:function(e){return!1},onRightMouseUp:function(e){return!1},onOtherMouseDown:function(e){return!1},onOtherMouseDragged:function(e){return!1},onOtherMouseUp:function(e){return!1},onScrollWheel:function(e){return!1},onMouseEntered:function(e){return!1},onMouseExited:function(e){return!1},onKeyDown:function(e){},onKeyUp:function(e){}}),cc.Layer.create=function(){var e=new cc.Layer;return e&&e.init()?e:null},cc._LayerColorBaseProperties={},cc.LayerColorCanvas=cc.Layer.extend({RGBAProtocol:!0,_opacity:0,_color:null,_blendFunc:null,getOpacity:function(){return this._opacity},getColor:function(){return this._color},getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(e,t){this.setContentSize(cc.size(e,t))},changeWidth:function(e){this.setContentSize(cc.size(e,this._contentSize.height))},changeHeight:function(e){this.setContentSize(cc.size(this._contentSize.width,e))},setOpacity:function(e){this._opacity=e,this._updateColor(),this.setNodeDirty()},setColor:function(e){this._color=e,this._updateColor(),this.setNodeDirty()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},_updateColor:function(){},_isLighterMode:!1,ctor:function(){this._super(),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this._color=new cc.Color4B(0,0,0,0),this._opacity=255},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t},this._isLighterMode=this._blendFunc&&this._blendFunc.src==1&&this._blendFunc.dst==771},init:function(e,t,n){this._initLayer();var r=cc.Director.getInstance().getWinSize();return e=e||new cc.Color4B(0,0,0,255),t=t||r.width,n=n||r.height,this._color=new cc.Color3B(e.r,e.g,e.b),this._opacity=e.a,this.setContentSize(cc.size(t,n)),this._updateColor(),!0},draw:function(e){var t=e||cc.renderContext,n=this.getContentSize().width,r=this.getContentSize().height;t.fillStyle="rgba("+(0|this._color.r)+","+(0|this._color.g)+","+(0|this._color.b)+","+this.getOpacity()/255+")",t.fillRect(0,0,n,-r),cc.INCREMENT_GL_DRAWS(1)}}),cc.LayerColorCanvas.create=function(e,t,n){var r=new cc.LayerColorCanvas;switch(arguments.length){case 0:r.init();break;case 1:r.init(e);break;case 3:r.init(e,t,n);break;default:r.init()}return r},cc.LayerColorWebGL=cc.Layer.extend({RGBAProtocol:!0,_opacity:0,_color:null,_blendFunc:null,getOpacity:function(){return this._opacity},getColor:function(){return this._color},getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(e,t){this.setContentSize(cc.size(e,t))},changeWidth:function(e){this.setContentSize(cc.size(e,this._contentSize.height))},changeHeight:function(e){this.setContentSize(cc.size(this._contentSize.width,e))},setOpacity:function(e){this._opacity=e,this._updateColor(),this.setNodeDirty()},setColor:function(e){this._color=e,this._updateColor(),this.setNodeDirty()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},_squareVertices:null,_squareColors:null,_verticesFloat32Buffer:null,_colorsUint8Buffer:null,_squareVerticesAB:null,_squareColorsAB:null,ctor:function(){this._super(),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this._color=new cc.Color4B(0,0,0,0),this._opacity=255,this._squareVerticesAB=new ArrayBuffer(32),this._squareColorsAB=new ArrayBuffer(64),this._squareVertices=[new cc.Vertex2F(0,0,this._squareVerticesAB,0),new cc.Vertex2F(0,0,this._squareVerticesAB,cc.Vertex2F.BYTES_PER_ELEMENT),new cc.Vertex2F(0,0,this._squareVerticesAB,cc.Vertex2F.BYTES_PER_ELEMENT*2),new cc.Vertex2F(0,0,this._squareVerticesAB,cc.Vertex2F.BYTES_PER_ELEMENT*3)],this._squareColors=[new cc.Color4F(0,0,0,1,this._squareColorsAB,0),new cc.Color4F(0,0,0,1,this._squareColorsAB,cc.Color4F.BYTES_PER_ELEMENT),new cc.Color4F(0,0,0,1,this._squareColorsAB,cc.Color4F.BYTES_PER_ELEMENT*2),new cc.Color4F(0,0,0,1,this._squareColorsAB,cc.Color4F.BYTES_PER_ELEMENT*3)],this._verticesFloat32Buffer=cc.renderContext.createBuffer(),this._colorsUint8Buffer=cc.renderContext.createBuffer()},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t}},init:function(e,t,n){this._initLayer(),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_COLOR));var r=cc.Director.getInstance().getWinSize();return e=e||new cc.Color4B(0,0,0,255),t=t||r.width,n=n||r.height,this._color=new cc.Color3B(e.r,e.g,e.b),this._opacity=e.a,this.setContentSize(cc.size(t,n)),this._updateColor(),!0},setContentSize:function(e){this._squareVertices[1].x=e.width,this._squareVertices[2].y=e.height,this._squareVertices[3].x=e.width,this._squareVertices[3].y=e.height,this._bindLayerVerticesBufferData(),this._super(e)},_updateColor:function(){for(var e=0;e<4;e++)this._squareColors[e].r=this._color.r/255,this._squareColors[e].g=this._color.g/255,this._squareColors[e].b=this._color.b/255,this._squareColors[e].a=this._opacity/255;this._bindLayerColorsBufferData()},draw:function(e){var t=e||cc.renderContext;cc.NODE_DRAW_SETUP(this),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.FLOAT,!1,0,0),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),t.drawArrays(t.TRIANGLE_STRIP,0,4)},_bindLayerVerticesBufferData:function(){cc.renderContext.bindBuffer(cc.renderContext.ARRAY_BUFFER,this._verticesFloat32Buffer),cc.renderContext.bufferData(cc.renderContext.ARRAY_BUFFER,this._squareVerticesAB,cc.renderContext.STATIC_DRAW)},_bindLayerColorsBufferData:function(){cc.renderContext.bindBuffer(cc.renderContext.ARRAY_BUFFER,this._colorsUint8Buffer),cc.renderContext.bufferData(cc.renderContext.ARRAY_BUFFER,this._squareColorsAB,cc.renderContext.STATIC_DRAW)}}),cc.LayerColorWebGL.create=function(e,t,n){var r=new cc.LayerColorWebGL;switch(arguments.length){case 0:r.init();break;case 1:r.init(e);break;case 3:r.init(e,t,n);break;default:r.init()}return r},cc.LayerColor=cc.Browser.supportWebGL?cc.LayerColorWebGL:cc.LayerColorCanvas,cc.LayerGradient=cc.LayerColor.extend({_startColor:null,_endColor:null,_startOpacity:null,_endOpacity:null,_alongVector:null,_compressedInterpolation:!1,_gradientStartPoint:null,_gradientEndPoint:null,ctor:function(){this._super(),this._color=new cc.Color3B(0,0,0),this._startColor=new cc.Color3B(0,0,0),this._endColor=new cc.Color3B(0,0,0),this._alongVector=cc.p(0,-1),this._startOpacity=255,this._endOpacity=255,this._gradientStartPoint=cc.p(0,0),this._gradientEndPoint=cc.p(0,0)},getStartColor:function(){return this._color},setStartColor:function(e){this.setColor(e)},setEndColor:function(e){this._endColor=e,this._updateColor()},getEndColor:function(){return this._endColor},setStartOpacity:function(e){this._startOpacity=e,this._updateColor()},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(e){this._endOpacity=e,this._updateColor()},getEndOpacity:function(){return this._endOpacity},setVector:function(e){this._alongVector=e,this._updateColor()},getVector:function(){return this._alongVector},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(e){this._compressedInterpolation=e,this._updateColor()},init:function(e,t,n){var r=arguments.length;return r===0?this._super():(r===2&&(n=cc.p(0,-1)),this._startColor.r=e.r,this._startColor.g=e.g,this._startColor.b=e.b,this._startOpacity=e.a,this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endOpacity=t.a,this._alongVector=n,this._compressedInterpolation=!0,this._super(cc.c4b(e.r,e.g,e.b,255)),!0)},draw:function(e){if(cc.renderContextType===cc.WEBGL){this._super(e);return}var t=e||cc.renderContext;this._isLighterMode&&(t.globalCompositeOperation="lighter"),t.save();var n=this.getContentSize().width,r=this.getContentSize().height,i=t.createLinearGradient(this._gradientStartPoint.x,this._gradientStartPoint.y,this._gradientEndPoint.x,this._gradientEndPoint.y);i.addColorStop(0,"rgba("+Math.round(this._color.r)+","+Math.round(this._color.g)+","+Math.round(this._color.b)+","+(this._startOpacity/255).toFixed(4)+")"),i.addColorStop(1,"rgba("+Math.round(this._endColor.r)+","+Math.round(this._endColor.g)+","+Math.round(this._endColor.b)+","+(this._endOpacity/255).toFixed(4)+")"),t.fillStyle=i,t.fillRect(0,0,n,-r),this._rotation!=0&&t.rotate(this._rotationRadians),t.restore()},_updateColor:function(){if(cc.renderContextType===cc.CANVAS){var e=this.getContentSize().width*.5,t=this.getContentSize().height*.5;this._gradientStartPoint=cc.p(e*-this._alongVector.x+e,t*this._alongVector.y-t),this._gradientEndPoint=cc.p(e*this._alongVector.x+e,t*-this._alongVector.y-t)}else{var n=cc.pLength(this._alongVector);if(n===0)return;var r=Math.sqrt(2),i=cc.p(this._alongVector.x/n,this._alongVector.y/n);if(this._compressedInterpolation){var s=1/(Math.abs(i.x)+Math.abs(i.y));i=cc.pMult(i,s*r)}var o=this._opacity/255,u=new cc.Color4F(this._color.r/255,this._color.g/255,this._color.b/255,this._startOpacity*o/255),a=new cc.Color4F(this._endColor.r/255,this._endColor.g/255,this._endColor.b/255,this._endOpacity*o/255);this._squareColors[0].r=a.r+(u.r-a.r)*((r+i.x+i.y)/(2*r)),this._squareColors[0].g=a.g+(u.g-a.g)*((r+i.x+i.y)/(2*r)),this._squareColors[0].b=a.b+(u.b-a.b)*((r+i.x+i.y)/(2*r)),this._squareColors[0].a=a.a+(u.a-a.a)*((r+i.x+i.y)/(2*r)),this._squareColors[1].r=a.r+(u.r-a.r)*((r-i.x+i.y)/(2*r)),this._squareColors[1].g=a.g+(u.g-a.g)*((r-i.x+i.y)/(2*r)),this._squareColors[1].b=a.b+(u.b-a.b)*((r-i.x+i.y)/(2*r)),this._squareColors[1].a=a.a+(u.a-a.a)*((r-i.x+i.y)/(2*r)),this._squareColors[2].r=a.r+(u.r-a.r)*((r+i.x-i.y)/(2*r)),this._squareColors[2].g=a.g+(u.g-a.g)*((r+i.x-i.y)/(2*r)),this._squareColors[2].b=a.b+(u.b-a.b)*((r+i.x-i.y)/(2*r)),this._squareColors[2].a=a.a+(u.a-a.a)*((r+i.x-i.y)/(2*r)),this._squareColors[3].r=a.r+(u.r-a.r)*((r-i.x-i.y)/(2*r)),this._squareColors[3].g=a.g+(u.g-a.g)*((r-i.x-i.y)/(2*r)),this._squareColors[3].b=a.b+(u.b-a.b)*((r-i.x-i.y)/(2*r)),this._squareColors[3].a=a.a+(u.a-a.a)*((r-i.x-i.y)/(2*r)),this._bindLayerColorsBufferData()}}}),cc.LayerGradient.create=function(e,t,n){var r=new cc.LayerGradient;switch(arguments.length){case 2:if(r&&r.init(e,t))return r;break;case 3:if(r&&r.init(e,t,n))return r;break;case 0:if(r&&r.init())return r;break;default:throw"Arguments error "}return null},cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,ctor:function(){this._super()},initWithLayer:function(e){return this._layers=[],this._layers.push(e),this._enabledLayer=0,this.addChild(e),!0},initWithLayers:function(e){return this._layers=e,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(e){cc.Assert(e<this._layers.length,"Invalid index in MultiplexLayer switchTo message"),this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=e,this.addChild(this._layers[e])},switchToAndReleaseMe:function(e){cc.Assert(e<this._layers.count(),"Invalid index in MultiplexLayer switchTo message"),this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=e,this.addChild(this._layers[e])},addLayer:function(e){cc.Assert(this._layers,"cc.Layer addLayer"),this._layers.push(e)}}),cc.LayerMultiplex.create=function(){var e=new cc.LayerMultiplex;return e.initWithLayers(arguments)?e:null};cc.SCENE_FADE=4208917214,cc.TransitionEaseScene=cc.Class.extend({easeActionWithAction:function(){}}),cc.TRANSITION_ORIENTATION_LEFT_OVER=0,cc.TRANSITION_ORIENTATION_RIGHT_OVER=1,cc.TRANSITION_ORIENTATION_UP_OVER=0,cc.TRANSITION_ORIENTATION_DOWN_OVER=1,cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_setNewScene:function(e){this.unschedule(this._setNewScene);var t=cc.Director.getInstance();this._isSendCleanupToScene=t.isSendCleanupToScene(),t.replaceScene(this._inScene),t.getTouchDispatcher().setDispatchEvents(!0),this._outScene.setVisible(!0)},_sceneOrder:function(){this._isInSceneOnTop=!0},draw:function(){this._super(),this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit())},onEnter:function(){this._super(),this._inScene.onEnter()},onExit:function(){this._super(),this._outScene.onExit(),this._inScene.onEnterTransitionDidFinish()},cleanup:function(){this._super(),this._isSendCleanupToScene&&this._outScene.cleanup()},initWithDuration:function(e,t){return cc.Assert(t!=null,"CCTransitionScene.initWithDuration() Argument scene must be non-nil"),this.init()?(this._duration=e,this.setAnchorPoint(cc.p(0,0)),this.setPosition(cc.p(0,0)),this._inScene=t,this._outScene=cc.Director.getInstance().getRunningScene(),this._outScene||(this._outScene=cc.Scene.create(),this._outScene.init()),cc.Assert(this._inScene!=this._outScene,"CCTransitionScene.initWithDuration() Incoming scene must be different from the outgoing scene"),cc.Director.getInstance().getTouchDispatcher().setDispatchEvents(!1),this._sceneOrder(),!0):!1},finish:function(){this._inScene.setVisible(!0),this._inScene.setPosition(cc.p(0,0)),this._inScene.setScale(1),this._inScene.setRotation(0),cc.renderContextType===cc.WEBGL&&this._inScene.getCamera().restore(),this._outScene.setVisible(!1),this._outScene.setPosition(cc.p(0,0)),this._outScene.setScale(1),this._outScene.setRotation(0),cc.renderContextType===cc.WEBGL&&this._outScene.getCamera().restore(),this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.setVisible(!0),this._outScene.setVisible(!1)}}),cc.TransitionScene.create=function(e,t){var n=new cc.TransitionScene;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,initWithDuration:function(e,t,n){return this._super(e,t)&&(this._orientation=n),!0}}),cc.TransitionSceneOriented.create=function(e,t,n){var r=new cc.TransitionSceneOriented;return r.initWithDuration(e,t,n),r},cc.TransitionRotoZoom=cc.TransitionScene.extend({ctor:function(){},onEnter:function(){this._super(),this._inScene.setScale(.001),this._outScene.setScale(1),this._inScene.setAnchorPoint(cc.p(.5,.5)),this._outScene.setAnchorPoint(cc.p(.5,.5));var e=cc.Sequence.create(cc.Spawn.create(cc.ScaleBy.create(this._duration/2,.001),cc.RotateBy.create(this._duration/2,720)),cc.DelayTime.create(this._duration/2));this._outScene.runAction(e),this._inScene.runAction(cc.Sequence.create(e.reverse(),cc.CallFunc.create(this.finish,this)))}}),cc.TransitionRotoZoom.create=function(e,t){var n=new cc.TransitionRotoZoom;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionJumpZoom=cc.TransitionScene.extend({onEnter:function(){this._super();var e=cc.Director.getInstance().getWinSize();this._inScene.setScale(.5),this._inScene.setPosition(cc.p(e.width,0)),this._inScene.setAnchorPoint(cc.p(.5,.5)),this._outScene.setAnchorPoint(cc.p(.5,.5));var t=cc.JumpBy.create(this._duration/4,cc.p(-e.width,0),e.width/4,2),n=cc.ScaleTo.create(this._duration/4,1),r=cc.ScaleTo.create(this._duration/4,.5),i=cc.Sequence.create(r,t),s=cc.Sequence.create(t,n),o=cc.DelayTime.create(this._duration/2);this._outScene.runAction(i),this._inScene.runAction(cc.Sequence.create(o,s,cc.CallFunc.create(this.finish,this)))}}),cc.TransitionJumpZoom.create=function(e,t){var n=new cc.TransitionJumpZoom;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInL=cc.TransitionScene.extend({onEnter:function(){this._super(),this.initScenes();var e=this.action();this._inScene.runAction(cc.Sequence.create(this.easeActionWithAction(e),cc.CallFunc.create(this.finish,this)))},initScenes:function(){this._inScene.setPosition(cc.p(-cc.Director.getInstance().getWinSize().width,0))},action:function(){return cc.MoveTo.create(this._duration,cc.p(0,0))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionMoveInL.create=function(e,t){var n=new cc.TransitionMoveInL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInR=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(cc.p(cc.Director.getInstance().getWinSize().width,0))}}),cc.TransitionMoveInR.create=function(e,t){var n=new cc.TransitionMoveInR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInT=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(cc.p(0,cc.Director.getInstance().getWinSize().height))}}),cc.TransitionMoveInT.create=function(e,t){var n=new cc.TransitionMoveInT;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInB=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(cc.p(0,-cc.Director.getInstance().getWinSize().height))}}),cc.TransitionMoveInB.create=function(e,t){var n=new cc.TransitionMoveInB;return n!=null&&n.initWithDuration(e,t)?n:null},cc.ADJUST_FACTOR=.5,cc.TransitionSlideInL=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},ctor:function(){},onEnter:function(){this._super(),this.initScenes();var e=this.action(),t=this.action(),n=this.easeActionWithAction(e),r=cc.Sequence.create(this.easeActionWithAction(t),cc.CallFunc.create(this.finish,this));this._inScene.runAction(n),this._outScene.runAction(r)},initScenes:function(){this._inScene.setPosition(cc.p(-(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR),0))},action:function(){return cc.MoveBy.create(this._duration,cc.p(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionSlideInL.create=function(e,t){var n=new cc.TransitionSlideInL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInR=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(cc.p(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR,0))},action:function(){return cc.MoveBy.create(this._duration,cc.p(-(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR),0))}}),cc.TransitionSlideInR.create=function(e,t){var n=new cc.TransitionSlideInR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInB=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){this._inScene.setPosition(cc.p(0,cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR))},action:function(){return cc.MoveBy.create(this._duration,cc.p(0,-(cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR)))}}),cc.TransitionSlideInB.create=function(e,t){var n=new cc.TransitionSlideInB;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInT=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(cc.p(0,-(cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR)))},action:function(){return cc.MoveBy.create(this._duration,cc.p(0,cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR))}}),cc.TransitionSlideInT.create=function(e,t){var n=new cc.TransitionSlideInT;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionShrinkGrow=cc.TransitionScene.extend({onEnter:function(){this._super(),this._inScene.setScale(.001),this._outScene.setScale(1),this._inScene.setAnchorPoint(cc.p(2/3,.5)),this._outScene.setAnchorPoint(cc.p(1/3,.5));var e=cc.ScaleTo.create(this._duration,.01),t=cc.ScaleTo.create(this._duration,1);this._inScene.runAction(this.easeActionWithAction(t)),this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(e),cc.CallFunc.create(this.finish,this)))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionShrinkGrow.create=function(e,t){var n=new cc.TransitionShrinkGrow;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,0,0),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,0,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipX.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionFlipX;return r.initWithDuration(e,t,n),r},cc.TransitionFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation==cc.TRANSITION_ORIENTATION_UP_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,90,0),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,90,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipY.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_UP_OVER);var r=new cc.TransitionFlipY;return r.initWithDuration(e,t,n),r},cc.TransitionFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,-45,0),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,45,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipAngular.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionFlipAngular;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,0,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,0,0),cc.ScaleTo.create(this._duration/2,.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipX.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionZoomFlipX;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_UP_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,90,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,90,0),cc.ScaleTo.create(this._duration/2,.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipY.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_UP_OVER);var r=new cc.TransitionZoomFlipY;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,-45,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.Show.create(),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,45,0),cc.ScaleTo.create(this._duration/2,.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipAngular.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionZoomFlipAngular;return r.initWithDuration(e,t,n),r},cc.TransitionFade=cc.TransitionScene.extend({_color:null,ctor:function(){this._super(),this._color=new cc.Color3B},onEnter:function(){this._super();var e=cc.LayerColor.create(this._color);this._inScene.setVisible(!1),this.addChild(e,2,cc.SCENE_FADE);var t=this.getChildByTag(cc.SCENE_FADE),n=cc.Sequence.create(cc.FadeIn.create(this._duration/2),cc.CallFunc.create(this.hideOutShowIn,this),cc.FadeOut.create(this._duration/2),cc.CallFunc.create(this.finish,this));t.runAction(n)},onExit:function(){this._super(),this.removeChildByTag(cc.SCENE_FADE,!1)},initWithDuration:function(e,t,n){return n=n||cc.black(),this._super(e,t)&&(this._color.r=n.r,this._color.g=n.g,this._color.b=n.b,this._color.a=0),!0}}),cc.TransitionFade.create=function(e,t,n){var r=new cc.TransitionFade;return r.initWithDuration(e,t,n),r},cc.TransitionCrossFade=cc.TransitionScene.extend({onEnter:function(){this._super();var e=new cc.Color4B(0,0,0,0),t=cc.Director.getInstance().getWinSize(),n=cc.LayerColor.create(e),r=cc.RenderTexture.create(t.width,t.height);if(null==r)return;r.getSprite().setAnchorPoint(cc.p(.5,.5)),r.setPosition(cc.p(t.width/2,t.height/2)),r.setAnchorPoint(cc.p(.5,.5)),r.begin(),this._inScene.visit(),r.end();var i=cc.RenderTexture.create(t.width,t.height);i.getSprite().setAnchorPoint(cc.p(.5,.5)),i.setPosition(cc.p(t.width/2,t.height/2)),i.setAnchorPoint(cc.p(.5,.5)),i.begin(),this._outScene.visit(),i.end(),r.getSprite().setBlendFunc(gl.ONE,gl.ONE),i.getSprite().setBlendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),n.addChild(r),n.addChild(i),r.getSprite().setOpacity(255),i.getSprite().setOpacity(255);var s=cc.Sequence.create(cc.FadeTo.create(this._duration,0),cc.CallFunc.create(this.hideOutShowIn,this),cc.CallFunc.create(this.finish,this));i.getSprite().runAction(s),this.addChild(n,2,cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,!1),this._super()},draw:function(){}}),cc.TransitionCrossFade.create=function(e,t){var n=new cc.TransitionCrossFade;return n.initWithDuration(e,t),n},cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){this._super();var e=cc.Director.getInstance().getWinSize(),t=e.width/e.height,n=0|12*t,r=12,i=cc.TurnOffTiles.create(this._duration,cc.SizeMake(n,r)),s=this.easeActionWithAction(i);this._outScene.runAction(cc.Sequence.create(s,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(e){return e}}),cc.TransitionTurnOffTiles.create=function(e,t){var n=new cc.TransitionTurnOffTiles;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSplitCols=cc.TransitionScene.extend({onEnter:function(){this._super(),this._inScene.setVisible(!1);var e=this.action(),t=cc.Sequence.create(e,cc.CallFunc.create(this.hideOutShowIn,this),e.reverse());this.runAction(cc.Sequence.create(this.easeActionWithAction(t),cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(e){return cc.EaseInOut.create(e,3)},action:function(){return cc.SplitCols.create(this._duration/2,3)}}),cc.TransitionSplitCols.create=function(e,t){var n=new cc.TransitionSplitCols;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSplitRows=cc.TransitionSplitCols.extend({action:function(){return cc.SplitRows.create(this._duration/2,3)}}),cc.TransitionSplitRows.create=function(e,t){var n=new cc.TransitionSplitRows;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeTR=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){this._super();var e=cc.Director.getInstance().getWinSize(),t=e.width/e.height,n=0|12*t,r=12,i=this.actionWithSize(cc.SizeMake(n,r));this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(i),cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(e){return e},actionWithSize:function(e){return cc.FadeOutTRTiles.create(this._duration,e)}}),cc.TransitionFadeTR.create=function(e,t){var n=new cc.TransitionFadeTR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeBL=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutBLTiles.create(this._duration,e)}}),cc.TransitionFadeBL.create=function(e,t){var n=new cc.TransitionFadeBL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeUp=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutUpTiles.create(this._duration,e)}}),cc.TransitionFadeUp.create=function(e,t){var n=new cc.TransitionFadeUp;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeDown=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutDownTiles.create(this._duration,e)}}),cc.TransitionFadeDown.create=function(e,t){var n=new cc.TransitionFadeDown;return n!=null&&n.initWithDuration(e,t)?n:null};cc.SCENE_RADIAL=49153,cc.TransitionProgress=cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,onEnter:function(){this._super(),this._setupTransition();var e=cc.Director.getInstance().getWinSize(),t=cc.RenderTexture.create(e.width,e.height);t.getSprite().setAnchorPoint(cc.p(.5,.5)),t.setPosition(cc.p(e.width/2,e.height/2)),t.setAnchorPoint(cc.p(.5,.5)),cc.renderContextType===cc.CANVAS?(t.clear(),this._sceneToBeModified.visit(t.context)):(t.clear(0,0,0,1),t.begin(),this._sceneToBeModified.visit(),t.end()),this._sceneToBeModified==this._outScene&&this.hideOutShowIn();var n=this._progressTimerNodeWithRenderTexture(t),r=cc.Sequence.create(cc.ProgressFromTo.create(this._duration,this._from,this._to),cc.CallFunc.create(this.finish,this));n.runAction(r),this.addChild(n,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,!1),this._super()},_setupTransition:function(){this._sceneToBeModified=this._outScene,this._from=100,this._to=0},_progressTimerNodeWithRenderTexture:function(e){return cc.Assert(!1,"override me - abstract class"),null},_sceneOrder:function(){this._isInSceneOnTop=!1}}),cc.TransitionProgress.create=function(e,t){var n=new cc.TransitionProgress;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressRadialCCW=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlipY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_RADIAL),n.setReverseDirection(!1),n.setPercentage(100),n.setPosition(cc.p(t.width/2,t.height/2)),n.setAnchorPoint(cc.p(.5,.5)),n}}),cc.TransitionProgressRadialCCW.create=function(e,t){var n=new cc.TransitionProgressRadialCCW;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressRadialCW=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlipY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_RADIAL),n.setReverseDirection(!0),n.setPercentage(100),n.setPosition(cc.p(t.width/2,t.height/2)),n.setAnchorPoint(cc.p(.5,.5)),n}}),cc.TransitionProgressRadialCW.create=function(e,t){var n=new cc.TransitionProgressRadialCW;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressHorizontal=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType==cc.WEBGL&&n.getSprite().setFlipY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(1,0)),n.setBarChangeRate(cc.p(1,0)),n.setPercentage(100),n.setPosition(cc.p(t.width/2,t.height/2)),n.setAnchorPoint(cc.p(.5,.5)),n}}),cc.TransitionProgressHorizontal.create=function(e,t){var n=new cc.TransitionProgressHorizontal;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressVertical=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType==cc.WEBGL&&n.getSprite().setFlipY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(0,0)),n.setBarChangeRate(cc.p(0,1)),n.setPercentage(100),n.setPosition(cc.p(t.width/2,t.height/2)),n.setAnchorPoint(cc.p(.5,.5)),n}}),cc.TransitionProgressVertical.create=function(e,t){var n=new cc.TransitionProgressVertical;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressInOut=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType==cc.WEBGL&&n.getSprite().setFlipY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(.5,.5)),n.setBarChangeRate(cc.p(1,1)),n.setPercentage(0),n.setPosition(cc.p(t.width/2,t.height/2)),n.setAnchorPoint(cc.p(.5,.5)),n},_sceneOrder:function(){this._isInSceneOnTop=!1},_setupTransition:function(){this._sceneToBeModified=this._inScene,this._from=0,this._to=100}}),cc.TransitionProgressInOut.create=function(e,t){var n=new cc.TransitionProgressInOut;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressOutIn=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType==cc.WEBGL&&n.getSprite().setFlipY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(.5,.5)),n.setBarChangeRate(cc.p(1,1)),n.setPercentage(100),n.setPosition(cc.p(t.width/2,t.height/2)),n.setAnchorPoint(cc.p(.5,.5)),n}}),cc.TransitionProgressOutIn.create=function(e,t){var n=new cc.TransitionProgressOutIn;return n!=null&&n.initWithDuration(e,t)?n:null};cc.TransitionPageTurn=cc.TransitionScene.extend({_back:!0,initWithDuration:function(e,t,n){return this._back=n,this._super(e,t),!0},actionWithSize:function(e){return this._back?cc.ReverseTime.create(cc.PageTurn3D.create(this._duration,e)):cc.PageTurn3D.create(this._duration,e)},onEnter:function(){this._super();var e=cc.Director.getInstance().getWinSize(),t,n;e.width>e.height?(t=16,n=12):(t=12,n=16);var r=this.actionWithSize(cc.SizeMake(t,n));this._back?(this._inScene.setVisible(!1),this._inScene.runAction(cc.Sequence.create(cc.Show.create(),r,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))):this._outScene.runAction(cc.Sequence.create(r,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},_sceneOrder:function(){this._isInSceneOnTop=this._back}}),cc.TransitionPageTurn.create=function(e,t,n){var r=new cc.TransitionPageTurn;return r.initWithDuration(e,t,n),r};cc.SPRITE_INDEX_NOT_INITIALIZED=-1,cc.generateTextureCacheForColor=function(e){function n(){var n=cc.generateTextureCacheForColor,r=e.width,i=e.height;t[0].width=r,t[0].height=i,t[1].width=r,t[1].height=i,t[2].width=r,t[2].height=i,n.canvas.width=r,n.canvas.height=i;var s=n.canvas.getContext("2d");s.drawImage(e,0,0),n.tempCanvas.width=r,n.tempCanvas.height=i;var o=s.getImageData(0,0,r,i).data;for(var u=0;u<3;u++){var a=t[u].getContext("2d");a.getImageData(0,0,r,i).data,n.tempCtx.drawImage(e,0,0);var f=n.tempCtx.getImageData(0,0,r,i),l=f.data;for(var c=0;c<o.length;c+=4)l[c]=u===0?o[c]:0,l[c+1]=u===1?o[c+1]:0,l[c+2]=u===2?o[c+2]:0,l[c+3]=o[c+3];a.putImageData(f,0,0)}e.onload=null}if(e.hasOwnProperty("channelCache"))return e.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];try{n()}catch(r){e.onload=n}return e.channelCache=t,t},cc.generateTextureCacheForColor.canvas=document.createElement("canvas"),cc.generateTextureCacheForColor.tempCanvas=document.createElement("canvas"),cc.generateTextureCacheForColor.tempCtx=cc.generateTextureCacheForColor.tempCanvas.getContext("2d"),cc.generateTintImage2=function(e,t,n){n||(n=cc.rect(0,0,e.width,e.height));var r;t instanceof cc.Color4F?r=cc.c4b(t.r*255,t.g*255,t.b*255,t.a*255):r=cc.c4b(t.r,t.g,t.b,50);var i=document.createElement("canvas"),s=i.getContext("2d");return i.width!=n.size.width&&(i.width=n.size.width),i.height!=n.size.height&&(i.height=n.size.height),s.save(),s.drawImage(e,n.origin.x,n.origin.y,n.size.width,n.size.height,0,0,n.size.width,n.size.height),s.globalCompositeOperation="source-in",s.globalAlpha=r.a/255,s.fillStyle="rgb("+r.r+","+r.g+","+r.b+")",s.fillRect(0,0,n.size.width,n.size.height),s.restore(),i},cc.generateTintImage=function(e,t,n,r,i,s){r||(r=cc.rect(0,0,e.width,e.height));var o;n instanceof cc.Color3B?o=cc.c4f(n.r/255,n.g/255,n.b/255,1):o=n;var u=Math.min(r.size.width,t[0].width),a=Math.min(r.size.height,t[0].height),f=i,l;f?(l=f.getContext("2d"),l.clearRect(0,0,u,a)):(f=document.createElement("canvas"),f.width=u,f.height=a,l=f.getContext("2d")),l.save(),l.globalCompositeOperation="lighter";var c=l.globalAlpha;return o.r>0&&(l.globalAlpha=o.r*c,l.drawImage(t[0],r.origin.x,r.origin.y,u,a,0,0,u,a)),o.g>0&&(l.globalAlpha=o.g*c,l.drawImage(t[1],r.origin.x,r.origin.y,u,a,0,0,u,a)),o.b>0&&(l.globalAlpha=o.b*c,l.drawImage(t[2],r.origin.x,r.origin.y,u,a,0,0,u,a)),l.restore(),f},cc.cutRotateImageToCanvas=function(e,t){if(!e)return null;if(!t)return e;var n=document.createElement("canvas");n.width=t.size.width,n.height=t.size.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),r.rotate(-1.5707963267948966),r.drawImage(e,t.origin.x,t.origin.y,t.size.height,t.size.width,-t.size.height/2,-t.size.width/2,t.size.height,t.size.width),n},cc.TransformValues=function(e,t,n,r,i,s){this.pos=e,this.scale=t,this.rotation=n,this.skew=r,this.ap=i,this.visible=s},cc.RENDER_IN_SUBPIXEL=function(e){return cc.SPRITEBATCHNODE_RENDER_SUBPIXEL?e:0|e},cc.SpriteCanvas=cc.Node.extend({RGBAProtocol:!0,_textureAtlas:null,_atlasIndex:0,_batchNode:null,_dirty:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_color:null,_rect:cc.rect(0,0,0,0),_rectRotated:null,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,colorUnmodified:null,_opacityModifyRGB:null,_flipX:null,_flipY:null,_opacity:255,isDirty:function(){return this._dirty},setDirty:function(e){this._dirty=e},getQuad:function(){return null},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this._atlasIndex},setAtlasIndex:function(e){this._atlasIndex=e},getTextureRect:function(){return cc.rect(this._rect.origin.x,this._rect.origin.y,this._rect.size.width,this._rect.size.height)},getTextureAtlas:function(e){return this._textureAtlas},setTextureAtlas:function(e){this._textureAtlas=e},getSpriteBatchNode:function(){return this._batchNode},setSpriteBatchNode:function(e){this._batchNode=e},getOffsetPosition:function(){return cc.p(this._offsetPosition.x,this._offsetPosition.y)},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(e){cc.Assert(e!=null,"");var t=this.initWithTexture(e.getTexture(),e.getRect());return this.setDisplayFrame(e),t},initWithSpriteFrameName:function(e){cc.Assert(e!=null,"");var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);return this.initWithSpriteFrame(t)},useBatchNode:function(e){this._textureAtlas=e.getTextureAtlas(),this._batchNode=e},setVertexRect:function(e){this._rect=e},sortAllChildren:function(){if(this._reorderChildDirty){var e,t=null;for(var n=1;n<this._children.length;n++){t=this._children[n],e=n-1;while(e>=0&&(t.getZOrder()<this._children[e].getZOrder()||t.getZOrder()==this._children[e].getZOrder()&&t.getOrderOfArrival()<this._children[e].getOrderOfArrival()))this._children[e+1]=this._children[e],e-=1;this._children[e+1]=t}this._batchNode&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(e,t){cc.Assert(e!=null,"child is null"),cc.Assert(this._children.indexOf(e)>-1,"this child is not in children list");if(t===e.getZOrder())return;this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),this._super(e,t)},removeChild:function(e,t){this._batchNode&&this._batchNode.removeSpriteFromAtlas(e),this._super(e,t)},removeAllChildren:function(e){if(this._batchNode&&this._children!=null)for(var t=0;t<this._children.length;t++)this._children[t]instanceof cc.Sprite&&this._batchNode.removeSpriteFromAtlas(this._children[t]);this._super(e),this._hasChildren=!1},setDirtyRecursively:function(e){this._recursiveDirty=e,this.setDirty(e);if(this._children!=null)for(var t=0;t<this._children.length;t++)this._children[t]instanceof cc.Sprite&&this._children[t].setDirtyRecursively(!0)},SET_DIRTY_RECURSIVELY:function(){this._batchNode&&!this._recursiveDirty&&(this._recursiveDirty=!0,this._dirty=!0,this._hasChildren&&this.setDirtyRecursively(!0))},setPosition:function(e){arguments.length>=2?cc.Node.prototype.setPosition.call(this,e,arguments[1]):cc.Node.prototype.setPosition.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotation:function(e){cc.Node.prototype.setRotation.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotationX:function(e){cc.Node.prototype.setRotationX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotationY:function(e){cc.Node.prototype.setRotationY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setSkewX:function(e){cc.Node.prototype.setSkewX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setSkewY:function(e){cc.Node.prototype.setSkewY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScaleX:function(e){cc.Node.prototype.setScaleX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScaleY:function(e){cc.Node.prototype.setScaleY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScale:function(e,t){cc.Node.prototype.setScale.call(this,e,t),this.SET_DIRTY_RECURSIVELY()},setVertexZ:function(e){cc.Node.prototype.setVertexZ.call(this,e),this.SET_DIRTY_RECURSIVELY()},setAnchorPoint:function(e){cc.Node.prototype.setAnchorPoint.call(this,e),this.SET_DIRTY_RECURSIVELY()},setVisible:function(e){cc.Node.prototype.setVisible.call(this,e),this.SET_DIRTY_RECURSIVELY()},ignoreAnchorPointForPosition:function(e){cc.Assert(!this._batchNode,"ignoreAnchorPointForPosition is invalid in cc.Sprite"),this._super(e)},setFlipX:function(e){this._flipX!=e&&(this._flipX=e,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty())},setFlipY:function(e){this._flipY!=e&&(this._flipY=e,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty())},isFlippedX:function(){return this._flipX},isFlippedY:function(){return this._flipY},getOpacity:function(){return this._opacity},getColor:function(){return this._opacityModifyRGB?new cc.Color3B(this._colorUnmodified):new cc.Color3B(this._color)},setOpacityModifyRGB:function(e){var t=this._color;this._opacityModifyRGB=e,this._color=t},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(e,t){cc.Assert(e,"cc.Sprite#setDisplayFrameWithAnimationName. animationName must not be null");var n=cc.AnimationCache.getInstance().getAnimation(e);cc.Assert(n,"cc.Sprite#setDisplayFrameWithAnimationName: Frame not found");var r=n.getFrames()[t];cc.Assert(r,"cc.Sprite#setDisplayFrame. Invalid frame"),this.setDisplayFrame(r.getSpriteFrame())},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;var e=this._parent;while(e&&e!=this._batchNode)e._setReorderChildDirtyRecursively(),e=e.getParent()}},getTexture:function(){return this._texture},_colorized:!1,_isLighterMode:!1,_originalTexture:null,ctor:function(e){this._super(),this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._color=cc.white(),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};if(e)if(typeof e=="string"){var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);this.initWithSpriteFrame(t)}else if(typeof e=="object")if(e instanceof cc.SpriteFrame)this.initWithSpriteFrame(e);else if(e instanceof cc.SpriteBatchNode){if(arguments.length>1){var n=arguments[1];n instanceof cc.Rect&&this.initWithBatchNode(e,n)}}else(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)&&this.initWithTexture(e)},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t},this._isLighterMode=this._blendFunc&&this._blendFunc.src===gl.SRC_ALPHA&&this._blendFunc.dst===gl.ONE},init:function(){return arguments.length>0?this.initWithFile(arguments[0],arguments[1]):(this._super(),this._dirty=this._recursiveDirty=!1,this._opacityModifyRGB=!0,this._opacity=255,this._color=cc.white(),this._colorUnmodified=cc.white(),this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setTexture(null),this._flipX=this._flipY=!1,this.setAnchorPoint(cc.p(.5,.5)),this._offsetPosition=cc.PointZero(),this._hasChildren=!1,this.setTextureRect(cc.RectZero(),!1,cc.SizeZero()),!0)},initWithFile:function(e,t){cc.Assert(e!=null,"Sprite#initWithFile():Invalid filename for sprite");var n=this,r=cc.TextureCache.getInstance().textureForKey(cc.FileUtils.getInstance().fullPathForFilename(e));if(!r){this._visible=!1;var i=new Image;return i.addEventListener("load",function(){t||(t=cc.rect(0,0,i.width,i.height)),n.initWithTexture(i,t),cc.TextureCache.getInstance().cacheImage(e,i),n._visible=!0}),i.addEventListener("error",function(){cc.log("load failure:"+e)}),i.src=e,!0}return r?(t||(t=cc.rect(0,0,r.width,r.height)),this.initWithTexture(r,t)):!1},initWithTexture:function(e,t,n){var r=arguments.length;if(r==0)throw"Sprite.initWithTexture(): Argument must be non-nil ";n=n||!1,this._batchNode=null,this._recursiveDirty=!1,this.setDirty(!1),this._opacityModifyRGB=!0,this._opacity=255,this._color=cc.white(),this._colorUnmodified=cc.white(),this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._flipX=this._flipY=!1,this.setAnchorPoint(cc.p(.5,.5)),this._offsetPosition=cc.p(0,0),this._hasChildren=!1;if(!t){t=cc.rect(0,0,0,0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)t.size=cc.size(e.width,e.height)}return this._originalTexture=e,this.setTexture(e),this.setTextureRect(t,n,t.size),this.setBatchNode(null),!0},setTextureRect:function(e,t,n){this._rectRotated=t||!1,n=n||e.size,this.setContentSize(n),this.setVertexRect(e);var r=this._unflippedOffsetPositionFromCenter;this._offsetPosition.x=r.x+(this._contentSize.width-this._rect.size.width)/2,this._offsetPosition.y=r.y+(this._contentSize.height-this._rect.size.height)/2,this._batchNode&&(this._dirty=!0)},updateTransform:function(){this.isDirty()&&(!this._visible||this._parent&&this._parent!=this._batchNode&&this._parent._shouldBeHidden?this._shouldBeHidden=!0:(this._shouldBeHidden=!1,!this._parent||this._parent==this._batchNode?this._transformToBatch=this.nodeToParentTransform():this._transformToBatch=cc.AffineTransformConcat(this.nodeToParentTransform(),this._parent._transformToBatch)),this._recursiveDirty=!1,this.setDirty(!1)),this._hasChildren&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},addChild:function(e,t,n){cc.Assert(e!=null,"Argument must be non-NULL"),t==null&&(t=e._zOrder),n==null&&(n=e._tag),this._super(e,t,n),this._hasChildren=!0},setOpacity:function(e){this._opacity=e,this.setNodeDirty()},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=this._colorUnmodified=new cc.Color3B(e.r,e.g,e.b),this._changeTextureColor(),this._opacityModifyRGB&&(this._color.r=0|e.r*this._opacity/255,this._color.g=0|e.g*this._opacity/255,this._color.b=0|e.b*this._opacity/255),this.setNodeDirty()},setDisplayFrame:function(e){this.setNodeDirty(),this._unflippedOffsetPositionFromCenter=e.getOffset();var t=e.getTexture();t!=this._texture&&this.setTexture(t),this._rectRotated=e.isRotated(),this._rectRotated&&(this._originalTexture=t),this.setTextureRect(e.getRect(),this._rectRotated,e.getOriginalSize()),(this._color.r!==255||this._color.g!==255||this._color.b!==255)&&this._changeTextureColor()},isFrameDisplayed:function(e){return e.getTexture()!=this._texture?!1:cc.Rect.CCRectEqualToRect(e.getRect(),this._rect)},displayFrame:function(){return cc.SpriteFrame._frameWithTextureForCanvas(this._texture,cc.RECT_POINTS_TO_PIXELS(this._rect),this._rectRotated,this._unflippedOffsetPositionFromCenter,cc.SIZE_POINTS_TO_PIXELS(this._contentSize))},setBatchNode:function(e){this._batchNode=e,this._batchNode?(this._transformToBatch=cc.AffineTransformIdentity(),this.setTextureAtlas(this._batchNode.getTextureAtlas())):(this._atlasIndex=cc.SPRITE_INDEX_NOT_INITIALIZED,this.setTextureAtlas(null),this._recursiveDirty=!1,this.setDirty(!1))},setTexture:function(e){cc.Assert(!e||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement,"setTexture expects a CCTexture2D. Invalid argument");if(this._texture!=e){if(e instanceof HTMLImageElement){if(!this._rect||cc.rectEqualToRect(this._rect,cc.RectZero()))this._rect=cc.rect(0,0,e.width,e.height);this._originalTexture=e}this._texture=e}},_changeTextureColor:function(){if(this.getTexture()){var e=cc.TextureCache.getInstance().getTextureColors(this._originalTexture);if(e){this._colorized=!0;if(this._texture instanceof HTMLCanvasElement&&!this._rectRotated)cc.generateTintImage(this.getTexture(),e,this._color,this.getTextureRect(),this._texture);else{var t=cc.generateTintImage(this.getTexture(),e,this._color,this.getTextureRect());this.setTexture(t)}}}},draw:function(e){var t=e||cc.renderContext;this._isLighterMode&&(t.globalCompositeOperation="lighter"),t.globalAlpha=this._opacity/255;var n=0,r=0;this._flipX&&(n=this._rect.size.width,t.scale(-1,1)),this._flipY&&(r=this._rect.size.height,t.scale(1,-1));var i=0|this._offsetPosition.x,s=0|this._offsetPosition.y;this._texture?this._colorized?t.drawImage(this._texture,0,0,this._rect.size.width,this._rect.size.height,this._offsetPosition.x-n,-this._offsetPosition.y-this._rect.size.height+r,this._rect.size.width,this._rect.size.height):t.drawImage(this._texture,this._rect.origin.x,this._rect.origin.y,this._rect.size.width,this._rect.size.height,this._offsetPosition.x-n,-this._offsetPosition.y-this._rect.size.height+r,this._rect.size.width,this._rect.size.height):this._contentSize.width!==0&&(t.fillStyle="rgba("+this._color.r+","+this._color.g+","+this._color.b+",1)",t.fillRect(i,s,this._contentSize.width,-this._contentSize.height));if(cc.SPRITE_DEBUG_DRAW===1){t.strokeStyle="rgba(0,255,0,1)";var o=[cc.p(i,s),cc.p(i+this._rect.size.width,s),cc.p(i+this._rect.size.width,s+this._rect.size.height),cc.p(i,s+this._rect.size.height)];cc.drawingUtil.drawPoly(o,4,!0)}else if(cc.SPRITE_DEBUG_DRAW===2){t.strokeStyle="rgba(0,255,0,1)";var u=this._rect.size,a=this.getOffsetPosition(),f=[cc.p(a.x,a.y),cc.p(a.x+u.width,a.y),cc.p(a.x+u.width,a.y+u.height),cc.p(a.x,a.y+u.height)];cc.drawingUtil.drawPoly(f,4,!0)}cc.g_NumberOfDraws++}}),cc.SpriteCanvas.createWithTexture=function(e,t,n){var r=arguments.length,i=new cc.SpriteCanvas;switch(r){case 1:if(i&&i.initWithTexture(e))return i;return null;case 2:if(i&&i.initWithTexture(e,t))return i;return null;case 3:return cc.Assert(0,""),null;default:throw"Sprite.createWithTexture(): Argument must be non-nil "}},cc.SpriteCanvas.create=function(e,t){var n=arguments.length,r=new cc.SpriteCanvas;if(n===0){if(r.init())return r}else if(r&&r.init(e,t))return r;return null},cc.SpriteCanvas.createWithSpriteFrameName=function(e){var t=null;if(typeof e!="string")return cc.log("Invalid argument. Expecting string."),null;t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);if(!t)return cc.log("Invalid spriteFrameName: "+e),null;var n=new cc.SpriteCanvas;return n&&n.initWithSpriteFrame(t)?n:null},cc.SpriteCanvas.createWithSpriteFrame=function(e){var t=new cc.SpriteCanvas;return t&&t.initWithSpriteFrame(e)?t:null},cc.SpriteWebGL=cc.Node.extend({RGBAProtocol:!0,_textureAtlas:null,_atlasIndex:0,_batchNode:null,_dirty:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_color:null,_rect:cc.rect(0,0,0,0),_rectRotated:null,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,colorUnmodified:null,_opacityModifyRGB:null,_flipX:null,_flipY:null,_opacity:255,isDirty:function(){return this._dirty},setDirty:function(e){this._dirty=e},getQuad:function(){return null},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this._atlasIndex},setAtlasIndex:function(e){this._atlasIndex=e},getTextureRect:function(){return cc.rect(this._rect.origin.x,this._rect.origin.y,this._rect.size.width,this._rect.size.height)},getTextureAtlas:function(e){return this._textureAtlas},setTextureAtlas:function(e){this._textureAtlas=e},getSpriteBatchNode:function(){return this._batchNode},setSpriteBatchNode:function(e){this._batchNode=e},getOffsetPosition:function(){return cc.p(this._offsetPosition.x,this._offsetPosition.y)},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(e){cc.Assert(e!=null,"");var t=this.initWithTexture(e.getTexture(),e.getRect());return this.setDisplayFrame(e),t},initWithSpriteFrameName:function(e){cc.Assert(e!=null,"");var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);return this.initWithSpriteFrame(t)},useBatchNode:function(e){this._textureAtlas=e.getTextureAtlas(),this._batchNode=e},setVertexRect:function(e){this._rect=e},sortAllChildren:function(){if(this._reorderChildDirty){var e,t=null;for(var n=1;n<this._children.length;n++){t=this._children[n],e=n-1;while(e>=0&&(t.getZOrder()<this._children[e].getZOrder()||t.getZOrder()==this._children[e].getZOrder()&&t.getOrderOfArrival()<this._children[e].getOrderOfArrival()))this._children[e+1]=this._children[e],e-=1;this._children[e+1]=t}this._batchNode&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(e,t){cc.Assert(e!=null,"child is null"),cc.Assert(this._children.indexOf(e)>-1,"this child is not in children list");if(t===e.getZOrder())return;this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),this._super(e,t)},removeChild:function(e,t){this._batchNode&&this._batchNode.removeSpriteFromAtlas(e),this._super(e,t)},removeAllChildren:function(e){if(this._batchNode&&this._children!=null)for(var t=0;t<this._children.length;t++)this._children[t]instanceof cc.Sprite&&this._batchNode.removeSpriteFromAtlas(this._children[t]);this._super(e),this._hasChildren=!1},setDirtyRecursively:function(e){this._recursiveDirty=e,this.setDirty(e);if(this._children!=null)for(var t=0;t<this._children.length;t++)this._children[t]instanceof cc.Sprite&&this._children[t].setDirtyRecursively(!0)},SET_DIRTY_RECURSIVELY:function(){this._batchNode&&!this._recursiveDirty&&(this._recursiveDirty=!0,this._dirty=!0,this._hasChildren&&this.setDirtyRecursively(!0))},setPosition:function(e){arguments.length>=2?cc.Node.prototype.setPosition.call(this,e,arguments[1]):cc.Node.prototype.setPosition.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotation:function(e){cc.Node.prototype.setRotation.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotationX:function(e){cc.Node.prototype.setRotationX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotationY:function(e){cc.Node.prototype.setRotationY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setSkewX:function(e){cc.Node.prototype.setSkewX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setSkewY:function(e){cc.Node.prototype.setSkewY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScaleX:function(e){cc.Node.prototype.setScaleX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScaleY:function(e){cc.Node.prototype.setScaleY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScale:function(e,t){cc.Node.prototype.setScale.call(this,e,t),this.SET_DIRTY_RECURSIVELY()},setVertexZ:function(e){cc.Node.prototype.setVertexZ.call(this,e),this.SET_DIRTY_RECURSIVELY()},setAnchorPoint:function(e){cc.Node.prototype.setAnchorPoint.call(this,e),this.SET_DIRTY_RECURSIVELY()},setVisible:function(e){cc.Node.prototype.setVisible.call(this,e),this.SET_DIRTY_RECURSIVELY()},ignoreAnchorPointForPosition:function(e){cc.Assert(!this._batchNode,"ignoreAnchorPointForPosition is invalid in cc.Sprite"),this._super(e)},setFlipX:function(e){this._flipX!=e&&(this._flipX=e,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty())},setFlipY:function(e){this._flipY!=e&&(this._flipY=e,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty())},isFlippedX:function(){return this._flipX},isFlippedY:function(){return this._flipY},getOpacity:function(){return this._opacity},getColor:function(){return this._opacityModifyRGB?new cc.Color3B(this._colorUnmodified):new cc.Color3B(this._color)},setOpacityModifyRGB:function(e){var t=this._color;this._opacityModifyRGB=e,this._color=t},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(e,t){cc.Assert(e,"cc.Sprite#setDisplayFrameWithAnimationName. animationName must not be null");var n=cc.AnimationCache.getInstance().getAnimation(e);cc.Assert(n,"cc.Sprite#setDisplayFrameWithAnimationName: Frame not found");var r=n.getFrames()[t];cc.Assert(r,"cc.Sprite#setDisplayFrame. Invalid frame"),this.setDisplayFrame(r.getSpriteFrame())},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;var e=this._parent;while(e&&e!=this._batchNode)e._setReorderChildDirtyRecursively(),e=e.getParent()}},getTexture:function(){return this._texture},_quad:null,_quadWebBuffer:null,_quadDirty:!1,ctor:function(e){this._super(),this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._color=cc.white(),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._quad=new cc.V3F_C4B_T2F_Quad,this._quadWebBuffer=cc.renderContext.createBuffer(),this._quadDirty=!0;if(e)if(typeof e=="string"){var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);this.initWithSpriteFrame(t)}else if(typeof e=="object")if(e instanceof cc.SpriteFrame)this.initWithSpriteFrame(e);else if(e instanceof cc.SpriteBatchNode){if(arguments.length>1){var n=arguments[1];n instanceof cc.Rect&&this.initWithBatchNode(e,n)}}else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var r=new cc.Texture2D;r.initWithElement(e),r.handleLoadedTexture(),this.initWithTexture(r)}else e instanceof cc.Texture2D&&this.initWithTexture(e)},getQuad:function(){return this._quad},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t}},init:function(){return arguments.length>0?this.initWithFile(arguments[0],arguments[1]):(this._super(),this._dirty=this._recursiveDirty=!1,this._opacityModifyRGB=!0,this._opacity=255,this._color=cc.white(),this._colorUnmodified=cc.white(),this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setTexture(null),this._flipX=this._flipY=!1,this.setAnchorPoint(cc.p(.5,.5)),this._offsetPosition=cc.PointZero(),this._hasChildren=!1,this._quad.bl.colors=new cc.Color4B(255,255,255,255),this._quad.br.colors=new cc.Color4B(255,255,255,255),this._quad.tl.colors=new cc.Color4B(255,255,255,255),this._quad.tr.colors=new cc.Color4B(255,255,255,255),this._quadDirty=!0,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),this.setTextureRect(cc.RectZero(),!1,cc.SizeZero()),!0)},initWithFile:function(e,t){cc.Assert(e!=null,"Sprite#initWithFile():Invalid filename for sprite");var n=this,r=cc.TextureCache.getInstance().textureForKey(cc.FileUtils.getInstance().fullPathForFilename(e));if(!r){this._visible=!1;var i=new Image;return i.addEventListener("load",function(){t||(t=cc.rect(0,0,i.width,i.height));var r=new cc.Texture2D;r.initWithElement(i),r.handleLoadedTexture(),n.initWithTexture(r,t),cc.TextureCache.getInstance().cacheImage(e,i),n._visible=!0}),i.addEventListener("error",function(){cc.log("load failure:"+e)}),i.src=e,!0}if(r){if(!t){var s=r.getContentSize();t=cc.rect(0,0,s.width,s.height)}return this.initWithTexture(r,t)}return!1},initWithTexture:function(e,t,n){var r=arguments.length;if(r==0)throw"Sprite.initWithTexture(): Argument must be non-nil ";n=n||!1,this._batchNode=null,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),this._recursiveDirty=!1,this.setDirty(!1),this._opacityModifyRGB=!0,this._opacity=255,this._color=cc.white(),this._colorUnmodified=cc.white(),this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._flipX=this._flipY=!1,this.setAnchorPoint(cc.p(.5,.5)),this._offsetPosition=cc.p(0,0),this._hasChildren=!1;var i=new cc.Color4B(255,255,255,255);return this._quad.bl.colors=i,this._quad.br.colors=i,this._quad.tl.colors=i,this._quad.tr.colors=i,t||(t=cc.rect(0,0,0,0),t.size=e.getContentSize()),this.setTexture(e),this.setTextureRect(t,n,t.size),this.setBatchNode(null),this._quadDirty=!0,!0},setTextureRect:function(e,t,n){this._rectRotated=t||!1,n=n||e.size,this.setContentSize(n),this.setVertexRect(e),this._setTextureCoords(e);var r=this._unflippedOffsetPositionFromCenter;this._flipX&&(r.x=-r.x),this._flipY&&(r.y=-r.y),this._offsetPosition.x=r.x+(this._contentSize.width-this._rect.size.width)/2,this._offsetPosition.y=r.y+(this._contentSize.height-this._rect.size.height)/2;if(this._batchNode)this._dirty=!0;else{var i=0+this._offsetPosition.x,s=0+this._offsetPosition.y,o=i+this._rect.size.width,u=s+this._rect.size.height;this._quad.bl.vertices={x:i,y:s,z:0},this._quad.br.vertices={x:o,y:s,z:0},this._quad.tl.vertices={x:i,y:u,z:0},this._quad.tr.vertices={x:o,y:u,z:0},this._quadDirty=!0}},updateTransform:function(){if(this.isDirty()){if(!this._visible||this._parent&&this._parent!=this._batchNode&&this._parent._shouldBeHidden)this._quad.br.vertices={x:0,y:0,z:0},this._quad.tl.vertices={x:0,y:0,z:0},this._quad.tr.vertices={x:0,y:0,z:0},this._quad.bl.vertices={x:0,y:0,z:0},this._shouldBeHidden=!0;else{this._shouldBeHidden=!1,!this._parent||this._parent==this._batchNode?this._transformToBatch=this.nodeToParentTransform():this._transformToBatch=cc.AffineTransformConcat(this.nodeToParentTransform(),this._parent._transformToBatch);var e=this._rect.size,t=this._offsetPosition.x,n=this._offsetPosition.y,r=t+e.width,i=n+e.height,s=this._transformToBatch.tx,o=this._transformToBatch.ty,u=this._transformToBatch.a,a=this._transformToBatch.b,f=this._transformToBatch.d,l=-this._transformToBatch.c,c=t*u-n*l+s,h=t*a+n*f+o,p=r*u-n*l+s,d=r*a+n*f+o,v=r*u-i*l+s,m=r*a+i*f+o,g=t*u-i*l+s,y=t*a+i*f+o;this._quad.bl.vertices={x:cc.RENDER_IN_SUBPIXEL(c),y:cc.RENDER_IN_SUBPIXEL(h),z:this._vertexZ},this._quad.br.vertices={x:cc.RENDER_IN_SUBPIXEL(p),y:cc.RENDER_IN_SUBPIXEL(d),z:this._vertexZ},this._quad.tl.vertices={x:cc.RENDER_IN_SUBPIXEL(g),y:cc.RENDER_IN_SUBPIXEL(y),z:this._vertexZ},this._quad.tr.vertices={x:cc.RENDER_IN_SUBPIXEL(v),y:cc.RENDER_IN_SUBPIXEL(m),z:this._vertexZ}}cc.renderContextType===cc.WEBGL&&this._textureAtlas.updateQuad(this._quad,this._atlasIndex),this._recursiveDirty=!1,this.setDirty(!1)}this._hasChildren&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform);if(cc.SPRITE_DEBUG_DRAW){var b=[cc.p(this._quad.bl.vertices.x,this._quad.bl.vertices.y),cc.p(this._quad.br.vertices.x,this._quad.br.vertices.y),cc.p(this._quad.tr.vertices.x,this._quad.tr.vertices.y),cc.p(this._quad.tl.vertices.x,this._quad.tl.vertices.y)];cc.drawingUtil.drawPoly(b,4,!0)}},addChild:function(e,t,n){cc.Assert(e!=null,"Argument must be non-NULL"),t==null&&(t=e._zOrder),n==null&&(n=e._tag),this._batchNode&&(cc.Assert(e instanceof cc.Sprite,"cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode"),cc.Assert(e.getTexture()._webTextureObj===this._textureAtlas.getTexture()._webTextureObj,""),this._batchNode.appendChild(e),this._reorderChildDirty||this._setReorderChildDirtyRecursively()),this._super(e,t,n),this._hasChildren=!0},updateColor:function(){var e={r:this._color.r,g:this._color.g,b:this._color.b,a:this._opacity};this._quad.bl.colors=e,this._quad.br.colors=e,this._quad.tl.colors=e,this._quad.tr.colors=e,this._batchNode&&(this._atlasIndex!=cc.SPRITE_INDEX_NOT_INITIALIZED?this._textureAtlas.updateQuad(this._quad,this._atlasIndex):this._dirty=!0),this._quadDirty=!0},setOpacity:function(e){this._opacity=e,this._opacityModifyRGB&&this.setColor(this._colorUnmodified),this.updateColor()},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=this._colorUnmodified=new cc.Color3B(e.r,e.g,e.b),this._opacityModifyRGB&&(this._color.r=0|e.r*this._opacity/255,this._color.g=0|e.g*this._opacity/255,this._color.b=0|e.b*this._opacity/255),this.updateColor()},setDisplayFrame:function(e){this.setNodeDirty(),this._unflippedOffsetPositionFromCenter=e.getOffset();var t=e.getTexture();t!=this._texture&&this.setTexture(t),this._rectRotated=e.isRotated(),this.setTextureRect(e.getRect(),this._rectRotated,e.getOriginalSize())},isFrameDisplayed:function(e){return cc.Rect.CCRectEqualToRect(e.getRect(),this._rect)&&e.getTexture().getName()==this._texture.getName()&&cc.Point.CCPointEqualToPoint(e.getOffset(),this._unflippedOffsetPositionFromCenter)},displayFrame:function(){return cc.SpriteFrame.createWithTexture(this._texture,cc.RECT_POINTS_TO_PIXELS(this._rect),this._rectRotated,this._unflippedOffsetPositionFromCenter,cc.SIZE_POINTS_TO_PIXELS(this._contentSize))},setBatchNode:function(e){this._batchNode=e;if(!this._batchNode){this._atlasIndex=cc.SPRITE_INDEX_NOT_INITIALIZED,this.setTextureAtlas(null),this._recursiveDirty=!1,this.setDirty(!1);var t=this._offsetPosition.x,n=this._offsetPosition.y,r=t+this._rect.size.width,i=n+this._rect.size.height;this._quad.bl.vertices={x:t,y:n,z:0},this._quad.br.vertices={x:r,y:n,z:0},this._quad.tl.vertices={x:t,y:i,z:0},this._quad.tr.vertices={x:r,y:i,z:0},this._quadDirty=!0}else this._transformToBatch=cc.AffineTransformIdentity(),this.setTextureAtlas(this._batchNode.getTextureAtlas())},setTexture:function(e){cc.Assert(!e||e instanceof cc.Texture2D,"setTexture expects a CCTexture2D. Invalid argument"),cc.Assert(!this._batchNode,"cc.Sprite: Batched sprites should use the same texture as the batchnode"),!this._batchNode&&this._texture!=e&&(this._texture=e,this._updateBlendFunc())},_updateBlendFunc:function(){cc.Assert(!this._batchNode,"cc.Sprite: _updateBlendFunc doesn't work when the sprite is rendered using a cc.SpriteSheet"),!this._texture||!this._texture.hasPremultipliedAlpha()?(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA,this.setOpacityModifyRGB(!1)):(this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setOpacityModifyRGB(!0))},_setTextureCoords:function(e){e=cc.RECT_POINTS_TO_PIXELS(e);var t=this._batchNode?this._textureAtlas.getTexture():this._texture;if(!t)return;var n=t.getPixelsWide(),r=t.getPixelsHigh(),i,s,o,u,a;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.origin.x+1)/(2*n),s=i+(e.size.height*2-2)/(2*n),o=(2*e.origin.y+1)/(2*r),u=o+(e.size.width*2-2)/(2*r)):(i=e.origin.x/n,s=(e.origin.x+e.size.height)/n,o=e.origin.y/r,u=(e.origin.y+e.size.width)/r),this._flipX&&(a=o,o=u,u=a),this._flipY&&(a=i,i=s,s=a),this._quad.bl.texCoords.u=i,this._quad.bl.texCoords.v=o,this._quad.br.texCoords.u=i,this._quad.br.texCoords.v=u,this._quad.tl.texCoords.u=s,this._quad.tl.texCoords.v=o,this._quad.tr.texCoords.u=s,this._quad.tr.texCoords.v=u):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.origin.x+1)/(2*n),s=i+(e.size.width*2-2)/(2*n),o=(2*e.origin.y+1)/(2*r),u=o+(e.size.height*2-2)/(2*r)):(i=e.origin.x/n,s=(e.origin.x+e.size.width)/n,o=e.origin.y/r,u=(e.origin.y+e.size.height)/r),this._flipX&&(a=i,i=s,s=a),this._flipY&&(a=o,o=u,u=a),this._quad.bl.texCoords.u=i,this._quad.bl.texCoords.v=u,this._quad.br.texCoords.u=s,this._quad.br.texCoords.v=u,this._quad.tl.texCoords.u=i,this._quad.tl.texCoords.v=o,this._quad.tr.texCoords.u=s,this._quad.tr.texCoords.v=o),this._quadDirty=!0},draw:function(e){var t=e||cc.renderContext;if(this._texture)this._texture._isLoaded&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewProjectionMatrixWithMat4(this._mvpMatrix),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(this._texture),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX),t.bindBuffer(t.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(t.bufferData(t.ARRAY_BUFFER,this._quad.arrayBuffer,t.STATIC_DRAW),this._quadDirty=!1),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.drawArrays(t.TRIANGLE_STRIP,0,4));else{var n=cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_COLOR);n.use(),n.setUniformForModelViewProjectionMatrixWithMat4(this._mvpMatrix),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(null),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),t.bindBuffer(t.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(cc.renderContext.bufferData(cc.renderContext.ARRAY_BUFFER,this._quad.arrayBuffer,cc.renderContext.STATIC_DRAW),this._quadDirty=!1),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.drawArrays(t.TRIANGLE_STRIP,0,4)}if(cc.SPRITE_DEBUG_DRAW===1){var r=[cc.p(this._quad.tl.vertices.x,this._quad.tl.vertices.y),cc.p(this._quad.bl.vertices.x,this._quad.bl.vertices.y),cc.p(this._quad.br.vertices.x,this._quad.br.vertices.y),cc.p(this._quad.tr.vertices.x,this._quad.tr.vertices.y)];cc.drawingUtil.drawPoly(r,4,!0)}else if(cc.SPRITE_DEBUG_DRAW===2){var i=this.getTextureRect().size,s=this.getOffsetPosition(),o=[cc.p(s.x,s.y),cc.p(s.x+i.width,s.y),cc.p(s.x+i.width,s.y+i.height),cc.p(s.x,s.y+i.height)];cc.drawingUtil.drawPoly(o,4,!0)}cc.g_NumberOfDraws++}}),cc.SpriteWebGL.createWithTexture=function(e,t,n){var r=arguments.length,i=new cc.SpriteWebGL;switch(r){case 1:if(i&&i.initWithTexture(e))return i;return null;case 2:if(i&&i.initWithTexture(e,t))return i;return null;case 3:return cc.Assert(0,""),null;default:throw"Sprite.createWithTexture(): Argument must be non-nil "}},cc.SpriteWebGL.create=function(e,t){var n=arguments.length,r=new cc.SpriteWebGL;if(n===0){if(r.init())return r}else if(r&&r.init(e,t))return r;return null},cc.SpriteWebGL.createWithSpriteFrameName=function(e){var t=null;if(typeof e!="string")return cc.log("Invalid argument. Expecting string."),null;t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);if(!t)return cc.log("Invalid spriteFrameName: "+e),null;var n=new cc.SpriteWebGL;return n&&n.initWithSpriteFrame(t)?n:null},cc.SpriteWebGL.createWithSpriteFrame=function(e){var t=new cc.SpriteWebGL;return t&&t.initWithSpriteFrame(e)?t:null},cc.Sprite=cc.Browser.supportWebGL?cc.SpriteWebGL:cc.SpriteCanvas;cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(){this._delayPerUnit=0},copyWithZone:function(e){return cc.clone(this)},copy:function(e){var t=new cc.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.copy(),this._delayPerUnit,this._userInfo),t},initWithSpriteFrame:function(e,t,n){return this.setSpriteFrame(e),this.setDelayUnits(t),this.setUserInfo(n),!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(e){this._spriteFrame=e},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(e){this._delayPerUnit=e},getUserInfo:function(){return this._userInfo},setUserInfo:function(e){this._userInfo=e}}),cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(){this._frames=[]},getFrames:function(){return this._frames},setFrames:function(e){this._frames=e},addSpriteFrame:function(e){var t=new cc.AnimationFrame;t.initWithSpriteFrame(e,1,null),this._frames.push(t),this._totalDelayUnits++},addSpriteFrameWithFile:function(e){var t=cc.TextureCache.getInstance().addImage(e),n=cc.RectZero();t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?n.size=cc.size(t.width,t.height):n.size=t.getContentSize();var r=cc.SpriteFrame.createWithTexture(t,n);this.addSpriteFrame(r)},addSpriteFrameWithTexture:function(e,t){var n=cc.SpriteFrame.createWithTexture(e,t);this.addSpriteFrame(n)},initWithAnimationFrames:function(e,t,n){cc.ArrayVerifyType(e,cc.AnimationFrame),this._delayPerUnit=t,this._loops=n,this.setFrames([]);for(var r=0;r<e.length;r++){var i=e[r];this._frames.push(i),this._totalDelayUnits+=i.getDelayUnits()}return!0},copyWithZone:function(e){var t=new cc.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},_copyFrames:function(){var e=[];for(var t=0;t<this._frames.length;t++)e.push(this._frames[t].copy());return e},copy:function(e){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(e){this._loops=e},setRestoreOriginalFrame:function(e){this._restoreOriginalFrame=e},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(e){this._delayPerUnit=e},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(e,t){cc.ArrayVerifyType(e,cc.SpriteFrame),this._loops=1,t=t||0,this._delayPerUnit=t;var n=[];this.setFrames(n);if(e)for(var r=0;r<e.length;r++){var i=e[r],s=new cc.AnimationFrame;s.initWithSpriteFrame(i,1,null),this._frames.push(s),this._totalDelayUnits++}return!0}}),cc.Animation.create=function(e,t,n){var r=arguments.length,i=new cc.Animation;return r==0?i.initWithSpriteFrames(null,0):r==2?(t=t||0,i.initWithSpriteFrames(e,t)):r==3&&i.initWithAnimationFrames(e,t,n),i},cc.Animation.createWithAnimationFrames=function(e,t,n){var r=new cc.Animation;return r.initWithAnimationFrames(e,t,n),r};cc.AnimationCache=cc.Class.extend({addAnimation:function(e,t){this._animations[t]=e},removeAnimation:function(e){if(!e)return;this._animations.hasOwnProperty(e)&&delete this._animations[e]},getAnimation:function(e){return this._animations.hasOwnProperty(e)?this._animations[e]:null},addAnimationsWithDictionary:function(e){var t=e.animations;if(!t){cc.log("cocos2d: cc.AnimationCache: No animations were found in provided dictionary.");return}var n=1,r=e.properties;if(r){n=r["format"]!=null?parseInt(r.format):n;var i=r.spritesheets;for(var s=0;s<i.length;s++)cc.SpriteFrameCache.getInstance().addSpriteFrames(i[s])}switch(n){case 1:this._parseVersion1(t);break;case 2:this._parseVersion2(t);break;default:cc.Assert(!1,"Invalid animation format")}},addAnimations:function(e){cc.Assert(e,"Invalid texture file name");var t=cc.FileUtils.getInstance().fullPathFromRelativePath(e),n=cc.FileUtils.getInstance().dictionaryWithContentsOfFileThreadSafe(t);cc.Assert(n,"cc.AnimationCache: File could not be found"),this.addAnimationsWithDictionary(n)},_parseVersion1:function(e){var t=cc.SpriteFrameCache.getInstance();for(var n in e){var r=e[n],i=r.frames,s=parseFloat(r.delay)||0,o=null;if(!i){cc.log("cocos2d: cc.AnimationCache: Animation '"+n+"' found in dictionary without any frames - cannot add to animation cache.");continue}var u=[];for(var a=0;a<i.length;a++){var f=t.getSpriteFrame(i[a]);if(!f){cc.log("cocos2d: cc.AnimationCache: Animation '"+n+"' refers to frame '"+i[a]+"' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.");continue}var l=new cc.AnimationFrame;l.initWithSpriteFrame(f,1,null),u.push(l)}if(u.length===0){cc.log("cocos2d: cc.AnimationCache: None of the frames for animation '"+n+"' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.");continue}u.length!=i.length&&cc.log("cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '"+n+"' may be missing."),o=cc.Animation.createWithAnimationFrames(u,s,1),cc.AnimationCache.getInstance().addAnimation(o,n)}},_parseVersion2:function(e){var t=cc.SpriteFrameCache.getInstance();for(var n in e){var r=e[n],i=parseInt(r.loops),s=isNaN(i)?1:i,o=r.restoreOriginalFrame&&r["restoreOriginalFrame"]==1?!0:!1,u=r.frames;if(!u){cc.log("cocos2d: CCAnimationCache: Animation '"+n+"' found in dictionary without any frames - cannot add to animation cache.");continue}var a=[];for(var f=0;f<u.length;f++){var l=u[f],c=l.spriteframe,h=t.getSpriteFrame(c);if(!h){cc.log("cocos2d: cc.AnimationCache: Animation '"+n+"' refers to frame '"+c+"' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.");continue}var p=parseFloat(l.delayUnits)||0,d=l.notification,v=new cc.AnimationFrame;v.initWithSpriteFrame(h,p,d),a.push(v)}var m=parseFloat(r.delayPerUnit)||0,g=new cc.Animation;g.initWithAnimationFrames(a,m,s),g.setRestoreOriginalFrame(o),cc.AnimationCache.getInstance().addAnimation(g,n)}},init:function(){return this._animations={},!0},_animations:null}),cc.AnimationCache.purgeSharedAnimationCache=function(){cc.s_sharedAnimationCache&&(cc.s_sharedAnimationCache._animations=null,cc.s_sharedAnimationCache=null)},cc.AnimationCache.getInstance=function(){return cc.s_sharedAnimationCache===null&&(cc.s_sharedAnimationCache=new cc.AnimationCache,cc.s_sharedAnimationCache.init()),cc.s_sharedAnimationCache},cc.s_sharedAnimationCache=null;cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:null,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",ctor:function(){this._offset=cc.p(0,0),this._offsetInPixels=cc.p(0,0),this._originalSize=cc.size(0,0),this._rectInPixels=cc.rect(0,0,0,0),this._rect=cc.rect(0,0,0,0),this._originalSizeInPixels=cc.size(0,0),this._textureFilename=""},getRectInPixels:function(){return this._rectInPixels},setRectInPixels:function(e){this._rectInPixels=e,this._rect=cc.RECT_PIXELS_TO_POINTS(e)},isRotated:function(){return this._rotated},setRotated:function(e){this._rotated=e},getRect:function(){return this._rect},setRect:function(e){this._rect=e,this._rectInPixels=cc.RECT_POINTS_TO_PIXELS(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels.x,this._offsetInPixels.y)},setOffsetInPixels:function(e){this._offsetInPixels=e,this._offset=cc.POINT_PIXELS_TO_POINTS(this._offsetInPixels)},getOriginalSizeInPixels:function(){return this._originalSizeInPixels},setOriginalSizeInPixels:function(e){this._originalSizeInPixels=e},getOriginalSize:function(){return cc.size(this._originalSize.width,this._originalSize.height)},setOriginalSize:function(e){this._originalSize=e},getTexture:function(){return this._texture?this._texture:this._textureFilename!==""?cc.TextureCache.getInstance().addImage(this._textureFilename):null},setTexture:function(e){this._texture!=e&&(this._texture=e)},getOffset:function(){return cc.p(this._offset.x,this._offset.y)},setOffset:function(e){this._offset=e},copyWithZone:function(){var e=new cc.SpriteFrame;return e.initWithTextureFilename(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),e.setTexture(this._texture),e},copy:function(){return this.copyWithZone()},initWithTexture:function(e,t,n,r,i){var s=arguments.length;switch(s){case 2:var o=cc.RECT_POINTS_TO_PIXELS(t);return this.initWithTexture(e,o,!1,cc.PointZero(),o.size);case 5:return this._texture=e,this._rectInPixels=t,this._rect=cc.RECT_PIXELS_TO_POINTS(t),this._offsetInPixels=r,this._offset=cc.POINT_PIXELS_TO_POINTS(this._offsetInPixels),this._originalSizeInPixels=i,this._originalSize=cc.SIZE_PIXELS_TO_POINTS(this._originalSizeInPixels),this._rotated=n,!0;default:throw"Argument must be non-nil "}},initWithTextureFilename:function(e,t,n,r,i){var s=cc.RECT_POINTS_TO_PIXELS(t);return r=r||cc.size(0,0),i=i||s.size,this._texture=null,this._textureFilename=e,this._rectInPixels=s,this._rect=cc.RECT_PIXELS_TO_POINTS(s),this._rotated=n||!1,this._offsetInPixels=r,this._offset=cc.POINT_PIXELS_TO_POINTS(r),this._originalSizeInPixels=i,this._originalSize=cc.SIZE_PIXELS_TO_POINTS(i),!0}}),cc.SpriteFrame.create=function(e,t,n,r,i){var s=new cc.SpriteFrame;switch(arguments.length){case 2:s.initWithTextureFilename(e,t);break;case 5:s.initWithTextureFilename(e,t,n,r,i);break;default:throw"Argument must be non-nil "}return s},cc.SpriteFrame.createWithTexture=function(e,t,n,r,i){var s=arguments.length,o=new cc.SpriteFrame;switch(s){case 2:o.initWithTexture(e,t);break;case 5:o.initWithTexture(e,t,n,r,i);break;default:throw"Argument must be non-nil "}return o},cc.SpriteFrame._frameWithTextureForCanvas=function(e,t,n,r,i){var s=new cc.SpriteFrame;return s._texture=e,s._rectInPixels=t,s._rect=cc.RECT_PIXELS_TO_POINTS(t),s._offsetInPixels=r,s._offset=cc.POINT_PIXELS_TO_POINTS(s._offsetInPixels),s._originalSizeInPixels=i,s._originalSize=cc.SIZE_PIXELS_TO_POINTS(s._originalSizeInPixels),s._rotated=n,s};cc.SpriteFrameCache=cc.Class.extend({_spriteFrames:null,_spriteFramesAliases:null,_loadedFileNames:null,ctor:function(){this._spriteFrames={},this._spriteFramesAliases={},this._loadedFileNames=[]},_addSpriteFramesWithDictionary:function(e,t){var n=e.metadata,r=e.frames,i=0;n!=null&&(i=parseInt(this._valueForKey("format",n))),cc.Assert(i>=0&&i<=3,"format is not supported for cc.SpriteFrameCache addSpriteFramesWithDictionary:textureFilename:");for(var s in r){var o=r[s];if(o){var u=this._spriteFrames[s];if(u)continue;if(i==0){var a=parseFloat(this._valueForKey("x",o)),f=parseFloat(this._valueForKey("y",o)),l=parseFloat(this._valueForKey("width",o)),c=parseFloat(this._valueForKey("height",o)),h=parseFloat(this._valueForKey("offsetX",o)),p=parseFloat(this._valueForKey("offsetY",o)),d=parseInt(this._valueForKey("originalWidth",o)),v=parseInt(this._valueForKey("originalHeight",o));(!d||!v)&&cc.log("cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist"),d=Math.abs(d),v=Math.abs(v),u=new cc.SpriteFrame,u.initWithTexture(t,cc.rect(a,f,l,c),!1,cc.p(h,p),cc.size(d,v))}else if(i==1||i==2){var m=cc.RectFromString(this._valueForKey("frame",o)),g=!1;i==2&&(g=this._valueForKey("rotated",o)=="true");var y=cc.PointFromString(this._valueForKey("offset",o)),b=cc.SizeFromString(this._valueForKey("sourceSize",o));u=new cc.SpriteFrame,u.initWithTexture(t,m,g,y,b)}else if(i==3){var w,E,S,x,T;w=cc.SizeFromString(this._valueForKey("spriteSize",o)),E=cc.PointFromString(this._valueForKey("spriteOffset",o)),S=cc.SizeFromString(this._valueForKey("spriteSourceSize",o)),x=cc.RectFromString(this._valueForKey("textureRect",o)),T=this._valueForKey("textureRotated",o)=="true";var N=o.aliases,C=s.toString();for(var k in N)this._spriteFramesAliases.hasOwnProperty(N[k])&&cc.log("cocos2d: WARNING: an alias with name "+k+" already exists"),this._spriteFramesAliases[N[k]]=C;u=new cc.SpriteFrame,o.hasOwnProperty("spriteSize")?u.initWithTexture(t,cc.rect(x.origin.x,x.origin.y,w.width,w.height),T,E,S):u.initWithTexture(t,w,T,E,S)}if(cc.renderContextType===cc.CANVAS&&u.isRotated()){var L=cc.cutRotateImageToCanvas(u.getTexture(),u.getRect()),A=u.getRect();u.setRect(cc.rect(0,0,A.size.width,A.size.height)),u.setTexture(L)}this._spriteFrames[s]=u}}},addSpriteFramesWithJson:function(e){var t=e,n="",r=t.metadata;r&&(n=this._valueForKey("textureFileName",r),n=n.toString());var i=cc.TextureCache.getInstance().addImage(n);i?this._addSpriteFramesWithDictionary(t,i):cc.log("cocos2d: cc.SpriteFrameCache: Couldn't load texture")},addSpriteFrames:function(e,t){var n=cc.FileUtils.getInstance().dictionaryWithContentsOfFileThreadSafe(e);switch(arguments.length){case 1:cc.Assert(e,"plist filename should not be NULL");if(!cc.ArrayContainsObject(this._loadedFileNames,e)){var r="",i=n.metadata;i&&(r=this._valueForKey("textureFileName",i).toString());if(r!=""){var s=e.lastIndexOf("/"),o;o=s?e.substring(0,s+1):"",r=o+r}else{r=e;var u=r.lastIndexOf(".",r.length);r=r.substr(0,u),r+=".png"}var a=cc.TextureCache.getInstance().addImage(r);a?this._addSpriteFramesWithDictionary(n,a):cc.log("cocos2d: cc.SpriteFrameCache: Couldn't load texture")}break;case 2:if(t instanceof cc.Texture2D||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)this._addSpriteFramesWithDictionary(n,t);else{var f=t;cc.Assert(f,"texture name should not be null");var l=cc.TextureCache.getInstance().addImage(f);l?this._addSpriteFramesWithDictionary(n,l):cc.log("cocos2d: cc.SpriteFrameCache: couldn't load texture file. File not found "+f)}break;default:throw"Argument must be non-nil "}},addSpriteFrame:function(e,t){this._spriteFrames[t]=e},removeSpriteFrames:function(){this._spriteFrames=[],this._spriteFramesAliases=[],this._loadedFileNames={}},removeSpriteFrameByName:function(e){if(!e)return;this._spriteFramesAliases.hasOwnProperty(e)&&delete this._spriteFramesAliases[e],this._spriteFrames.hasOwnProperty(e)&&delete this._spriteFrames[e],this._loadedFileNames={}},removeSpriteFramesFromFile:function(e){var t=cc.FileUtils.getInstance().fullPathFromRelativePath(e),n=cc.FileUtils.getInstance().dictionaryWithContentsOfFileThreadSafe(t);this._removeSpriteFramesFromDictionary(n),cc.ArrayContainsObject(this._loadedFileNames,e)&&cc.ArrayRemoveObject(e)},_removeSpriteFramesFromDictionary:function(e){var t=e.frames;for(var n in t)this._spriteFrames.hasOwnProperty(n)&&delete this._spriteFrames[n]},removeSpriteFramesFromTexture:function(e){for(var t in this._spriteFrames){var n=this._spriteFrames[t];n&&n.getTexture()==e&&delete this._spriteFrames[t]}},getSpriteFrame:function(e){var t;this._spriteFrames.hasOwnProperty(e)&&(t=this._spriteFrames[e]);if(!t){var n;this._spriteFramesAliases.hasOwnProperty(e)&&(n=this._spriteFramesAliases[e]),n&&(this._spriteFrames.hasOwnProperty(n.toString())&&(t=this._spriteFrames[n.toString()]),t||cc.log("cocos2d: cc.SpriteFrameCahce: Frame "+e+" not found"))}return t},_valueForKey:function(e,t){return t&&t.hasOwnProperty(e)?t[e].toString():""}}),cc.s_sharedSpriteFrameCache=null,cc.SpriteFrameCache.getInstance=function(){return cc.s_sharedSpriteFrameCache||(cc.s_sharedSpriteFrameCache=new cc.SpriteFrameCache),cc.s_sharedSpriteFrameCache},cc.SpriteFrameCache.purgeSharedSpriteFrameCache=function(){cc.s_sharedSpriteFrameCache=null};cc.DEFAULT_SPRITE_BATCH_CAPACITY=29,cc.SpriteBatchNodeCanvas=cc.Node.extend({_textureAtlas:null,_blendFunc:null,_descendants:null,addSpriteWithoutQuad:function(e,t,n){cc.Assert(e!=null,"SpriteBatchNode.addQuadFromSprite():Argument must be non-nil"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children"),e.setAtlasIndex(t);var r=0;if(this._descendants&&this._descendants.length>0)for(var i=0;i<this._descendants.length;i++){var s=this._descendants[i];s&&s.getAtlasIndex()>=t&&++r}return this._descendants=cc.ArrayAppendObjectToIndex(this._descendants,e,r),cc.Node.prototype.addChild.call(this,e,t,n),this.reorderBatch(!1),this},getTextureAtlas:function(){return this._textureAtlas},setTextureAtlas:function(e){e!=this._textureAtlas&&(this._textureAtlas=e)},getDescendants:function(){return this._descendants},initWithFile:function(e,t){var n=cc.TextureCache.getInstance().textureForKey(e);return n||(n=cc.TextureCache.getInstance().addImage(e)),this.initWithTexture(n,t)},_setNodeDirtyForCache:function(){this._cacheDirty=!0},init:function(e,t){var n=cc.TextureCache.getInstance().textureForKey(e);return n||(n=cc.TextureCache.getInstance().addImage(e)),this.initWithTexture(n,t)},increaseAtlasCapacity:function(){var e=Math.floor((this._textureAtlas.getCapacity()+1)*4/3);cc.log("cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from "+this._textureAtlas.getCapacity()+" to "+e+"."),this._textureAtlas.resizeCapacity(e)||(cc.log("cocos2d: WARNING: Not enough memory to resize the atlas"),cc.Assert(!1,"Not enough memory to resize the atla"))},removeChildAtIndex:function(e,t){this.removeChild(this._children[e],t)},rebuildIndexInOrder:function(e,t){var n=e.getChildren();if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r];i&&i.getZOrder()<0&&(t=this.rebuildIndexInOrder(i,t))}!e==this&&(e.setAtlasIndex(t),t++);if(n&&n.length>0)for(r=0;r<n.length;r++)i=n[r],i&&i.getZOrder()>=0&&(t=this.rebuildIndexInOrder(i,t));return t},highestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.highestAtlasIndexInChild(t[t.length-1])},lowestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.lowestAtlasIndexInChild(t[t.length-1])},atlasIndexForChild:function(e,t){var n=e.getParent().getChildren(),r=cc.ArrayGetIndexOfObject(n,e),i=e.getParent()==this,s=null;r>0&&r<cc.UINT_MAX&&(s=n[r-1]);if(i)return r==0?0:this.highestAtlasIndexInChild(s)+1;var o;return r==0?(o=e.getParent(),t<0?o.getAtlasIndex():o.getAtlasIndex()+1):s.getZOrder()<0&&t<0||s.getZOrder()>=0&&t>=0?this.highestAtlasIndexInChild(s)+1:(o=e.getParent(),o.getAtlasIndex()+1)},reorderBatch:function(e){this._reorderChildDirty=e},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t}},getBlendFunc:function(){return this._blendFunc},reorderChild:function(e,t){cc.Assert(e!=null,"SpriteBatchNode.addChild():the child should not be null"),cc.Assert(this._children.indexOf(e)>-1,"SpriteBatchNode.addChild():Child doesn't belong to Sprite");if(t===e.getZOrder())return;this._super(e,t),this.setNodeDirty()},removeChild:function(e,t){if(e==null)return;cc.Assert(this._children.indexOf(e)>-1,"SpriteBatchNode.addChild():sprite batch node should contain the child"),this.removeSpriteFromAtlas(e),this._super(e,t)},_textureForCanvas:null,_renderTexture:null,_useCache:!1,_originalTexture:null,ctor:function(e){this._super(),e&&this.init(e,cc.DEFAULT_SPRITE_BATCH_CAPACITY),this._renderTexture=cc.RenderTexture.create(cc.canvas.width,cc.canvas.height),this.setContentSize(cc.size(cc.canvas.width,cc.canvas.height))},updateQuadFromSprite:function(e,t){cc.Assert(e!=null,"SpriteBatchNode.addQuadFromSprite():Argument must be non-nil"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children"),e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),e.updateTransform()},insertQuadFromSprite:function(e,t){cc.Assert(e!=null,"Argument must be non-NULL"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children"),e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),e.updateTransform(),this._children=cc.ArrayAppendObjectToIndex(this._children,e,t)},setContentSize:function(e){if(!e)return;this._super(e),this._renderTexture.setContentSize(e)},initWithTexture:function(e,t){return this._children=[],this._descendants=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this._originalTexture=e,this._textureForCanvas=e,!0},appendChild:function(e){this._reorderChildDirty=!0,e.setBatchNode(this),e.setDirty(!0),cc.ArrayAppendObject(this._descendants,e);var t=this._descendants.length-1;e.setAtlasIndex(t);var n=e.getChildren();for(var r=0;r<n.length;r++)this.appendChild(n[r])},removeSpriteFromAtlas:function(e){e.setBatchNode(null);var t=cc.ArrayGetIndexOfObject(this._descendants,e);if(t!=-1){cc.ArrayRemoveObjectAtIndex(this._descendants,t);var n=this._descendants.length;for(;t<n;++t){var r=this._descendants[t];r.setAtlasIndex(r.getAtlasIndex()-1)}}var i=e.getChildren();if(i&&i.length>0)for(var s=0;s<i.length;s++)i[s]&&this.removeSpriteFromAtlas(i[s])},getTexture:function(){return this._useCache?this._renderTexture.getCanvas():this._textureForCanvas},setTexture:function(e){this._textureForCanvas=e;for(var t=0;t<this._children.length;t++)this._children[t].setTexture(e)},visit:function(e){var t=e||cc.renderContext;if(!this._visible)return;t.save(),this.transform(e);var n;if(this._useCache){if(this._cacheDirty){this._renderTexture.clear(),this._renderTexture.context.save(),this._renderTexture.context.translate(this._anchorPointInPoints.x,-this._anchorPointInPoints.y);if(this._children){this.sortAllChildren();for(n=0;n<this._children.length;n++)this._children[n]&&this._children[n].visit(this._renderTexture.context)}this._renderTexture.context.restore(),this._cacheDirty=!1}this.draw(e)}else if(this._children){this.sortAllChildren();for(n=0;n<this._children.length;n++)this._children[n]&&this._children[n].visit(t)}t.restore()},addChild:function(e,t,n){if(e==null)return;if(arguments.length===4&&arguments[3]==1){this._super(e,t,n),this.setNodeDirty();return}t=t==null?e.getZOrder():t,n=n==null?e.getTag():n,cc.Assert(e!=null,"SpriteBatchNode.addChild():child should not be null"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children"),this._super(e,t,n),this.appendChild(e),this.setNodeDirty()},removeAllChildren:function(e){if(this._descendants&&this._descendants.length>0)for(var t=0;t<this._descendants.length;t++)this._descendants[t]&&this._descendants[t].setBatchNode(null);this._super(e),this._descendants=[]},sortAllChildren:function(){if(this._reorderChildDirty){var e=0,t=0,n=this._children.length;for(e=1;e<n;e++){var r=this._children[e];t=e-1;while(t>=0&&(r.getZOrder()<this._children[t].getZOrder()||r.getZOrder()==this._children[t].getZOrder()&&r.getOrderOfArrival()<this._children[t].getOrderOfArrival()))this._children[t+1]=this._children[t],t--;this._children[t+1]=r}this._children.length>0&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},draw:function(e){var t=e||cc.renderContext,n=cc.p(0|-this._anchorPointInPoints.x,0|-this._anchorPointInPoints.y);this._renderTexture&&t.drawImage(this._renderTexture.getCanvas(),n.x,-(n.y+this._renderTexture.getCanvas().height))}}),cc.SpriteBatchNodeCanvas.create=function(e,t){t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY;var n=new cc.SpriteBatchNodeCanvas;return n.init(e,t),n},cc.SpriteBatchNodeCanvas.createWithTexture=function(e,t){t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY;var n=new cc.SpriteBatchNodeCanvas;return n.initWithTexture(e,t),n},cc.SpriteBatchNodeWebGL=cc.Node.extend({_textureAtlas:null,_blendFunc:null,_descendants:null,addSpriteWithoutQuad:function(e,t,n){cc.Assert(e!=null,"SpriteBatchNode.addQuadFromSprite():Argument must be non-nil"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children"),e.setAtlasIndex(t);var r=0;if(this._descendants&&this._descendants.length>0)for(var i=0;i<this._descendants.length;i++){var s=this._descendants[i];s&&s.getAtlasIndex()>=t&&++r}return this._descendants=cc.ArrayAppendObjectToIndex(this._descendants,e,r),cc.Node.prototype.addChild.call(this,e,t,n),this.reorderBatch(!1),this},getTextureAtlas:function(){return this._textureAtlas},setTextureAtlas:function(e){e!=this._textureAtlas&&(this._textureAtlas=e)},getDescendants:function(){return this._descendants},initWithFile:function(e,t){var n=cc.TextureCache.getInstance().textureForKey(e);return n||(n=cc.TextureCache.getInstance().addImage(e)),this.initWithTexture(n,t)},_setNodeDirtyForCache:function(){this._cacheDirty=!0},init:function(e,t){var n=cc.TextureCache.getInstance().textureForKey(e);return n||(n=cc.TextureCache.getInstance().addImage(e)),this.initWithTexture(n,t)},increaseAtlasCapacity:function(){var e=0|(this._textureAtlas.getCapacity()+1)*4/3;cc.log("cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from "+this._textureAtlas.getCapacity()+" to ["+e+"]."),this._textureAtlas.resizeCapacity(e)||(cc.log("cocos2d: WARNING: Not enough memory to resize the atlas"),cc.Assert(!1,"Not enough memory to resize the atla"))},removeChildAtIndex:function(e,t){this.removeChild(this._children[e],t)},rebuildIndexInOrder:function(e,t){var n=e.getChildren();if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r];i&&i.getZOrder()<0&&(t=this.rebuildIndexInOrder(i,t))}!e==this&&(e.setAtlasIndex(t),t++);if(n&&n.length>0)for(r=0;r<n.length;r++)i=n[r],i&&i.getZOrder()>=0&&(t=this.rebuildIndexInOrder(i,t));return t},highestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.highestAtlasIndexInChild(t[t.length-1])},lowestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.lowestAtlasIndexInChild(t[t.length-1])},atlasIndexForChild:function(e,t){var n=e.getParent().getChildren(),r=cc.ArrayGetIndexOfObject(n,e),i=e.getParent()==this,s=null;r>0&&r<cc.UINT_MAX&&(s=n[r-1]);if(i)return r==0?0:this.highestAtlasIndexInChild(s)+1;var o;return r==0?(o=e.getParent(),t<0?o.getAtlasIndex():o.getAtlasIndex()+1):s.getZOrder()<0&&t<0||s.getZOrder()>=0&&t>=0?this.highestAtlasIndexInChild(s)+1:(o=e.getParent(),o.getAtlasIndex()+1)},reorderBatch:function(e){this._reorderChildDirty=e},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t}},getBlendFunc:function(){return this._blendFunc},reorderChild:function(e,t){cc.Assert(e!=null,"SpriteBatchNode.addChild():the child should not be null"),cc.Assert(this._children.indexOf(e)>-1,"SpriteBatchNode.addChild():Child doesn't belong to Sprite");if(t===e.getZOrder())return;this._super(e,t),this.setNodeDirty()},removeChild:function(e,t){if(e==null)return;cc.Assert(this._children.indexOf(e)>-1,"SpriteBatchNode.addChild():sprite batch node should contain the child"),this.removeSpriteFromAtlas(e),this._super(e,t)},ctor:function(e){this._super(),e&&this.init(e,cc.DEFAULT_SPRITE_BATCH_CAPACITY)},updateQuadFromSprite:function(e,t){cc.Assert(e!=null,"SpriteBatchNode.addQuadFromSprite():Argument must be non-nil"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children");while(t>=this._textureAtlas.getCapacity()||this._textureAtlas.getCapacity()==this._textureAtlas.getTotalQuads())this.increaseAtlasCapacity();e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),e.updateTransform()},_swap:function(e,t){var n=this._textureAtlas.getQuads(),r=this._descendants[e],i=n[e];this._descendants[t].setAtlasIndex(e),this._descendants[e]=this._descendants[t],this._textureAtlas.updateQuad(n[t],e),this._descendants[t]=r,this._textureAtlas.updateQuad(i,t)},insertQuadFromSprite:function(e,t){cc.Assert(e!=null,"Argument must be non-NULL"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children");while(t>=this._textureAtlas.getCapacity()||this._textureAtlas.getCapacity()===this._textureAtlas.getTotalQuads())this.increaseAtlasCapacity();e.setBatchNode(this),e.setAtlasIndex(t),this._textureAtlas.insertQuad(e.getQuad(),t),e.setDirty(!0),e.updateTransform()},_updateAtlasIndex:function(e,t){var n=0,r=e.getChildren();r&&(n=r.length);var i=0;if(n==0)i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++;else{var s=!0;r[0].getZOrder()>=0&&(i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++,s=!1);for(var o=0;o<r.length;o++){var u=r[o];s&&u.getZOrder()>=0&&(i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++,s=!1),t=this._updateAtlasIndex(u,t)}s&&(i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++)}return t},_updateBlendFunc:function(){this._textureAtlas.getTexture().hasPremultipliedAlpha()||(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA)},initWithTexture:function(e,t){return this._children=[],this._descendants=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY,this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(e,t),this._updateBlendFunc(),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),!0},insertChild:function(e,t){e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),this._textureAtlas.getTotalQuads()==this._textureAtlas.getCapacity()&&this.increaseAtlasCapacity(),this._textureAtlas.insertQuad(e.getQuad(),t),this._descendants=cc.ArrayAppendObjectToIndex(this._descendants,e,t);var n=t+1;if(this._descendants&&this._descendants.length>0)for(;n<this._descendants.length;n++)this._descendants[n].setAtlasIndex(this._descendants[n].getAtlasIndex()+1);var r=e.getChildren();if(r&&r.length>0)for(n=0;n<r.length;n++)if(r[n]){var i=this.atlasIndexForChild(r[n],r[n].getZOrder());this.insertChild(r[n],i)}},appendChild:function(e){this._reorderChildDirty=!0,e.setBatchNode(this),e.setDirty(!0),cc.ArrayAppendObject(this._descendants,e);var t=this._descendants.length-1;e.setAtlasIndex(t),this._textureAtlas.getTotalQuads()==this._textureAtlas.getCapacity()&&this.increaseAtlasCapacity(),this._textureAtlas.insertQuad(e.getQuad(),t);var n=e.getChildren();for(var r=0;r<n.length;r++)this.appendChild(n[r])},removeSpriteFromAtlas:function(e){this._textureAtlas.removeQuadAtIndex(e.getAtlasIndex()),e.setBatchNode(null);var t=cc.ArrayGetIndexOfObject(this._descendants,e);if(t!=-1){cc.ArrayRemoveObjectAtIndex(this._descendants,t);var n=this._descendants.length;for(;t<n;++t){var r=this._descendants[t];r.setAtlasIndex(r.getAtlasIndex()-1)}}var i=e.getChildren();if(i&&i.length>0)for(var s=0;s<i.length;s++)i[s]&&this.removeSpriteFromAtlas(i[s])},getTexture:function(){return this._textureAtlas.getTexture()},setTexture:function(e){this._textureAtlas.setTexture(e),this._updateBlendFunc()},visit:function(e){var t=e||cc.renderContext;if(!this._visible)return;cc.kmGLPushMatrix(),this._grid&&this._grid.isActive()&&(this._grid.beforeDraw(),this.transformAncestors()),this.sortAllChildren(),this.transform(t),this.draw(t),this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),cc.kmGLPopMatrix(),this.setOrderOfArrival(0)},addChild:function(e,t,n){if(e==null)return;if(arguments.length===4&&arguments[3]==1){this._super(e,t,n),this.setNodeDirty();return}t=t==null?e.getZOrder():t,n=n==null?e.getTag():n,cc.Assert(e!=null,"SpriteBatchNode.addChild():child should not be null"),cc.Assert(e instanceof cc.Sprite,"cc.SpriteBatchNode only supports cc.Sprites as children"),cc.Assert(e.getTexture()._webTextureObj==this._textureAtlas.getTexture()._webTextureObj,"SpriteBatchNode.addChild():cc.Sprite is not using the same texture id"),this._super(e,t,n),this.appendChild(e),this.setNodeDirty()},removeAllChildren:function(e){if(this._descendants&&this._descendants.length>0)for(var t=0;t<this._descendants.length;t++)this._descendants[t]&&this._descendants[t].setBatchNode(null);this._super(e),this._descendants=[],this._textureAtlas.removeAllQuads()},sortAllChildren:function(){if(this._reorderChildDirty){var e=0,t=0,n=this._children.length;for(e=1;e<n;e++){var r=this._children[e];t=e-1;while(t>=0&&(r.getZOrder()<this._children[t].getZOrder()||r.getZOrder()==this._children[t].getZOrder()&&r.getOrderOfArrival()<this._children[t].getOrderOfArrival()))this._children[t+1]=this._children[t],t--;this._children[t+1]=r}if(this._children.length>0){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.sortAllChildren);var i=0;for(e=0;e<this._children.length;e++)i=this._updateAtlasIndex(this._children[e],i)}this._reorderChildDirty=!1}},draw:function(e){if(this._textureAtlas.getTotalQuads()===0)return;cc.NODE_DRAW_SETUP(this),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),this._textureAtlas.drawQuads()}}),cc.SpriteBatchNodeWebGL.create=function(e,t){t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY;var n=new cc.SpriteBatchNodeWebGL;return n.init(e,t),n},cc.SpriteBatchNodeWebGL.createWithTexture=function(e,t){t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY;var n=new cc.SpriteBatchNodeWebGL;return n.initWithTexture(e,t),n},cc.SpriteBatchNode=cc.Browser.supportWebGL?cc.SpriteBatchNodeWebGL:cc.SpriteBatchNodeCanvas;cc.LabelAtlasCanvas=cc.AtlasNode.extend({_string:null,_mapStartChar:null,initWithString:function(e,t,n,r,i){var s=e+"",o,u,a,f;cc.Assert(s!==null,"Label must be non-nil");if(arguments.length===2){var l=cc.FileUtils.getInstance().dictionaryWithContentsOfFileThreadSafe(t);cc.Assert(parseInt(l["version"],10)==1,"Unsupported version. Upgrade cocos2d version"),o=cc.FileUtils.getInstance().fullPathFromRelativeFile(l.textureFilename,t),u=parseInt(l.itemWidth,10)/cc.CONTENT_SCALE_FACTOR(),a=parseInt(l.itemHeight,10)/cc.CONTENT_SCALE_FACTOR(),f=String.fromCharCode(parseInt(l.firstChar,10))}else o=t,u=n||0,a=r||0,f=i||" ";return this.initWithTileFile(o,u,a,s.length)?(this._mapStartChar=f,this.setString(s),!0):!1},setColor:function(e){this._super(e),this.updateAtlasValues()},getString:function(){return this._string},draw:function(){this._super();if(cc.LABELATLAS_DEBUG_DRAW){var e=this.getContentSize(),t=[cc.p(0,0),cc.p(e.width,0),cc.p(e.width,e.height),cc.p(0,e.height)];cc.drawingUtil.drawPoly(t,4,!0)}},updateAtlasValues:function(){var e=this.getTexture();for(var t=0;t<this._string.length;t++){var n=this._string.charCodeAt(t)-this._mapStartChar.charCodeAt(0),r=parseInt(n%this._itemsPerRow,10)*cc.CONTENT_SCALE_FACTOR(),i=parseInt(n/this._itemsPerRow,10)*cc.CONTENT_SCALE_FACTOR(),s=cc.rect(r*this._itemWidth,i*this._itemHeight,this._itemWidth,this._itemHeight),o=this._string.charCodeAt(t),u=this.getChildByTag(t);u?o==32?(u.init(),u.setTextureRect(cc.rect(0,0,10,10),!1,cc.SizeZero())):(u.initWithTexture(e,s),u.setVisible(!0),u.setOpacity(this._opacity)):(u=new cc.Sprite,o==32?(u.init(),u.setTextureRect(cc.rect(0,0,10,10),!1,cc.SizeZero())):u.initWithTexture(e,s),this.addChild(u,0,t)),u.setPosition(cc.p(t*this._itemWidth+this._itemWidth/2,this._itemHeight/2))}},setString:function(e){var t=e.length;this._string=e,this.setContentSize(cc.size(t*this._itemWidth,this._itemHeight));if(this._children)for(var n=0;n<this._children.length;n++){var r=this._children[n];r&&r.setVisible(!1)}this.updateAtlasValues(),this._quadsToDraw=t},setOpacity:function(e){if(this._opacity!=e){this._super(e);for(var t=0;t<this._children.length;t++)this._children[t]&&this._children[t].setOpacity(e)}}}),cc.LabelAtlasCanvas.create=function(e,t,n,r,i){var s=new cc.LabelAtlasCanvas;return s&&cc.LabelAtlasCanvas.prototype.initWithString.apply(s,arguments)?s:null},cc.LabelAtlasWebGL=cc.AtlasNode.extend({_string:null,_mapStartChar:null,initWithString:function(e,t,n,r,i){var s=e+"",o,u,a,f;cc.Assert(s!==null,"Label must be non-nil");if(arguments.length===2){var l=cc.FileUtils.getInstance().dictionaryWithContentsOfFileThreadSafe(t);cc.Assert(parseInt(l["version"],10)==1,"Unsupported version. Upgrade cocos2d version"),o=cc.FileUtils.getInstance().fullPathFromRelativeFile(l.textureFilename,t),u=parseInt(l.itemWidth,10)/cc.CONTENT_SCALE_FACTOR(),a=parseInt(l.itemHeight,10)/cc.CONTENT_SCALE_FACTOR(),f=String.fromCharCode(parseInt(l.firstChar,10))}else o=t,u=n||0,a=r||0,f=i||" ";return this.initWithTileFile(o,u,a,s.length)?(this._mapStartChar=f,this.setString(s),!0):!1},setColor:function(e){this._super(e),this.updateAtlasValues()},getString:function(){return this._string},draw:function(){this._super();if(cc.LABELATLAS_DEBUG_DRAW){var e=this.getContentSize(),t=[cc.p(0,0),cc.p(e.width,0),cc.p(e.width,e.height),cc.p(0,e.height)];cc.drawingUtil.drawPoly(t,4,!0)}},updateAtlasValues:function(){var e=this._textureAtlas.getTexture(),t=e.getPixelsWide(),n=e.getPixelsHigh(),r=this._itemWidth*cc.CONTENT_SCALE_FACTOR(),i=this._itemHeight*cc.CONTENT_SCALE_FACTOR();for(var s=0;s<this._string.length;s++){var o=this._string.charCodeAt(s)-this._mapStartChar.charCodeAt(0),u=o%this._itemsPerRow,a=0|o/this._itemsPerRow,f,l,c,h;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*u*r+1)/(2*t),l=f+(r*2-2)/(2*t),c=(2*a*i+1)/(2*n),h=c+(i*2-2)/(2*n)):(f=u*r/t,l=f+r/t,c=a*i/n,h=c+i/n);var p=new cc.V3F_C4B_T2F_Quad;p.tl.texCoords.u=f,p.tl.texCoords.v=c,p.tr.texCoords.u=l,p.tr.texCoords.v=c,p.bl.texCoords.u=f,p.bl.texCoords.v=h,p.br.texCoords.u=l,p.br.texCoords.v=h,p.bl.vertices.x=s*this._itemWidth,p.bl.vertices.y=0,p.bl.vertices.z=0,p.br.vertices.x=s*this._itemWidth+this._itemWidth,p.br.vertices.y=0,p.br.vertices.z=0,p.tl.vertices.x=s*this._itemWidth,p.tl.vertices.y=this._itemHeight,p.tl.vertices.z=0,p.tr.vertices.x=s*this._itemWidth+this._itemWidth,p.tr.vertices.y=this._itemHeight,p.tr.vertices.z=0;var d=cc.c4b(this._color.r,this._color.g,this._color.b,this._opacity);p.tl.colors=d,p.tr.colors=d,p.bl.colors=d,p.br.colors=d,this._textureAtlas.updateQuad(p,s)}},setString:function(e){var t=e.length;t>this._textureAtlas.getTotalQuads()&&this._textureAtlas.resizeCapacity(t),this._string=e,this.setContentSize(cc.size(t*this._itemWidth,this._itemHeight)),this.updateAtlasValues(),this._quadsToDraw=t},setOpacity:function(e){this._opacity!==e&&this._super(e)}}),cc.LabelAtlasWebGL.create=function(e,t,n,r,i){var s=new cc.LabelAtlasWebGL;return s&&cc.LabelAtlasWebGL.prototype.initWithString.apply(s,arguments)?s:null},cc.LabelAtlas=cc.Browser.supportWebGL?cc.LabelAtlasWebGL:cc.LabelAtlasCanvas;cc.LabelTTFCanvas=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:"Arial",_fontSize:0,_string:"",_isMultiLine:!1,_fontStyleStr:null,_colorStyleStr:null,ctor:function(){this._super(),this._dimensions=cc.SizeZero(),this._opacityModifyRGB=!1,this._fontStyleStr="",this._colorStyleStr="",this._opacity=255,this._color=cc.white(),this._setColorStyleStr()},init:function(e){return e?this._super():this.initWithString([" ",this._fontName,this._fontSize])},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._super(e),this._setColorStyleStr(),this.setNodeDirty()},setOpacity:function(e){if(this._opacity===e)return;this._super(e),this._setColorStyleStr()},_setColorStyleStr:function(){this._colorStyleStr="rgba("+this._color.r+","+this._color.g+","+this._color.b+", "+this._opacity/255+")"},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return this._dimensions},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithString:function(e){var t=e[0]+"",n,r,i,s,o;return cc.Assert(t!=null,"cc.LabelTTF.initWithString() label is null"),e.length==6?(n=e[1],r=e[2],i=e[3],s=e[4],o=e[5]):e.length==5?(n=e[1],r=e[2],i=e[3],s=e[4],o=cc.VERTICAL_TEXT_ALIGNMENT_TOP):(n=e[1]||"Arial",r=e[2]||16,i=cc.size(0,e[2]),s=cc.TEXT_ALIGNMENT_LEFT,o=cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM),cc.Sprite.prototype.init.call(this)?(this._opacityModifyRGB=!1,this._dimensions=cc.size(i.width,i.height),this._fontName=n,this._hAlignment=s,this._vAlignment=o,this._fontSize=r*cc.CONTENT_SCALE_FACTOR(),this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",isXC?this._fontClientHeight=r+5:this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this.setString(t),!0):!1},setString:function(e){cc.Assert(e!=null,"Invalid string"),this._string!=e&&(this._string=e+"",this._string.length>0&&this._updateTTF())},setHorizontalAlignment:function(e){e!=this._hAlignment&&(this._hAlignment=e,this._string.length>0&&this._updateTTF())},setVerticalAlignment:function(e){e!=this._vAlignment&&(this._vAlignment=e,this._string.length>0&&this._updateTTF())},setDimensions:function(e){if(e.width!=this._dimensions.width||e.height!=this._dimensions.height)this._dimensions=e,this._string.length>0&&this._updateTTF()},setFontSize:function(e){this._fontSize!=e&&(this._fontSize=e,this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this._string.length>0&&this._updateTTF())},setFontName:function(e){this._fontName!=e&&(this._fontName=new String(e),this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this._string.length>0&&this._updateTTF())},_updateTTF:function(){cc.renderContext.font!=this._fontStyleStr&&(cc.renderContext.font=this._fontStyleStr);var e=cc.renderContext.measureText(this._string).width;if(this._string.indexOf("\n")!==-1||this._dimensions.width!==0&&e>this._dimensions.width&&this._string.indexOf(" ")!==-1){var t=this._strings=this._string.split("\n"),n=this._lineWidths=[];for(var r=0;r<t.length;r++){if(t[r].indexOf(" ")!==-1&&this._dimensions.width>0){var i=this._dimensions.width/cc.renderContext.measureText(this._strings[r]).width,s=0|i*t[r].length+1,o=s,u=0;if(i<1){do{o=t[r].lastIndexOf(" ",o-1);var a=t[r].substring(0,o);u=cc.renderContext.measureText(a).width;if(o===-1){o=t[r].indexOf(" ",s);break}}while(u>this._dimensions.width);var f=t[r].substr(o+1);t.splice(r+1,0,f),t[r]=a}}n[r]=u||cc.renderContext.measureText(t[r]).width}this._isMultiLine=!0}else this._isMultiLine=!1;this._dimensions.width===0?(this._isMultiLine?this.setContentSize(cc.size(Math.max.apply(Math,this._lineWidths),this._fontClientHeight*this._strings.length)):this.setContentSize(cc.size(e,this._fontClientHeight)),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y)):(this.setContentSize(cc.size(this._dimensions.width,this._dimensions.height)),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y))},draw:function(e,t){var n=e||cc.renderContext;this._flipX&&n.scale(-1,1),this._flipY&&n.scale(1,-1),n.fillStyle=this._colorStyleStr,n.font!=this._fontStyleStr&&(n.font=this._fontStyleStr),n.textBaseline=cc.LabelTTF._textBaseline[this._vAlignment],n.textAlign=cc.LabelTTF._textAlign[this._hAlignment];var r=0;this._hAlignment===cc.TEXT_ALIGNMENT_RIGHT?r=this._contentSize.width:this._hAlignment===cc.TEXT_ALIGNMENT_CENTER&&(r=this._contentSize.width/2);if(this._isMultiLine){var i=0;this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?i=this._fontSize+this._contentSize.height-this._fontSize*this._strings.length:this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(i=this._fontSize/2+(this._contentSize.height-this._fontSize*this._strings.length)/2);for(var s=0;s<this._strings.length;s++){var o=this._strings[s];n.fillText(o,r,-this._contentSize.height+this._fontSize*s+i)}}else this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?n.fillText(this._string,r,0):this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_TOP?n.fillText(this._string,r,-this._contentSize.height):n.fillText(this._string,r,-this._contentSize.height/2);cc.SPRITE_DEBUG_DRAW===1&&(n.fillStyle="rgba(255,0,0,0.2)",n.fillRect(this._offsetPosition.x,this._offsetPosition.y,this._contentSize.width,-this._contentSize.height)),cc.INCREMENT_GL_DRAWS(1)}}),cc.LabelTTFCanvas._textAlign=["left","center","right"],cc.LabelTTFCanvas._textBaseline=["top","middle","bottom"],cc.LabelTTFCanvas.create=function(){var e=new cc.LabelTTFCanvas;return e.initWithString(arguments)?e:null},cc.LabelTTFWebGL=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:"Arial",_fontSize:0,_string:"",_isMultiLine:!1,_fontStyleStr:null,_colorStyleStr:null,ctor:function(){this._super(),this._dimensions=cc.SizeZero(),this._opacityModifyRGB=!1,this._fontStyleStr="",this._colorStyleStr="",this._opacity=255,this._color=cc.white(),this._setColorStyleStr()},init:function(e){return e?this._super():this.initWithString([" ",this._fontName,this._fontSize])},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._super(e),this._setColorStyleStr(),this.setNodeDirty()},setOpacity:function(e){if(this._opacity===e)return;this._super(e),this._setColorStyleStr()},_setColorStyleStr:function(){this._colorStyleStr="rgba("+this._color.r+","+this._color.g+","+this._color.b+", "+this._opacity/255+")"},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return this._dimensions},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithString:function(e){var t=e[0]==undefined?" ":e[0]+"",n,r,i,s,o;return cc.Assert(t!=null,"cc.LabelTTF.initWithString() label is null"),e.length==6?(n=e[1],r=e[2],i=e[3],s=e[4],o=e[5]):e.length==5?(n=e[1],r=e[2],i=e[3],s=e[4],o=cc.VERTICAL_TEXT_ALIGNMENT_TOP):(n=e[1]||"Arial",r=e[2]||16,i=cc.size(0,e[2]),s=cc.TEXT_ALIGNMENT_LEFT,o=cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM),cc.Sprite.prototype.init.call(this)?(this._opacityModifyRGB=!1,this._dimensions=cc.size(i.width,i.height),this._fontName=n,this._hAlignment=s,this._vAlignment=o,this._fontSize=r*cc.CONTENT_SCALE_FACTOR(),this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this.setString(t),this._updateTexture(),!0):!1},_fontClientHeight:18,setString:function(e){cc.Assert(e!=null,"Invalid string"),this._string!=e&&(this._string=e+"",this._needUpdateTexture=!0)},setHorizontalAlignment:function(e){e!=this._hAlignment&&(this._hAlignment=e,this._needUpdateTexture=!0)},setVerticalAlignment:function(e){e!=this._vAlignment&&(this._vAlignment=e,this._needUpdateTexture=!0)},setDimensions:function(e){if(e.width!=this._dimensions.width||e.height!=this._dimensions.height)this._dimensions=e,this._needUpdateTexture=!0},setFontSize:function(e){this._fontSize!=e&&(this._fontSize=e,this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this._needUpdateTexture=!0)},setFontName:function(e){this._fontName&&this._fontName!=e&&(this._fontName=e,this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this._needUpdateTexture=!0)},_drawTTFInCanvasForWebGL:function(e){if(!e)return;e.setTransform(1,0,0,1,0,this._contentSize.height),e.font!=this._fontStyleStr&&(e.font=this._fontStyleStr),e.fillStyle="rgba(255,255,255,1)",e.textBaseline=cc.LabelTTF._textBaseline[this._vAlignment],e.textAlign=cc.LabelTTF._textAlign[this._hAlignment];var t=0;this._hAlignment===cc.TEXT_ALIGNMENT_RIGHT?t=this._contentSize.width:this._hAlignment===cc.TEXT_ALIGNMENT_CENTER&&(t=this._contentSize.width/2);if(this._isMultiLine){var n=0;this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?n=this._fontSize+this._contentSize.height-this._fontSize*this._strings.length:this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(n=this._fontSize/2+(this._contentSize.height-this._fontSize*this._strings.length)/2);for(var r=0;r<this._strings.length;r++){var i=this._strings[r];e.fillText(i,t,-this._contentSize.height+this._fontSize*r+n)}}else this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?e.fillText(this._string,t,0):this._vAlignment===cc.VERTICAL_TEXT_ALIGNMENT_TOP?e.fillText(this._string,t,-this._contentSize.height):e.fillText(this._string,t,-this._contentSize.height/2)},_getLabelContext:function(){if(this._labelContext)return this._labelContext;if(!this._labelCanvas){this._labelCanvas=document.createElement("canvas");var e=new cc.Texture2D;e.initWithElement(this._labelCanvas),this.setTexture(e)}return this._labelContext=this._labelCanvas.getContext("2d"),this._labelContext},_updateTTF:function(){var e=this._labelContext.measureText(this._string).width;if(this._string.indexOf("\n")!==-1||this._dimensions.width!==0&&e>this._dimensions.width&&this._string.indexOf(" ")!==-1){var t=this._strings=this._string.split("\n"),n=this._lineWidths=[];for(var r=0;r<t.length;r++){if(t[r].indexOf(" ")!==-1&&this._dimensions.width>0){var i=this._dimensions.width/this._labelContext.measureText(this._strings[r]).width,s=0|i*t[r].length+1,o=s,u=0;if(i<1){do{o=t[r].lastIndexOf(" ",o-1);var a=t[r].substring(0,o);u=this._labelContext.measureText(a).width;if(o===-1){o=t[r].indexOf(" ",s);break}}while(u>this._dimensions.width);var f=t[r].substr(o+1);t.splice(r+1,0,f),t[r]=a}}n[r]=u||this._labelContext.measureText(t[r]).width}this._isMultiLine=!0}else this._isMultiLine=!1;this._dimensions.width===0?(this._isMultiLine?this.setContentSize(cc.size(Math.max.apply(Math,this._lineWidths),this._fontClientHeight*this._strings.length)):this.setContentSize(cc.size(e,this._fontClientHeight)),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y)):(this.setContentSize(cc.size(this._dimensions.width,this._dimensions.height)),this._anchorPointInPoints=new cc.Point(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y))},_updateTexture:function(){return this._labelContext=this._getLabelContext(),this._labelContext.font=this._fontStyleStr,this._updateTTF(),this._labelCanvas.width=this._contentSize.width,this._labelCanvas.height=this._contentSize.height,this._drawTTFInCanvasForWebGL(this._labelContext),this._texture.handleLoadedTexture(),this.setTextureRect(cc.rect(0,0,this._labelCanvas.width,this._labelCanvas.height)),!0},_needUpdateTexture:!1,visit:function(){this._needUpdateTexture&&this._string.length>0&&(this._needUpdateTexture=!1,this._updateTexture()),this._super()},draw:function(e){var t=e||cc.renderContext;this._texture&&this._texture.isLoaded()&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewProjectionMatrixWithMat4(this._mvpMatrix),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(this._texture),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture._webTextureObj),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX),t.bindBuffer(t.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(t.bufferData(t.ARRAY_BUFFER,this._quad.arrayBuffer,t.STATIC_DRAW),this._quadDirty=!1),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.drawArrays(t.TRIANGLE_STRIP,0,4));if(cc.SPRITE_DEBUG_DRAW===1){var n=[cc.p(this._quad.tl.vertices.x,this._quad.tl.vertices.y),cc.p(this._quad.bl.vertices.x,this._quad.bl.vertices.y),cc.p(this._quad.br.vertices.x,this._quad.br.vertices.y),cc.p(this._quad.tr.vertices.x,this._quad.tr.vertices.y)];cc.drawingUtil.drawPoly(n,4,!0)}else if(cc.SPRITE_DEBUG_DRAW===2){var r=this.getTextureRect().size,i=this.getOffsetPosition(),s=[cc.p(i.x,i.y),cc.p(i.x+r.width,i.y),cc.p(i.x+r.width,i.y+r.height),cc.p(i.x,i.y+r.height)];cc.drawingUtil.drawPoly(s,4,!0)}cc.g_NumberOfDraws++}}),cc.LabelTTFWebGL._textAlign=["left","center","right"],cc.LabelTTFWebGL._textBaseline=["top","middle","bottom"],cc.LabelTTFWebGL.create=function(){var e=new cc.LabelTTFWebGL;return e.initWithString(arguments)?e:null},cc.LabelTTF=cc.Browser.supportWebGL?cc.LabelTTFWebGL:cc.LabelTTFCanvas,cc.LabelTTF.__labelHeightDiv=document.createElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.innerHTML="ajghl~!",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",document.body.appendChild(cc.LabelTTF.__labelHeightDiv),cc.LabelTTF.__getFontHeightByDiv=function(e,t){var n=cc.LabelTTF.__labelHeightDiv;return n.style.fontFamily=e,n.style.fontSize=t+"px",n.clientHeight};cc.LABEL_AUTOMATIC_WIDTH=-1,cc.KerningHashElement=function(e,t){this.key=e||0,this.amount=t||0},cc.FontDefHashElement=function(e,t){this.key=e||0,this.fontDef=t||new cc.BMFontDef},cc.BMFontDef=function(e,t,n,r,i){this.charID=e||0,this.rect=t||cc.rect(0,0,.1,.1),this.xOffset=n||0,this.yOffset=r||0,this.xAdvance=i||0},cc.BMFontPadding=function(e,t,n,r){this.left=e||0,this.top=t||0,this.right=n||0,this.bottom=r||0},cc.BMFontConfiguration=cc.Class.extend({commonHeight:0,padding:null,atlasName:null,kerningDictionary:null,fontDefDictionary:null,characterSet:null,ctor:function(){this.padding=new cc.BMFontPadding,this.atlasName="",this.kerningDictionary=new cc.KerningHashElement,this.fontDefDictionary={},this.characterSet=[]},description:function(){return"<cc.BMFontConfiguration | Kernings:"+this.kerningDictionary.amount+" | Image = "+this.atlasName.toString()+">"},getAtlasName:function(){return this.atlasName},setAtlasName:function(e){this.atlasName=e},getCharacterSet:function(){return this.characterSet},initWithFNTfile:function(e){return cc.Assert(e!=null&&e.length!=0,""),this.characterSet=this._parseConfigFile(e),this.characterSet!=null},_parseConfigFile:function(e){var t=cc.SAXParser.getInstance().getList(e);cc.Assert(t,"cc.BMFontConfiguration._parseConfigFile | Open file error.");if(!t)return cc.log("cocos2d: Error parsing FNTfile "+e),null;var n=[],r,i,s;i=/padding+[a-z0-9\-= ",]+/gi,r=i.exec(t)[0],r&&this._parseInfoArguments(r),i=/common lineHeight+[a-z0-9\-= ",]+/gi,r=i.exec(t)[0],r&&this._parseCommonArguments(r),i=/page id=[0-9]+ file="[\w\-\.]+/gi,r=i.exec(t)[0],r&&this._parseImageFileName(r,e),i=/chars c+[a-z0-9\-= ",]+/gi,r=i.exec(t)[0],r,i=/char id=\w[a-z0-9\-= ]+/gi,r=t.match(i);if(r)for(s=0;s<r.length;s++){var o=new cc.FontDefHashElement;this._parseCharacterDefinition(r[s],o.fontDef),o.key=o.fontDef.charID,this.fontDefDictionary[o.key]=o,n.push(o.fontDef.charID)}i=/kerning first=\w[a-z0-9\-= ]+/gi,r=t.match(i);if(r)for(s=0;s<r.length;s++)this._parseKerningEntry(r[s]);return n},_parseCharacterDefinition:function(e,t){var n=/id=(\d+)/gi.exec(e)[1];t.charID=n.toString(),n=/x=([\-\d]+)/gi.exec(e)[1],t.rect.origin.x=parseInt(n),n=/y=([\-\d]+)/gi.exec(e)[1],t.rect.origin.y=parseInt(n),n=/width=([\-\d]+)/gi.exec(e)[1],t.rect.size.width=parseInt(n),n=/height=([\-\d]+)/gi.exec(e)[1],t.rect.size.height=parseInt(n),n=/xoffset=([\-\d]+)/gi.exec(e)[1],t.xOffset=parseInt(n),n=/yoffset=([\-\d]+)/gi.exec(e)[1],t.yOffset=parseInt(n),n=/xadvance=([\-\d]+)/gi.exec(e)[1],t.xAdvance=parseInt(n)},_parseInfoArguments:function(e){var t=/padding=(\d+)[,](\d+)[,](\d+)[,](\d+)/gi.exec(e);this.padding.left=t[1],this.padding.top=t[2],this.padding.right=t[3],this.padding.bottom=t[4],cc.log("cocos2d: padding: "+this.padding.left+","+this.padding.top+","+this.padding.right+","+this.padding.bottom)},_parseCommonArguments:function(e){var t;this.commonHeight=parseInt(/lineHeight=(\d+)/gi.exec(e)[1]);if(cc.renderContextType===cc.WEBGL){var n=parseInt(/scaleW=(\d+)/gi.exec(e)[1]);cc.Assert(n<=cc.Configuration.getInstance().getMaxTextureSize(),"cc.LabelBMFont: page can't be larger than supported");var r=parseInt(/scaleH=(\d+)/gi.exec(e)[1]);cc.Assert(r<=cc.Configuration.getInstance().getMaxTextureSize(),"cc.LabelBMFont: page can't be larger than supported")}t=/pages=(\d+)/gi.exec(e)[1],cc.Assert(parseInt(t)==1,"cc.BitfontAtlas: only supports 1 page")},_parseImageFileName:function(e,t){var n;n=/id=(\d+)/gi.exec(e)[1],cc.Assert(parseInt(n)==0,"LabelBMFont file could not be found"),n=/file="([a-zA-Z0-9\-\._]+)/gi.exec(e)[1],this.atlasName=cc.FileUtils.getInstance().fullPathFromRelativeFile(n,t)},_parseKerningCapacity:function(e){},_parseKerningEntry:function(e){var t=/first=([\-\d]+)/gi.exec(e)[1],n=parseInt(t);t=/second=([\-\d]+)/gi.exec(e)[1];var r=parseInt(t);t=/amount=([\-\d]+)/gi.exec(e)[1];var i=parseInt(t),s=new cc.KerningHashElement;s.amount=i,s.key=n<<16|r&65535,this.kerningDictionary[s.key]=s},_purgeKerningDictionary:function(){this.kerningDictionary=null},_purgeFontDefDictionary:function(){this.fontDefDictionary=null}}),cc.BMFontConfiguration.create=function(e){var t=new cc.BMFontConfiguration;return t.initWithFNTfile(e)?t:null},cc.LabelBMFont=cc.SpriteBatchNode.extend({RGBAProtocol:!0,_opacity:0,_color:null,_opacityModifyRGB:!1,_string:null,_configuration:null,_fntFile:null,_initialString:"",_alignment:null,_width:0,_lineBreakWithoutSpaces:!1,_imageOffset:null,_reusedChar:null,ctor:function(){this._super(),this._imageOffset=cc.POINT_ZERO,this._string="",this._fntFile="",this._initialString="",this._reusedChar=[]},draw:function(e){this._super();if(cc.LABELBMFONT_DEBUG_DRAW){var t=this.getContentSize(),n=cc.p(0|-this._anchorPointInPoints.x,0|-this._anchorPointInPoints.y),r=[cc.p(n.x,n.y),cc.p(n.x+t.width,n.y),cc.p(n.x+t.width,n.y+t.height),cc.p(n.x,n.y+t.height)];cc.drawingUtil.setDrawColor4B(0,255,0,255),cc.drawingUtil.drawPoly(r,4,!0)}},getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;if(this._children)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&n.RGBAProtocol&&n.setOpacity(this._opacity)}},getColor:function(){return this._color},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=e;if(cc.renderContextType===cc.WEBGL){if(this._children)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&n.setColor(this._color)}}else if(this.getTexture()){var r=cc.TextureCache.getInstance().getTextureColors(this._originalTexture);if(r){var i=this.getTexture(),s=cc.rect(0,0,i.width,i.height),o=cc.generateTintImage(i,r,this._color,s);this.setTexture(o),this.updateString(!1)}}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(e){this._opacityModifyRGB=e;if(this._children)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&n.RGBAProtocol&&n.setOpacityModifyRGB(this._opacityModifyRGB)}},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(e,t,n,r,i){var s=e||"";cc.Assert(!this._configuration,"re-init is no longer supported");var o;if(t){var u=cc.FNTConfigLoadFile(t);cc.Assert(u,"cc.LabelBMFont: Impossible to create font. Please check file"),this._configuration=u,this._fntFile=t,o=cc.TextureCache.getInstance().addImage(this._configuration.getAtlasName())}else o=cc.renderContextType===cc.CANVAS?new Image:new cc.Texture2D;return this.initWithTexture(o,s.length)?(this._alignment=r||cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=i||cc.PointZero(),this._width=n==null?cc.LabelAutomaticWidth:n,this._opacity=255,this._color=cc.white(),this._contentSize=cc.SizeZero(),this.setAnchorPoint(cc.p(.5,.5)),cc.renderContextType===cc.WEBGL&&(this._opacityModifyRGB=this._textureAtlas.getTexture().hasPremultipliedAlpha(),this._reusedChar=new cc.Sprite,this._reusedChar.initWithTexture(this._textureAtlas.getTexture(),cc.RectMake(0,0,0,0),!1),this._reusedChar.setBatchNode(this)),this.setString(s),!0):!1},createFontChars:function(){var e=0,t=-1,n=0,r=cc.SizeZero(),i=0,s=1,o=this._string.length;if(o===0)return;var u,a=this._configuration.getCharacterSet();for(u=0;u<o-1;u++)this._string.charCodeAt(u)==10&&s++;var f=this._configuration.commonHeight*s,l=-(this._configuration.commonHeight-this._configuration.commonHeight*s);for(u=0;u<o;u++){var c=this._string.charCodeAt(u);if(c===10){e=0,l-=this._configuration.commonHeight;continue}if(a[c]===null){cc.log("cc.LabelBMFont: Attempted to use character not defined in this bitmap: "+this._string[u]);continue}var h=this._configuration.fontDefDictionary[c];if(!h){cc.log("cocos2d: LabelBMFont: character not found "+this._string[u]);continue}var p=h.fontDef,d=cc.rect(p.rect.origin.x,p.rect.origin.y,p.rect.size.width,p.rect.size.height);d=cc.RECT_PIXELS_TO_POINTS(d),d.origin.x+=this._imageOffset.x,d.origin.y+=this._imageOffset.y;var v=this.getChildByTag(u);v?c===32&&cc.renderContextType===cc.CANVAS?(v.init(),v.setTextureRect(cc.RectZero(),!1,cc.SizeZero())):(cc.renderContextType===cc.CANVAS?v.initWithTexture(this.getTexture(),d,!1):v.setTextureRect(d,!1,d.size),v.setVisible(!0),v.setOpacity(255)):(v=new cc.Sprite,c===32&&cc.renderContextType===cc.CANVAS?(v.init(),v.setTextureRect(cc.RectZero(),!1,cc.SizeZero())):v.initWithTexture(this.getTexture(),d,!1),this.addChild(v,0,u));var m=this._configuration.commonHeight-p.yOffset,g=cc.p(e+p.xOffset+p.rect.size.width*.5+n,l+m-d.size.height*.5*cc.CONTENT_SCALE_FACTOR());v.setPosition(cc.POINT_PIXELS_TO_POINTS(g)),e+=p.xAdvance+n,t=c,v.setOpacityModifyRGB(this._opacityModifyRGB),cc.renderContextType===cc.WEBGL&&v.setColor(this._color),this._opacity!==255&&v.setOpacity(this._opacity),i<e&&(i=e)}r.width=i,r.height=f,this.setContentSize(cc.SIZE_PIXELS_TO_POINTS(r))},updateString:function(e){if(this._children)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&n.setVisible(!1)}this._configuration&&this.createFontChars(),e||this.updateLabel()},getString:function(){return this._initialString},setString:function(e,t){t=t||!1,this._string!=e&&(this._string=e+"",this._initialString!==this._string&&(this._initialString=this._string),this.updateString(t))},setCString:function(e){this.setString(e)},updateLabel:function(){if(this._width>0){this.setString(this._initialString,!0);var e=this._string.length,t=[],n=[],r=1,i=0,s=!1,o=!1,u=-1,a=-1,f=0,l,c;for(l=0;l<this._children.length;l++){while(!(c=this.getChildByTag(l+f)))f++;if(i>=e)break;var h=this._string[i];o||(a=this._getLetterPosXLeft(c),o=!0),s||(u=a,s=!0);if(h.charCodeAt(0)==10){n.push("\n"),t=t.concat(n),n.length=0,o=!1,s=!1,a=-1,u=-1,i++,r++;if(i>=e)break;h=this._string[i],a||(a=this._getLetterPosXLeft(c),o=!0),u||(u=a,s=!0)}if(h.charCodeAt(0)==32){n.push(h),t=t.concat(n),n.length=0,o=!1,a=-1,i++;continue}if(this._getLetterPosXRight(c)-u>this._width)if(!this._lineBreakWithoutSpaces){n.push(h);var p=t.lastIndexOf(" ");p!=-1?cc.utf8_trim_ws(t):t=[],t.length>0&&t.push("\n"),r++,s=!1,u=-1,i++}else{cc.utf8_trim_ws(n),n.push("\n"),t=t.concat(n),n.length=0,o=!1,s=!1,a=-1,u=-1,r++;if(i>=e)break;a||(a=this._getLetterPosXLeft(c),o=!0),u||(u=a,s=!0),l--}else n.push(h),i++}t=t.concat(n);var d=t.length,v="";for(i=0;i<d;++i)v+=t[i];this._string=v+String.fromCharCode(0),this.updateString(!0)}if(this._alignment!=cc.TEXT_ALIGNMENT_LEFT){i=0;var m=0,g=this._string.length,y=[];for(var b=0;b<g;b++){if(this._string[b].charCodeAt(0)==10||this._string[b].charCodeAt(0)==0){var w=0,E=y.length,S=i+E-1+m;if(S<0)continue;var x=this.getChildByTag(S);if(x==null)continue;w=x.getPosition().x+x.getContentSize().width/2;var T=0;switch(this._alignment){case cc.TEXT_ALIGNMENT_CENTER:T=this.getContentSize().width/2-w/2;break;case cc.TEXT_ALIGNMENT_RIGHT:T=this.getContentSize().width-w;break;default:}if(T!=0)for(l=0;l<E;l++){S=i+l+m;if(S<0)continue;c=this.getChildByTag(S),c&&c.setPosition(cc.pAdd(c.getPosition(),cc.p(T,0)))}i+=E,m++,y.length=0;continue}y.push(this._string[i])}}},setAlignment:function(e){this._alignment=e,this.updateLabel()},setWidth:function(e){this._width=e,this.updateLabel()},setLineBreakWithoutSpace:function(e){this._lineBreakWithoutSpaces=e,this.updateLabel()},setScale:function(e,t){this._super(e,t),this.updateLabel()},setScaleX:function(e){this._super(e),this.updateLabel()},setScaleY:function(e){this._super(e),this.updateLabel()},setFntFile:function(e){if(e!=null&&e!=this._fntFile){var t=cc.FNTConfigLoadFile(e);cc.Assert(t,"cc.LabelBMFont: Impossible to create font. Please check file"),this._fntFile=e,this._configuration=t,this.setTexture(cc.TextureCache.getInstance().addImage(this._configuration.getAtlasName())),cc.renderContextType==cc.CANVAS&&(this._originalTexture=this.getTexture()),this.createFontChars()}},getFntFile:function(){return this._fntFile},setAnchorPoint:function(e){cc.Point.CCPointEqualToPoint(e,this._anchorPoint)||(this._super(e),this.updateLabel())},_atlasNameFromFntFile:function(e){},_kerningAmountForFirst:function(e,t){var n=0,r=e<<16|t&65535;if(this._configuration.kerningDictionary){var i=this._configuration.kerningDictionary[r.toString()];i&&(n=i.amount)}return n},_getLetterPosXLeft:function(e){return e.getPosition().x*this._scaleX+e.getContentSize().width*this._scaleX*e.getAnchorPoint().x},_getLetterPosXRight:function(e){return e.getPosition().x*this._scaleX-e.getContentSize().width*this._scaleX*e.getAnchorPoint().x}}),cc.LabelBMFont.create=function(e,t,n,r,i){var s=new cc.LabelBMFont;return arguments.length==0?s&&s.init()?s:null:s&&s.initWithString(e,t,n,r,i)?s:null},cc.LabelBMFont._configurations=null,cc.FNTConfigLoadFile=function(e){cc.LabelBMFont._configurations||(cc.LabelBMFont._configurations={});var t=cc.LabelBMFont._configurations[e];return t||(t=cc.BMFontConfiguration.create(e),cc.LabelBMFont._configurations[e]=t),t},cc.LabelBMFont.purgeCachedData=function(){cc.FNTConfigRemoveCache()},cc.FNTConfigRemoveCache=function(){cc.LabelBMFont._configurations&&(cc.LabelBMFont._configurations=null)},cc.isspace_unicode=function(e){return e=e.charCodeAt(0),e>=9&&e<=13||e==32||e==133||e==160||e==5760||e>=8192&&e<=8202||e==8232||e==8233||e==8239||e==8287||e==12288},cc.utf8_trim_ws=function(e){var t=e.length;if(t<=0)return;var n=t-1;if(cc.isspace_unicode(e[n])){for(var r=n-1;r>=0;--r){if(!cc.isspace_unicode(e[r]))break;n=r}cc.utf8_trim_from(e,n)}},cc.utf8_trim_from=function(e,t){var n=e.length;if(t>=n||t<0)return;e.splice(t,n)};cc.PARTICLE_SHAPE_MODE=0,cc.PARTICLE_TEXTURE_MODE=1,cc.PARTICLE_STAR_SHAPE=0,cc.PARTICLE_BALL_SHAPE=1,cc.PARTICLE_DURATION_INFINITY=-1,cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE=-1,cc.PARTICLE_START_RADIUS_EQUAL_TO_END_RADIUS=-1,cc.PARTICLE_MODE_GRAVITY=0,cc.PARTICLE_MODE_RADIUS=1,cc.PARTICLE_TYPE_FREE=0,cc.PARTICLE_TYPE_RELATIVE=1,cc.PARTICLE_TYPE_GROUPED=2,cc.PARTICLE_TYPE_FREE=cc.PARTICLE_TYPE_FREE,cc.PARTICLE_TYPE_GROUPED=cc.PARTICLE_TYPE_GROUPED,cc.Particle=function(e,t,n,r,i,s,o,u,a,f,l,c){this.pos=e?e:cc.PointZero(),this.startPos=t?t:cc.PointZero(),this.color=n?n:new cc.Color4F(0,0,0,1),this.deltaColor=r?r:new cc.Color4F(0,0,0,1),this.size=i||0,this.deltaSize=s||0,this.rotation=o||0,this.deltaRotation=u||0,this.timeToLive=a||0,this.atlasIndex=f||0,this.modeA=l?l:new cc.Particle.ModeA,this.modeB=c?c:new cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=cc.p(0,0)},cc.Particle.ModeA=function(e,t,n){this.dir=e?e:cc.PointZero(),this.radialAccel=t||0,this.tangentialAccel=n||0},cc.Particle.ModeB=function(e,t,n,r){this.angle=e||0,this.degreesPerSecond=t||0,this.radius=n||0,this.deltaRadius=r||0},cc.ParticleSystem=cc.Node.extend({_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_particlePool:null,_emitCounter:0,_particleIdx:0,_batchNode:null,getBatchNode:function(){return this._batchNode},setBatchNode:function(e){if(this._batchNode!=e){this._batchNode=e;if(e)for(var t=0;t<this._totalParticles;t++)this._particles[t].atlasIndex=t}},_atlasIndex:0,getAtlasIndex:function(){return this._atlasIndex},setAtlasIndex:function(e){this._atlasIndex=e},_transformSystemDirty:!1,_allocatedParticles:0,_drawMode:cc.PARTICLE_SHAPE_MODE,getDrawMode:function(){return this._drawMode},setDrawMode:function(e){this._drawMode=e},_shapeType:cc.PARTICLE_BALL_SHAPE,getShapeType:function(){return this._shapeType},setShapeType:function(e){this._shapeType=e},_isActive:!1,isActive:function(){return this._isActive},_particleCount:0,getParticleCount:function(){return this._particleCount},setParticleCount:function(e){this._particleCount=e},_duration:0,getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},_sourcePosition:cc.PointZero(),getSourcePosition:function(){return this._sourcePosition},setSourcePosition:function(e){this._sourcePosition=e},_posVar:cc.PointZero(),getPosVar:function(){return this._posVar},setPosVar:function(e){this._posVar=e},_life:0,getLife:function(){return this._life},setLife:function(e){this._life=e},_lifeVar:0,getLifeVar:function(){return this._lifeVar},setLifeVar:function(e){this._lifeVar=e},_angle:0,getAngle:function(){return this._angle},setAngle:function(e){this._angle=e},_angleVar:0,getAngleVar:function(){return this._angleVar},setAngleVar:function(e){this._angleVar=e},getGravity:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.gravity},setGravity:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.gravity=e},getSpeed:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speed},setSpeed:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speed=e},getSpeedVar:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speedVar},setSpeedVar:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speedVar=e},getTangentialAccel:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccel},setTangentialAccel:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccel=e},getTangentialAccelVar:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccelVar},setTangentialAccelVar:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccelVar=e},getRadialAccel:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccel},setRadialAccel:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccel=e},getRadialAccelVar:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccelVar},setRadialAccelVar:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccelVar=e},getStartRadius:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.startRadius},setStartRadius:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.startRadius=e},getStartRadiusVar:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.startRadiusVar},setStartRadiusVar:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.startRadiusVar=e},getEndRadius:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.endRadius},setEndRadius:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.endRadius=e},getEndRadiusVar:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.endRadiusVar},setEndRadiusVar:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.endRadiusVar=e},getRotatePerSecond:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.rotatePerSecond},setRotatePerSecond:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.rotatePerSecond=e},getRotatePerSecondVar:function(){return cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(e){cc.Assert(this._emitterMode==cc.PARTICLE_MODE_RADIUS,"Particle Mode should be Radius"),this.modeB.rotatePerSecondVar=e},setScale:function(e,t){this._transformSystemDirty=!0,this._super(e,t)},setRotation:function(e){this._transformSystemDirty=!0,this._super(e)},setScaleX:function(e){this._transformSystemDirty=!0,this._super(e)},setScaleY:function(e){this._transformSystemDirty=!0,this._super(e)},_startSize:0,getStartSize:function(){return this._startSize},setStartSize:function(e){this._startSize=e},_startSizeVar:0,getStartSizeVar:function(){return this._startSizeVar},setStartSizeVar:function(e){this._startSizeVar=e},_endSize:0,getEndSize:function(){return this._endSize},setEndSize:function(e){this._endSize=e},_endSizeVar:0,getEndSizeVar:function(){return this._endSizeVar},setEndSizeVar:function(e){this._endSizeVar=e},_startColor:new cc.Color4F(0,0,0,1),getStartColor:function(){return this._startColor},setStartColor:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._startColor=e},_startColorVar:new cc.Color4F(0,0,0,1),getStartColorVar:function(){return this._startColorVar},setStartColorVar:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._startColorVar=e},_endColor:new cc.Color4F(0,0,0,1),getEndColor:function(){return this._endColor},setEndColor:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._endColor=e},_endColorVar:new cc.Color4F(0,0,0,1),getEndColorVar:function(){return this._endColorVar},setEndColorVar:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._endColorVar=e},_startSpin:0,getStartSpin:function(){return this._startSpin},setStartSpin:function(e){this._startSpin=e},_startSpinVar:0,getStartSpinVar:function(){return this._startSpinVar},setStartSpinVar:function(e){this._startSpinVar=e},_endSpin:0,getEndSpin:function(){return this._endSpin},setEndSpin:function(e){this._endSpin=e},_endSpinVar:0,getEndSpinVar:function(){return this._endSpinVar},setEndSpinVar:function(e){this._endSpinVar=e},_emissionRate:0,getEmissionRate:function(){return this._emissionRate},setEmissionRate:function(e){this._emissionRate=e},_totalParticles:0,getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(e){cc.Assert(e<=this._allocatedParticles,"Particle: resizing particle array only supported for quads"),this._totalParticles=e},_texture:null,getTexture:function(){return this._texture},setTexture:function(e){this._texture!=e&&(this._texture=e,this._updateBlendFunc())},_blendFunc:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e,t){if(arguments.length==1)this._blendFunc!=e&&(this._blendFunc=e,this._updateBlendFunc());else if(this._blendFunc.src!=e||this._blendFunc.dst!=t)this._blendFunc={src:e,dst:t},this._updateBlendFunc()},_opacityModifyRGB:!1,getOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(e){this._opacityModifyRGB=e},isBlendAdditive:function(){return this._blendFunc.src==gl.SRC_ALPHA&&this._blendFunc.dst==gl.ONE||this._blendFunc.src==gl.ONE&&this._blendFunc.dst==gl.ONE},setBlendAdditive:function(e){e?(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE):cc.renderContextType===cc.WEBGL?this._texture&&!this._texture.hasPremultipliedAlpha()?(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA):(this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST):(this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST)},_positionType:cc.PARTICLE_TYPE_FREE,getPositionType:function(){return this._positionType},setPositionType:function(e){this._positionType=e},_isAutoRemoveOnFinish:!1,isAutoRemoveOnFinish:function(){return this._isAutoRemoveOnFinish},setAutoRemoveOnFinish:function(e){this._isAutoRemoveOnFinish=e},_emitterMode:0,getEmitterMode:function(){return this._emitterMode},setEmitterMode:function(e){this._emitterMode=e},ctor:function(){this._super(),this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA=new cc.ParticleSystem.ModeA,this.modeB=new cc.ParticleSystem.ModeB,this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._particles=[],this._sourcePosition=new cc.Point(0,0),this._posVar=new cc.Point(0,0),this._startColor=new cc.Color4F(1,1,1,1),this._startColorVar=new cc.Color4F(1,1,1,1),this._endColor=new cc.Color4F(1,1,1,1),this._endColorVar=new cc.Color4F(1,1,1,1),this._particlePool=[]},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(e){this._plistFile=e;var t=cc.FileUtils.getInstance().dictionaryWithContentsOfFileThreadSafe(this._plistFile);return cc.Assert(t!=null,"Particles: file not found"),this.initWithDictionary(t,"")},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc.canvas.width,cc.canvas.height)},initWithDictionary:function(e,t){var n=!1,r=null,i=null,s=parseInt(this._valueForKey("maxParticles",e));if(this.initWithTotalParticles(s)){this._angle=parseFloat(this._valueForKey("angle",e)),this._angleVar=parseFloat(this._valueForKey("angleVariance",e)),this._duration=parseFloat(this._valueForKey("duration",e)),this._blendFunc.src=parseInt(this._valueForKey("blendFuncSource",e)),this._blendFunc.dst=parseInt(this._valueForKey("blendFuncDestination",e)),this._startColor.r=parseFloat(this._valueForKey("startColorRed",e)),this._startColor.g=parseFloat(this._valueForKey("startColorGreen",e)),this._startColor.b=parseFloat(this._valueForKey("startColorBlue",e)),this._startColor.a=parseFloat(this._valueForKey("startColorAlpha",e)),this._startColorVar.r=parseFloat(this._valueForKey("startColorVarianceRed",e)),this._startColorVar.g=parseFloat(this._valueForKey("startColorVarianceGreen",e)),this._startColorVar.b=parseFloat(this._valueForKey("startColorVarianceBlue",e)),this._startColorVar.a=parseFloat(this._valueForKey("startColorVarianceAlpha",e)),this._endColor.r=parseFloat(this._valueForKey("finishColorRed",e)),this._endColor.g=parseFloat(this._valueForKey("finishColorGreen",e)),this._endColor.b=parseFloat(this._valueForKey("finishColorBlue",e)),this._endColor.a=parseFloat(this._valueForKey("finishColorAlpha",e)),this._endColorVar.r=parseFloat(this._valueForKey("finishColorVarianceRed",e)),this._endColorVar.g=parseFloat(this._valueForKey("finishColorVarianceGreen",e)),this._endColorVar.b=parseFloat(this._valueForKey("finishColorVarianceBlue",e)),this._endColorVar.a=parseFloat(this._valueForKey("finishColorVarianceAlpha",e)),this._startSize=parseFloat(this._valueForKey("startParticleSize",e)),this._startSizeVar=parseFloat(this._valueForKey("startParticleSizeVariance",e)),this._endSize=parseFloat(this._valueForKey("finishParticleSize",e)),this._endSizeVar=parseFloat(this._valueForKey("finishParticleSizeVariance",e));var o=parseFloat(this._valueForKey("sourcePositionx",e)),u=parseFloat(this._valueForKey("sourcePositiony",e));this.setPosition(cc.p(o,u)),this._posVar.x=parseFloat(this._valueForKey("sourcePositionVariancex",e)),this._posVar.y=parseFloat(this._valueForKey("sourcePositionVariancey",e)),this._startSpin=parseFloat(this._valueForKey("rotationStart",e)),this._startSpinVar=parseFloat(this._valueForKey("rotationStartVariance",e)),this._endSpin=parseFloat(this._valueForKey("rotationEnd",e)),this._endSpinVar=parseFloat(this._valueForKey("rotationEndVariance",e)),this._emitterMode=parseInt(this._valueForKey("emitterType",e));if(this._emitterMode==cc.PARTICLE_MODE_GRAVITY){this.modeA.gravity.x=parseFloat(this._valueForKey("gravityx",e)),this.modeA.gravity.y=parseFloat(this._valueForKey("gravityy",e)),this.modeA.speed=parseFloat(this._valueForKey("speed",e)),this.modeA.speedVar=parseFloat(this._valueForKey("speedVariance",e));var a=this._valueForKey("radialAcceleration",e);this.modeA.radialAccel=a?parseFloat(a):0,a=this._valueForKey("radialAccelVariance",e),this.modeA.radialAccelVar=a?parseFloat(a):0,a=this._valueForKey("tangentialAcceleration",e),this.modeA.tangentialAccel=a?parseFloat(a):0,a=this._valueForKey("tangentialAccelVariance",e),this.modeA.tangentialAccelVar=a?parseFloat(a):0}else{if(this._emitterMode!=cc.PARTICLE_MODE_RADIUS)return cc.Assert(!1,"Invalid emitterType in config file"),!1;this.modeB.startRadius=parseFloat(this._valueForKey("maxRadius",e)),this.modeB.startRadiusVar=parseFloat(this._valueForKey("maxRadiusVariance",e)),this.modeB.endRadius=parseFloat(this._valueForKey("minRadius",e)),this.modeB.endRadiusVar=0,this.modeB.rotatePerSecond=parseFloat(this._valueForKey("rotatePerSecond",e)),this.modeB.rotatePerSecondVar=parseFloat(this._valueForKey("rotatePerSecondVariance",e))}this._life=parseFloat(this._valueForKey("particleLifespan",e)),this._lifeVar=parseFloat(this._valueForKey("particleLifespanVariance",e)),this._emissionRate=this._totalParticles/this._life;if(!this._batchNode){this._opacityModifyRGB=!1;var f=this._valueForKey("textureFileName",e),l=cc.FileUtils.getInstance().fullPathFromRelativeFile(f,this._plistFile),c=cc.TextureCache.getInstance().textureForKey(l);if(c)this.setTexture(c);else{var h=this._valueForKey("textureImageData",e);if(h&&h.length==0){cc.Assert(h,"cc.ParticleSystem.initWithDictory:textureImageData is null"),c=cc.TextureCache.getInstance().addImage(l);if(!c)return!1;this.setTexture(c)}else{r=cc.unzipBase64AsArray(h,1);if(!r)return cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;var p=cc.getImageFormatByData(r);if(p!==cc.FMT_TIFF&&p!==cc.FMT_PNG)return cc.log("cc.ParticleSystem: unknown image format with Data"),!1;var d=document.createElement("canvas");if(p===cc.FMT_PNG){var v=new cc.PNGReader(r);v.render(d)}else{var m=cc.TIFFReader.getInstance();m.parseTIFF(r,d)}cc.TextureCache.getInstance().cacheImage(l,d);var g=cc.TextureCache.getInstance().textureForKey(l);cc.Assert(g!=null,"cc.ParticleSystem: error loading the texture"),this.setTexture(g)}}}n=!0}return n},initWithTotalParticles:function(e){this._totalParticles=e,this._particles=[],this._particlePool=[];if(!this._particles)return cc.log("Particle system: not enough memory"),!1;this._allocatedParticles=e;if(this._batchNode)for(var t=0;t<this._totalParticles;t++)this._particles[t].atlasIndex=t;return this._isActive=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._positionType=cc.PARTICLE_TYPE_FREE,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this._isAutoRemoveOnFinish=!1,this._transformSystemDirty=!1,this.scheduleUpdateWithPriority(1),!0},destroyParticleSystem:function(){this._particlePool=null,this.unscheduleUpdate()},_getParticleObject:function(){return this._particlePool.length>0?this._particlePool.pop():new cc.Particle},addParticle:function(){if(this.isFull())return!1;var e=this._getParticleObject();return this.initParticle(e),this._particles.push(e),++this._particleCount,!0},initParticle:function(e){e.timeToLive=this._life+this._lifeVar*cc.RANDOM_MINUS1_1(),e.timeToLive=Math.max(0,e.timeToLive),e.pos.x=this._sourcePosition.x+this._posVar.x*cc.RANDOM_MINUS1_1(),e.pos.y=this._sourcePosition.y+this._posVar.y*cc.RANDOM_MINUS1_1();var t=new cc.Color4F(cc.clampf(this._startColor.r+this._startColorVar.r*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._startColor.g+this._startColorVar.g*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._startColor.b+this._startColorVar.b*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._startColor.a+this._startColorVar.a*cc.RANDOM_MINUS1_1(),0,1)),n=new cc.Color4F(cc.clampf(this._endColor.r+this._endColorVar.r*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._endColor.g+this._endColorVar.g*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._endColor.b+this._endColorVar.b*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._endColor.a+this._endColorVar.a*cc.RANDOM_MINUS1_1(),0,1));e.color=t,e.deltaColor.r=(n.r-t.r)/e.timeToLive,e.deltaColor.g=(n.g-t.g)/e.timeToLive,e.deltaColor.b=(n.b-t.b)/e.timeToLive,e.deltaColor.a=(n.a-t.a)/e.timeToLive;var r=this._startSize+this._startSizeVar*cc.RANDOM_MINUS1_1();r=Math.max(0,r),e.size=r;if(this._endSize==cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE)e.deltaSize=0;else{var i=this._endSize+this._endSizeVar*cc.RANDOM_MINUS1_1();i=Math.max(0,i),e.deltaSize=(i-r)/e.timeToLive}var s=this._startSpin+this._startSpinVar*cc.RANDOM_MINUS1_1(),o=this._endSpin+this._endSpinVar*cc.RANDOM_MINUS1_1();e.rotation=s,e.deltaRotation=(o-s)/e.timeToLive,this._positionType==cc.PARTICLE_TYPE_FREE?e.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this._positionType==cc.PARTICLE_TYPE_RELATIVE&&(e.startPos=this._position);var u=cc.DEGREES_TO_RADIANS(this._angle+this._angleVar*cc.RANDOM_MINUS1_1());if(this._emitterMode==cc.PARTICLE_MODE_GRAVITY){var a=cc.p(Math.cos(u),Math.sin(u)),f=this.modeA.speed+this.modeA.speedVar*cc.RANDOM_MINUS1_1();e.modeA.dir=cc.pMult(a,f),e.modeA.radialAccel=this.modeA.radialAccel+this.modeA.radialAccelVar*cc.RANDOM_MINUS1_1(),e.modeA.tangentialAccel=this.modeA.tangentialAccel+this.modeA.tangentialAccelVar*cc.RANDOM_MINUS1_1()}else{var l=this.modeB.startRadius+this.modeB.startRadiusVar*cc.RANDOM_MINUS1_1(),c=this.modeB.endRadius+this.modeB.endRadiusVar*cc.RANDOM_MINUS1_1();e.modeB.radius=l,this.modeB.endRadius==cc.PARTICLE_START_RADIUS_EQUAL_TO_END_RADIUS?e.modeB.deltaRadius=0:e.modeB.deltaRadius=(c-l)/e.timeToLive,e.modeB.angle=u,e.modeB.degreesPerSecond=cc.DEGREES_TO_RADIANS(this.modeB.rotatePerSecond+this.modeB.rotatePerSecondVar*cc.RANDOM_MINUS1_1())}},stopSystem:function(){this._isActive=!1,this._elapsed=this._duration,this._emitCounter=0,this._particlePool=[]},resetSystem:function(){this._isActive=!0,this._elapsed=0;for(this._particleIdx=0;this._particleIdx<this._particleCount;++this._particleIdx){var e=this._particles[this._particleIdx];e.timeToLive=0}},isFull:function(){return this._particleCount>=this._totalParticles},updateQuadWithParticle:function(e,t){},postStep:function(){},update:function(e){if(this._isActive&&this._emissionRate){var t=1/this._emissionRate;this._particleCount<this._totalParticles&&(this._emitCounter+=e);while(this._particleCount<this._totalParticles&&this._emitCounter>t)this.addParticle(),this._emitCounter-=t;this._elapsed+=e,this._duration!=-1&&this._duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var n;this._positionType==cc.PARTICLE_TYPE_FREE?n=this.convertToWorldSpace(this._pointZeroForParticle):this._positionType==cc.PARTICLE_TYPE_RELATIVE&&(n=cc.p(this._position.x,this._position.y));if(this._visible){while(this._particleIdx<this._particleCount){var r=this._particles[this._particleIdx];r.timeToLive-=e;if(r.timeToLive>0){if(this._emitterMode==cc.PARTICLE_MODE_GRAVITY){var i,s,o;r.pos.x||r.pos.y?s=cc.pNormalize(r.pos):s=cc.PointZero(),o=s,s=cc.pMult(s,r.modeA.radialAccel);var u=o.x;o.x=-o.y,o.y=u,o=cc.pMult(o,r.modeA.tangentialAccel),i=cc.pAdd(cc.pAdd(s,o),this.modeA.gravity),i=cc.pMult(i,e),r.modeA.dir=cc.pAdd(r.modeA.dir,i),i=cc.pMult(r.modeA.dir,e),r.pos=cc.pAdd(r.pos,i)}else r.modeB.angle+=r.modeB.degreesPerSecond*e,r.modeB.radius+=r.modeB.deltaRadius*e,r.pos.x=-Math.cos(r.modeB.angle)*r.modeB.radius,r.pos.y=-Math.sin(r.modeB.angle)*r.modeB.radius;this._dontTint||(r.color.r+=r.deltaColor.r*e,r.color.g+=r.deltaColor.g*e,r.color.b+=r.deltaColor.b*e,r.color.a+=r.deltaColor.a*e,r.isChangeColor=!0),r.size+=r.deltaSize*e,r.size=Math.max(0,r.size),r.rotation+=r.deltaRotation*e;var a;if(this._positionType==cc.PARTICLE_TYPE_FREE||this._positionType==cc.PARTICLE_TYPE_RELATIVE){var f=cc.pSub(n,r.startPos);a=cc.pSub(r.pos,f)}else a=r.pos;this._batchNode&&(a.x+=this._position.x,a.y+=this._position.y),cc.renderContextType==cc.WEBGL?this.updateQuadWithParticle(r,a):r.drawPos=a,++this._particleIdx}else{var l=r.atlasIndex;cc.ArrayRemoveObject(this._particles,r),this._particlePool.push(r),this._batchNode&&(this._batchNode.disableParticle(this._atlasIndex+l),this._particles[this._particleCount-1].atlasIndex=l),--this._particleCount;if(this._particleCount==0&&this._isAutoRemoveOnFinish){this.unscheduleUpdate(),this._parent.removeChild(this,!0);return}}}this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(e,t){if(t){var n=t[e];return n!=null?n:""}return""},_updateBlendFunc:function(){cc.Assert(!this._batchNode,"Can't change blending functions when the particle is being batched");if(this._texture&&!(this._texture instanceof HTMLImageElement||this._texture instanceof HTMLCanvasElement)){var e=this._texture.hasPremultipliedAlpha();this._opacityModifyRGB=!1,this._texture&&this._blendFunc.src==cc.BLEND_SRC&&this._blendFunc.dst==cc.BLEND_DST&&(e?this._opacityModifyRGB=!0:(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA))}}}),cc.ParticleSystem.create=function(e){return cc.ParticleSystemQuad.create(e)},cc.ParticleSystem.createWithTotalParticles=function(e){return cc.ParticleSystemQuad.create(e)},cc.ParticleSystem.ModeA=function(e,t,n,r,i,s,o){this.gravity=e?e:cc.PointZero(),this.speed=t||0,this.speedVar=n||0,this.tangentialAccel=r||0,this.tangentialAccelVar=i||0,this.radialAccel=s||0,this.radialAccelVar=o||0},cc.ParticleSystem.ModeB=function(e,t,n,r,i,s){this.startRadius=e||0,this.startRadiusVar=t||0,this.endRadius=n||0,this.endRadiusVar=r||0,this.rotatePerSecond=i||0,this.rotatePerSecondVar=s||0},cc.encodeToBase64=function(e){var t="=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],i="",s=e.length,o;for(o=0;o<s-2;o+=3)i+=n[e[o]>>2],i+=n[((e[o]&3)<<4)+(e[o+1]>>4)],i+=n[((e[o+1]&15)<<2)+(e[o+2]>>6)],i+=n[e[o+2]&63];return s%3&&(o=s-s%3,i+=n[e[o]>>2],s%3===2?(i+=n[((e[o]&3)<<4)+(e[o+1]>>4)],i+=n[(e[o+1]&15)<<2],i+=t):(i+=n[(e[o]&3)<<4],i+=t+t)),i};cc.ParticleSystemQuad=cc.ParticleSystem.extend({_quads:null,_indices:null,_VAOname:0,_buffersVBO:null,_pointRect:null,ctor:function(){this._super(),this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._pointRect=cc.RectZero(),cc.renderContextType===cc.WEBGL&&(this._positionsArray=null,this._positionsArrayBuffer=null,this._colorsArray=null,this._colorsArrayBuffer=null,this._texCoordsArray=null,this._texCoordsArrayBuffer=null)},setupIndices:function(){for(var e=0;e<this._totalParticles;++e){var t=e*6,n=e*4;this._indices[t+0]=n+0,this._indices[t+1]=n+1,this._indices[t+2]=n+2,this._indices[t+5]=n+1,this._indices[t+4]=n+2,this._indices[t+3]=n+3}},initTexCoordsWithRect:function(e){var t=cc.rect(e.origin.x*cc.CONTENT_SCALE_FACTOR(),e.origin.y*cc.CONTENT_SCALE_FACTOR(),e.size.width*cc.CONTENT_SCALE_FACTOR(),e.size.height*cc.CONTENT_SCALE_FACTOR()),n=e.size.width,r=e.size.height;this._texture&&(this._texture instanceof HTMLImageElement||this._texture instanceof HTMLCanvasElement?(n=this._texture.width,r=this._texture.height):(n=this._texture.getPixelsWide(),r=this._texture.getPixelsHigh()));var i,s,o,u;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(t.origin.x*2+1)/(n*2),s=(t.origin.y*2+1)/(r*2),o=i+(t.size.width*2-2)/(n*2),u=s+(t.size.height*2-2)/(r*2)):(i=t.origin.x/n,s=t.origin.y/r,o=i+t.size.width/n,u=s+t.size.height/r);var a=u;u=s,s=a;var f,l=0,c=0;this._batchNode?(f=this._batchNode.getTextureAtlas().getQuads(),l=this._atlasIndex,c=this._atlasIndex+this._totalParticles):(f=this._quads,l=0,c=this._totalParticles);for(var h=l;h<c;h++)f[h]||(f[h]=cc.V3F_C4B_T2F_QuadZero()),f[h].bl.texCoords.u=i,f[h].bl.texCoords.v=s,f[h].br.texCoords.u=o,f[h].br.texCoords.v=s,f[h].tl.texCoords.u=i,f[h].tl.texCoords.v=u,f[h].tr.texCoords.u=o,f[h].tr.texCoords.v=u},clone:function(){var e=new cc.ParticleSystemQuad;return e.initWithTotalParticles(this._totalParticles)&&(e._angle=this._angle,e._angleVar=this._angleVar,e._duration=this._duration,e._blendFunc.src=this._blendFunc.src,e._blendFunc.dst=this._blendFunc.dst,e._startColor.r=this._startColor.r,e._startColor.g=this._startColor.g,e._startColor.b=this._startColor.b,e._startColor.a=this._startColor.a,e._startColorVar.r=this._startColorVar.r,e._startColorVar.g=this._startColorVar.g,e._startColorVar.b=this._startColorVar.b,e._startColorVar.a=this._startColorVar.a,e._endColor.r=this._endColor.r,e._endColor.g=this._endColor.g,e._endColor.b=this._endColor.b,e._endColor.a=this._endColor.a,e._endColorVar.r=this._endColorVar.r,e._endColorVar.g=this._endColorVar.g,e._endColorVar.b=this._endColorVar.b,e._endColorVar.a=this._endColorVar.a,e._startSize=this._startSize,e._startSizeVar=this._startSizeVar,e._endSize=this._endSize,e._endSizeVar=this._endSizeVar,e.setPosition(new cc.Point(this._position.x,this._position.y)),e._posVar.x=this._posVar.x,e._posVar.y=this._posVar.y,e._startSpin=this._startSpin,e._startSpinVar=this._startSpinVar,e._endSpin=this._endSpin,e._endSpinVar=this._endSpinVar,e._emitterMode=this._emitterMode,this._emitterMode==cc.PARTICLE_MODE_GRAVITY?(e.modeA.gravity.x=this.modeA.gravity.x,e.modeA.gravity.y=this.modeA.gravity.y,e.modeA.speed=this.modeA.speed,e.modeA.speedVar=this.modeA.speedVar,e.modeA.radialAccel=this.modeA.radialAccel,e.modeA.radialAccelVar=this.modeA.radialAccelVar,e.modeA.tangentialAccel=this.modeA.tangentialAccel,e.modeA.tangentialAccelVar=this.modeA.tangentialAccelVar):this._emitterMode==cc.PARTICLE_MODE_RADIUS&&(e.modeB.startRadius=this.modeB.startRadius,e.modeB.startRadiusVar=this.modeB.startRadiusVar,e.modeB.endRadius=this.modeB.endRadius,e.modeB.endRadiusVar=this.modeB.endRadiusVar,e.modeB.rotatePerSecond=this.modeB.rotatePerSecond,e.modeB.rotatePerSecondVar=this.modeB.rotatePerSecondVar),e._life=this._life,e._lifeVar=this._lifeVar,e._emissionRate=this._emissionRate,this._batchNode||(e._opacityModifyRGB=this._opacityModifyRGB,this._texture instanceof cc.Texture2D?e._texture=this._texture:e._texture=this._texture)),e},setDisplayFrame:function(e){cc.Assert(cc.Point.CCPointEqualToPoint(e.getOffsetInPixels(),cc.PointZero()),"QuadParticle only supports SpriteFrames with no offsets"),cc.renderContextType===cc.WEBGL&&(!this._texture||e.getTexture()._webTextureObj!=this._texture._webTextureObj)&&this.setTexture(e.getTexture())},setTextureWithRect:function(e,t){cc.renderContextType===cc.WEBGL?((!this._texture||e._webTextureObj!=this._texture._webTextureObj)&&cc.ParticleSystem.prototype.setTexture.call(this,e),this._pointRect=t,this.initTexCoordsWithRect(t)):((!this._texture||e!=this._texture)&&cc.ParticleSystem.prototype.setTexture.call(this,e),this._pointRect=t,this.initTexCoordsWithRect(t))},initWithTotalParticles:function(e){return this._super(e)?cc.renderContextType===cc.CANVAS?!0:this._allocMemory()?(this.setupIndices(),cc.TEXTURE_ATLAS_USE_VAO?this._setupVBOandVAO():this._setupVBO(),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),!0):!1:!1},setTexture:function(e,t){if(t!=null&&t===!0){this._super(e);return}var n=null;e instanceof HTMLImageElement||e instanceof HTMLCanvasElement?n=cc.size(e.width,e.height):n=e.getContentSize(),this.setTextureWithRect(e,cc.rect(0,0,n.width,n.height))},updateQuadWithParticle:function(e,t){var n=null;if(this._batchNode){var r=this._batchNode.getTextureAtlas().getQuads();n=r[this._atlasIndex+e.atlasIndex],this._batchNode.getTextureAtlas()._dirty=!0}else n=this._quads[this._particleIdx];var i=this._opacityModifyRGB?new cc.Color4B(0|e.color.r*e.color.a*255,0|e.color.g*e.color.a*255,0|e.color.b*e.color.a*255,0|e.color.a*255):new cc.Color4B(0|e.color.r*255,0|e.color.g*255,0|e.color.b*255,0|e.color.a*255);n.bl.colors=i,n.br.colors=i,n.tl.colors=i,n.tr.colors=i;var s=e.size/2;if(e.rotation){var o=-s,u=-s,a=s,f=s,l=t.x,c=t.y,h=-cc.DEGREES_TO_RADIANS(e.rotation),p=Math.cos(h),d=Math.sin(h),v=o*p-u*d+l,m=o*d+u*p+c,g=a*p-u*d+l,y=a*d+u*p+c,b=a*p-f*d+l,w=a*d+f*p+c,E=o*p-f*d+l,S=o*d+f*p+c;n.bl.vertices.x=v,n.bl.vertices.y=m,n.br.vertices.x=g,n.br.vertices.y=y,n.tl.vertices.x=E,n.tl.vertices.y=S,n.tr.vertices.x=b,n.tr.vertices.y=w}else n.bl.vertices.x=t.x-s,n.bl.vertices.y=t.y-s,n.br.vertices.x=t.x+s,n.br.vertices.y=t.y-s,n.tl.vertices.x=t.x-s,n.tl.vertices.y=t.y+s,n.tr.vertices.x=t.x+s,n.tr.vertices.y=t.y+s;this._batchNode||(this._setQuadToPositionsTypeArray(n,this._particleIdx),this._setQuadToColorsTypeArray(n,this._particleIdx),this._setQuadToTexCoordsTypeArray(n,this._particleIdx))},postStep:function(){if(cc.renderContextType===cc.WEBGL){var e=cc.renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._positionsArrayBuffer),e.bufferData(e.ARRAY_BUFFER,this._positionsArray,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorsArrayBuffer),e.bufferData(e.ARRAY_BUFFER,this._colorsArray,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._texCoordsArrayBuffer),e.bufferData(e.ARRAY_BUFFER,this._texCoordsArray,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)}},_setQuadToPositionsTypeArray:function(e,t){this._positionsArray[t*12]=e.bl.vertices.x,this._positionsArray[t*12+1]=e.bl.vertices.y,this._positionsArray[t*12+2]=e.bl.vertices.z,this._positionsArray[t*12+3]=e.br.vertices.x,this._positionsArray[t*12+4]=e.br.vertices.y,this._positionsArray[t*12+5]=e.br.vertices.z,this._positionsArray[t*12+6]=e.tl.vertices.x,this._positionsArray[t*12+7]=e.tl.vertices.y,this._positionsArray[t*12+8]=e.tl.vertices.z,this._positionsArray[t*12+9]=e.tr.vertices.x,this._positionsArray[t*12+10]=e.tr.vertices.y,this._positionsArray[t*12+11]=e.tr.vertices.z},_setQuadToColorsTypeArray:function(e,t){this._colorsArray[t*16]=e.bl.colors.r,this._colorsArray[t*16+1]=e.bl.colors.g,this._colorsArray[t*16+2]=e.bl.colors.b,this._colorsArray[t*16+3]=e.bl.colors.a,this._colorsArray[t*16+4]=e.br.colors.r,this._colorsArray[t*16+5]=e.br.colors.g,this._colorsArray[t*16+6]=e.br.colors.b,this._colorsArray[t*16+7]=e.br.colors.a,this._colorsArray[t*16+8]=e.tl.colors.r,this._colorsArray[t*16+9]=e.tl.colors.g,this._colorsArray[t*16+10]=e.tl.colors.b,this._colorsArray[t*16+11]=e.tl.colors.a,this._colorsArray[t*16+12]=e.tr.colors.r,this._colorsArray[t*16+13]=e.tr.colors.g,this._colorsArray[t*16+14]=e.tr.colors.b,this._colorsArray[t*16+15]=e.tr.colors.a},_setQuadToTexCoordsTypeArray:function(e,t){this._texCoordsArray[t*8]=e.bl.texCoords.u,this._texCoordsArray[t*8+1]=e.bl.texCoords.v,this._texCoordsArray[t*8+2]=e.br.texCoords.u,this._texCoordsArray[t*8+3]=e.br.texCoords.v,this._texCoordsArray[t*8+4]=e.tl.texCoords.u,this._texCoordsArray[t*8+5]=e.tl.texCoords.v,this._texCoordsArray[t*8+6]=e.tr.texCoords.u,this._texCoordsArray[t*8+7]=e.tr.texCoords.v},draw:function(e){cc.Assert(!this._batchNode,"draw should not be called when added to a particleBatchNode"),cc.renderContextType===cc.CANVAS?this._drawForCanvas(e):this._drawForWebGL(e),cc.INCREMENT_GL_DRAWS(1)},_drawForCanvas:function(e){var t=e||cc.renderContext;t.save(),this.isBlendAdditive()?t.globalCompositeOperation="lighter":t.globalCompositeOperation="source-over";for(var n=0;n<this._particleCount;n++){var r=this._particles[n],i=0|r.size*.5;if(this._drawMode==cc.PARTICLE_TEXTURE_MODE){var s=this.getTexture();if(!s.width||!s.height)continue;t.save(),t.globalAlpha=r.color.a,t.translate(0|r.drawPos.x,-(0|r.drawPos.y));var o=Math.floor(r.size/4)*4,u=this._pointRect.size.width,a=this._pointRect.size.height;t.scale(Math.max(1/u*o,1e-6),Math.max(1/a*o,1e-6)),r.rotation&&t.rotate(cc.DEGREES_TO_RADIANS(r.rotation)),t.translate(-(0|u/2),-(0|a/2));if(r.isChangeColor){var f=cc.TextureCache.getInstance().getTextureColors(s);f&&(f.tintCache||(f.tintCache=document.createElement("canvas"),f.tintCache.width=s.width,f.tintCache.height=s.height),cc.generateTintImage(s,f,r.color,this._pointRect,f.tintCache),s=f.tintCache)}t.drawImage(s,0,0),t.restore()}else t.save(),t.globalAlpha=r.color.a,t.translate(0|r.drawPos.x,-(0|r.drawPos.y)),this._shapeType==cc.PARTICLE_STAR_SHAPE?(r.rotation&&t.rotate(cc.DEGREES_TO_RADIANS(r.rotation)),cc.drawingUtil.drawStar(t,i,r.color)):cc.drawingUtil.drawColorBall(t,i,r.color),t.restore()}t.restore()},_drawForWebGL:function(e){if(!this._texture||!this._texture.isLoaded())return;var t=e||cc.renderContext;cc.NODE_DRAW_SETUP(this),cc.glBindTexture2D(this._texture),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.Assert(this._particleIdx==this._particleCount,"Abnormal error in particle quad"),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSCOLORTEX),t.bindBuffer(t.ARRAY_BUFFER,this._positionsArrayBuffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsArrayBuffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordsArrayBuffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.drawElements(t.TRIANGLES,this._particleIdx*6,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),cc.INCREMENT_GL_DRAWS(1)},setBatchNode:function(e){if(this._batchNode!=e){var t=this._batchNode;this._super(e),e?t||(this._batchNode.getTextureAtlas().insertQuads(this._quads,this._atlasIndex,this._quads.length),cc.renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.setupIndices(),this.setTexture(t.getTexture()),cc.TEXTURE_ATLAS_USE_VAO?this._setupVBOandVAO():this._setupVBO())}},setTotalParticles:function(e){e<200?this._totalParticles=e:this._totalParticles=200;if(cc.renderContextType===cc.CANVAS)return;if(e>this._allocatedParticles){var t=[],n=[],r=new Uint16Array(e*6);if(!(t&&n&&r)){t&&(this._particles=t),n&&(this._quads=n),r&&(this._indices=r),cc.log("Particle system: out of memory");return}this._particles=t,this._quads=n,this._indices=r,this._positionsArray=new Float32Array(e*12),this._colorsArray=new Uint8Array(e*16),this._texCoordsArray=new Float32Array(e*8);for(var i=0;i<e;i++)this._particles[i]=new cc.Particle,this._quads[i]=new cc.V3F_C4B_T2F_Quad;this._allocatedParticles=e,this._totalParticles=e;if(this._batchNode)for(var s=0;s<this._totalParticles;s++)this._particles[s].atlasIndex=s;this.setupIndices(),cc.TEXTURE_ATLAS_USE_VAO?this._setupVBOandVAO():this._setupVBO()}else this._totalParticles=e},listenBackToForeground:function(e){cc.TEXTURE_ATLAS_USE_VAO?this._setupVBOandVAO():this._setupVBO()},_setupVBOandVAO:function(){},_setupVBO:function(){if(cc.renderContextType==cc.CANVAS)return;var e=cc.renderContext;this._positionsArrayBuffer=e.createBuffer(),this._colorsArrayBuffer=e.createBuffer(),this._texCoordsArrayBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._positionsArrayBuffer),e.bufferData(e.ARRAY_BUFFER,this._positionsArray,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorsArrayBuffer),e.bufferData(e.ARRAY_BUFFER,this._colorsArray,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._texCoordsArrayBuffer),e.bufferData(e.ARRAY_BUFFER,this._texCoordsArray,e.DYNAMIC_DRAW),this._buffersVBO[1]=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)},_allocMemory:function(){if(cc.renderContextType===cc.CANVAS)return;cc.Assert(!this._batchNode,"Memory should not be allocated when not using batchNode"),this._quads=[],this._indices=new Uint16Array(this._totalParticles*6),this._positionsArray=new Float32Array(this._totalParticles*12),this._colorsArray=new Uint8Array(this._totalParticles*16),this._texCoordsArray=new Float32Array(this._totalParticles*8);for(var e=0;e<this._totalParticles;e++)this._quads[e]=new cc.V3F_C4B_T2F_Quad;return!this._quads||!this._indices?(cc.log("cocos2d: Particle system: not enough memory"),!1):!0}}),cc.ParticleSystemQuad.create=function(e){var t=new cc.ParticleSystemQuad;if(!e||typeof e=="number"){var n=e||100;return t.setDrawMode(cc.PARTICLE_TEXTURE_MODE),t.initWithTotalParticles(n),t}return t&&t.initWithFile(e)?t:null},cc.ParticleSystemQuad.createWithTotalParticles=function(e){return cc.ParticleSystemQuad.create(e)},cc.ARCH_OPTIMAL_PARTICLE_SYSTEM=cc.ParticleSystemQuad;cc.ParticleFire=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?300:150)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,0),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=60,this.modeA.speedVar=20,this._angle=90,this._angleVar=10;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,60)),this._posVar=cc.p(40,20),this._life=3,this._lifeVar=.25,this._startSize=54,this._startSizeVar=10,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.76,this._startColor.g=.25,this._startColor.b=.12,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleFire.create=function(){var e=new cc.ParticleFire;return e.init()?e:null},cc.ParticleFireworks=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?1500:150)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,-90),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=180,this.modeA.speedVar=50;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height/2)),this._angle=90,this._angleVar=20,this._life=3.5,this._lifeVar=1,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.5,this._startColor.g=.5,this._startColor.b=.5,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=.1,this._endColor.r=.1,this._endColor.g=.1,this._endColor.b=.1,this._endColor.a=.2,this._endColorVar.r=.1,this._endColorVar.g=.1,this._endColorVar.b=.1,this._endColorVar.a=.2,this._startSize=8,this._startSizeVar=2,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleFireworks.create=function(){var e=new cc.ParticleFireworks;return e.init()?e:null},cc.ParticleSun=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?350:150)},initWithTotalParticles:function(e){if(this._super(e)){this.setBlendAdditive(!0),this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,0),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=20,this.modeA.speedVar=5,this._angle=90,this._angleVar=360;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=1,this._lifeVar=.5,this._startSize=30,this._startSizeVar=10,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.76,this._startColor.g=.25,this._startColor.b=.12,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,!0}return!1}}),cc.ParticleSun.create=function(){var e=new cc.ParticleSun;return e.init()?e:null},cc.ParticleGalaxy=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?200:100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,0),this.modeA.speed=60,this.modeA.speedVar=10,this.modeA.radialAccel=-80,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=80,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=4,this._lifeVar=1,this._startSize=37,this._startSizeVar=10,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.12,this._startColor.g=.25,this._startColor.b=.76,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleGalaxy.create=function(){var e=new cc.ParticleGalaxy;return e.init()?e:null},cc.ParticleFlower=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?250:100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,0),this.modeA.speed=80,this.modeA.speedVar=10,this.modeA.radialAccel=-60,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=15,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=4,this._lifeVar=1,this._startSize=30,this._startSizeVar=10,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.5,this._startColor.g=.5,this._startColor.b=.5,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=.5,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleFlower.create=function(){var e=new cc.ParticleFlower;return e.init()?e:null},cc.ParticleMeteor=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?150:100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(-200,200),this.modeA.speed=15,this.modeA.speedVar=5,this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=2,this._lifeVar=1,this._startSize=60,this._startSizeVar=10,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.2,this._startColor.g=.4,this._startColor.b=.7,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=.2,this._startColorVar.a=.1,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleMeteor.create=function(){var e=new cc.ParticleMeteor;return e.init()?e:null},cc.ParticleSpiral=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?500:100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,0),this.modeA.speed=150,this.modeA.speedVar=0,this.modeA.radialAccel=-380,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=45,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=0;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=12,this._lifeVar=0,this._startSize=20,this._startSizeVar=0,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.5,this._startColor.g=.5,this._startColor.b=.5,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=0,this._endColor.r=.5,this._endColor.g=.5,this._endColor.b=.5,this._endColor.a=1,this._endColorVar.r=.5,this._endColorVar.g=.5,this._endColorVar.b=.5,this._endColorVar.a=0,this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleSpiral.create=function(){var e=new cc.ParticleSpiral;return e.init()?e:null},cc.ParticleExplosion=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?700:300)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=.1,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,0),this.modeA.speed=70,this.modeA.speedVar=40,this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=5,this._lifeVar=2,this._startSize=15,this._startSizeVar=10,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._duration,this._startColor.r=.7,this._startColor.g=.1,this._startColor.b=.2,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=0,this._endColor.r=.5,this._endColor.g=.5,this._endColor.b=.5,this._endColor.a=0,this._endColorVar.r=.5,this._endColorVar.g=.5,this._endColorVar.b=.5,this._endColorVar.a=0,this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleExplosion.create=function(){var e=new cc.ParticleExplosion;return e.init()?e:null},cc.ParticleSmoke=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?200:100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,0),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=25,this.modeA.speedVar=10,this._angle=90,this._angleVar=5;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,0)),this._posVar=cc.p(20,0),this._life=4,this._lifeVar=1,this._startSize=60,this._startSizeVar=10,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.8,this._startColor.g=.8,this._startColor.b=.8,this._startColor.a=1,this._startColorVar.r=.02,this._startColorVar.g=.02,this._startColorVar.b=.02,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleSmoke.create=function(){var e=new cc.ParticleSmoke;return e.init()?e:null},cc.ParticleSnow=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?700:250)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(0,-1),this.modeA.speed=5,this.modeA.speedVar=1,this.modeA.radialAccel=0,this.modeA.radialAccelVar=1,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=1;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height+10)),this._posVar=cc.p(t.width/2,0),this._angle=-90,this._angleVar=5,this._life=45,this._lifeVar=15,this._startSize=10,this._startSizeVar=5,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=10,this._startColor.r=1,this._startColor.g=1,this._startColor.b=1,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=1,this._endColor.g=1,this._endColor.b=1,this._endColor.a=0,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleSnow.create=function(){var e=new cc.ParticleSnow;return e.init()?e:null},cc.ParticleRain=cc.ParticleSystemQuad.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?1e3:300)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.PARTICLE_DURATION_INFINITY,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.p(10,-10),this.modeA.radialAccel=0,this.modeA.radialAccelVar=1,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=1,this.modeA.speed=130,this.modeA.speedVar=30,this._angle=-90,this._angleVar=5;var t=cc.Director.getInstance().getWinSize();return this.setPosition(cc.p(t.width/2,t.height)),this._posVar=cc.p(t.width/2,0),this._life=4.5,this._lifeVar=0,this._startSize=4,this._startSizeVar=2,this._endSize=cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=20,this._startColor.r=.7,this._startColor.g=.8,this._startColor.b=1,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=.7,this._endColor.g=.8,this._endColor.b=1,this._endColor.a=.5,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleRain.create=function(){var e=new cc.ParticleRain;return e.init()?e:null};cc.PARTICLE_DEFAULT_CAPACITY=500,cc.ParticleBatchNode=cc.Node.extend({TextureProtocol:!0,_blendFunc:null,_textureAtlas:null,ctor:function(){this._super(),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST}},initWithTexture:function(e,t){return this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(e,t),this._children=[],cc.renderContextType===cc.WEBGL&&this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),!0},initWithFile:function(e,t){var n=cc.TextureCache.getInstance().addImage(e);return this.initWithTexture(n,t)},init:function(e,t){var n=cc.TextureCache.getInstance().addImage(e);return this.initWithTexture(n,t)},addChild:function(e,t,n){cc.Assert(e!=null,"Argument must be non-NULL"),cc.Assert(e instanceof cc.ParticleSystem,"cc.ParticleBatchNode only supports cc.ParticleSystemQuads as children"),t=t==null?e.getZOrder():t,n=n==null?e.getTag():n,cc.Assert(e.getTexture()==this._textureAtlas.getTexture(),"cc.ParticleSystem is not using the same texture id"),this._children.length===0&&this.setBlendFunc(e.getBlendFunc()),cc.Assert(this._blendFunc.src==e.getBlendFunc().src&&this._blendFunc.dst==e.getBlendFunc().dst,"Can't add a PaticleSystem that uses a differnt blending function");var r=this._addChildHelper(e,t,n),i=0;if(r!=0){var s=this._children[r-1];i=s.getAtlasIndex()+s.getTotalParticles()}else i=0;this.insertChild(e,i),e.setBatchNode(this)},insertChild:function(e,t){e.setAtlasIndex(t),this._textureAtlas.getTotalQuads()+e.getTotalParticles()>this._textureAtlas.getCapacity()&&(this._increaseAtlasCapacityTo(this._textureAtlas.getTotalQuads()+e.getTotalParticles()),this._textureAtlas.fillWithEmptyQuadsFromIndex(this._textureAtlas.getCapacity()-e.getTotalParticles(),e.getTotalParticles())),e.getAtlasIndex()+e.getTotalParticles()!=this._textureAtlas.getTotalQuads()&&this._textureAtlas.moveQuadsFromIndex(t,t+e.getTotalParticles()),this._textureAtlas.increaseTotalQuadsWith(e.getTotalParticles()),this._updateAllAtlasIndexes()},removeChild:function(e,t){if(e==null)return;cc.Assert(e instanceof cc.ParticleSystem,"cc.ParticleBatchNode only supports cc.ParticleSystemQuads as children"),cc.Assert(this._children.indexOf(e)>-1,"cc.ParticleBatchNode doesn't contain the sprite. Can't remove it"),this._super(e,t),this._textureAtlas.removeQuadsAtIndex(e.getAtlasIndex(),e.getTotalParticles()),this._textureAtlas.fillWithEmptyQuadsFromIndex(this._textureAtlas.getTotalQuads(),e.getTotalParticles()),e.setBatchNode(null),this._updateAllAtlasIndexes()},reorderChild:function(e,t){cc.Assert(e!=null,"Child must be non-NULL"),cc.Assert(e instanceof cc.ParticleSystem,"cc.ParticleBatchNode only supports cc.QuadParticleSystems as children"),cc.Assert(this._children.indexOf(e)===-1,"Child doesn't belong to batch");if(t==e.getZOrder())return;if(this._children.length>1){var n=this._getCurrentIndex(e,t);if(n.oldIndex!=n.newIndex){cc.ArrayRemoveObjectAtIndex(this._children,n.oldIndex),this._children=cc.ArrayAppendObjectToIndex(this._children,e,n.newIndex);var r=e.getAtlasIndex();this._updateAllAtlasIndexes();var i=0;for(var s=0;s<this._children.length;s++){var o=this._children[s];if(o==e){i=e.getAtlasIndex();break}}this._textureAtlas.moveQuadsFromIndex(r,e.getTotalParticles(),i),e.updateWithNoTime()}}e._setZOrder(t)},removeChildAtIndex:function(e,t){this.removeChild(this._children[i],t)},removeAllChildren:function(e){for(var t=0;t<this._children.length;t++)this._children[t].setBatchNode(null);this._super(e),this._textureAtlas.removeAllQuads()},disableParticle:function(e){var t=this._textureAtlas.getQuads()[e];t.br.vertices.x=t.br.vertices.y=t.tr.vertices.x=t.tr.vertices.y=t.tl.vertices.x=t.tl.vertices.y=t.bl.vertices.x=t.bl.vertices.y=0},draw:function(e){if(cc.renderContextType===cc.CANVAS)return;if(this._textureAtlas.getTotalQuads()==0)return;cc.NODE_DRAW_SETUP(this),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),this._textureAtlas.drawQuads()},getTexture:function(){return this._textureAtlas.getTexture()},setTexture:function(e){this._textureAtlas.setTexture(e),e&&!e.hasPremultipliedAlpha()&&this._blendFunc.src==gl.BLEND_SRC&&this._blendFunc.dst==gl.BLEND_DST&&(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(e,t){arguments.length==1?this._blendFunc=e:this._blendFunc={src:e,dst:t}},getBlendFunc:function(){return this._blendFunc},visit:function(e){if(cc.renderContextType===cc.WEBGL){this._super(e);return}if(!this._visible)return;cc.kmGLPushMatrix(),this._grid&&this._grid.isActive()&&(this._grid.beforeDraw(),this.transformAncestors()),this.transform(e),this.draw(e),this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),cc.kmGLPopMatrix()},_updateAllAtlasIndexes:function(){var e=0;for(var t=0;t<this._children[0].length;t++){var n=this._children[t];n.setAtlasIndex(e),e+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(e){cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this._textureAtlas.getCapacity()+"] to ["+e+"]."),this._textureAtlas.resizeCapacity(e)||(cc.log("cocos2d: WARNING: Not enough memory to resize the atlas"),cc.Assert(!1,"XXX: cc.ParticleBatchNode #increaseAtlasCapacity SHALL handle this assert"))},_searchNewPositionInChildrenForZ:function(e){var t=this._children.length;for(var n=0;n<t;n++)if(this._children[n].getZOrder()>e)return n;return t},_getCurrentIndex:function(e,t){var n=!1,r=!1,i=0,s=0,o=0,u=this._children.length;for(var a=0;a<u;a++){var f=this._children[a];if(f.getZOrder()>t&&!r){i=a,r=!0;if(n&&r)break}if(e==f){s=a,n=!0,r||(o=-1);if(n&&r)break}}return r||(i=u),i+=o,{newIndex:i,oldIndex:s}},_addChildHelper:function(e,t,n){cc.Assert(e!=null,"Argument must be non-nil"),cc.Assert(e.getParent()==null,"child already added. It can't be added again"),this._children||(this._children=[]);var r=this._searchNewPositionInChildrenForZ(t);return this._children=cc.ArrayAppendObjectToIndex(this._children,e,r),e.setTag(n),e._setZOrder(t),e.setParent(this),this._running&&(e.onEnter(),e.onEnterTransitionDidFinish()),r},_updateBlendFunc:function(){this._textureAtlas.getTexture().hasPremultipliedAlpha()||(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this._textureAtlas},setTextureAtlas:function(e){this._textureAtlas=e}}),cc.ParticleBatchNode.createWithTexture=function(e,t){var n=new cc.ParticleBatchNode;return n&&n.initWithTexture(e,t)?n:null},cc.ParticleBatchNode.create=function(e,t){var n=new cc.ParticleBatchNode;return n&&n.init(e,t)?n:null};cc.Touch=cc.Class.extend({_point:null,_prevPoint:cc.PointZero(),_id:0,ctor:function(e,t,n){this._point=cc.p(e||0,t||0),this._id=n||0},getLocation:function(){return this._point},getPreviousLocation:function(){return this._prevPoint},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getID:function(){return this._id},getId:function(){return this._id},setTouchInfo:function(e,t,n){this._prevPoint=this._point,this._point=cc.p(t||0,n||0),this._id=e},_setPrevPoint:function(e,t){this._prevPoint=cc.p(e||0,t||0)}}),cc.TouchDelegate=cc.Class.extend({_eventTypeFuncMap:null,onTouchBegan:function(e,t){return!1},onTouchMoved:function(e,t){},onTouchEnded:function(e,t){},onTouchCancelled:function(e,t){},onTouchesBegan:function(e,t){},onTouchesMoved:function(e,t){},onTouchesEnded:function(e,t){},onTouchesCancelled:function(e,t){},touchDelegateRetain:function(){},touchDelegateRelease:function(){}}),cc.TargetedTouchDelegate=cc.TouchDelegate.extend({onTouchBegan:function(e,t){return!1},onTouchMoved:function(e,t){},onTouchEnded:function(e,t){},onTouchCancelled:function(e,t){}}),cc.StandardTouchDelegate=cc.TouchDelegate.extend({onTouchesBegan:function(e,t){},onTouchesMoved:function(e,t){},onTouchesEnded:function(e,t){},onTouchesCancelled:function(e,t){}});cc.TouchHandler=cc.Class.extend({_delegate:null,_priority:0,_enabledSelectors:0,getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getPriority:function(){return this._priority},setPriority:function(e){this._priority=e},getEnabledSelectors:function(){return this._enabledSelectors},setEnalbedSelectors:function(e){this._enabledSelectors=e},initWithDelegate:function(e,t){return cc.Assert(e!=null,"TouchHandler.initWithDelegate():touch delegate should not be null"),this._delegate=e,this._priority=t,this._enabledSelectors=0,!0}}),cc.TouchHandler.handlerWithDelegate=function(e,t){var n=new cc.TouchHandler;return n&&n.initWithDelegate(e,t),n},cc.StandardTouchHandler=cc.TouchHandler.extend({initWithDelegate:function(e,t){return this._super(e,t)?!0:!1}}),cc.StandardTouchHandler.handlerWithDelegate=function(e,t){var n=new cc.StandardTouchHandler;return n&&n.initWithDelegate(e,t),n},cc.TargetedTouchHandler=cc.TouchHandler.extend({_swallowsTouches:!1,_claimedTouches:null,isSwallowsTouches:function(){return this._swallowsTouches},setSwallowsTouches:function(e){this._swallowsTouches=e},getClaimedTouches:function(){return this._claimedTouches},initWithDelegate:function(e,t,n){return this._super(e,t)?(this._claimedTouches=[],this._swallowsTouches=n,!0):!1}}),cc.TargetedTouchHandler.handlerWithDelegate=function(e,t,n){var r=new cc.TargetedTouchHandler;return r&&r.initWithDelegate(e,t,n),r};cc.TouchSelectorBeganBit=1,cc.TouchSelectorMovedBit=2,cc.TouchSelectorEndedBit=4,cc.TouchSelectorCancelledBit=8,cc.TouchSelectorAllBits=cc.TouchSelectorBeganBit|cc.TouchSelectorMovedBit|cc.TouchSelectorEndedBit|cc.TouchSelectorCancelledBit,cc.TOUCH_BEGAN=0,cc.TOUCH_MOVED=1,cc.TOUCH_ENDED=2,cc.TOUCH_CANCELLED=3,cc.TouchMax=4,cc.less=function(e,t){return e.getPriority()>t.getPriority()},cc.TouchHandlerHelperData=function(e){this.type=e},cc.TouchDispatcher=cc.Class.extend({_mousePressed:!1,_targetedHandlers:null,_standardHandlers:null,_locked:!1,_toAdd:!1,_toRemove:!1,_handlersToAdd:null,_handlersToRemove:null,_toQuit:!1,_dispatchEvents:!1,_handlerHelperData:[new cc.TouchHandlerHelperData(cc.TOUCH_BEGAN),new cc.TouchHandlerHelperData(cc.TOUCH_MOVED),new cc.TouchHandlerHelperData(cc.TOUCH_ENDED),new cc.TouchHandlerHelperData(cc.TOUCH_CANCELLED)],init:function(){return this._dispatchEvents=!0,this._targetedHandlers=[],this._standardHandlers=[],this._handlersToAdd=[],this._handlersToRemove=[],this._toRemove=!1,this._toAdd=!1,this._toQuit=!1,this._locked=!1,this._mousePressed=!1,cc.TouchDispatcher.registerHtmlElementEvent(cc.canvas),!0},_setMousePressed:function(e){this._mousePressed=e},_getMousePressed:function(){return this._mousePressed},isDispatchEvents:function(){return this._dispatchEvents},setDispatchEvents:function(e){this._dispatchEvents=e},addStandardDelegate:function(e,t){var n=cc.StandardTouchHandler.handlerWithDelegate(e,t);if(!this._locked)this._standardHandlers=this.forceAddHandler(n,this._standardHandlers);else{if(this._handlersToRemove.indexOf(e)!=-1){cc.ArrayRemoveObject(this._handlersToRemove,e);return}this._handlersToAdd.push(n),this._toAdd=!0}},addTargetedDelegate:function(e,t,n){var r=cc.TargetedTouchHandler.handlerWithDelegate(e,t,n);if(!this._locked)this._targetedHandlers=this.forceAddHandler(r,this._targetedHandlers);else{if(this._handlersToRemove.indexOf(e)!=-1){cc.ArrayRemoveObject(this._handlersToRemove,e);return}this._handlersToAdd.push(r),this._toAdd=!0}},forceAddHandler:function(e,t){var n=0,r;for(var i=0;i<t.length;i++){r=t[i];if(r){r.getPriority()<e.getPriority()&&++n;if(r.getDelegate()==e.getDelegate())return cc.Assert(0,"TouchDispatcher.forceAddHandler()"),t}}return cc.ArrayAppendObjectToIndex(t,e,n)},forceRemoveAllDelegates:function(){this._standardHandlers.length=0,this._targetedHandlers.length=0},removeDelegate:function(e){if(e==null)return;if(!this._locked)this.forceRemoveDelegate(e);else{var t=this.findHandler(this._handlersToAdd,e);if(t){cc.ArrayRemoveObject(this._handlersToAdd,t);return}this._handlersToRemove.push(e),this._toRemove=!0}},removeAllDelegates:function(){this._locked?this._toQuit=!0:this.forceRemoveAllDelegates()},setPriority:function(e,t){cc.Assert(t!=null,"TouchDispatcher.setPriority():Arguments is null");var n=this.findHandler(t);cc.Assert(n!=null,"TouchDispatcher.setPriority():Cant find TouchHandler"),n.getPriority()!=e&&(n.setPriority(e),this.rearrangeHandlers(this._targetedHandlers),this.rearrangeHandlers(this._standardHandlers))},touches:function(e,t,n){cc.Assert(n>=0&&n<4,"TouchDispatcher.touches()"),this._locked=!0;var r=this._targetedHandlers.length,i=this._standardHandlers.length,s=r&&i,o=s?e.slice():e,u=this._handlerHelperData[n];if(r>0){var a,f,l;for(var c=0;c<e.length;c++){a=e[c];for(var h=0;h<this._targetedHandlers.length;h++){f=this._targetedHandlers[h];if(!f)break;l=!1;if(n==cc.TOUCH_BEGAN)f.getDelegate().onTouchBegan&&(l=f.getDelegate().onTouchBegan(a,t),l&&f.getClaimedTouches().push(a));else if(f.getClaimedTouches().length>0){l=!0;switch(u.type){case cc.TOUCH_MOVED:cc.Browser.isMobile?f.getDelegate().onTouchMoved&&f.getDelegate().onTouchMoved(a,t):this._mousePressed&&f.getDelegate().onTouchMoved&&f.getDelegate().onTouchMoved(a,t);break;case cc.TOUCH_ENDED:f.getDelegate().onTouchEnded&&f.getDelegate().onTouchEnded(a,t),f.getClaimedTouches().length=0;break;case cc.TOUCH_CANCELLED:f.getDelegate().onTouchCancelled&&f.getDelegate().onTouchCancelled(a,t),f.getClaimedTouches().length=0}}if(l&&f.isSwallowsTouches()){s&&cc.ArrayRemoveObject(o,a);break}}}}if(i>0)for(c=0;c<this._standardHandlers.length;c++){f=this._standardHandlers[c];if(!f)break;switch(u.type){case cc.TOUCH_BEGAN:o.length>0&&f.getDelegate().onTouchesBegan&&f.getDelegate().onTouchesBegan(o,t);break;case cc.TOUCH_MOVED:o.length>0&&(cc.Browser.isMobile||isXC?f.getDelegate().onTouchesMoved&&f.getDelegate().onTouchesMoved(o,t):this._mousePressed&&f.getDelegate().onTouchesMoved&&f.getDelegate().onTouchesMoved(o,t));break;case cc.TOUCH_ENDED:f.getDelegate().onTouchesEnded&&f.getDelegate().onTouchesEnded(o,t);break;case cc.TOUCH_CANCELLED:f.getDelegate().onTouchesCancelled&&f.getDelegate().onTouchesCancelled(o,t)}}s&&(o=null),this._locked=!1;if(this._toRemove){this._toRemove=!1;for(c=0;c<this._handlersToRemove.length;c++)this.forceRemoveDelegate(this._handlersToRemove[c]);this._handlersToRemove.length=0}if(this._toAdd){this._toAdd=!1;for(c=0;c<this._handlersToAdd.length;c++){f=this._handlersToAdd[c];if(!f)break;f instanceof cc.TargetedTouchHandler?this._targetedHandlers=this.forceAddHandler(f,this._targetedHandlers):this._standardHandlers=this.forceAddHandler(f,this._standardHandlers)}this._handlersToAdd.length=0}this._toQuit&&(this._toQuit=!1,this.forceRemoveAllDelegates())},touchesBegan:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_BEGAN)},touchesMoved:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_MOVED)},touchesEnded:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_ENDED)},touchesCancelled:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_CANCELLED)},findHandler:function(e,t){switch(arguments.length){case 1:t=arguments[0];for(var n=0;n<this._targetedHandlers.length;n++)if(this._targetedHandlers[n].getDelegate()==t)return this._targetedHandlers[n];for(n=0;n<this._standardHandlers.length;n++)if(this._standardHandlers[n].getDelegate()==t)return this._standardHandlers[n];return null;case 2:cc.Assert(e!=null&&t!=null,"TouchDispatcher.findHandler():Arguments is null");for(n=0;n<e.length;n++)if(e[n].getDelegate()==t)return e[n];return null;default:throw"Argument must be non-nil "}},forceRemoveDelegate:function(e){var t;for(var n=0;n<this._standardHandlers.length;n++){t=this._standardHandlers[n];if(t&&t.getDelegate()==e){cc.ArrayRemoveObject(this._standardHandlers,t);break}}for(n=0;n<this._targetedHandlers.length;n++){t=this._targetedHandlers[n];if(t&&t.getDelegate()==e){cc.ArrayRemoveObject(this._targetedHandlers,t);break}}},rearrangeHandlers:function(e){e.sort(cc.less)}}),cc.TouchDispatcher.preTouchPoint=cc.p(0,0),cc.TouchDispatcher.isRegisterEvent=!1,cc.getHTMLElementPosition=function(e){var t=document.documentElement,n=window,r=null;return typeof e.getBoundingClientRect=="function"?r=e.getBoundingClientRect():e instanceof HTMLCanvasElement?r={left:0,top:0,width:e.width,height:e.height}:r={left:0,top:0,width:parseInt(e.style.width),height:parseInt(e.style.height)},isXC?r:{left:r.left+n.pageXOffset-t.clientLeft,top:r.top+n.pageYOffset-t.clientTop,width:r.width,height:r.height}},cc.ProcessMouseupEvent=function(e,t){var n=cc.getHTMLElementPosition(e),r,i;t.hasOwnProperty("pageX")?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesEnded(u,null)},cc.TouchDispatcher.registerHtmlElementEvent=function(e){if(cc.TouchDispatcher.isRegisterEvent)return;if(!cc.Browser.isMobile&&!isXC)window.addEventListener("mousedown",function(e){cc.Director.getInstance().getTouchDispatcher()._setMousePressed(!0)}),window.addEventListener("mouseup",function(t){cc.Director.getInstance().getTouchDispatcher()._setMousePressed(!1);var n=cc.getHTMLElementPosition(e),r,i;t.hasOwnProperty("pageX")?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);if(!cc.rectContainsPoint(new cc.Rect(n.left,n.top,n.width,n.height),cc.p(r,i))){var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesEnded(u,null)}}),e.addEventListener("mousedown",function(t){var n=cc.getHTMLElementPosition(e),r,i;t.hasOwnProperty("pageX")?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesBegan(u,null)}),e.addEventListener("mouseup",function(t){cc.ProcessMouseupEvent(e,t)}),e.addEventListener("mousemove",function(t){var n=cc.getHTMLElementPosition(e),r,i;t.hasOwnProperty("pageX")?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesMoved(u,null)});else if(window.navigator.msPointerEnabled){var t={MSPointerDown:"touchesBegan",MSPointerMove:"touchesMoved",MSPointerUp:"touchesEnded",MSPointerCancel:"touchesCancelled"};for(var n in t)(function(t,n){e.addEventListener(t,function(t){var r=cc.getHTMLElementPosition(e);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop;var i,s,o,u;i=t.clientX,s=t.clientY;var a=cc.EGLView.getInstance().convertToLocationInView(i,s,r),o=new cc.Touch(a.x,a.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=a.x,cc.TouchDispatcher.preTouchPoint.y=a.y,cc.Director.getInstance().getTouchDispatcher()[n]([o],null),t.stopPropagation(),t.preventDefault()},!1)})(n,t[n])}else e.addEventListener("touchstart",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);isXC?(r.left=0,r.top=0):(r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop);var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=isXC?i.pageX:i.clientX,o=isXC?i.pageY:i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.hasOwnProperty("identifier")?(u=new cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._setPreTouch(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesBegan(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchmove",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);isXC?(r.left=0,r.top=0):(r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop);var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=isXC?i.pageX:i.clientX,o=isXC?i.pageY:i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.hasOwnProperty("identifier")?(u=new cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._setPreTouch(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesMoved(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchend",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);isXC?(r.left=0,r.top=0):(r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop);var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=isXC?i.pageX:i.clientX,o=isXC?i.pageY:i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.hasOwnProperty("identifier")?(u=new cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._deletePreTouchWithSameId(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesEnded(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchcancel",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);isXC?(r.left=0,r.top=0):(r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop);var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=isXC?i.pageX:i.clientX,o=isXC?i.pageY:i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.hasOwnProperty("identifier")?(u=new cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._deletePreTouchWithSameId(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesCancelled(n,null),t.stopPropagation(),t.preventDefault()},!1);cc.TouchDispatcher.isRegisterEvent=!0},cc.TouchDispatcher._getPreTouch=function(e){var t=null,n=cc.TouchDispatcher._preTouchPool,r=e.getId();for(var i=n.length-1;i>=0;i--)if(n[i].getId()==r){t=n[i];break}return t||(t=e),t},cc.TouchDispatcher._setPreTouch=function(e){var t=!1,n=cc.TouchDispatcher._preTouchPool,r=e.getId();for(var i=n.length-1;i>=0;i--)if(n[i].getId()==r){n[i]=e,t=!0;break}t||(n.length<=50?n.push(e):(n[cc.TouchDispatcher._preTouchPoolPointer]=e,cc.TouchDispatcher._preTouchPoolPointer=(cc.TouchDispatcher._preTouchPoolPointer+1)%50))},cc.TouchDispatcher._deletePreTouchWithSameId=function(e){var t,n=cc.TouchDispatcher._preTouchPool,r=e.getId();for(var i=n.length-1;i>=0;i--)if(n[i].getId()==r){t=n.pop(),i!=n.length&&(n[i]=t);break}},cc.TouchDispatcher._preTouchPool=[],cc.TouchDispatcher._preTouchPoolPointer=0;cc.MOUSE_DOWN=1,cc.MOUSE_MOVED=2,cc.MOUSE_DRAGGED=4,cc.MOUSE_UP=8,cc.RIGHT_MOUSE_DOWN=16,cc.RIGHT_MOUSE_DRAGGED=32,cc.RIGHT_MOUSE_UP=64,cc.OTHER_MOUSE_DOWN=128,cc.OTHER_MOUSE_DRAGGED=256,cc.OTHER_MOUSE_UP=512,cc.SCROLL_WHEEL=1024,cc.MOUSE_ENTERED=2048,cc.MOUSE_EXITED=4096,cc.MOUSE_LEFTBUTTON=0,cc.MOUSE_MIDDLEBUTTON=1,cc.MOUSE_RIGHTBUTTON=2,cc.MouseEventDelegate=cc.Class.extend({onMouseDown:function(e){return!1},onMouseDragged:function(e){return!1},onMouseMoved:function(e){return!1},onMouseUp:function(e){return!1},onRightMouseDown:function(e){return!1},onRightMouseDragged:function(e){return!1},onRightMouseUp:function(e){return!1},onOtherMouseDown:function(e){return!1},onOtherMouseDragged:function(e){return!1},onOtherMouseUp:function(e){return!1},onScrollWheel:function(e){return!1},onMouseEntered:function(e){return!1},onMouseExited:function(e){return!1}}),cc.Mouse=cc.Touch.extend({_wheelDelta:0,_button:cc.MOUSE_LEFTBUTTON,getWheelDelta:function(){return this._wheelDelta},setWheelDelta:function(e){this._wheelDelta=e},getButton:function(){return this._button},setButton:function(e){this._button=e}}),cc.MouseHandler=cc.Class.extend({_delegate:null,_priority:0,_enabledSelectors:0,getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getPriority:function(){return this._priority},setPriority:function(e){this._priority=e},getEnabledSelectors:function(){return this._enabledSelectors},setEnalbedSelectors:function(e){this._enabledSelectors=e},initWithDelegate:function(e,t){this._delegate=e,this._priority=t}}),cc.MouseHandler.create=function(e,t){var n=new cc.MouseHandler;return n.initWithDelegate(e,t),n},cc.MouseDispatcher=cc.Class.extend({_mousePressed:!1,_rightMousePressed:!1,_mouseDelegateHandlers:null,_dispatchEvents:!1,init:function(){return this._dispatchEvents=!0,this._mouseDelegateHandlers=[],this._mousePressed=!1,this._rightMousePressed=!1,cc.MouseDispatcher._registerHtmlElementEvent(cc.canvas),!0},_setMousePressed:function(e){this._mousePressed=e},_getMousePressed:function(){return this._mousePressed},_setRightMousePressed:function(e){this._rightMousePressed=e},_getRightMousePressed:function(){return this._rightMousePressed},addMouseDelegate:function(e,t){var n=cc.MouseHandler.create(e,t);this._mouseDelegateHandlers=this.forceAddHandler(n,this._mouseDelegateHandlers)},forceAddHandler:function(e,t){var n=0;for(var r=0;r<t.length;r++){var i=t[r];if(i){i.getPriority()<e.getPriority()&&++n;if(i.getDelegate()==e.getDelegate())return cc.Assert(0,"TouchDispatcher.forceAddHandler()"),t}}return cc.ArrayAppendObjectToIndex(t,e,n)},removeMouseDelegate:function(e){if(e==null)return;for(var t=0;t<this._mouseDelegateHandlers.length;t++){var n=this._mouseDelegateHandlers[t];if(n&&n.getDelegate()==e){cc.ArrayRemoveObject(this._mouseDelegateHandlers,n);break}}},_findHandler:function(e){for(i=0;i<this._mouseDelegateHandlers.length;i++)if(this._mouseDelegateHandlers[i]&&this._mouseDelegateHandlers[i].getDelegate()==e)return this._mouseDelegateHandlers[i]},setPriority:function(e,t){cc.Assert(t!=null,"MouseDispatcher.setPriority():Arguments is null");var n=this._findHandler(t);cc.Assert(n!=null,"MouseDispatcher.setPriority():Cant find MouseHandler"),n.getPriority()!=e&&(n.setPriority(e),this._mouseDelegateHandlers.sort(cc.less))},removeAllMouseDelegates:function(){this._mouseDelegateHandlers.length=0},mouseHandle:function(e,t,n){for(var r=0;r<this._mouseDelegateHandlers.length;r++){var i=this._mouseDelegateHandlers[r];switch(n){case cc.MOUSE_DOWN:e.getButton()==cc.MOUSE_RIGHTBUTTON?i.getDelegate().onRightMouseDown&&i.getDelegate().onRightMouseDown(e):i.getDelegate().onMouseDown&&i.getDelegate().onMouseDown(e);break;case cc.MOUSE_UP:e.getButton()==cc.MOUSE_RIGHTBUTTON?i.getDelegate().onRightMouseUp&&i.getDelegate().onRightMouseUp(e):i.getDelegate().onMouseUp&&i.getDelegate().onMouseUp(e);break;case cc.MOUSE_MOVED:this._mousePressed?i.getDelegate().onMouseDragged&&i.getDelegate().onMouseDragged(e):this._rightMousePressed?i.getDelegate().onRightMouseDragged&&i.getDelegate().onRightMouseDragged(e):i.getDelegate().onMouseMoved&&i.getDelegate().onMouseMoved(e);break;case cc.MOUSE_ENTERED:i.getDelegate().onMouseEntered&&i.getDelegate().onMouseEntered(e);break;case cc.MOUSE_EXITED:i.getDelegate().onMouseExited&&i.getDelegate().onMouseExited(e);break;case cc.SCROLL_WHEEL:i.getDelegate().onScrollWheel&&i.getDelegate().onScrollWheel(e)}}}}),cc.MouseDispatcher._preMousePoint=cc.p(0,0),cc.MouseDispatcher._isRegisterEvent=!1,cc.MouseDispatcher._registerHtmlElementEvent=function(e){function t(t){var n=cc.getHTMLElementPosition(e),r=t.pageX,i=t.pageY,s=(r-n.left)/cc.Director.getInstance().getContentScaleFactor(),o=(n.height-(i-n.top))/cc.Director.getInstance().getContentScaleFactor(),u=new cc.Mouse(s,o);return u._setPrevPoint(cc.MouseDispatcher._preMousePoint.x,cc.MouseDispatcher._preMousePoint.y),u.setButton(t.button),cc.MouseDispatcher._preMousePoint.x=s,cc.MouseDispatcher._preMousePoint.y=o,u}if(cc.MouseDispatcher._isRegisterEvent)return;window.addEventListener("mousedown",function(e){e.button==cc.MOUSE_RIGHTBUTTON?cc.Director.getInstance().getMouseDispatcher()._setRightMousePressed(!0):cc.Director.getInstance().getMouseDispatcher()._setMousePressed(!0)}),window.addEventListener("mouseup",function(e){e.button==cc.MOUSE_RIGHTBUTTON?cc.Director.getInstance().getMouseDispatcher()._setRightMousePressed(!1):cc.Director.getInstance().getMouseDispatcher()._setMousePressed(!1)}),e.addEventListener("mousedown",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_DOWN)}),e.addEventListener("mouseup",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_UP)}),e.addEventListener("mousemove",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_MOVED)}),e.addEventListener("mousewheel",function(e){var n=t(e);n.setWheelDelta(e.wheelDelta),cc.Director.getInstance().getMouseDispatcher().mouseHandle(n,e,cc.SCROLL_WHEEL)},!1),e.addEventListener("DOMMouseScroll",function(e){var n=t(e);n.setWheelDelta(e.detail*-120),cc.Director.getInstance().getMouseDispatcher().mouseHandle(n,e,cc.SCROLL_WHEEL)}),e.addEventListener("mouseout",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_EXITED)},!1),e.addEventListener("mouseover",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_ENTERED)},!1)};cc.KeyboardDelegate=cc.Class.extend({onKeyDown:function(e){},onKeyUp:function(e){}}),cc.KeyboardHandler=cc.Class.extend({getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},initWithDelegate:function(e){return cc.Assert(e!=null,"It's a wrong delegate!"),this._delegate=e,!0},_delegate:null}),cc.KeyboardHandler.create=function(e){var t=new cc.KeyboardHandler;return t.initWithDelegate(e),t};cc.TYPE_BACK_CLICKED=1,cc.TYPE_MENU_CLICKED=2,cc.KEY={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,",":186,equal:187,"=":187,";":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,"]":221,closebracket:221,backslash:220,quote:222,space:32},cc.KeyboardDispatcher=cc.Class.extend({addDelegate:function(e){if(!e)return;this._locked?(this._handlersToAdd.push(e),this._toAdd=!0):this.forceAddDelegate(e)},removeDelegate:function(e){if(!e)return;this._locked?(this._handlersToRemove.push(e),this._toRemove=!0):this.forceRemoveDelegate(e)},forceAddDelegate:function(e){var t=cc.KeyboardHandler.create(e);if(t){for(var n=0;n<this._delegates;n++)this._delegates[n].getDelegate()==t.getDelegate();this._delegates.push(t)}},forceRemoveDelegate:function(e){for(var t=0;t<this._delegates.length;t++)if(this._delegates[t].getDelegate()==e){this._delegates.splice(t,1);return}},dispatchKeyboardMSG:function(e,t){this._locked=!0,e.stopPropagation(),e.preventDefault();var n=0;if(t&&e)for(n=0;n<this._delegates.length;n++)this._delegates[n].getDelegate()&&this._delegates[n].getDelegate().onKeyDown&&this._delegates[n].getDelegate().onKeyDown(e.keyCode);else if(!t&&e)for(n=0;n<this._delegates.length;n++)this._delegates[n].getDelegate()&&this._delegates[n].getDelegate().onKeyUp&&this._delegates[n].getDelegate().onKeyUp(e.keyCode);this._locked=!1;if(this._toRemove){this._toRemove=!1;for(n=0;n<this._handlersToRemove.length;++n)this.forceRemoveDelegate(this._handlersToRemove[n]);delete this._handlersToRemove,this._handlersToRemove=[]}if(this._toAdd){this._toAdd=!1;for(n=0;n<this._handlersToAdd.length;++n)this.forceAddDelegate(this._handlersToAdd[n]);this._handlersToAdd=[]}return!0},_delegates:[],_locked:!1,_toAdd:!1,_toRemove:!1,_handlersToAdd:[],_handlersToRemove:[]}),cc.KeyboardDispatcher.getInstance=function(){return cc.keyboardDispatcher||(cc.keyboardDispatcher=new cc.KeyboardDispatcher,cc.canvas.setAttribute("tabindex",1),cc.canvas.style.outline="none",cc.canvas.style.cursor="default",cc.canvas.addEventListener("keydown",function(e){cc.keyboardDispatcher.dispatchKeyboardMSG(e,!0)}),cc.canvas.addEventListener("keyup",function(e){cc.keyboardDispatcher.dispatchKeyboardMSG(e,!1)})),cc.keyboardDispatcher},cc.KeyboardDispatcher.purgeSharedDispatcher=function(){cc.keyboardDispatcher&&(delete cc.keyboardDispatcher,cc.keyboardDispatcher=null)};cc.IMEKeyboardNotificationInfo=function(e,t,n){this.begin=e||cc.RectZero(),this.end=t||cc.RectZero(),this.duration=n||0},cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.IMEDispatcher.getInstance().addDelegate(this)},removeDelegate:function(){cc.IMEDispatcher.getInstance().removeDelegate(this)},attachWithIME:function(){return cc.IMEDispatcher.getInstance().attachDelegateWithIME(this)},detachWithIME:function(){return cc.IMEDispatcher.getInstance().detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(e,t){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(e){},keyboardDidShow:function(e){},keyboardWillHide:function(e){},keyboardDidHide:function(e){}}),cc.IMEDispatcher=cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl,this._lastClickPosition=cc.p(0,0)},init:function(){if(cc.Browser.isMobile)return;this._domInputControl=cc.$("#imeDispatcherInput"),this._domInputControl||(this._domInputControl=cc.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl));var e=this;this._domInputControl.addEventListener("input",function(){e._processDomInputString(e._domInputControl.value)},!1),this._domInputControl.addEventListener("keydown",function(t){t.keyCode===cc.KEY.tab?(t.stopPropagation(),t.preventDefault()):t.keyCode==cc.KEY.enter&&(e.dispatchInsertText("\n",1),t.stopPropagation(),t.preventDefault())},!1),/msie/i.test(navigator.userAgent)&&this._domInputControl.addEventListener("keyup",function(t){t.keyCode==cc.KEY.backspace&&e._processDomInputString(e._domInputControl.value)},!1),window.addEventListener("mousedown",function(t){var n=t.pageX||0,r=t.pageY||0;e._lastClickPosition=cc.p(n,r)},!1)},_processDomInputString:function(e){var t,n,r=this._currentInputString.length<e.length?this._currentInputString.length:e.length;for(n=0;n<r;n++)if(e[n]!==this._currentInputString[n])break;var i=this._currentInputString.length-n,s=e.length-n;for(t=0;t<i;t++)this.dispatchDeleteBackward();for(t=0;t<s;t++)this.dispatchInsertText(e[n+t],1);this._currentInputString=e},dispatchInsertText:function(e,t){if(!this.impl||!e||t<=0)return;if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.insertText(e,t)},dispatchDeleteBackward:function(){if(!this.impl)return;if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.deleteBackward()},getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var e=this.impl._delegateWithIme.getContentText();return e?e:""}return""},dispatchKeyboardWillShow:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardWillShow(e)}},dispatchKeyboardDidShow:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardDidShow(e)}},dispatchKeyboardWillHide:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardWillHide(e)}},dispatchKeyboardDidHide:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardDidHide(e)}},addDelegate:function(e){if(!e||!this.impl)return;if(this.impl._delegateList.indexOf(e)>-1)return;this.impl._delegateList=cc.ArrayAppendObjectToIndex(this.impl._delegateList,e,0)},attachDelegateWithIME:function(e){if(!this.impl||!e)return!1;if(this.impl._delegateList.indexOf(e)==-1)return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!e.canAttachWithIME())return!1;var t=this.impl._delegateWithIme;return this.impl._delegateWithIme=null,t.didDetachWithIME(),this._focusDomInput(e),!0}return e.canAttachWithIME()?(this._focusDomInput(e),!0):!1},_focusDomInput:function(e){if(cc.Browser.isMobile){this.impl._delegateWithIme=e,e.didAttachWithIME(),this._currentInputString=e.getString?e.getString():"";var t=prompt("please enter your word:",this._currentInputString);t!=null&&this._processDomInputString(t),this.dispatchInsertText("\n",1)}else this.impl._delegateWithIme=e,this._currentInputString=e.getString?e.getString():"",e.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate()},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(e){return!this.impl||!e?!1:this.impl._delegateWithIme!=e?!1:e.canDetachWithIME()?(this.impl._delegateWithIme=null,e.didDetachWithIME(),cc.canvas.focus(),!0):!1},removeDelegate:function(e){if(!this.impl||!e)return;if(this.impl._delegateList.indexOf(e)==-1)return;this.impl._delegateWithIme&&e==this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),cc.ArrayRemoveObject(this.impl._delegateList,e)},processKeycode:function(e){e<32?e==cc.KEY.backspace?this.dispatchDeleteBackward():e==cc.KEY.enter?this.dispatchInsertText("\n",1):e!=cc.KEY.tab&&e==cc.KEY.escape:e<255&&this.dispatchInsertText(String.fromCharCode(e),1)}}),cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(e){for(var t=0;t<this._delegateList.length;t++)if(this._delegateList[t]==e)return t;return null}}),cc.IMEDispatcher.getInstance=function(){return cc.IMEDispatcher.instance||(cc.IMEDispatcher.instance=new cc.IMEDispatcher,cc.IMEDispatcher.instance.init()),cc.IMEDispatcher.instance},cc.IMEDispatcher.instance=null;cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(e){return!1},onTextFieldDetachWithIME:function(e){return!1},onTextFieldInsertText:function(e,t,n){return!1},onTextFieldDeleteBackward:function(e,t,n){return!1},onDraw:function(e){return!1}}),cc.TextFieldTTF=cc.LabelTTF.extend({_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_delegate:null,_ColorSpaceHolder:null,ctor:function(){this._ColorSpaceHolder=new cc.Color3B(127,127,127),cc.IMEDispatcher.getInstance().addDelegate(this),this._super()},getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return this._ColorSpaceHolder},setColorSpaceHolder:function(e){this._ColorSpaceHolder=e},initWithPlaceHolder:function(e,t,n,r,i){switch(arguments.length){case 5:return e&&(this._placeHolder=e),this.initWithString(this._placeHolder,t,n,r,i);case 3:return e&&(this._placeHolder=e),r=arguments[1],i=arguments[2],this.initWithString(this._placeHolder,r,i);default:throw"Argument must be non-nil "}},setString:function(e,t){if(t&&t==1){this._super(e);return}this._inputText=e||"",this._inputText.length?this._super(this._inputText):this._super(this._placeHolder),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(e){this._placeHolder=e||"",this._inputText.length||cc.LabelTTF.prototype.setString.call(this,this._placeHolder)},getPlaceHolder:function(){return this._placeHolder},draw:function(e){var t=e||cc.renderContext;if(this._delegate&&this._delegate.onDraw(this))return;if(this._inputText&&this._inputText.length>0){this._super(t);return}var n=this.getColor();this.setColor(this._ColorSpaceHolder),this._super(t),this.setColor(n)},attachWithIME:function(){return cc.IMEDispatcher.getInstance().attachDelegateWithIME(this)},detachWithIME:function(){return cc.IMEDispatcher.getInstance().detachDelegateWithIME(this)},canAttachWithIME:function(){return this._delegate?!this._delegate.onTextFieldAttachWithIME(this):!0},didAttachWithIME:function(){},canDetachWithIME:function(){return this._delegate?!this._delegate.onTextFieldDetachWithIME(this):!0},didDetachWithIME:function(){},deleteBackward:function(){var e=this._inputText.length;if(e==0)return;var t=1;if(this._delegate&&this._delegate.onTextFieldDeleteBackward(this,this._inputText[e-t],t))return;if(e<=t){this._inputText="",this._charCount=0,cc.LabelTTF.prototype.setString.call(this,this._placeHolder);return}var n=this._inputText.substring(0,e-t);this.setString(n,!1)},removeDelegate:function(){cc.IMEDispatcher.getInstance().removeDelegate(this)},insertText:function(e,t){var n=e,r=n.indexOf("\n");r>-1&&(n=n.substring(0,r));if(n.length>0){if(this._delegate&&this._delegate.onTextFieldInsertText(this,n,n.length))return;var i=this._inputText+n;this._charCount=i.length,this.setString(i)}if(r==-1)return;if(this._delegate&&this._delegate.onTextFieldInsertText(this,"\n",1))return;this.detachWithIME()},getContentText:function(){return this._inputText},keyboardWillShow:function(e){},keyboardDidShow:function(e){},keyboardWillHide:function(e){},keyboardDidHide:function(e){}}),cc.TextFieldTTF.create=function(e,t,n,r,i){var s;switch(arguments.length){case 5:s=new cc.TextFieldTTF;if(s&&s.initWithPlaceHolder("",t,n,r,i))return e&&s.setPlaceHolder(e),s;return null;case 3:s=new cc.TextFieldTTF,r=arguments[1],i=arguments[2];if(s&&s.initWithString(["",r,i]))return e&&s.setPlaceHolder(e),s;return null;default:throw"Argument must be non-nil "}};cc.Configuration=cc.Class.extend({_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(e){return this._GlExtensions.indexOf(e)>-1},init:function(){if(cc.renderContextType===cc.CANVAS)return!0;var e=cc.renderContext;cc.log("cocos2d: GL_VENDOR:     "+e.getParameter(e.VENDOR)),cc.log("cocos2d: GL_RENDERER:   "+e.getParameter(e.RENDERER)),cc.log("cocos2d: GL_VERSION:    "+e.getParameter(e.VERSION)),this._GlExtensions="";var t=e.getSupportedExtensions();for(var n=0;n<t.length;n++)this._GlExtensions+=t[n]+" ";return cc.log("cocos2d: GL_EXTENSIONS:  "+this._GlExtensions),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._maxTextureUnits=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),this._supportsNPOT=!0,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),cc.log("cocos2d: GL_MAX_TEXTURE_SIZE: "+this._maxTextureSize),cc.log("cocos2d: GL_MAX_TEXTURE_UNITS: "+this._maxTextureUnits),cc.log("cocos2d: GL supports PVRTC: "+(this._supportsPVRTC?"YES":"NO")),cc.log("cocos2d: GL supports BGRA8888 textures: "+(this._supportsBGRA8888?"YES":"NO")),cc.log("cocos2d: GL supports NPOT textures: "+(this._supportsNPOT?"YES":"NO")),cc.log("cocos2d: GL supports discard_framebuffer: "+(this._supportsDiscardFramebuffer?"YES":"NO")),cc.log("cocos2d: GL supports shareable VAO: "+(this._supportsShareableVAO?"YES":"NO")),cc.ENABLE_GL_STATE_CACHE==0&&cc.log("cocos2d: **** WARNING **** CC_ENABLE_GL_STATE_CACHE is disabled. To improve performance, enable it by editing ccConfig.h"),cc.CHECK_GL_ERROR_DEBUG(),!0}}),cc.Configuration._sharedConfiguration=null,cc.Configuration.getInstance=function(){return cc.Configuration._sharedConfiguration||(cc.Configuration._sharedConfiguration=new cc.Configuration,cc.Configuration._sharedConfiguration.init()),cc.Configuration._sharedConfiguration},cc.Configuration.purgeConfiguration=function(){cc.Configuration._sharedConfiguration=null};cc.g_NumberOfDraws=0,cc.DIRECTOR_PROJECTION_2D=0,cc.DIRECTOR_PROJECTION_3D=1,cc.DIRECTOR_PROJECTION_CUSTOM=3,cc.DIRECTOR_PROJECTION_DEFAULT=cc.DIRECTOR_PROJECTION_3D,cc.DEVICE_ORIENTATION_PORTRAIT=0,cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1,cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2,cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3,cc.DEVICE_MAX_ORIENTATIONS=2,cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}}),cc.GLToClipTransform=function(e){var t=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t);var n=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,n),cc.kmMat4Multiply(e,t,n)},cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirecotorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_accumDt:0,_contentScaleFactor:1,_displayStats:!1,_deltaTime:0,_frameRate:0,_FPSLabel:null,_SPFLabel:null,_drawsLabel:null,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_frames:0,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_touchDispatcher:null,_keyboardDispatcher:null,_accelerometer:null,_mouseDispatcher:null,_isBlur:!1,ctor:function(){this._lastUpdate=Date.now();if(!cc.isAddedHiddenEvent){var e=this;window.addEventListener("focus",function(){e._lastUpdate=Date.now()},!1)}},_resetLastUpdate:function(){this._lastUpdate=Date.now()},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.DIRECTOR_PROJECTION_DEFAULT,this._projectionDelegate=null,this._accumDt=0,this._frameRate=0,this._displayStats=!1,this._totalFrames=this._frames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirecotorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdateForTarget(this._actionManager,cc.PRIORITY_SYSTEM,!1),this._touchDispatcher=new cc.TouchDispatcher,this._touchDispatcher.init(),isXC||(this._keyboardDispatcher=cc.KeyboardDispatcher.getInstance()),this._accelerometer=new cc.Accelerometer,this._mouseDispatcher=new cc.MouseDispatcher,this._mouseDispatcher.init(),!0},calculateDeltaTime:function(){var e=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(e-this._lastUpdate)/1e3,cc.COCOS2D_DEBUG>0&&this._deltaTime>.2&&(this._deltaTime=1/60),this._lastUpdate=e},convertToGL:function(e){var t=new cc.kmMat4;cc.GLToClipTransform(t);var n=new cc.kmMat4;cc.kmMat4Inverse(n,t);var r=t.mat[14]/t.mat[15],i=this._openGLView.getDesignResolutionSize(),s=new cc.kmVec3(2*e.x/i.width-1,1-2*e.y/i.height,r),o=new cc.kmVec3;return cc.kmVec3TransformCoord(o,s,n),cc.p(o.x,o.y)},convertToUI:function(e){var t=new cc.kmMat4;cc.GLToClipTransform(t);var n=new cc.kmVec3,r=new cc.kmVec3(e.x,e.y,0);cc.kmVec3TransformCoord(n,r,t);var i=this._openGLView.getDesignResolutionSize();return cc.p(i.width*(n.x*.5+.5),i.height*(-n.y*.5+.5))},drawScene:function(){this.calculateDeltaTime(),this._paused||this._scheduler.update(this._deltaTime),cc.renderContextType===cc.CANVAS?this._drawSceneForCanvas():this._drawSceneForWebGL(),this._totalFrames++,this._displayStats&&this._calculateMPF()},_drawSceneForCanvas:function(){cc.renderContext.clearRect(0,0,cc.canvas.width,-cc.canvas.height),this._nextScene&&this.setNextScene(),this._runningScene&&this._runningScene.visit(),this._notificationNode&&this._notificationNode.visit(),this._displayStats&&this._showStats()},_drawSceneForWebGL:function(){var e=cc.renderContext;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this._nextScene&&this.setNextScene(),cc.kmGLPushMatrix(),this._runningScene&&this._runningScene.visit(),this._notificationNode&&this._notificationNode.visit(),this._displayStats&&this._showStats(),cc.kmGLPopMatrix()},addRegionToDirtyRegion:function(e){if(!e)return;if(!this._dirtyRegion){this._dirtyRegion=cc.rect(e.origin.x,e.origin.y,e.size.width,e.size.height);return}this._dirtyRegion=cc.Rect.CCRectUnion(this._dirtyRegion,cc.rect(e.origin.x,e.origin.y,e.size.width,e.size.height))},rectIsInDirtyRegion:function(e){return!e||!this._fullRect?!1:cc.Rect.CCRectIntersectsRect(this._fullRect,e)},end:function(){this._purgeDirecotorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return this._winSizeInPoints},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:function(){return this._openGLView?this._openGLView.getVisibleSize():cc.size(0,0)},getVisibleOrigin:function(){return this._openGLView?this._openGLView.getVisibleOrigin():cc.p(0,0)},getZEye:function(){return this._winSizeInPoints.height/1.1566},pause:function(){if(this._paused)return;this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0},popScene:function(){cc.Assert(this._runningScene!=null,"running scene should not null"),this._scenesStack.pop();var e=this._scenesStack.length;e==0?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[e-1])},purgeCachedData:function(){cc.LabelBMFont.purgeCachedData()},purgeDirector:function(){this.getScheduler().unscheduleAllCallbacks(),this._touchDispatcher.removeAllDelegates(),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup()),this._runningScene=null,this._nextScene=null,this._scenesStack=[],this.stopAnimation(),cc.LabelBMFont.purgeCachedData(),cc.AnimationCache.purgeSharedAnimationCache(),cc.SpriteFrameCache.purgeSharedSpriteFrameCache(),cc.TextureCache.purgeSharedTextureCache(),cc.CHECK_GL_ERROR_DEBUG()},pushScene:function(e){cc.Assert(e,"the scene should not null"),this._sendCleanupToScene=!1,this._scenesStack.push(e),this._nextScene=e},replaceScene:function(e){cc.Assert(this._runningScene,"Use runWithScene: instead to start the director"),cc.Assert(e!=null,"the scene should not be null");var t=this._scenesStack.length;this._sendCleanupToScene=!0,this._scenesStack[t-1]=e,this._nextScene=e},resume:function(){if(!this._paused)return;this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log("cocos2d: Director: Error in gettimeofday"),this._paused=!1,this._deltaTime=0},runWithScene:function(e){cc.Assert(e!=null,"This command can only be used to start the CCDirector. There is already a scene present."),cc.Assert(this._runningScene==null,"_runningScene should be null"),this.pushScene(e),this.startAnimation()},setAlphaBlending:function(e){e?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc.renderContext.ONE,cc.renderContext.ZERO)},setContentScaleFactor:function(e){e!=this._contentScaleFactor&&(this._contentScaleFactor=e,this._createStatsLabel())},setDepthTest:function(e){if(cc.renderContextType===cc.CANVAS)return;e?(cc.renderContext.clearDepth(1),cc.renderContext.enable(cc.renderContext.DEPTH_TEST),cc.renderContext.depthFunc(cc.renderContext.LEQUAL)):cc.renderContext.disable(cc.renderContext.DEPTH_TEST)},setGLDefaultValues:function(){this.setAlphaBlending(!0),this.setDepthTest(!1),this.setProjection(this._projection),cc.renderContext.clearColor(0,0,0,1)},setNextDeltaTimeZero:function(e){this._nextDeltaTimeZero=e},setNextScene:function(){var e=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,t=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1;t||(this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit()),this._sendCleanupToScene&&this._runningScene&&this._runningScene.cleanup()),this._runningScene=this._nextScene,this._nextScene=null,!e&&this._runningScene!=null&&(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(e){this._notificationNode=e},getDelegate:function(){return this._projectionDelegate},setDelegate:function(e){this._projectionDelegate=e},setOpenGLView:function(e){this._winSizeInPoints=cc.size(cc.canvas.width,cc.canvas.height);if(cc.renderContextType===cc.CANVAS)return;this._openGLView=e||cc.EGLView.getInstance(),this._createStatsLabel(),this.setGLDefaultValues(),this._touchDispatcher.setDispatchEvents(!0)},setProjection:function(e){var t=this._winSizeInPoints;if(cc.renderContextType===cc.WEBGL){this._openGLView&&this._openGLView.setViewPortInPoints(0,0,t.width,t.height);switch(e){case cc.DIRECTOR_PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var n=new cc.kmMat4;cc.kmMat4OrthographicProjection(n,0,t.width,0,t.height,-1024,1024),cc.kmGLMultMatrix(n),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.DIRECTOR_PROJECTION_3D:var r=this.getZEye(),i=new cc.kmMat4,s=new cc.kmMat4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),cc.kmMat4PerspectiveProjection(i,60,t.width/t.height,.1,r*2),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();var o=cc.kmVec3Fill(null,t.width/2,t.height/2,r),u=cc.kmVec3Fill(null,t.width/2,t.height/2,0),a=cc.kmVec3Fill(null,0,1,0);cc.kmMat4LookAt(s,o,u,a),cc.kmGLMultMatrix(s);break;case cc.DIRECTOR_PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.log("cocos2d: Director: unrecognized projection")}}this._projection=e,cc.setProjectionMatrixDirty()},_showStats:function(){this._frames++,this._accumDt+=this._deltaTime,this._displayStats&&(this._FPSLabel&&this._SPFLabel&&this._drawsLabel?(this._accumDt>cc.DIRECTOR_FPS_INTERVAL&&(this._SPFLabel.setString(this._secondsPerFrame.toFixed(3)),this._frameRate=this._frames/this._accumDt,this._frames=0,this._accumDt=0,this._FPSLabel.setString(this._frameRate.toFixed(1)),this._drawsLabel.setString((0|cc.g_NumberOfDraws).toString())),this._FPSLabel.visit(),this._SPFLabel.visit(),this._drawsLabel.visit()):this._createStatsLabel()),cc.g_NumberOfDraws=0},isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return this._displayStats},setDisplayStats:function(e){this._displayStats=e},getSecondsPerFrame:function(){return this._secondsPerFrame},getOpenGLView:function(){return this._openGLView},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},getProjection:function(){return this._projection},popToRootScene:function(){cc.Assert(this._runningScene!=null,"A running Scene is needed");var e=this._scenesStack.length;if(e==1)this._scenesStack.pop(),this.end();else{while(e>1){var t=this._scenesStack.pop();t.isRunning()&&(t.onExitTransitionDidStart(),t.onExit()),t.cleanup(),e--}this._nextScene=this._scenesStack[this._scenesStack.length-1],this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(e){this._scheduler!=e&&(this._scheduler=e)},getActionManager:function(){return this._actionManager},setActionManager:function(e){this._actionManager!=e&&(this._actionManager=e)},getTouchDispatcher:function(){return this._touchDispatcher},setTouchDispatcher:function(e){this._touchDispatcher!=e&&(this._touchDispatcher=e)},getKeyboardDispatcher:function(){return this._keyboardDispatcher},setKeyboardDispatcher:function(e){this._keyboardDispatcher=e},getAccelerometer:function(){return this._accelerometer},setAccelerometer:function(e){this._accelerometer!=e&&(this._accelerometer=e)},getMouseDispatcher:function(){return this._mouseDispatcher},setMouseDispatcher:function(e){this._mouseDispatcher!=e&&(this._mouseDispatcher=e)},_createStatsLabel:function(){var e=0;this._winSizeInPoints.width>this._winSizeInPoints.height?e=0|this._winSizeInPoints.height/320*24:e=0|this._winSizeInPoints.width/320*24,this._FPSLabel=cc.LabelTTF.create("000.0","Arial",e),this._SPFLabel=cc.LabelTTF.create("0.000","Arial",e),this._drawsLabel=cc.LabelTTF.create("0000","Arial",e);var t=this._drawsLabel.getContentSize();this._drawsLabel.setPosition(cc.pAdd(cc.p(t.width/2,t.height*5/2),cc.DIRECTOR_STATS_POSITION)),t=this._SPFLabel.getContentSize(),this._SPFLabel.setPosition(cc.pAdd(cc.p(t.width/2,t.height*3/2),cc.DIRECTOR_STATS_POSITION)),t=this._FPSLabel.getContentSize(),this._FPSLabel.setPosition(cc.pAdd(cc.p(t.width/2,t.height/2),cc.DIRECTOR_STATS_POSITION))},_calculateMPF:function(){var e=Date.now();this._secondsPerFrame=(e-this._lastUpdate)/1e3}}),cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1,cc.Application.sharedApplication().setAnimationInterval(this._animationInterval)},mainLoop:function(){this._purgeDirecotorInNextLoop?(this._purgeDirecotorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(e){this._animationInterval=e,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.s_SharedDirector=null,cc.firstUseDirector=!0,cc.Director.getInstance=function(){return cc.firstUseDirector&&(cc.firstUseDirector=!1,cc.s_SharedDirector=new cc.DisplayLinkDirector,cc.s_SharedDirector.init(),cc.s_SharedDirector.setOpenGLView(cc.EGLView.getInstance())),cc.s_SharedDirector},cc.firstRun=!0,cc.defaultFPS=60;cc.Camera=cc.Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:null,_lookupMatrix:new cc.kmMat4,ctor:function(){this.restore()},description:function(){return"<CCCamera | center =("+this._centerX+","+this._centerY+","+this._centerZ+")>"},setDirty:function(e){this._dirty=e},isDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0,this._eyeZ=cc.Camera.getZEye(),this._centerX=this._centerY=this._centerZ=0,this._upX=0,this._upY=1,this._upZ=0,cc.kmMat4Identity(this._lookupMatrix),this._dirty=!1},locate:function(){if(this._dirty){var e=new cc.kmVec3,t=new cc.kmVec3,n=new cc.kmVec3;cc.kmVec3Fill(e,this._eyeX,this._eyeY,this._eyeZ),cc.kmVec3Fill(t,this._centerX,this._centerY,this._centerZ),cc.kmVec3Fill(n,this._upX,this._upY,this._upZ),cc.kmMat4LookAt(this._lookupMatrix,e,t,n),this._dirty=!1}cc.kmGLMultMatrix(this._lookupMatrix)},setEyeXYZ:function(e,t,n){this.setEye(e,t,n)},setEye:function(e,t,n){this._eyeX=e,this._eyeY=t,this._eyeZ=n,this._dirty=!0},setCenterXYZ:function(e,t,n){this.setCenter(e,t,n)},setCenter:function(e,t,n){this._centerX=e,this._centerY=t,this._centerZ=n,this._dirty=!0},setUpXYZ:function(e,t,n){this.setUp(e,t,n)},setUp:function(e,t,n){this._upX=e,this._upY=t,this._upZ=n,this._dirty=!0},getEyeXYZ:function(e,t,n){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getEye:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getCenterXYZ:function(e,t,n){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getCenter:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getUpXYZ:function(e,t,n){return{x:this._upX,y:this._upY,z:this._upZ}},getUp:function(){return{x:this._upX,y:this._upY,z:this._upZ}},_DISALLOW_COPY_AND_ASSIGN:function(e){}}),cc.Camera.getZEye=function(){return cc.FLT_EPSILON};cc.PRIORITY_SYSTEM=-2147483648,cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1,cc.ArrayVerifyType=function(e,t){if(e&&e.length>0)for(var n=0;n<e.length;n++)if(!(e[n]instanceof t))return cc.log("element type is wrong!"),!1;return!0},cc.ArrayRemoveObjectAtIndex=function(e,t){e.splice(t,1)},cc.ArrayRemoveObject=function(e,t){for(var n=0;n<e.length;n++)e[n]==t&&e.splice(n,1)},cc.ArrayRemoveArray=function(e,t){for(var n=0;n<t.length;n++)cc.ArrayRemoveObject(e,t[n])},cc.ArrayGetIndexOfValue=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return-1},cc.ArrayAppendObject=function(e,t){e.push(t)},cc.ArrayAppendObjectToIndex=function(e,t,n){var r=e.slice(0,n),i=e.slice(n);return r.push(t),e=r.concat(i),e},cc.ArrayAppendObjectsToIndex=function(e,t,n){var r=e.slice(0,n),i=e.slice(n);for(var s=0;s<t.length;s++)r.push(t[s]);return e=r.concat(i),e},cc.ArrayGetIndexOfObject=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return-1},cc.ArrayContainsObject=function(e,t){return cc.ArrayGetIndexOfObject(e,t)!=-1},cc.HASH_FIND_INT=function(e,t){if(e==null)return null;for(var n=0;n<e.length;n++)if(e[n].target===t)return e[n];return null},cc.ListEntry=function(e,t,n,r,i,s){this.prev=e,this.next=t,this.target=n,this.priority=r,this.paused=i,this.markedForDeletion=s},cc.HashUpdateEntry=function(e,t,n,r){this.list=e,this.entry=t,this.target=n,this.hh=r},cc.HashTimerEntry=function(e,t,n,r,i,s,o){this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=r,this.currentTimerSalvaged=i,this.paused=s,this.hh=o},cc.Timer=cc.Class.extend({_interval:0,_selector:null,_target:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,ctor:function(){},getInterval:function(){return this._interval},setInterval:function(e){},getSelector:function(){return this._selector},initWithTarget:function(e,t,n,r,i){try{return this._target=e,this._selector=t,this._elapsed=-1,this._interval=n||0,this._delay=i||0,this._useDelay=this._delay>0,this._repeat=r==null?cc.REPEAT_FOREVER:r,this._runForever=this._repeat==cc.REPEAT_FOREVER,!0}catch(s){return!1}},_callSelector:function(){typeof this._selector=="string"?this._target[this._selector](this._elapsed):this._selector.call(this._target,this._elapsed)},update:function(e){this._elapsed==-1?(this._elapsed=0,this._timesExecuted=0):this._runForever&&!this._useDelay?(this._elapsed+=e,this._elapsed>=this._interval&&(this._selector&&this._callSelector(),this._elapsed=0)):(this._elapsed+=e,this._useDelay?this._elapsed>=this._delay&&(this._target&&this._selector&&this._callSelector(),this._elapsed=this._elapsed-this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this._target&&this._selector&&this._callSelector(),this._elapsed=0,this._timesExecuted+=1),this._timesExecuted>this._repeat&&cc.Director.getInstance().getScheduler().unscheduleCallbackForTarget(this._target,this._selector))}}),cc.Timer.timerWithTarget=function(e,t,n){if(arguments<2)throw new Error("timerWithTarget'argument can't is null");var r=new cc.Timer;return arguments.length==2?r.initWithTarget(e,t,0,cc.REPEAT_FOREVER,0):r.initWithTarget(e,t,n,cc.REPEAT_FOREVER,0),r},cc._sharedScheduler=null,cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForUpdates:null,_hashForTimers:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=[],this._hashForTimers=[],this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1},_removeHashElement:function(e){e.Timer=null,e.target=null,cc.ArrayRemoveObject(this._hashForTimers,e),e=null},_findElementFromArray:function(e,t){for(var n=0;n<e.length;n++)if(e[n].target==t)return e[n];return null},_removeUpdateFromHash:function(e){var t=this._findElementFromArray(this._hashForUpdates,e.target);t&&(cc.ArrayRemoveObject(t.list,t.entry),t.entry=null,t.target=null,cc.ArrayRemoveObject(this._hashForUpdates,t))},_priorityIn:function(e,t,n,r){var i=new cc.ListEntry(null,null,t,n,r,!1);if(!e)e=[],e.push(i);else{var s=!1;for(var o=0;o<e.length;o++)if(n<e[o].priority){e=cc.ArrayAppendObjectToIndex(e,i,o),s=!0;break}s||e.push(i)}var u=new cc.HashUpdateEntry(e,i,t,null);return this._hashForUpdates.push(u),e},_appendIn:function(e,t,n){var r=new cc.ListEntry(null,null,t,0,n,!1);e.push(r);var i=new cc.HashUpdateEntry(e,r,t,null);this._hashForUpdates.push(i)},setTimeScale:function(e){this._timeScale=e},getTimeScale:function(){return this._timeScale},update:function(e){this._updateHashLocked=!0,this._timeScale!=1&&(e*=this._timeScale);var t,n;for(n=0;n<this._updatesNegList.length;n++)t=this._updatesNegList[n],!t.paused&&!t.markedForDeletion&&t.target.update(e);for(n=0;n<this._updates0List.length;n++)t=this._updates0List[n],!t.paused&&!t.markedForDeletion&&t.target.update(e);for(n=0;n<this._updatesPosList.length;n++)t=this._updatesPosList[n],!t.paused&&!t.markedForDeletion&&t.target.update(e);var r;for(n=0;n<this._hashForTimers.length;n++){this._currentTarget=this._hashForTimers[n],r=this._currentTarget,this._currentTargetSalvaged=!1;if(!this._currentTarget.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;r.timerIndex++)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(e),r.currentTimer=null;this._currentTargetSalvaged&&this._currentTarget.timers.length==0&&this._removeHashElement(this._currentTarget)}for(n=0;n<this._updatesNegList.length;n++)this._updatesNegList[n].markedForDeletion&&this._removeUpdateFromHash(this._updatesNegList[n]);for(n=0;n<this._updates0List.length;n++)this._updates0List[n].markedForDeletion&&this._removeUpdateFromHash(this._updates0List[n]);for(n=0;n<this._updatesPosList.length;n++)this._updatesPosList[n].markedForDeletion&&this._removeUpdateFromHash(this._updatesPosList[n]);this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(e,t,n,r,i,s){cc.Assert(t,"scheduler.scheduleCallbackForTarget() Argument callback_fn must be non-NULL"),cc.Assert(e,"scheduler.scheduleCallbackForTarget() Argument target must be non-NULL"),n=n||0,r=r==null?cc.REPEAT_FOREVER:r,i=i||0,s=s||!1;var o=cc.HASH_FIND_INT(this._hashForTimers,e);o?cc.Assert(o.paused==s,"Sheduler.scheduleCallbackForTarget()"):(o=new cc.HashTimerEntry(null,e,0,null,null,s,null),this._hashForTimers.push(o));var u;if(o.timers==null)o.timers=[];else for(var a=0;a<o.timers.length;a++){u=o.timers[a];if(t==u._selector){cc.log("CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:"+u.getInterval().toFixed(4)+" to "+n.toFixed(4)),u._interval=n;return}}u=new cc.Timer,u.initWithTarget(e,t,n,r,i),o.timers.push(u)},scheduleUpdateForTarget:function(e,t,n){var r=cc.HASH_FIND_INT(this._hashForUpdates,e);if(r){cc.COCOS2D_DEBUG>=1&&cc.Assert(r.entry.markedForDeletion,""),r.entry.markedForDeletion=!1;return}t==0?this._appendIn(this._updates0List,e,n):t<0?this._updatesNegList=this._priorityIn(this._updatesNegList,e,t,n):this._updatesPosList=this._priorityIn(this._updatesPosList,e,t,n)},unscheduleCallbackForTarget:function(e,t){if(e==null||t==null)return;var n=cc.HASH_FIND_INT(this._hashForTimers,e);if(n!=null)for(var r=0;r<n.timers.length;r++){var i=n.timers[r];if(t==i._selector){i==n.currentTimer&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0),cc.ArrayRemoveObjectAtIndex(n.timers,r),n.timerIndex>=r&&n.timerIndex--,n.timers.length==0&&(this._currentTarget==n?this._currentTargetSalvaged=!0:this._removeHashElement(n));return}}},unscheduleUpdateForTarget:function(e){if(e==null)return;var t=cc.HASH_FIND_INT(this._hashForUpdates,e);t!=null&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry))},unscheduleAllCallbacksForTarget:function(e){if(e==null)return;var t=cc.HASH_FIND_INT(this._hashForTimers,e);t&&(!t.currentTimerSalvaged&&cc.ArrayContainsObject(t.timers,t.currentTimer)&&(t.currentTimerSalvaged=!0),t.timers.length=0,this._currentTarget==t?this._currentTargetSalvaged=!0:this._removeHashElement(t)),this.unscheduleUpdateForTarget(e)},unscheduleAllCallbacks:function(){this.unscheduleAllCallbacksWithMinPriority(cc.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(e){var t;for(t=0;t<this._hashForTimers.length;t++)this.unscheduleAllCallbacksForTarget(this._hashForTimers[t].target);if(e<0)for(t=0;t<this._updatesNegList.length;t++)this.unscheduleUpdateForTarget(this._updatesNegList[t].target);if(e<=0)for(t=0;t<this._updates0List.length;t++)this.unscheduleUpdateForTarget(this._updates0List[t].target);for(t=0;t<this._updatesPosList.length;t++)this._updatesPosList[t].priority>=e&&this.unscheduleUpdateForTarget(this._updatesPosList[t].target)},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(e){var t=[],n,r;for(n=0;n<this._hashForTimers.length;n++)r=this._hashForTimers[n],r&&(r.paused=!0,t.push(r.target));if(e<0)for(n=0;n<this._updatesNegList.length;n++)r=this._updatesNegList[n],r&&(r.paused=!0,t.push(r.target));if(e<=0)for(n=0;n<this._updates0List.length;n++)r=this._updates0List[n],r&&(r.paused=!0,t.push(r.target));for(n=0;n<this._updatesPosList.length;n++)r=this._updatesPosList[n],r&&(r.paused=!0,t.push(r.target));return t},resumeTargets:function(e){if(!e)return;for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},pauseTarget:function(e){cc.Assert(e!=null,"Scheduler.pauseTarget():entry must be non nil");var t=cc.HASH_FIND_INT(this._hashForTimers,e);t&&(t.paused=!0);var n=cc.HASH_FIND_INT(this._hashForUpdates,e);n&&(cc.Assert(n.entry!=null,"Scheduler.pauseTarget():entry must be non nil"),n.entry.paused=!0)},resumeTarget:function(e){cc.Assert(e!=null,"");var t=cc.HASH_FIND_INT(this._hashForTimers,e);t&&(t.paused=!1);var n=cc.HASH_FIND_INT(this._hashForUpdates,e);n&&(cc.Assert(n.entry!=null,"Scheduler.resumeTarget():entry must be non nil"),n.entry.paused=!1)},isTargetPaused:function(e){cc.Assert(e!=null,"Scheduler.isTargetPaused():target must be non nil");var t=cc.HASH_FIND_INT(this._hashForTimers,e);return t?t.paused:!1}});cc.RESOURCE_TYPE={IMAGE:["png","jpg","bmp"],SOUND:["mp3","ogg","wav","mp4","m4a"],XML:["plist","xml","fnt","tmx","tsx"],BINARY:["ccbi"],FONT:"FONT",TEXT:["txt","vsh","fsh"],UNKNOW:[]},cc.Loader=cc.Class.extend({_curNumber:0,_totalNumber:0,_loadedNumber:0,_resouces:null,_animationInterval:1/60,_interval:null,_isAsync:!1,ctor:function(){this._resouces=[]},initWithResources:function(e,t,n){cc.Assert(e!=null,"resources should not null"),t&&(this._selector=t,this._target=n);if(e!=this._resouces||this._curNumber==0){this._curNumber=0,this._loadedNumber=0;if(e[0]instanceof Array)for(var r=0;r<e.length;r++){var i=e[r];this._resouces=this._resouces.concat(i)}else this._resouces=e;this._totalNumber=this._resouces.length}this._schedulePreload()},setAsync:function(e){this._isAsync=e},onResLoadingErr:function(e){cc.log("cocos2d:Failed loading resource: "+e)},onResLoaded:function(){this._loadedNumber++},getPercentage:function(){var e=0;return this._totalNumber==0?e=100:e=0|this._loadedNumber/this._totalNumber*100,e},releaseResources:function(e){if(e&&e.length>0){var t=cc.TextureCache.getInstance(),n=cc.AudioEngine.getInstance(),r=cc.SAXParser.getInstance(),i=cc.FileUtils.getInstance(),s;for(var o=0;o<e.length;o++){s=e[o];var u=this._getResType(s);switch(u){case"IMAGE":t.removeTextureForKey(s.src);break;case"SOUND":n.unloadEffect(s.src);break;case"XML":r.unloadPlist(s.src);break;case"BINARY":i.unloadBinaryFileData(s.src);break;case"TEXT":i.unloadTextFileData(s.src);break;case"FONT":this._unregisterFaceFont(s);break;default:throw"cocos2d:unknown filename extension: "+u}}}},_preload:function(){this._updatePercent();if(this._isAsync){var e=cc.Director.getInstance()._frameRate;if(e!=null&&e<20){cc.log("cocos2d: frame rate less than 20 fps, skip frame.");return}}this._curNumber<this._totalNumber&&(this._loadOneResource(),this._curNumber++)},_loadOneResource:function(){var e=cc.TextureCache.getInstance();if(!isXC)var t=cc.AudioEngine.getInstance(),n=cc.SAXParser.getInstance(),r=cc.FileUtils.getInstance();var i=this._resouces[this._curNumber],s=this._getResType(i);switch(s){case"IMAGE":e.addImage(i.src);break;case"SOUND":t.preloadSound(i.src);break;case"XML":n.preloadPlist(i.src);break;case"BINARY":r.preloadBinaryFileData(i.src);break;case"TEXT":r.preloadTextFileData(i.src);break;case"FONT":this._registerFaceFont(i);break;default:throw"cocos2d:unknown filename extension: "+s}},_schedulePreload:function(){this._interval=setInterval(this._preload.bind(this),this._animationInterval*1e3)},_unschedulePreload:function(){clearInterval(this._interval)},_getResType:function(e){var t=e.fontName;if(t!=null)return cc.RESOURCE_TYPE.FONT;var n=e.src,r=n.substring(n.lastIndexOf(".")+1,n.length);for(var i in cc.RESOURCE_TYPE)if(cc.RESOURCE_TYPE[i].indexOf(r)!=-1)return i;return r},_updatePercent:function(){var e=this.getPercentage();e>=100&&(this._unschedulePreload(),this._complete())},_complete:function(){this._target&&typeof this._selector=="string"?this._target[this._selector](this):this._target&&typeof this._selector=="function"?this._selector.call(this._target,this):this._selector(this),this._curNumber=0,this._loadedNumber=0},_registerFaceFont:function(e){var t=e.src;if(t&&t.length>0){var n=document.createElement("style");n.type="text/css",document.body.appendChild(n);var r="@font-face { font-family:"+e.fontName+"; src:";for(var i=0;i<t.length;i++)r+="url('"+encodeURI(t[i].src)+"') format('"+t[i].type+"')",r+=i==t.length-1?";":",";n.textContent+=r+"};";var s=document.createElement("div");s.style.fontFamily=e.fontName,s.innerHTML=".",s.style.position="absolute",s.style.left="-100px",s.style.top="-100px",document.body.appendChild(s)}cc.Loader.getInstance().onResLoaded()},_unregisterFaceFont:function(e){}}),cc.Loader.preload=function(e,t,n){return this._instance||(this._instance=new cc.Loader),this._instance.initWithResources(e,t,n),this._instance},cc.Loader.preloadAsync=function(e,t,n){return this._instance||(this._instance=new cc.Loader),this._instance.setAsync(!0),this._instance.initWithResources(e,t,n),this._instance},cc.Loader.purgeCachedData=function(e){this._instance&&this._instance.releaseResources(e)},cc.Loader.getInstance=function(){return this._instance||(this._instance=new cc.Loader),this._instance},cc.Loader._instance=null,cc.LoaderScene=cc.Scene.extend({_logo:null,_logoTexture:null,_texture2d:null,_bgLayer:null,_label:null,ctor:function(){this._super(),this._logoTexture=new Image;var e=this;this._logoTexture.src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k=",this._logoTexture.width=160,this._logoTexture.height=200,setTimeout(function(){e.initStage()},1e3)},initStage:function(){this._bgLayer=cc.LayerColor.create(cc.c4(32,32,32,255)),this._bgLayer.setPosition(cc.p(0,0)),this.addChild(this._bgLayer,0);var e=cc.Director.getInstance().getWinSize(),t=cc.p(e.width/2,e.height/2),n=200;cc.renderContextType===cc.CANVAS?(this._logo=cc.Sprite.createWithTexture(this._logoTexture),this._logo.setPosition(t),this._bgLayer.addChild(this._logo,10)):(this._texture2d=new cc.Texture2D,this._texture2d.initWithElement(this._logoTexture),this._texture2d.handleLoadedTexture(),this._texture2d&&(this._logo=cc.Sprite.createWithTexture(this._texture2d),this._logo.setPosition(t),this._bgLayer.addChild(this._logo,10),n=this._logo.getContentSize().height)),this._label=cc.LabelTTF.create("Loading... 0%","Arial",14),this._label.setColor(cc.c3(180,180,180)),this._label.setOpacity(0),this._label.setPosition(cc.pAdd(t,cc.p(0,-n/2-10))),this._bgLayer.addChild(this._label,10),isXC||this._logoFadeIn(),this.schedule(this._startLoading,.3)},initWithResources:function(e,t,n){this.resources=e,this.selector=t,this.target=n},_startLoading:function(){this.unschedule(this._startLoading),cc.Loader.preload(this.resources,this.selector,this.target),this.schedule(this._updatePercent)},_logoFadeIn:function(){var e=cc.Spawn.create(cc.EaseBounce.create(cc.MoveBy.create(.25,cc.p(0,10))),cc.FadeIn.create(.5)),t=cc.Sequence.create(cc.DelayTime.create(.15),e.copy());this._logo.runAction(e),this._label.runAction(t)},_updatePercent:function(){var e=cc.Loader.getInstance().getPercentage(),t="Loading... "+e+"%";this._label.setString(t),e>=100&&this.unschedule(this._updatePercent)}}),cc.LoaderScene.preload=function(e,t,n){this._instance||(this._instance=new cc.LoaderScene,this._instance.init());var r=cc.Director.getInstance();return r.getRunningScene()?r.replaceScene(this._instance):r.runWithScene(this._instance),this._instance.initWithResources(e,t,n),this._instance};cc.DrawingPrimitive=cc.Class.extend({_renderContext:null,setRenderContext:function(e){this._renderContext=e},getRenderContext:function(){return this._renderContext},ctor:function(e){this._renderContext=e},drawPoint:function(e){cc.log("DrawingPrimitive.drawPoint() not implement!")},drawPoints:function(e,t){cc.log("DrawingPrimitive.drawPoints() not implement!")},drawLine:function(e,t){cc.log("DrawingPrimitive.drawLine() not implement!")},drawRect:function(e,t){cc.log("DrawingPrimitive.drawRect() not implement!")},drawSolidRect:function(e,t,n){cc.log("DrawingPrimitive.drawSolidRect() not implement!")},drawPoly:function(e,t,n,r){cc.log("DrawingPrimitive.drawPoly() not implement!")},drawSolidPoly:function(e,t,n){cc.log("DrawingPrimitive.drawSolidPoly() not implement!")},drawCircle:function(e,t,n,r,i){cc.log("DrawingPrimitive.drawCircle() not implement!")},drawQuadBezier:function(e,t,n,r){cc.log("DrawingPrimitive.drawQuadBezier() not implement!")},drawCubicBezier:function(e,t,n,r,i){cc.log("DrawingPrimitive.drawCubicBezier() not implement!")},drawCatmullRom:function(e,t){cc.log("DrawingPrimitive.drawCardinalSpline() not implement!")},drawCardinalSpline:function(e,t,n){cc.log("DrawingPrimitive.drawCardinalSpline() not implement!")}}),cc.DrawingPrimitiveCanvas=cc.DrawingPrimitive.extend({drawPoint:function(e,t){t||(t=1);var n=cc.p(e.x*cc.CONTENT_SCALE_FACTOR(),e.y*cc.CONTENT_SCALE_FACTOR());this._renderContext.beginPath(),this._renderContext.arc(n.x,-n.y,t*cc.CONTENT_SCALE_FACTOR(),0,Math.PI*2,!1),this._renderContext.closePath(),this._renderContext.fill()},drawPoints:function(e,t,n){if(e==null)return;n||(n=1),this._renderContext.beginPath();for(var r=0;r<e.length;r++)this._renderContext.arc(e[r].x*cc.CONTENT_SCALE_FACTOR(),-e[r].y*cc.CONTENT_SCALE_FACTOR(),n*cc.CONTENT_SCALE_FACTOR(),0,Math.PI*2,!1);this._renderContext.closePath(),this._renderContext.fill()},drawLine:function(e,t){this._renderContext.beginPath(),this._renderContext.moveTo(e.x*cc.CONTENT_SCALE_FACTOR(),-e.y*cc.CONTENT_SCALE_FACTOR()),this._renderContext.lineTo(t.x*cc.CONTENT_SCALE_FACTOR(),-t.y*cc.CONTENT_SCALE_FACTOR()),this._renderContext.closePath(),this._renderContext.stroke()},drawRect:function(e,t){this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y)),this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y))},drawSolidRect:function(e,t,n){var r=[e,cc.p(t.x,e.y),t,cc.p(e.x,t.y)];this.drawSolidPoly(r,4,n)},drawPoly:function(e,t,n,r){r=="undefined"&&(r=!1);if(e==null)return;if(e.length<3)throw new Error("Polygon's point must greater than 2");var i=e[0];this._renderContext.beginPath(),this._renderContext.moveTo(i.x*cc.CONTENT_SCALE_FACTOR(),-i.y*cc.CONTENT_SCALE_FACTOR());for(var s=1;s<e.length;s++)this._renderContext.lineTo(e[s].x*cc.CONTENT_SCALE_FACTOR(),-e[s].y*cc.CONTENT_SCALE_FACTOR());n&&this._renderContext.closePath(),r?this._renderContext.fill():this._renderContext.stroke()},drawSolidPoly:function(e,t,n){this.setDrawColor4F(n.r,n.g,n.b,n.a),this.drawPoly(e,t,!0,!0)},drawCircle:function(e,t,n,r,i){this._renderContext.beginPath();var s=n-Math.PI*2;this._renderContext.arc(0|e.x,0|-e.y,t,-n,-s,!1),i&&this._renderContext.lineTo(0|e.x,0|-e.y),this._renderContext.stroke()},drawQuadBezier:function(e,t,n,r){var i=[],s=0;for(var o=0;o<r;o++){var u=Math.pow(1-s,2)*e.x+2*(1-s)*s*t.x+s*s*n.x,a=Math.pow(1-s,2)*e.y+2*(1-s)*s*t.y+s*s*n.y;i.push(cc.p(u*cc.CONTENT_SCALE_FACTOR(),a*cc.CONTENT_SCALE_FACTOR())),s+=1/r}i.push(cc.p(n.x*cc.CONTENT_SCALE_FACTOR(),n.y*cc.CONTENT_SCALE_FACTOR())),this.drawPoly(i,r+1,!1,!1)},drawCubicBezier:function(e,t,n,r,i){var s=[],o=0;for(var u=0;u<i;u++){var a=Math.pow(1-o,3)*e.x+3*Math.pow(1-o,2)*o*t.x+3*(1-o)*o*o*n.x+o*o*o*r.x,f=Math.pow(1-o,3)*e.y+3*Math.pow(1-o,2)*o*t.y+3*(1-o)*o*o*n.y+o*o*o*r.y;s.push(cc.p(a*cc.CONTENT_SCALE_FACTOR(),f*cc.CONTENT_SCALE_FACTOR())),o+=1/i}s.push(cc.p(r.x*cc.CONTENT_SCALE_FACTOR(),r.y*cc.CONTENT_SCALE_FACTOR())),this.drawPoly(s,i+1,!1,!1)},drawCatmullRom:function(e,t){this.drawCardinalSpline(e,.5,t)},drawCardinalSpline:function(e,t,n){cc.renderContext.strokeStyle="rgba(255,255,255,1)";var r=[],i,s,o=1/e.length;for(var u=0;u<n+1;u++){var a=u/n;a==1?(i=e.length-1,s=1):(i=0|a/o,s=(a-o*i)/o);var f=cc.CardinalSplineAt(cc.getControlPointAt(e,i-1),cc.getControlPointAt(e,i-0),cc.getControlPointAt(e,i+1),cc.getControlPointAt(e,i+2),t,s);r.push(f)}this.drawPoly(r,n+1,!1,!1)},drawImage:function(e,t,n,r,i){var s=arguments.length;switch(s){case 2:var o=e.height;this._renderContext.drawImage(e,t.x,-(t.y+o));break;case 3:this._renderContext.drawImage(e,t.x,-(t.y+n.height),n.width,n.height);break;case 5:this._renderContext.drawImage(e,t.x,t.y,n.width,n.height,r.x,-(r.y+i.height),i.width,i.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(e,t,n){var r=e||this._renderContext;n instanceof cc.Color4F&&(n=new cc.Color3B(0|n.r*255,0|n.g*255,0|n.b*255));var i="rgba("+n.r+","+n.g+","+n.b;r.fillStyle=i+",1)";var s=t/10;r.beginPath(),r.moveTo(-t,t),r.lineTo(0,s),r.lineTo(t,t),r.lineTo(s,0),r.lineTo(t,-t),r.lineTo(0,-s),r.lineTo(-t,-t),r.lineTo(-s,0),r.lineTo(-t,t),r.closePath(),r.fill();var o=r.createRadialGradient(0,0,s,0,0,t);o.addColorStop(0,i+", 1)"),o.addColorStop(.3,i+", 0.8)"),o.addColorStop(1,i+", 0.0)"),r.fillStyle=o,r.beginPath();var u=0,a=cc.PI2;r.arc(0,0,t-s,u,a,!1),r.closePath(),r.fill()},drawColorBall:function(e,t,n){var r=e||this._renderContext;n instanceof cc.Color4F&&(n=new cc.Color3B(0|n.r*255,0|n.g*255,0|n.b*255));var i="rgba("+n.r+","+n.g+","+n.b,s=t/10,o=r.createRadialGradient(0,0,s,0,0,t);o.addColorStop(0,i+", 1)"),o.addColorStop(.3,i+", 0.8)"),o.addColorStop(.6,i+", 0.4)"),o.addColorStop(1,i+", 0.0)"),r.fillStyle=o,r.beginPath();var u=0,a=cc.PI2;r.arc(0,0,t,u,a,!1),r.closePath(),r.fill()},fillText:function(e,t,n){this._renderContext.fillText(e,t,-n)},setDrawColor4B:function(e,t,n,r){this._renderContext.fillStyle="rgba("+e+","+t+","+n+","+r/255+")",this._renderContext.strokeStyle="rgba("+e+","+t+","+n+","+r/255+")"},setDrawColor4F:function(e,t,n,r){this._renderContext.fillStyle="rgba("+(0|e*255)+","+(0|t*255)+","+(0|n*255)+","+r+")",this._renderContext.strokeStyle="rgba("+(0|e*255)+","+(0|t*255)+","+(0|n*255)+","+r+")"},setPointSize:function(e){},setLineWidth:function(e){this._renderContext.lineWidth=e}}),cc.DrawingPrimitiveWebGL=cc.DrawingPrimitive.extend({_initialized:!1,_shader:null,_colorLocation:-1,_color:null,_pointSizeLocation:-1,_pointSize:-1,ctor:function(e){e==null&&(e=cc.renderContext);if(!e instanceof WebGLRenderingContext)throw"Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext";this._super(e),this._color=new cc.Color4F(1,1,1,1)},lazy_init:function(){this._initialized||(this._shader=cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_UCOLOR),this._colorLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_color"),this._pointSizeLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_pointSize"),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(e){this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var t=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,t),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,new Float32Array([e.x,e.y]),this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.POINTS,0,1),cc.INCREMENT_GL_DRAWS(1)},drawPoints:function(e,t){if(!e||e.length==0)return;this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,n),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,this._pointsToTypeArray(e),this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.POINTS,0,e.length),cc.INCREMENT_GL_DRAWS(1)},_pointsToTypeArray:function(e){var t=new Float32Array(e.length*2);for(var n=0;n<e.length;n++)t[n*2]=e[n].x,t[n*2+1]=e[n].y;return t},drawLine:function(e,t){this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var n=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,n),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,this._pointsToTypeArray([e,t]),this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.LINES,0,2),cc.INCREMENT_GL_DRAWS(1)},drawRect:function(e,t){this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y)),this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y))},drawSolidRect:function(e,t,n){var r=[e,cc.p(t.x,e.y),t,cc.p(e.x,t.y)];this.drawSolidPoly(r,4,n)},drawPoly:function(e,t,n){this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var r=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,r),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,this._pointsToTypeArray(e),this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),n?this._renderContext.drawArrays(this._renderContext.LINE_LOOP,0,e.length):this._renderContext.drawArrays(this._renderContext.LINE_STRIP,0,e.length),cc.INCREMENT_GL_DRAWS(1)},drawSolidPoly:function(e,t,n){this.lazy_init(),n||(n=this._color),this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(n._arrayBuffer,0,4),1);var r=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,r),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,this._pointsToTypeArray(e),this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.TRIANGLE_FAN,0,e.length),cc.INCREMENT_GL_DRAWS(1)},drawCircle:function(e,t,n,r,i){this.lazy_init();var s=1;i&&s++;var o=2*Math.PI/r,u=new Float32Array((r+2)*2);if(!u)return;for(var a=0;a<=r;a++){var f=a*o,l=t*Math.cos(f+n)+e.x,c=t*Math.sin(f+n)+e.y;u[a*2]=l,u[a*2+1]=c}u[(r+1)*2]=e.x,u[(r+1)*2+1]=e.y,this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var h=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,h),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,u,this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.LINE_STRIP,0,r+s),cc.INCREMENT_GL_DRAWS(1)},drawQuadBezier:function(e,t,n,r){this.lazy_init();var i=new Float32Array((r+1)*2),s=0;for(var o=0;o<r;o++)i[o*2]=Math.pow(1-s,2)*e.x+2*(1-s)*s*t.x+s*s*n.x,i[o*2+1]=Math.pow(1-s,2)*e.y+2*(1-s)*s*t.y+s*s*n.y,s+=1/r;i[r*2]=n.x,i[r*2+1]=n.y,this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var u=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,u),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,i,this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.LINE_STRIP,0,r+1),cc.INCREMENT_GL_DRAWS(1)},drawCubicBezier:function(e,t,n,r,i){this.lazy_init();var s=new Float32Array((i+1)*2),o=0;for(var u=0;u<i;u++)s[u*2]=Math.pow(1-o,3)*e.x+3*Math.pow(1-o,2)*o*t.x+3*(1-o)*o*o*n.x+o*o*o*r.x,s[u*2+1]=Math.pow(1-o,3)*e.y+3*Math.pow(1-o,2)*o*t.y+3*(1-o)*o*o*n.y+o*o*o*r.y,o+=1/i;s[i*2]=r.x,s[i*2+1]=r.y,this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var a=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,a),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,s,this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.LINE_STRIP,0,i+1),cc.INCREMENT_GL_DRAWS(1)},drawCatmullRom:function(e,t){this.drawCardinalSpline(e,.5,t)},drawCardinalSpline:function(e,t,n){this.lazy_init();var r=new Float32Array((n+1)*2),i,s,o=1/e.length;for(var u=0;u<n+1;u++){var a=u/n;a==1?(i=e.length-1,s=1):(i=0|a/o,s=(a-o*i)/o);var f=cc.CardinalSplineAt(cc.getControlPointAt(e,i-1),cc.getControlPointAt(e,i),cc.getControlPointAt(e,i+1),cc.getControlPointAt(e,i+2),t,s);r[u*2]=f.x,r[u*2+1]=f.y}this._shader.use(),this._shader.setUniformForModelViewProjectionMatrix(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var l=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,l),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,r,this._renderContext.STATIC_DRAW),this._renderContext.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,this._renderContext.FLOAT,!1,0,0),this._renderContext.drawArrays(this._renderContext.LINE_STRIP,0,n+1),cc.INCREMENT_GL_DRAWS(1)},setDrawColor4B:function(e,t,n,r){this._color.r=e/255,this._color.g=t/255,this._color.b=n/255,this._color.a=r/255},setDrawColor4F:function(e,t,n,r){this._color.r=e,this._color.g=t,this._color.b=n,this._color.a=r},setPointSize:function(e){this._pointSize=e*cc.CONTENT_SCALE_FACTOR()},setLineWidth:function(e){this._renderContext.lineWidth&&this._renderContext.lineWidth(e)}}),cc.PI2=Math.PI*2;cc.ORIENTATION_PORTRAIT=0,cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1,cc.ORIENTATION_LANDSCAPE_LEFT=2,cc.ORIENTATION_LANDSCAPE_RIGHT=3,cc.CANVAS=0,cc.WEBGL=1,cc.drawingUtil=null,cc.renderContext=null,cc.canvas=null,cc.gameDiv=null,cc.renderContextType=cc.CANVAS,cc.originalCanvasSize=cc.size(0,0),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),window.console||(window.console={},window.console.log=function(){},window.console.assert=function(){}),cc.isAddedHiddenEvent=!1,cc.setup=function(e,t,n){function o(){document[i]||cc.Director.getInstance()._resetLastUpdate()}var r=isXC?XCanvas:cc.$(e)||cc.$("#"+e);r.tagName=="CANVAS"?(t=t||r.width,n=n||r.height,cc.canvas=r,isXC||(cc.container=cc.$new("DIV"),cc.canvas.parentNode.insertBefore(cc.container,cc.canvas),cc.canvas.appendTo(cc.container),cc.container.style.width=(t||480)+"px",cc.container.style.height=(n||320)+"px",cc.container.setAttribute("id","Cocos2dGameContainer"),cc.canvas.setAttribute("width",t||480),cc.canvas.setAttribute("height",n||320))):(r.tagName!="DIV"&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||r.clientWidth,n=n||r.clientHeight,cc.canvas=cc.$new("CANVAS"),cc.canvas.addClass("gameCanvas"),cc.canvas.setAttribute("width",t||480),cc.canvas.setAttribute("height",n||320),cc.container=r,r.appendChild(cc.canvas),cc.container.style.width=(t||480)+"px",cc.container.style.height=(n||320)+"px"),isXC||(cc.container.style.position="relative",cc.container.style.overflow="hidden",cc.container.top="100%");if(cc.__renderDoesnotSupport)return;cc.Browser.supportWebGL&&(cc.renderContext=cc.webglContext=cc.create3DContext(cc.canvas,{stencil:!0,preserveDrawingBuffer:!0,alpha:!1})),cc.renderContext?(cc.renderContextType=cc.WEBGL,window.gl=cc.renderContext,cc.drawingUtil=new cc.DrawingPrimitiveWebGL(cc.renderContext),cc.TextureCache.getInstance()._initializingRenderer()):(cc.renderContext=cc.canvas.getContext("2d"),cc.renderContextType=cc.CANVAS,cc.renderContext.translate(0,cc.canvas.height),cc.drawingUtil=new cc.DrawingPrimitiveCanvas(cc.renderContext)),cc.originalCanvasSize=cc.size(cc.canvas.width,cc.canvas.height),cc.gameDiv=cc.container,cc.log(cc.ENGINE_VERSION),cc.Configuration.getInstance(),cc.setContextMenuEnable(!1),cc.Browser.isMobile&&cc._addUserSelectStatus();var i,s;typeof document.hidden!="undefined"?(i="hidden",s="visibilitychange"):typeof document.mozHidden!="undefined"?(i="mozHidden",s="mozvisibilitychange"):typeof document.msHidden!="undefined"?(i="msHidden",s="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(i="webkitHidden",s="webkitvisibilitychange"),typeof document.addEventListener=="undefined"||typeof i=="undefined"?cc.isAddedHiddenEvent=!1:(cc.isAddedHiddenEvent=!0,document.addEventListener(s,o,!1))},cc._addUserSelectStatus=function(){var e=document.createElement("style");e.type="text/css",document.body.appendChild(e),e.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"},cc.bindingRendererClass=function(e){e===cc.WEBGL?(cc.Node=cc.NodeWebGL,cc.Sprite=cc.SpriteWebGL,cc.SpriteBatchNode=cc.SpriteBatchNodeWebGL,cc.TextureCache=cc.TextureCacheWebGL,cc.ProgressTimer=cc.ProgressTimerWebGL,cc.AtlasNode=cc.AtlasNodeWebGL,cc.LabelTTF=cc.LabelTTFWebGL,cc.LayerColor=cc.LayerColorWebGL,cc.DrawNode=cc.DrawNodeWebGL,cc.LabelAtlas=cc.LabelAtlasWebGL):(cc.Node=cc.NodeCanvas,cc.Sprite=cc.SpriteCanvas,cc.SpriteBatchNode=cc.SpriteBatchNodeCanvas,cc.TextureCache=cc.TextureCacheCanvas,cc.ProgressTimer=cc.ProgressTimerCanvas,cc.AtlasNode=cc.AtlasNodeCanvas,cc.LabelTTF=cc.LabelTTFCanvas,cc.LayerColor=cc.LayerColorCanvas,cc.DrawNode=cc.DrawNodeCanvas,cc.LabelAtlas=cc.LabelAtlasCanvas)},cc._isContextMenuEnable=!1,cc.setContextMenuEnable=function(e){cc._isContextMenuEnable=e,cc._isContextMenuEnable?cc.canvas.oncontextmenu=function(){}:cc.canvas.oncontextmenu=function(){return!1}},cc.Application=cc.Class.extend({ctor:function(){this._animationInterval=0,cc.Assert(!cc._sharedApplication,"CCApplication ctor"),cc._sharedApplication=this},setAnimationInterval:function(e){this._animationInterval=e},statusBarFrame:function(e){e&&(e=cc.rect(0,0,0,0))},run:function(){if(!this.applicationDidFinishLaunching())return 0;var e;return window.requestAnimFrame&&this._animationInterval==1/60?(e=function(){cc.Director.getInstance().mainLoop(),window.requestAnimFrame(e)},cc.log(window.requestAnimFrame),window.requestAnimFrame(e)):(e=function(){cc.Director.getInstance().mainLoop()},setInterval(e,this._animationInterval*1e3)),0},_animationInterval:null}),cc.Application.sharedApplication=function(){return cc.Assert(cc._sharedApplication,"sharedApplication"),cc._sharedApplication},cc.Application.getCurrentLanguage=function(){var e=cc.LANGUAGE_ENGLISH,t=navigator.language;t||(t=navigator.browserLanguage||navigator.userLanguage);if(!t)return e;t=t.toLowerCase();switch(t){case"zh-cn":e=cc.LANGUAGE_CHINESE;break;case"fr":e=cc.LANGUAGE_FRENCH;break;case"it":e=cc.LANGUAGE_ITALIAN;break;case"de":e=cc.LANGUAGE_GERMAN;break;case"es":e=cc.LANGUAGE_SPANISH;break;case"ru":e=cc.LANGUAGE_RUSSIAN}return e},cc._sharedApplication=null;cc.SAXParser=cc.Class.extend({xmlDoc:null,parser:null,_xmlDict:null,plist:null,ctor:function(){this._xmlDict={},this.plist={}},parse:function(e){e=this.getList(e),window.DOMParser?(this.parser=new DOMParser,this.xmlDoc=this.parser.parseFromString(e,"text/xml")):(this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async="false",this.xmlDoc.loadXML(e)),this.xmlDoc==null&&cc.log("cocos2d:xml "+this.xmlDoc+" not found!");var t=this.xmlDoc.documentElement;if(t.tagName!="plist")throw"cocos2d:Not a plist file";var n=null;for(var r=0,i=t.childNodes.length;r<i;r++){n=t.childNodes[r];if(n.nodeType==1)break}return this.plist=this._parseNode(n),this.plist},tmxParse:function(e,t){if(t==null||t===!1)e=this.getList(e);return window.DOMParser?(this.parser=new DOMParser,this.xmlDoc=this.parser.parseFromString(e,"text/xml")):(this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async="false",this.xmlDoc.loadXML(e)),this.xmlDoc==null&&cc.log("cocos2d:xml "+this.xmlDoc+" not found!"),this.xmlDoc},_parseNode:function(e){var t=null;switch(e.tagName){case"dict":t=this._parseDict(e);break;case"array":t=this._parseArray(e);break;case"string":if(e.childNodes.length==1)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}break;case"false":t=!1;break;case"true":t=!0;break;case"real":t=parseFloat(e.firstChild.nodeValue);break;case"integer":t=parseInt(e.firstChild.nodeValue,10)}return t},_parseArray:function(e){var t=[];for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(i.nodeType!=1)continue;t.push(this._parseNode(i))}return t},_parseDict:function(e){var t={},n=null;for(var r=0,i=e.childNodes.length;r<i;r++){var s=e.childNodes[r];if(s.nodeType!=1)continue;s.tagName=="key"?n=s.firstChild.nodeValue:t[n]=this._parseNode(s)}return t},preloadPlist:function(e){e=cc.FileUtils.getInstance().fullPathFromRelativePath(e);if(window.XMLHttpRequest){var t=new XMLHttpRequest;t.overrideMimeType&&t.overrideMimeType("text/xml")}else t=new ActiveXObject("Microsoft.XMLHTTP");if(t!=null){var n=this;t.onreadystatechange=function(){t.readyState==4&&(t.responseText?(cc.Loader.getInstance().onResLoaded(),n._xmlDict[e]=t.responseText,t=null):cc.Assert("cocos2d:There was a problem retrieving the xml data:"+t.statusText))},t.open("GET",e,!0),t.send(null)}else cc.Assert("cocos2d:Your browser does not support XMLHTTP.")},getName:function(e){var t=e.lastIndexOf("/",e.length)+1,n=e.lastIndexOf(".",e.length);return e.substring(t,n)},getExt:function(e){var t=e.lastIndexOf(".",e.length)+1;return e.substring(t,e.length)},getList:function(e){return this._xmlDict!=null?this._xmlDict[e]:null}}),cc.SAXParser.getInstance=function(){return this._instance||(this._instance=new cc.SAXParser),this._instance},cc.SAXParser._instance=null;cc.AppController=cc.Class.extend({didFinishLaunchingWithOptions:function(){return cc.Application.sharedApplication().run(),!0},applicationWillResignActive:function(){cc.Director.getInstance().pause()},applicationDidBecomeActive:function(){cc.Director.getInstance().resume()},applicationDidEnterBackground:function(){cc.Application.sharedApplication().applicationDidEnterBackground()},applicationWillEnterForeground:function(){cc.Application.sharedApplication().applicationWillEnterForeground()},applicationWillTerminate:function(){}}),cc.AppController.shareAppController=function(){return cc.sharedAppController==null&&(cc.sharedAppController=new cc.AppController),cc.Assert(cc.sharedAppController,"shareAppController"),cc.sharedAppController},cc.sharedAppController=null;cc.ITEM_SIZE=32,cc._fontSize=cc.ITEM_SIZE,cc._fontName="Arial",cc._fontNameRelease=!1,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.MenuItem=cc.Node.extend({_listener:null,_selector:null,_isSelected:!1,_isEnabled:!1,isSelected:function(){return this._isSelected},setTarget:function(e,t){this._listener=t,this._selector=e},isEnabled:function(){return this._isEnabled},setEnabled:function(e){this._isEnabled=e},initWithCallback:function(e,t){return this.setAnchorPoint(cc.p(.5,.5)),this._listener=t,this._selector=e,this._isEnabled=!0,this._isSelected=!1,!0},rect:function(){return cc.rect(this._position.x-this._contentSize.width*this._anchorPoint.x,this._position.y-this._contentSize.height*this._anchorPoint.y,this._contentSize.width,this._contentSize.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(e,t){this._listener=t,this._selector=e},activate:function(){this._isEnabled&&(this._listener&&typeof this._selector=="string"?this._listener[this._selector](this):this._listener&&typeof this._selector=="function"?this._selector.call(this._listener,this):this._selector(this))}}),cc.MenuItem.create=function(e,t){var n=new cc.MenuItem;return n.initWithCallback(t,e),n},cc.MenuItemLabel=cc.MenuItem.extend({RGBAProtocol:!0,_disabledColor:new cc.Color3B,getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(e){this._disabledColor=e},_label:null,getLabel:function(){return this._label},setLabel:function(e){e&&(this.addChild(e),e.setAnchorPoint(cc.p(0,0)),this.setContentSize(e.getContentSize())),this._label&&this.removeChild(this._label,!0),this._label=e},_orginalScale:0,setEnabled:function(e){this._isEnabled!=e&&(e?this._label.setColor(this._colorBackup):(this._colorBackup=this._label.getColor(),this._label.setColor(this._disabledColor))),this._super(e)},setOpacity:function(e){this._label.setOpacity(e)},getOpacity:function(){return this._label.getOpacity()},setColor:function(e){this._label.setColor(e)},getColor:function(){return this._label.getColor()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){},initWithLabel:function(e,t,n){return this.initWithCallback(t,n),this._originalScale=1,this._colorBackup=cc.white(),this._disabledColor=cc.c3b(126,126,126),this.setLabel(e),!0},setString:function(e){this._label.setString(e),this.setContentSize(this._label.getContentSize())},activate:function(){this._isEnabled&&(this.stopAllActions(),this.setScale(this._originalScale),this._super())},selected:function(){if(this._isEnabled){this._super();var e=this.getActionByTag(cc.ZOOM_ACTION_TAG);e?this.stopAction(e):this._originalScale=this.getScale();var t=cc.ScaleTo.create(.1,this._originalScale*1.2);t.setTag(cc.ZOOM_ACTION_TAG),this.runAction(t)}},unselected:function(){if(this._isEnabled){this._super(),this.stopActionByTag(cc.ZOOM_ACTION_TAG);var e=cc.ScaleTo.create(.1,this._originalScale);e.setTag(cc.ZOOM_ACTION_TAG),this.runAction(e)}}}),cc.MenuItemLabel.create=function(e,t,n){var r=new cc.MenuItemLabel;return r.initWithLabel(e,t,n),r},cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({initWithString:function(e,t,n,r,i,s,o){cc.Assert(e!=null&&e.length!=0,"value length must be greater than 0");var u=new cc.LabelAtlas;return u.initWithString(e,t,n,r,i),this.initWithLabel(u,s,o),!0}}),cc.MenuItemAtlasFont.create=function(e,t,n,r,i,s,o){var u=new cc.MenuItemAtlasFont;return u.initWithString(e,t,n,r,i,s,o),u},cc.MenuItemFont=cc.MenuItemLabel.extend({initWithString:function(e,t,n){cc.Assert(e!=null&&e.length!=0,"Value length must be greater than 0"),this._fontName=cc._fontName,this._fontSize=cc._fontSize;var r=cc.LabelTTF.create(e,this._fontName,this._fontSize);return this.initWithLabel(r,t,n),!0},setFontSize:function(e){this._fontSize=e,this._recreateLabel()},fontSize:function(){return this._fontSize},setFontName:function(e){this._fontName=e,this._recreateLabel()},fontName:function(){return this._fontName},_recreateLabel:function(){var e=cc.LabelTTF.create(this._label.getString(),this._fontName,this._fontSize);this.setLabel(e)},_fontSize:0,_fontName:""}),cc.MenuItemFont.setFontSize=function(e){cc._fontSize=e},cc.MenuItemFont.fontSize=function(){return cc._fontSize},cc.MenuItemFont.setFontName=function(e){cc._fontNameRelease&&(cc._fontName=""),cc._fontName=e,cc._fontNameRelease=!0},cc.MenuItemFont.fontName=function(){return cc._fontName},cc.MenuItemFont.create=function(e,t,n){var r=new cc.MenuItemFont;return r.initWithString(e,t,n),r},cc.MenuItemSprite=cc.MenuItem.extend({RGBAProtocol:!0,_normalImage:null,getNormalImage:function(){return this._normalImage},setNormalImage:function(e){if(this._normalImage==e)return;e&&(this.addChild(e,0,cc.NORMAL_TAG),e.setAnchorPoint(cc.p(0,0))),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=e,this.setContentSize(this._normalImage.getContentSize()),this._updateImagesVisibility()},_selectedImage:null,getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(e){if(this._selectedImage==e)return;e&&(this.addChild(e,0,cc.SELECTED_TAG),e.setAnchorPoint(cc.p(0,0))),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=e,this._updateImagesVisibility()},_disabledImage:null,getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(e){if(this._disabledImage==e)return;e&&(this.addChild(e,0,cc.DISABLE_TAG),e.setAnchorPoint(cc.p(0,0))),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=e,this._updateImagesVisibility()},initWithNormalSprite:function(e,t,n,r,i){return this.initWithCallback(r,i),this.setNormalImage(e),this.setSelectedImage(t),this.setDisabledImage(n),this._normalImage&&this.setContentSize(this._normalImage.getContentSize()),!0},setColor:function(e){this._normalImage.setColor(e),this._selectedImage&&this._selectedImage.setColor(e),this._disabledImage&&this._disabledImage.setColor(e)},getColor:function(){return this._normalImage.getColor()},setOpacity:function(e){this._normalImage.setOpacity(e),this._selectedImage&&this._selectedImage.setOpacity(e),this._disabledImage&&this._disabledImage.setOpacity(e)},getOpacity:function(){return this._normalImage.getOpacity()},selected:function(){this._super(),this._normalImage&&(this._disabledImage&&this._disabledImage.setVisible(!1),this._selectedImage?(this._normalImage.setVisible(!1),this._selectedImage.setVisible(!0)):this._normalImage.setVisible(!0))},unselected:function(){this._super(),this._normalImage&&(this._normalImage.setVisible(!0),this._selectedImage&&this._selectedImage.setVisible(!1),this._disabledImage&&this._disabledImage.setVisible(!1))},setEnabled:function(e){this._isEnabled!=e&&(this._super(e),this._updateImagesVisibility())},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},_updateImagesVisibility:function(){this._isEnabled?(this._normalImage&&this._normalImage.setVisible(!0),this._selectedImage&&this._selectedImage.setVisible(!1),this._disabledImage&&this._disabledImage.setVisible(!1)):this._disabledImage?(this._normalImage&&this._normalImage.setVisible(!1),this._selectedImage&&this._selectedImage.setVisible(!1),this._disabledImage&&this._disabledImage.setVisible(!0)):(this._normalImage&&this._normalImage.setVisible(!0),this._selectedImage&&this._selectedImage.setVisible(!1),this._disabledImage&&this._disabledImage.setVisible(!1))}}),cc.MenuItemSprite.create=function(e,t,n,r,i){var s=arguments.length,e=arguments[0],t=arguments[1],o,u,a,f=new cc.MenuItemSprite;return s==5?(o=arguments[2],a=arguments[3],u=arguments[4]):s==4&&typeof arguments[3]=="function"?(o=arguments[2],a=arguments[3]):s==4&&typeof arguments[2]=="function"?(u=arguments[3],a=arguments[2]):s<=2&&(o=arguments[2]),f.initWithNormalSprite(e,t,o,a,u),f},cc.MenuItemImage=cc.MenuItemSprite.extend({setNormalSpriteFrame:function(e){this.setNormalImage(cc.Sprite.createWithSpriteFrame(e))},setSelectedSpriteFrame:function(e){this.setSelectedImage(cc.Sprite.createWithSpriteFrame(e))},setDisabledSpriteFrame:function(e){this.setDisabledImage(cc.Sprite.createWithSpriteFrame(e))},initWithNormalImage:function(e,t,n,r,i){var s=null,o=null,u=null;return e&&(s=cc.Sprite.create(e)),t&&(o=cc.Sprite.create(t)),n&&(u=cc.Sprite.create(n)),this.initWithNormalSprite(s,o,u,r,i)}}),cc.MenuItemImage.create=function(e,t,n,r,i){if(arguments.length==0)return cc.MenuItemImage.create(null,null,null,null,null);if(arguments.length==3)return cc.MenuItemImage.create(e,t,null,n,null);if(arguments.length==4)return cc.MenuItemImage.create(e,t,null,n,r);var s=new cc.MenuItemImage;return s.initWithNormalImage(e,t,n,r,i)?s:null},cc.MenuItemToggle=cc.MenuItem.extend({RGBAProtocol:!0,_opacity:0,getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setOpacity(e)},_color:new cc.Color3B,getColor:function(){return this._color},setColor:function(e){this._color=e;if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setColor(e)},_selectedIndex:0,getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(e){if(e!=this._selectedIndex){this._selectedIndex=e;var t=this.getChildByTag(cc.CURRENT_ITEM);t&&t.removeFromParent(!1);var n=this._subItems[this._selectedIndex];this.addChild(n,0,cc.CURRENT_ITEM);var r=n.getContentSize();this.setContentSize(r),n.setPosition(cc.p(r.width/2,r.height/2))}},_subItems:[],getSubItems:function(){return this._subItems},setSubItems:function(e){this._subItems=e},initWithItems:function(e){var t=e.length;typeof e[e.length-2]=="function"?(this.initWithCallback(e[e.length-2],e[e.length-1]),t-=2):typeof e[e.length-1]=="function"?(this.initWithCallback(e[e.length-1],null),t-=1):this.initWithCallback(null,null),this._subItems=[];for(var n=0;n<t;n++)e[n]&&this._subItems.push(e[n]);return this._selectedIndex=cc.UINT_MAX,this.setSelectedIndex(0),!0},addSubItem:function(e){this._subItems.push(e)},activate:function(){if(this._isEnabled){var e=(this._selectedIndex+1)%this._subItems.length;this.setSelectedIndex(e)}this._super()},selected:function(){this._super(),this._subItems[this._selectedIndex].selected()},unselected:function(){this._super(),this._subItems[this._selectedIndex].unselected()},setEnabled:function(e){if(this._isEnabled!=e){this._super(e);if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setEnabled(e)}},selectedItem:function(){return this._subItems[this._selectedIndex]},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},onEnter:function(){this._super(),this.setSelectedIndex(this._selectedIndex)}}),cc.MenuItemToggle.create=function(){var e=new cc.MenuItemToggle;return e.initWithItems(arguments),e};cc.MENU_STATE_WAITING=0,cc.MENU_STATE_TRACKING_TOUCH=1,cc.MENU_HANDLER_PRIORITY=-128,cc.DEFAULT_PADDING=5,cc.Menu=cc.Layer.extend({RGBAProtocol:!0,_color:new cc.Color3B,getColor:function(){return this._color},setColor:function(e){this._color=e;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++)this._children[t].setColor(this._color)},_opacity:0,getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++)this._children[t].setOpacity(this._opacity)},_enabled:!1,isEnabled:function(){return this._enabled},setEnabled:function(e){this._enabled=e},_selectedItem:null,initWithItems:function(e){var t=[];if(e)for(var n=0;n<e.length;n++)e[n]&&t.push(e[n]);return this.initWithArray(t)},initWithArray:function(e){if(this.init()){this.setTouchEnabled(!0),this._enabled=!0;var t=cc.Director.getInstance().getWinSize();this.ignoreAnchorPointForPosition(!0),this.setAnchorPoint(cc.p(.5,.5)),this.setContentSize(t),this.setPosition(cc.p(t.width/2,t.height/2));if(e)for(var n=0;n<e.length;n++)this.addChild(e[n],n);return this._selectedItem=null,this._state=cc.MENU_STATE_WAITING,!0}return!1},addChild:function(e,t,n){cc.Assert(e instanceof cc.MenuItem,"Menu only supports MenuItem objects as children"),this._super(e,t,n)},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(e){var t=-e;if(this._children&&this._children.length>0)for(var n=0;n<this._children.length;n++)t+=this._children[n].getContentSize().height*this._children[n].getScaleY()+e;var r=t/2;if(this._children&&this._children.length>0)for(n=0;n<this._children.length;n++)this._children[n].setPosition(cc.p(0,r-this._children[n].getContentSize().height*this._children[n].getScaleY()/2)),r-=this._children[n].getContentSize().height*this._children[n].getScaleY()+e},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(e){var t=-e;if(this._children&&this._children.length>0)for(var n=0;n<this._children.length;n++)t+=this._children[n].getContentSize().width*this._children[n].getScaleX()+e;var r=-t/2;if(this._children&&this._children.length>0)for(n=0;n<this._children.length;n++)this._children[n].setPosition(cc.p(r+this._children[n].getContentSize().width*this._children[n].getScaleX()/2,0)),r+=this._children[n].getContentSize().width*this._children[n].getScaleX()+e},alignItemsInColumns:function(){var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);var n=-5,r=0,i=0,s=0,o;if(this._children&&this._children.length>0)for(t=0;t<this._children.length;t++){cc.Assert(r<e.length,""),o=e[r],cc.Assert(o,"");var u=this._children[t].getContentSize().height;i=i>=u||isNaN(u)?i:u,++s,s>=o&&(n+=i+5,s=0,i=0,++r)}cc.Assert(!s,"");var a=cc.Director.getInstance().getWinSize();r=0,i=0,o=0;var f=0,l=0,c=n/2;if(this._children&&this._children.length>0)for(t=0;t<this._children.length;t++){var h=this._children[t];o==0&&(o=e[r],f=a.width/(1+o),l=f);var u=h.getContentSize().height;i=i>=u||isNaN(u)?i:u,h.setPosition(cc.p(l-a.width/2,c-h.getContentSize().height/2)),l+=f,++s,s>=o&&(c-=i+5,s=0,o=0,i=0,++r)}},alignItemsInRows:function(){var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);var n=[],r=[],i=-10,s=-5,o=0,u=0,a=0,f;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++){var l=this._children[t];cc.Assert(o<e.length,""),f=e[o],cc.Assert(f,"");var c=l.getContentSize().width;u=u>=c||isNaN(c)?u:c,s+=l.getContentSize().height+5,++a,a>=f&&(n.push(u),r.push(s),i+=u+10,a=0,u=0,s=-5,++o)}cc.Assert(!a,"");var h=cc.Director.getInstance().getWinSize();o=0,u=0,f=0;var p=-i/2,d=0;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++){var l=this._children[t];f==0&&(f=e[o],d=r[o]);var c=l.getContentSize().width;u=u>=c||isNaN(c)?u:c,l.setPosition(cc.p(p+n[o]/2,d-h.height/2)),d-=l.getContentSize().height+10,++a,a>=f&&(p+=u+5,a=0,f=0,u=0,++o)}},registerWithTouchDispatcher:function(){cc.Director.getInstance().getTouchDispatcher().addTargetedDelegate(this,cc.MENU_HANDLER_PRIORITY,!0)},onTouchBegan:function(e,t){if(this._state!=cc.MENU_STATE_WAITING||!this._visible||!this._enabled)return!1;for(var n=this._parent;n!=null;n=n.getParent())if(!n.isVisible())return!1;return this._selectedItem=this._itemForTouch(e),this._selectedItem?(this._state=cc.MENU_STATE_TRACKING_TOUCH,this._selectedItem.selected(),!0):!1},onTouchEnded:function(e,t){cc.Assert(this._state==cc.MENU_STATE_TRACKING_TOUCH,"[Menu onTouchEnded] -- invalid state"),this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem.activate()),this._state=cc.MENU_STATE_WAITING},onTouchCancelled:function(e,t){cc.Assert(this._state==cc.MENU_STATE_TRACKING_TOUCH,"[Menu onTouchCancelled] -- invalid state"),this._selectedItem&&this._selectedItem.unselected(),this._state=cc.MENU_STATE_WAITING},onTouchMoved:function(e,t){cc.Assert(this._state==cc.MENU_STATE_TRACKING_TOUCH,"[Menu onTouchMoved] -- invalid state");var n=this._itemForTouch(e);n!=this._selectedItem&&(this._selectedItem&&this._selectedItem.unselected(),this._selectedItem=n,this._selectedItem&&this._selectedItem.selected())},onExit:function(){this._state==cc.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem.unselected(),this._state=cc.MENU_STATE_WAITING,this._selectedItem=null),this._super()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},_itemForTouch:function(e){var t=e.getLocation();if(this._children&&this._children.length>0)for(var n=0;n<this._children.length;n++)if(this._children[n].isVisible()&&this._children[n].isEnabled()){var r=this._children[n].convertToNodeSpace(t),i=this._children[n].rect();i.origin=cc.p(0,0);if(cc.Rect.CCRectContainsPoint(i,r))return this._children[n]}return null},_state:-1,setHandlerPriority:function(e){cc.Director.getInstance().getTouchDispatcher().setPriority(e,this)}}),cc.Menu.create=function(){var e=new cc.Menu;if(arguments.length==0)e.initWithItems(null,null);else if(arguments.length==1&&arguments[0]instanceof Array)return e.initWithArray(arguments[0]),e;return e.initWithItems(arguments),e};cc.TMX_ORIENTATION_ORTHO=0,cc.TMX_ORIENTATION_HEX=1,cc.TMX_ORIENTATION_ISO=2,cc.TMXTiledMap=cc.Node.extend({_mapSize:null,_tileSize:null,_properties:null,_objectGroups:null,_mapOrientation:null,_TMXLayers:null,_tileProperties:null,ctor:function(){this._super(),this._mapSize=cc.SizeZero(),this._tileSize=cc.SizeZero(),this._tileProperties=[]},getMapSize:function(){return this._mapSize},setMapSize:function(e){this._mapSize=e},getTileSize:function(){return this._tileSize},setTileSize:function(e){this._tileSize=e},getMapOrientation:function(){return this._mapOrientation},setMapOrientation:function(e){this._mapOrientation=e},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(e){this._objectGroups=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e},initWithTMXFile:function(e,t){cc.Assert(e!=null&&e.length>0,"TMXTiledMap: tmx file should not be nil"),this.setContentSize(cc.SizeZero());var n=cc.TMXMapInfo.create(e,t);return n?(cc.Assert(n.getTilesets().length!=0,"TMXTiledMap: Map not found. Please check the filename."),this._buildWithMapInfo(n),!0):!1},initWithXML:function(e,t){this.setContentSize(cc.SizeZero());var n=cc.TMXMapInfo.createWithXML(e,t);return cc.Assert(n.getTilesets().length!=0,"TMXTiledMap: Map not found. Please check the filename."),this._buildWithMapInfo(n),!0},_buildWithMapInfo:function(e){this._mapSize=e.getMapSize(),this._tileSize=e.getTileSize(),this._mapOrientation=e.getOrientation(),this._objectGroups=e.getObjectGroups(),this._properties=e.getProperties(),this._tileProperties=e.getTileProperties();var t=0,n=e.getLayers();if(n){var r=null;for(var i=0,s=n.length;i<s;i++){r=n[i];if(r&&r.visible){var o=this._parseLayer(r,e);this.addChild(o,t,t);var u=o.getContentSize(),a=this.getContentSize();a.width=Math.max(a.width,u.width),a.height=Math.max(a.height,u.height),this.setContentSize(a),t++}}}},getLayer:function(e){cc.Assert(e!=null&&e.length>0,"Invalid layer name!");for(var t=0;t<this._children.length;t++){var n=this._children[t];if(n&&n.getLayerName()==e)return n}return null},getObjectGroup:function(e){cc.Assert(e!=null&&e.length>0,"Invalid group name!");if(this._objectGroups)for(var t=0;t<this._objectGroups.length;t++){var n=this._objectGroups[t];if(n&&n.getGroupName()==e)return n}return null},getProperty:function(e){return this._properties[e.toString()]},propertiesForGID:function(e){return this._tileProperties[e]},_parseLayer:function(e,t){var n=this._tilesetForLayer(e,t),r=cc.TMXLayer.create(n,e,t);return e.ownTiles=!1,r.setupTiles(),r},_tilesetForLayer:function(e,t){var n=e._layerSize,r=t.getTilesets();if(r)for(var i=r.length-1;i>=0;i--){var s=r[i];if(s)for(var o=0;o<n.height;o++)for(var u=0;u<n.width;u++){var a=u+n.width*o,f=e._tiles[a];if(f!=0&&(f&cc.TMX_TILE_FLIPPED_MASK)>>>0>=s.firstGid)return s}}return cc.log("cocos2d: Warning: TMX Layer "+e.name+" has no tiles"),null}}),cc.TMXTiledMap.create=function(e,t){var n=new cc.TMXTiledMap;return n.initWithTMXFile(e,t)?n:null},cc.TMXTiledMap.createWithXML=function(e,t){var n=new cc.TMXTiledMap;return n.initWithXML(e,t)?n:null};cc.TMX_LAYER_ATTRIB_NONE=1,cc.TMX_LAYER_ATTRIB_BASE64=2,cc.TMX_LAYER_ATTRIB_GZIP=4,cc.TMX_LAYER_ATTRIB_ZLIB=8,cc.TMX_PROPERTY_NONE=0,cc.TMX_PROPERTY_MAP=1,cc.TMX_PROPERTY_LAYER=2,cc.TMX_PROPERTY_OBJECTGROUP=3,cc.TMX_PROPERTY_OBJECT=4,cc.TMX_PROPERTY_TILE=5,cc.TMX_TILE_HORIZONTAL_FLAG=2147483648,cc.TMX_TILE_VERTICAL_FLAG=1073741824,cc.TMX_TILE_DIAGONAL_FLAG=536870912,cc.TMX_TILE_FLIPPED_ALL=(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_DIAGONAL_FLAG)>>>0,cc.TMX_TILE_FLIPPED_MASK=~cc.TMX_TILE_FLIPPED_ALL>>>0,cc.TMXLayerInfo=cc.Class.extend({_properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this._properties=[],this._tiles=[],this._offset=cc.PointZero()},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e}}),cc.TMXTilesetInfo=cc.Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=cc.SizeZero(),this.imageSize=cc.SizeZero()},rectForGID:function(e){var t=cc.RectZero();t.size=this._tileSize,e&=cc.TMX_TILE_FLIPPED_MASK,e-=parseInt(this.firstGid,10);var n=parseInt((this.imageSize.width-this.margin*2+this.spacing)/(this._tileSize.width+this.spacing),10);return t.origin.x=parseInt(e%n*(this._tileSize.width+this.spacing)+this.margin,10),t.origin.y=parseInt(parseInt(e/n,10)*(this._tileSize.height+this.spacing)+this.margin,10),t}}),cc.TMXMapInfo=cc.SAXParser.extend({_orientation:null,_mapSize:null,_tileSize:null,_layers:null,_tileSets:null,_objectGroups:null,_parentElement:null,_parentGID:null,_layerAttribs:0,_storingCharacters:!1,_properties:null,_TMXFileName:null,_currentString:null,_tileProperties:null,_resources:null,ctor:function(){this._tileSets=[],this._tileProperties=[],this._properties=[],this._mapSize=cc.SizeZero(),this._tileSize=cc.SizeZero()},getOrientation:function(){return this._orientation},setOrientation:function(e){this._orientation=e},getMapSize:function(){return this._mapSize},setMapSize:function(e){this._mapSize=e},getTileSize:function(){return this._tileSize},setTileSize:function(e){this._tileSize=e},getLayers:function(){return this._layers},setLayers:function(e){this._layers.push(e)},getTilesets:function(){return this._tileSets},setTilesets:function(e){this._tileSets.push(e)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(e){this._objectGroups.push(e)},getParentElement:function(){return this._parentElement},setParentElement:function(e){this._parentElement=e},getParentGID:function(){return this._parentGID},setParentGID:function(e){this._parentGID=e},getLayerAttribs:function(){return this._layerAttribs},setLayerAttribs:function(e){this._layerAttribs=e},getStoringCharacters:function(){return this._storingCharacters},setStoringCharacters:function(e){this._storingCharacters=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties.push(e)},initWithTMXFile:function(e,t){return this._internalInit(e,t),this.parseXMLFile(this._TMXFileName)},initWithXML:function(e,t){return this._internalInit(null,t),this.parseXMLString(e)},parseXMLFile:function(e,t){t=t||!1;var n=cc.SAXParser.getInstance().tmxParse(e,t),r,i,r,i,s=n.documentElement,o=s.getAttribute("version"),u=s.getAttribute("orientation");if(s.nodeName=="map"){o!="1.0"&&o!==null&&cc.log("cocos2d: TMXFormat: Unsupported TMX version:"+o),u=="orthogonal"?this.setOrientation(cc.TMX_ORIENTATION_ORTHO):u=="isometric"?this.setOrientation(cc.TMX_ORIENTATION_ISO):u=="hexagonal"?this.setOrientation(cc.TMX_ORIENTATION_HEX):u!==null&&cc.log("cocos2d: TMXFomat: Unsupported orientation:"+this.getOrientation());var a=cc.size(0,0);a.width=parseFloat(s.getAttribute("width")),a.height=parseFloat(s.getAttribute("height")),this.setMapSize(a),a=cc.size(0,0),a.width=parseFloat(s.getAttribute("tilewidth")),a.height=parseFloat(s.getAttribute("tileheight")),this.setTileSize(a);var f=s.querySelectorAll("map > properties >  property");if(f)for(r=0;r<f.length;r++){var l={};l[f[r].getAttribute("name")]=f[r].getAttribute("value"),this.setProperties(l)}}var c=s.getElementsByTagName("tileset");s.nodeName!=="map"&&(c=[],c.push(s));for(r=0;r<c.length;r++){var h=c[r],p=h.getAttribute("source");if(p)this.parseXMLFile(cc.FileUtils.getInstance().fullPathFromRelativeFile(p,t?this._resources+"/":e));else{var d=new cc.TMXTilesetInfo;d.name=h.getAttribute("name")||"",d.firstGid=parseInt(h.getAttribute("firstgid"))||1,d.spacing=parseInt(h.getAttribute("spacing"))||0,d.margin=parseInt(h.getAttribute("margin"))||0;var v=cc.size(0,0);v.width=parseFloat(h.getAttribute("tilewidth")),v.height=parseFloat(h.getAttribute("tileheight")),d._tileSize=v;var m=h.getElementsByTagName("image")[0],g=m.getAttribute("source");g&&(this._resources?g=this._resources+"/"+g:g=cc.FileUtils.getInstance().fullPathFromRelativeFile(g,e)),d.sourceImage=g,this.setTilesets(d)}}var y=s.querySelectorAll("tile");if(y)for(r=0;r<y.length;r++){var b=this._tileSets[0],w=y[r];this.setParentGID(parseInt(b.firstGid)+parseInt(w.getAttribute("id")||0));var E=w.querySelectorAll("properties > property");if(E){var S={};for(i=0;i<E.length;i++){var x=E[i].getAttribute("name"),T=E[i].getAttribute("value");S[x]=T}this._tileProperties[this.getParentGID()]=S}}var N=s.getElementsByTagName("layer");if(N)for(r=0;r<N.length;r++){var C=N[r],k=C.getElementsByTagName("data")[0],L=new cc.TMXLayerInfo;L.name=C.getAttribute("name");var A=cc.size(0,0);A.width=parseFloat(C.getAttribute("width")),A.height=parseFloat(C.getAttribute("height")),L._layerSize=A;var O=C.getAttribute("visible");L.visible=O!="0";var M=C.getAttribute("opacity")||1;M?L._opacity=parseInt(255*parseFloat(M)):L._opacity=255,L.offset=cc.p(parseFloat(C.getAttribute("x"))||0,parseFloat(C.getAttribute("y"))||0);var _="";for(i=0;i<k.childNodes.length;i++)_+=k.childNodes[i].nodeValue;_=_.trim();var D=k.getAttribute("compression"),P=k.getAttribute("encoding");cc.Assert(D==null||D==="gzip"||D==="zlib","TMX: unsupported compression method");switch(D){case"gzip":L._tiles=cc.unzipBase64AsArray(_,4);break;case"zlib":var H=new Zlib.Inflate(cc.Codec.Base64.decodeAsArray(_,1));L._tiles=cc.uint8ArrayToUint32Array(H.decompress());break;case null:case"":if(P=="base64")L._tiles=cc.Codec.Base64.decodeAsArray(_,4);else if(P==="csv"){L._tiles=[];var B=_.split(",");for(var j=0;j<B.length;j++)L._tiles.push(parseInt(B[j]))}else{var F=k.getElementsByTagName("tile");L._tiles=[];for(var I=0;I<F.length;I++)L._tiles.push(parseInt(F[I].getAttribute("gid")))}break;default:cc.Assert(this.getLayerAttribs()!=cc.TMX_LAYER_ATTRIB_NONE,"TMX tile map: Only base64 and/or gzip/zlib maps are supported")}var q=C.querySelectorAll("properties > property");if(q){var R={};for(i=0;i<q.length;i++)R[q[i].getAttribute("name")]=q[i].getAttribute("value");L.setProperties(R)}this.setLayers(L)}var U=s.getElementsByTagName("objectgroup");if(U)for(r=0;r<U.length;r++){var z=U[r],W=new cc.TMXObjectGroup;W.setGroupName(z.getAttribute("name")),W.setPositionOffset(cc.p(parseFloat(z.getAttribute("x"))*this.getTileSize().width||0,parseFloat(z.getAttribute("y"))*this.getTileSize().height||0));var X=z.querySelectorAll("objectgroup > properties > property");if(X)for(i=0;i<X.length;i++){var V={};V[X[i].getAttribute("name")]=X[i].getAttribute("value"),W.setProperties(V)}var $=z.querySelectorAll("object");if($)for(i=0;i<$.length;i++){var J=$[i],K={};K.name=J.getAttribute("name")||"",K.type=J.getAttribute("type")||"",K.x=parseInt(J.getAttribute("x")||0)+W.getPositionOffset().x;var Q=parseInt(J.getAttribute("y")||0)+W.getPositionOffset().y;K.width=parseInt(J.getAttribute("width"))||0,K.height=parseInt(J.getAttribute("height"))||0,K.y=parseInt(this.getMapSize().height*this.getTileSize().height)-Q-K.height;var G=J.querySelectorAll("properties > property");if(G)for(var Y=0;Y<G.length;Y++)K[G[Y].getAttribute("name")]=G[Y].getAttribute("value");W.setObjects(K)}this.setObjectGroups(W)}return s},parseXMLString:function(e){return this.parseXMLFile(e,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(e){this._tileProperties.push(e)},getCurrentString:function(){return this._currentString},setCurrentString:function(e){this._currentString=e},getTMXFileName:function(){return this._TMXFileName},setTMXFileName:function(e){this._TMXFileName=e},_internalInit:function(e,t){this._tileSets=[],this._layers=[],this._TMXFileName=cc.FileUtils.getInstance().fullPathFromRelativePath(e),t&&(this._resources=t),this._objectGroups=[],this._properties=[],this._tileProperties=[],this._currentString="",this._storingCharacters=!1,this._layerAttribs=cc.TMX_LAYER_ATTRIB_NONE,this._parentElement=cc.TMX_PROPERTY_NONE}}),cc.TMXMapInfo.create=function(e,t){var n=new cc.TMXMapInfo;return n.initWithTMXFile(e,t)?n:null},cc.TMXMapInfo.createWithXML=function(e,t){var n=new cc.TMXMapInfo;return n.initWithXML(e,t)?n:null};cc.TMXObjectGroup=cc.Class.extend({_groupName:"",_positionOffset:null,_properties:null,_objects:null,ctor:function(){this._properties=[],this._objects=[],this._positionOffset=cc.PointZero()},getPositionOffset:function(){return this._positionOffset},setPositionOffset:function(e){this._positionOffset=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties.push(e)},getGroupName:function(){return this._groupName.toString()},setGroupName:function(e){this._groupName=e},propertyNamed:function(e){return this._properties[e]},objectNamed:function(e){if(this._objects&&this._objects.length>0)for(var t=0,n=this._objects.length;t<n;t++){var r=this._objects[t].name;if(r&&r==e)return this._objects[t]}return null},getObjects:function(){return this._objects},setObjects:function(e){this._objects.push(e)}});cc.TMXLayer=cc.SpriteBatchNode.extend({_layerSize:null,_mapTileSize:null,_tiles:null,_tileSet:null,_layerOrientation:null,_properties:null,_layerName:"",_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_alphaFuncValue:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,ctor:function(){this._super(),this._children=[],this._descendants=[],this._useCache=!0,this._layerSize=cc.SizeZero(),this._mapTileSize=cc.SizeZero()},getLayerSize:function(){return this._layerSize},setLayerSize:function(e){this._layerSize=e},getMapTileSize:function(){return this._mapTileSize},setMapTileSize:function(e){this._mapTileSize=e},getTiles:function(){return this._tiles},setTiles:function(e){this._tiles=e},getTileSet:function(){return this._tileSet},setTileSet:function(e){this._tileSet=e},getLayerOrientation:function(){return this._layerOrientation},setLayerOrientation:function(e){this._layerOrientation=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e},initWithTilesetInfo:function(e,t,n){var r=t._layerSize,i=parseInt(r.width*r.height),s=i*.35+1,o;e&&(o=cc.TextureCache.getInstance().addImage(e.sourceImage));if(this.initWithTexture(o,s)){this._layerName=t.name,this._layerSize=r,this._tiles=t._tiles,this._minGID=t._minGID,this._maxGID=t._maxGID,this._opacity=t._opacity,this.setProperties(t.getProperties()),this._contentScaleFactor=cc.Director.getInstance().getContentScaleFactor(),this._tileSet=e,this._mapTileSize=n.getTileSize(),this._layerOrientation=n.getOrientation();var u=this._calculateLayerOffset(t.offset);return this.setPosition(cc.POINT_PIXELS_TO_POINTS(u)),this._atlasIndexArray=[],this.setContentSize(cc.SIZE_PIXELS_TO_POINTS(cc.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height))),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0}return!1},releaseMap:function(){this._tiles&&(this._tiles=null),this._atlasIndexArray&&(this._atlasIndexArray=null)},getTileAt:function(e){cc.Assert(e.x<this._layerSize.width&&e.y<this._layerSize.height&&e.x>=0&&e.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released");var t=null,n=this.getTileGIDAt(e);if(n===0)return t;var r=0|e.x+e.y*this._layerSize.width;t=this.getChildByTag(r);if(!t){var i=this._tileSet.rectForGID(n);i=cc.RECT_PIXELS_TO_POINTS(i),t=new cc.Sprite,t.initWithTexture(this.getTexture(),i),t.setBatchNode(this),t.setPosition(this.getPositionAt(e)),t.setVertexZ(this._vertexZForPos(e)),t.setAnchorPoint(cc.PointZero()),t.setOpacity(this._opacity);var s=this._atlasIndexForExistantZ(r);this.addSpriteWithoutQuad(t,s,r)}return t},getTileGIDAt:function(e){cc.Assert(e.x<this._layerSize.width&&e.y<this._layerSize.height&&e.x>=0&&e.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released");var t=0|e.x+e.y*this._layerSize.width,n=this._tiles[t];return(n&cc.TMX_TILE_FLIPPED_MASK)>>>0},getTileFlagsAt:function(e){cc.Assert(e.x<this._layerSize.width&&e.y<this._layerSize.height&&e.x>=0&&e.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released");var t=0|e.x+e.y*this._layerSize.width,n=this._tiles[t];return(n&cc.TMX_TILE_FLIPPED_ALL)>>>0},setTileGID:function(e,t,n){cc.Assert(t.x<this._layerSize.width&&t.y<this._layerSize.height&&t.x>=0&&t.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released"),cc.Assert(e!==0||!(e>=this._tileSet.firstGid),"TMXLayer: invalid gid:"+e),n=n||0,this._setNodeDirtyForCache();var r=this.getTileFlagsAt(t),i=this.getTileGIDAt(t);if(i!=e||r!=n){var s=(e|n)>>>0;if(e===0)this.removeTileAt(t);else if(i===0)this._insertTileForGID(s,t);else{var o=t.x+t.y*this._layerSize.width,u=this.getChildByTag(o);if(u){var a=this._tileSet.rectForGID(e);a=cc.RECT_PIXELS_TO_POINTS(a),u.setTextureRect(a,!1,a.size),n!=null&&this._setupTileSprite(u,t,s),this._tiles[o]=s}else this._updateTileForGID(s,t)}}},removeTileAt:function(e){cc.Assert(e.x<this._layerSize.width&&e.y<this._layerSize.height&&e.x>=0&&e.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released");var t=this.getTileGIDAt(e);if(t!==0){cc.renderContextType===cc.CANVAS&&this._setNodeDirtyForCache();var n=0|e.x+e.y*this._layerSize.width,r=this._atlasIndexForExistantZ(n);this._tiles[n]=0,cc.ArrayRemoveObjectAtIndex(this._atlasIndexArray,r);var i=this.getChildByTag(n);if(i)cc.SpriteBatchNode.prototype.removeChild.call(this,i,!0);else{cc.renderContextType===cc.WEBGL&&this._textureAtlas.removeQuadAtIndex(r);if(this._children)for(var s=0;s<this._children.length;s++){var o=this._children[s];if(o){var u=o.getAtlasIndex();u>=r&&o.setAtlasIndex(u-1)}}}}},getPositionAt:function(e){var t=cc.PointZero();switch(this._layerOrientation){case cc.TMX_ORIENTATION_ORTHO:t=this._positionForOrthoAt(e);break;case cc.TMX_ORIENTATION_ISO:t=this._positionForIsoAt(e);break;case cc.TMX_ORIENTATION_HEX:t=this._positionForHexAt(e)}return cc.POINT_PIXELS_TO_POINTS(t)},getProperty:function(e){return this._properties[e]},setupTiles:function(){if(cc.renderContextType===cc.CANVAS){var e=this._originalTexture;this._tileSet.imageSize=cc.size(e.width,e.height)}else this._tileSet.imageSize=this._textureAtlas.getTexture().getContentSizeInPixels(),this._textureAtlas.getTexture().setAliasTexParameters();this._parseInternalProperties(),cc.renderContextType===cc.CANVAS&&this._setNodeDirtyForCache();for(var t=0;t<this._layerSize.height;t++)for(var n=0;n<this._layerSize.width;n++){var r=n+this._layerSize.width*t,i=this._tiles[r];i!==0&&(this._appendTileForGID(i,cc.p(n,t)),this._minGID=Math.min(i,this._minGID),this._maxGID=Math.max(i,this._maxGID))}this._maxGID>=this._tileSet.firstGid&&this._minGID>=this._tileSet.firstGid||cc.log("cocos2d:TMX: Only 1 tileset per layer is supported")},addChild:function(e,t,n){cc.Assert(0,"addChild: is not supported on cc.TMXLayer. Instead use setTileGID:at:/tileAt:")},removeChild:function(e,t){if(!e)return;cc.Assert(cc.ArrayContainsObject(this._children,e),"Tile does not belong to TMXLayer"),cc.renderContextType===cc.CANVAS&&this._setNodeDirtyForCache();var n=e.getAtlasIndex(),r=this._atlasIndexArray[n];this._tiles[r]=0,cc.ArrayRemoveObjectAtIndex(this._atlasIndexArray,n),this._super(e,t)},getLayerName:function(){return this._layerName.toString()},setLayerName:function(e){this._layerName=e},_positionForIsoAt:function(e){return cc.p(this._mapTileSize.width/2*(this._layerSize.width+e.x-e.y-1),this._mapTileSize.height/2*(this._layerSize.height*2-e.x-e.y-2))},_positionForOrthoAt:function(e){return cc.p(e.x*this._mapTileSize.width,(this._layerSize.height-e.y-1)*this._mapTileSize.height)},_positionForHexAt:function(e){var t=e.x%2==1?-this._mapTileSize.height/2:0;return cc.p(e.x*this._mapTileSize.width*3/4,(this._layerSize.height-e.y-1)*this._mapTileSize.height+t)},_calculateLayerOffset:function(e){var t=cc.PointZero();switch(this._layerOrientation){case cc.TMX_ORIENTATION_ORTHO:t=cc.p(e.x*this._mapTileSize.width,-e.y*this._mapTileSize.height);break;case cc.TMX_ORIENTATION_ISO:t=cc.p(this._mapTileSize.width/2*(e.x-e.y),this._mapTileSize.height/2*(-e.x-e.y));break;case cc.TMX_ORIENTATION_HEX:cc.Assert(cc.pointEqualToPoint(e,cc.PointZero()),"offset for hexagonal map not implemented yet")}return t},_appendTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.RECT_PIXELS_TO_POINTS(n);var r=0|t.x+t.y*this._layerSize.width,i=this._reusedTileWithRect(n);this._setupTileSprite(i,t,e);var s=this._atlasIndexArray.length;return this.insertQuadFromSprite(i,s),this._atlasIndexArray=cc.ArrayAppendObjectToIndex(this._atlasIndexArray,r,s),i},_insertTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.RECT_PIXELS_TO_POINTS(n);var r=0|t.x+t.y*this._layerSize.width,i=this._reusedTileWithRect(n);this._setupTileSprite(i,t,e);var s=this._atlasIndexForNewZ(r);this.insertQuadFromSprite(i,s),this._atlasIndexArray=cc.ArrayAppendObjectToIndex(this._atlasIndexArray,r,s);if(this._children)for(var o=0;o<this._children.length;o++){var u=this._children[o];if(u){var a=u.getAtlasIndex();a>=s&&u.setAtlasIndex(a+1)}}return this._tiles[r]=e,i},_updateTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.rect(n.origin.x/this._contentScaleFactor,n.origin.y/this._contentScaleFactor,n.size.width/this._contentScaleFactor,n.size.height/this._contentScaleFactor);var r=t.x+t.y*this._layerSize.width,i=this._reusedTileWithRect(n);this._setupTileSprite(i,t,e);var s=this._atlasIndexForExistantZ(r);return i.setAtlasIndex(s),i.setDirty(!0),i.updateTransform(),this._tiles[r]=e,i},_parseInternalProperties:function(){var e=this.getProperty("cc_vertexz");if(e)if(e=="automatic"){this._useAutomaticVertexZ=!0;var t=this.getProperty("cc_alpha_func"),n=0;t&&(n=parseFloat(t));if(cc.renderContextType===cc.WEBGL){this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST));var r=cc.renderContext.getUniformLocation(this.getShaderProgram().getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S);this.getShaderProgram().use(),this.getShaderProgram().setUniformLocationWith1f(r,n)}}else this._vertexZvalue=parseInt(e,10)},_setupTileSprite:function(e,t,n){var r=t.x+t.y*this._layerSize.width;e.setPosition(this.getPositionAt(t)),cc.renderContextType===cc.WEBGL?e.setVertexZ(this._vertexZForPos(t)):e.setTag(r),e.setAnchorPoint(cc.PointZero()),e.setOpacity(this._opacity),cc.renderContextType===cc.WEBGL&&e.setRotation(0),e.setFlipX(!1),e.setFlipY(!1);if((n&cc.TMX_TILE_DIAGONAL_FLAG)>>>0){e.setAnchorPoint(cc.p(.5,.5)),e.setPosition(cc.p(this.getPositionAt(t).x+e.getContentSize().height/2,this.getPositionAt(t).y+e.getContentSize().width/2));var i=(n&(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG)>>>0)>>>0;i==cc.TMX_TILE_HORIZONTAL_FLAG?e.setRotation(90):i==cc.TMX_TILE_VERTICAL_FLAG?e.setRotation(270):i==(cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_HORIZONTAL_FLAG)>>>0?(e.setRotation(90),e.setFlipX(!0)):(e.setRotation(270),e.setFlipX(!0))}else(n&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0&&e.setFlipX(!0),(n&cc.TMX_TILE_VERTICAL_FLAG)>>>0&&e.setFlipY(!0)},_reusedTileWithRect:function(e){return cc.renderContextType!==cc.WEBGL?(this._reusedTile=new cc.Sprite,this._reusedTile.initWithTexture(this._textureForCanvas,e,!1),this._reusedTile.setBatchNode(this),this._reusedTile.setParent(this),this._reusedTile):(this._reusedTile?(this._reusedTile.setBatchNode(null),this._reusedTile.setTextureRect(e,!1,e.size),this._reusedTile.setBatchNode(this)):(this._reusedTile=new cc.Sprite,this._reusedTile.initWithTexture(this.getTexture(),e,!1),this._reusedTile.setBatchNode(this)),this._reusedTile)},_vertexZForPos:function(e){var t=0,n=0;if(this._useAutomaticVertexZ)switch(this._layerOrientation){case cc.TMX_ORIENTATION_ISO:n=this._layerSize.width+this._layerSize.height,t=-(n-(e.x+e.y));break;case cc.TMX_ORIENTATION_ORTHO:t=-(this._layerSize.height-e.y);break;case cc.TMX_ORIENTATION_HEX:cc.Assert(0,"TMX Hexa zOrder not supported");break;default:cc.Assert(0,"TMX invalid value")}else t=this._vertexZvalue;return t},_atlasIndexForExistantZ:function(e){var t;if(this._atlasIndexArray)for(var n=0;n<this._atlasIndexArray.length;n++){t=this._atlasIndexArray[n];if(t==e)break}return cc.Assert(t!=null,"TMX atlas index not found. Shall not happen"),n},_atlasIndexForNewZ:function(e){for(var t=0;t<this._atlasIndexArray.length;t++){var n=this._atlasIndexArray[t];if(e<n)break}return t}}),cc.TMXLayer.create=function(e,t,n){var r=new cc.TMXLayer;return r.initWithTilesetInfo(e,t,n)?r:null};cc.PointObject=cc.Class.extend({_ratio:null,_offset:null,_child:null,getRatio:function(){return this._ratio},setRatio:function(e){this._ratio=e},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e},getChild:function(){return this._child},setChild:function(e){this._child=e},initWithCCPoint:function(e,t){return this._ratio=e,this._offset=t,this._child=null,!0}}),cc.PointObject.create=function(e,t){var n=new cc.PointObject;return n.initWithCCPoint(e,t),n},cc.ParallaxNode=cc.Node.extend({_lastPosition:null,_parallaxArray:[],getParallaxArray:function(){return this._parallaxArray},setParallaxArray:function(e){this._parallaxArray=e},ctor:function(){this._super(),this._parallaxArray=[],this._lastPosition=cc.p(-100,-100)},addChild:function(e,t,n,r){if(arguments.length==3){cc.Assert(0,"ParallaxNode: use addChild:z:parallaxRatio:positionOffset instead");return}cc.Assert(e!=null,"Argument must be non-nil");var i=cc.PointObject.create(n,r);i.setChild(e),this._parallaxArray.push(i);var s=cc.p(this._position.x,this._position.y);s.x=s.x*n.x+r.x,s.y=s.y*n.y+r.y,e.setPosition(s),this._super(e,t,e.getTag())},removeChild:function(e,t){for(var n=0;n<this._parallaxArray.length;n++){var r=this._parallaxArray[n];if(r.getChild()==e){this._parallaxArray.splice(n,1);break}}this._super(e,t)},removeAllChildren:function(e){this._parallaxArray=[],this._super(e)},visit:function(){var e=this._absolutePosition();if(!cc.Point.CCPointEqualToPoint(e,this._lastPosition)){for(var t=0;t<this._parallaxArray.length;t++){var n=this._parallaxArray[t],r=-e.x+e.x*n.getRatio().x+n.getOffset().x,i=-e.y+e.y*n.getRatio().y+n.getOffset().y;n.getChild().setPosition(cc.p(r,i))}this._lastPosition=e}this._super()},_absolutePosition:function(){var e=this._position,t=this;while(t.getParent()!=null)t=t.getParent(),e=cc.pAdd(e,t.getPosition());return e}}),cc.ParallaxNode.create=function(){return new cc.ParallaxNode};cc.DOM={},cc.DOMEditMode=!0,cc.DOM.addMethods=function(e){for(funcs in cc.DOM.methods)e[funcs]=cc.DOM.methods[funcs]},cc.DOM.methods={setPosition:function(e,t){arguments.length==2?(this._position.x=e,this._position.y=t):this._position=e,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionY:function(e){this._position.y=e,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionX:function(e){this._position.x=e,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setScale:function(e,t){this._scaleX=e,this._scaleY=t||e,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleX:function(e){this._scaleX=e,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleY:function(e){this._scaleY=e,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setAnchorPoint:function(e){this._anchorPoint=e,this._anchorPointInPoints=cc.p(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y),this.dom.style[cc.$.pfx+"TransformOrigin"]=""+this._anchorPointInPoints.x+"px "+this._anchorPointInPoints.y+"px",this.isIgnoreAnchorPointForPosition()?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):(this.dom.style.marginLeft=this.isToggler?0:-this._anchorPointInPoints.x+"px",this.dom.style.marginBottom=-this._anchorPointInPoints.y+"px"),this.setNodeDirty()},setContentSize:function(e){cc.Size.CCSizeEqualToSize(e,this._contentSize)||(this._contentSize=e,this._anchorPointInPoints=cc.p(this._contentSize.width*this._anchorPoint.x,this._contentSize.height*this._anchorPoint.y),this.dom.width=e.width,this.dom.height=e.height,this.setAnchorPoint(this.getAnchorPoint())),this.canvas&&(this.canvas.width=this._contentSize.width,this.canvas.height=this._contentSize.height),cc.DOMEditMode&&!this.placeholder&&(this.dom.style.width=this._contentSize.width+"px",this.dom.style.height=this._contentSize.height+"px",this.dom.addClass("CCDOMEdit")),this.setNodeDirty(),this.redraw()},setRotation:function(e){if(this._rotation==e)return;this._rotation=e,this._rotationRadians=this._rotation*(Math.PI/180),this.setNodeDirty(),this.dom.rotate(e)},setSkewX:function(e){this._skewX=e,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setSkewY:function(e){this._skewY=e,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setVisible:function(e){this._visible=e,this.setNodeDirty(),this.dom&&(this.dom.style.visibility=e?"visible":"hidden")},_setZOrder:function(e){this._zOrder=e,this.setNodeDirty(),this.dom&&(this.dom.zIndex=e)},setParent:function(e){this._parent=e,this.setNodeDirty(),cc.DOM.parentDOM(this)},resumeSchedulerAndActions:function(){this.getScheduler().resumeTarget(this),this.getActionManager().resumeTarget(this),this.dom&&!this.dom.parentNode&&(this.getParent()?cc.DOM.parentDOM(this):this.dom.appendTo(cc.container)),this.dom&&(this.dom.style.visibility="visible")},pauseSchedulerAndActions:function(){this.getScheduler().pauseTarget(this),this.getActionManager().pauseTarget(this),this.dom&&(this.dom.style.visibility="hidden")},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup),this.dom&&this.dom.remove()},removeFromParentAndCleanup:function(){this.dom.remove()},setOpacity:function(e){this._opacity=e,this.dom.style.opacity=e/255},redraw:function(){if(this.isSprite){var e=this._children;this._children=null,cc.Sprite.prototype.visit.call(this,this.ctx),this._children=e}else cc.Sprite.prototype.visit.call(this,this.ctx)}},cc.DOM.parentDOM=function(e){var t=e.getParent();if(!t||!e.dom)return!1;t.dom||(cc.DOM.placeHolder(t),t.setParent=cc.DOM.methods.setParent),e.dom.appendTo(t.dom);var n;return(n=t.getParent())?cc.DOM.parentDOM(t):t.isRunning()&&t.dom.appendTo(cc.container),!0},cc.DOM.setTransform=function(e){if(e.ctx){e.ctx.translate(e.getAnchorPointInPoints().x,e.getAnchorPointInPoints().y);if(e.isSprite){var t=e._children;e._children=null,cc.Sprite.prototype.visit.call(e,e.ctx),e._children=t}else cc.Sprite.prototype.visit.call(e,e.ctx)}e.dom&&(e.dom.position.x=e.getPosition().x,e.dom.position.y=-e.getPosition().y,e.dom.rotation=e.getRotation(),e.dom.scale={x:e.getScaleX(),y:e.getScaleY()},e.dom.skew={x:e.getSkewX(),y:e.getSkewY()},e.setAnchorPoint&&e.setAnchorPoint(e.getAnchorPoint()),e.dom.transforms(),e.dom.position.y=-e.getPosition().y,e.dom.rotation=e.getRotation(),e.dom.scale={x:e.getScaleX(),y:e.getScaleY()},e.dom.skew={x:e.getSkewX(),y:e.getSkewY()},e.setAnchorPoint&&e.setAnchorPoint(e.getAnchorPoint()),e.dom.transforms())},cc.DOM.forSprite=function(e){e.dom=cc.$new("div"),e.canvas=cc.$new("canvas"),e.canvas.width=e.getContentSize().width,e.canvas.height=e.getContentSize().height,cc.DOMEditMode&&(e.dom.style.width=e.getContentSize().width+"px",e.dom.style.height=e.getContentSize().height+"px",e.dom.addClass("CCDOMEdit")),e.dom.style.position="absolute",e.dom.style.bottom=0,e.ctx=e.canvas.getContext("2d"),e.dom.appendChild(e.canvas),e.getParent()&&cc.DOM.parentDOM(e),e.isSprite=!0},cc.DOM.forMenuToggler=function(e){e.dom=cc.$new("div"),e.dom2=cc.$new("div"),e.dom.appendChild(e.dom2);for(var t=0;t<e._subItems.length;t++)cc.DOM.convert(e._subItems[t]),e.dom2.appendChild(e._subItems[t].dom),e._subItems[t].setPosition(cc.p(0,0));e.dom.style.marginLeft=0,e.setSelectedIndex=function(e){this._selectedIndex=e;for(var t=0;t<this._subItems.length;t++)this._subItems[t].setVisible(!1);this._subItems[e].setVisible(!0)},e.setSelectedIndex(e.getSelectedIndex()),e.dom2.addEventListener("click",function(){e.activate()}),e.dom2.addEventListener("mousedown",function(){for(var t=0;t<e._subItems.length;t++)e._subItems[t]._isEnabled=!0,e._subItems[t]._running=!0,e._subItems[t].selected(),e._subItems[t]._isEnabled=!1,e._subItems[t]._running=!1;e._subItems[e.getSelectedIndex()]._isEnabled=!0,e._subItems[e.getSelectedIndex()]._running=!0}),e.dom2.addEventListener("mouseup",function(){for(var t=0;t<e._subItems.length;t++)e._subItems[t]._isEnabled=!0,e._subItems[t].unselected(),e._subItems[t]._isEnabled=!1;e._subItems[e.getSelectedIndex()]._isEnabled=!0}),e.dom2.addEventListener("mouseout",function(){if(e.mouseDown){for(var t=0;t<e._subItems.length;t++)e._subItems[t]._isEnabled=!0,e._subItems[t].unselected(),e._subItems[t]._isEnabled=!1;e._subItems[e.getSelectedIndex()]._isEnabled=!0,e.mouseDown=!1}}),e.dom.style.position="absolute",e.isToggler=!0},cc.DOM.forMenuItem=function(e){e.dom=cc.$new("div"),e.canvas=cc.$new("canvas"),e.canvas.width=e.getContentSize().width,e.canvas.height=e.getContentSize().height,cc.DOMEditMode&&(e.dom.style.width=e.getContentSize().width+"px",e.dom.style.height=e.getContentSize().height+"px",e.dom.addClass("CCDOMEdit")),e.dom.style.position="absolute",e.dom.style.bottom=0,e.ctx=e.canvas.getContext("2d"),e.dom.appendChild(e.canvas),e.getParent()&&cc.DOM.parentDOM(e),e._selector&&(e.canvas.addEventListener("click",function(){e.activate()}),e.canvas.addEventListener("mousedown",function(){e.selected(),e.ctx.save(),e.ctx.setTransform(1,0,0,1,0,0),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.restore(),e.mouseDown=!0,cc.Sprite.prototype.visit.call(e,e.ctx)}),e.canvas.addEventListener("mouseup",function(){e.unselected(),e.ctx.save(),e.ctx.setTransform(1,0,0,1,0,0),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.restore(),cc.Sprite.prototype.visit.call(e,e.ctx)}),e.canvas.addEventListener("mouseout",function(){e.mouseDown&&(e.unselected(),e.ctx.save(),e.ctx.setTransform(1,0,0,1,0,0),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.restore(),cc.Sprite.prototype.visit.call(e,e.ctx),e.mouseDown=!1)}))},cc.DOM.placeHolder=function(e){e.dom=cc.$new("div"),e.placeholder=!0,e.dom.style.position="absolute",e.dom.style.bottom=0,e.dom.style.width=(e.getContentSize().width||cc.Director.getInstance().getWinSize().width)+"px",e.dom.style.maxHeight=(e.getContentSize().height||cc.Director.getInstance().getWinSize().height)+"px",e.dom.style.margin=0,cc.DOM.setTransform(e),e.dom.transforms(),cc.DOM.addMethods(e)},cc.DOM.convert=function(){if(arguments.length>1)return cc.DOM.convert(arguments);if(arguments.length==1&&!arguments[0].length)return cc.DOM.convert([arguments[0]]);var e=arguments[0];for(var t=0;t<e.length;t++){e[t]instanceof cc.Sprite?e[t].dom||cc.DOM.forSprite(e[t]):e[t]instanceof cc.MenuItemToggle?e[t].dom||cc.DOM.forMenuToggler(e[t]):e[t]instanceof cc.MenuItem?e[t].dom||cc.DOM.forMenuItem(e[t]):cc.log("DOM converter only supports sprite and menuitems yet"),cc.DOM.addMethods(e[t]),e[t].visit=function(){},e[t].transform=function(){},cc.DOM.setTransform(e[t]),e[t].setVisible(e[t].isVisible());if(cc.DOMEditMode){if(!cc.DOM.tooltip){var n=cc.$new("style");n.textContent=".CCDOMEdit:hover{border: rgba(255,0,0,0.5) 2px dashed;left: -2px;} .CCDOMEdit  #CCCloseButton{width:80px;height:15px;background: rgba(0,0,0,0.4);border:1px solid #aaaaaa;font-size: 9px;line-height:9px;color:#bbbbbb;}  .CCTipWindow .CCTipMove{cursor:move;} .CCTipWindow .CCTipRotate{cursor:w-resize;} .CCTipWindow .CCTipScale{cursor:ne-resize;} .CCTipWindow .CCTipSkew{cursor:se-resize;} .CCTipWindow input{width:40px;background: rgba(0,0,0,0.5);color:white;border:none;border-bottom: 1px solid #fff;} div.CCTipWindow:hover{color:rgb(50,50,255);}",document.body.appendChild(n),cc.container.style.overflow="visible";var r=cc.DOM.tooltip=cc.$new("div");r.mouseDown=!1,document.body.appendChild(r),r.addClass("CCTipWindow"),r.style.width="140px",r.style.height="134px",r.style.background="rgba(50,50,50,0.5)",r.style.border="1px rgba(255,255,255,0.5) solid",r.style.borderRadius="5px",r.style.color="rgb(255,255,255)",r.style.boxShadow="0 0 10px 1px rgba(0,0,0,0.5)",r.style.position="absolute",r.style.display="none",r.style.top=0,r.style.left="-150px",r.style[cc.$.pfx+"Transform"]="translate3d(0,0,100px)",r.style[cc.$.pfx+"UserSelect"]="none",r.innerHTML='<table><tr><td><label class="CCTipMove">Move</label></td><td><input type="text" value="12" id="posx"/></td><td><input type="text" value="12" id="posy"/></td></tr><tr><td><label class="CCTipRotate">Rotate</label></td><td><input type="text" value="12" id="rot"/></td></tr><tr><td><label class="CCTipScale">Scale</label></td><td><input type="text" value="12" id="scalex"/></td><td><input type="text" value="12" id="scaley"/></td></tr><tr><td><label class="CCTipSkew">Skew</label></td><td><input type="text" value="12" id="skewx"/></td><td><input type="text" value="12" id="skewy"/></td></tr></table><button id="CCCloseButton">Close</button>',r.updateNumbers=function(){var e=cc.DOM.tooltip;e.target&&(e.find("#posx").value=e.target._position.x,e.find("#posy").value=e.target._position.y,e.find("#rot").value=e.target._rotation,e.find("#scalex").value=e.target._scaleX,e.find("#scaley").value=e.target._scaleY,e.find("#skewx").value=e.target._skewX,e.find("#skewy").value=e.target._skewY)},r.find(".CCTipMove").addEventListener("mousedown",function(e){r.mode="move",r.initialpos={x:e.clientX,y:e.clientY},r.mouseDown=!0}),r.find(".CCTipRotate").addEventListener("mousedown",function(e){var t=cc.$.findpos(cc.canvas),t={x:t.x,y:t.y+cc.canvas.height};r.nodepos=r.target.getPosition(),r.nodepos={x:t.x+r.nodepos.x,y:t.y-r.nodepos.y},r.startPos={x:e.x,y:e.y},r.mode="rot",r.initialpos={x:e.clientX,y:e.clientY},r.mouseDown=!0;var n={x:r.startPos.x,y:r.nodepos.y},i=r.startPos,s=r.nodepos,o=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2)),u=Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)),a=Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2)),f=(o*o+a*a-u*u)/(2*o*a),f=Math.acos(f)*(180/cc.PI);r.startAngle=f,r.startRot=r.target.getRotation()}),r.find(".CCTipScale").addEventListener("mousedown",function(e){r.mode="scale",r.initialpos={x:e.clientX,y:e.clientY},r.mouseDown=!0}),r.find(".CCTipSkew").addEventListener("mousedown",function(e){r.mode="skew",r.initialpos={x:e.clientX,y:e.clientY},r.mouseDown=!0}),document.body.addEventListener("mousemove",function(e){if(r.mode=="move"){var t=e.clientX-r.initialpos.x,n=e.clientY-r.initialpos.y,i=r.target.getPosition();r.target.setPosition(t+i.x,-n+i.y),r.initialpos={x:e.clientX,y:e.clientY},r.updateNumbers()}else if(r.mode=="rot"){var s={x:e.x,y:e.y},o=r.startPos,u=r.nodepos,a=Math.sqrt(Math.pow(u.x-s.x,2)+Math.pow(u.y-s.y,2)),f=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2)),l=Math.sqrt(Math.pow(o.x-u.x,2)+Math.pow(o.y-u.y,2)),c=(a*a+l*l-f*f)/(2*a*l),c=Math.acos(c)*(180/cc.PI),n=e.clientY-r.initialpos.y,t=e.clientX-r.initialpos.x;e.y>r.startPos.y?r.target.setRotation(-c+r.startRot):r.target.setRotation(c+r.startRot),r.updateNumbers()}else if(r.mode=="scale"){var n=e.clientY-r.initialpos.y,t=e.clientX-r.initialpos.x,h=r.target.getScaleX(),p=r.target.getScaleY();r.target.setScale(h-t/150,p+n/150),r.initialpos={x:e.clientX,y:e.clientY},r.updateNumbers()}else if(r.mode=="skew"){var n=e.clientY-r.initialpos.y,t=e.clientX-r.initialpos.x,d=r.target.getSkewX(),v=r.target.getSkewY();r.target.setSkewX(d-t/4),r.target.setSkewY(v+n/4),r.initialpos={x:e.clientX,y:e.clientY},r.updateNumbers()}}),r.find("#CCCloseButton").addEventListener("click",function(){r.mode=null,r.style.display="none",r.mouseDown=!1}),document.addEventListener("mouseup",function(){r.mode=null,r.mouseDown=!1})}e[t].dom.ccnode=e[t];var i=e[t];e[t].dom.addEventListener("mouseover",function(){this.style.zIndex=999999;if(this.showTooltipDiv!==undefined&&this.showTooltipDiv===!1)return;if(!cc.DOM.tooltip.mouseDown){var e=cc.$.findpos(this);cc.DOM.tooltip.style.display="block",cc.DOM.tooltip.prependTo(this),cc.DOM.tooltip.target=i,this.style.zIndex=999999,cc.DOM.tooltip.updateNumbers()}}),e[t].dom.addEventListener("mouseout",function(){this.style.zIndex=this.ccnode._zOrder})}}};var cc=cc||{};cc.SFX=function(e,t){this.audio=e,this.ext=t||".ogg"},cc.AudioEngine=cc.Class.extend({_supportedFormat:[],_soundEnable:!1,_effectList:{},_soundList:{},_playingMusic:null,_effectsVolume:1,_maxAudioInstance:10,_canPlay:!0,_capabilities:{mp3:!1,ogg:!1,wav:!1,mp4:!1,m4a:!1},ctor:function(){this._supportedFormat=[];var e=document.createElement("audio");e.canPlayType&&(this._capabilities.mp3="no"!=e.canPlayType("audio/mpeg")&&""!=e.canPlayType("audio/mpeg"),this._capabilities.mp4="no"!=e.canPlayType("audio/mp4")&&""!=e.canPlayType("audio/mp4"),this._capabilities.m4a="no"!=e.canPlayType("audio/x-m4a")&&""!=e.canPlayType("audio/x-m4a")||"no"!=e.canPlayType("audio/aac")&&""!=e.canPlayType("audio/aac"),this._capabilities.ogg="no"!=e.canPlayType('audio/ogg; codecs="vorbis"')&&""!=e.canPlayType('audio/ogg; codecs="vorbis"'),this._capabilities.wav="no"!=e.canPlayType('audio/wav; codecs="1"')&&""!=e.canPlayType('audio/wav; codecs="1"'),this._soundEnable=this._capabilities.mp3||this._capabilities.mp4||this._capabilities.m4a||this._capabilities.ogg||this._capabilities.wav);var t=navigator.userAgent;if(/Mobile/.test(t)&&(/iPhone OS/.test(t)||/iPad/.test(t)||/Firefox/.test(t))||/MSIE/.test(t))this._canPlay=!1},init:function(){return this._getSupportedAudioFormat(),this._soundEnable},preloadSound:function(e){if(this._soundEnable){var t=this._getExtFromFullPath(e),n=this._getPathWithoutExt(e);if(this._checkAudioFormatSupported(t)&&!this._soundList.hasOwnProperty(n))if(this._canPlay){var r=new cc.SFX;r.ext=t,r.audio=new Audio(e),r.audio.preload="auto",r.audio.addEventListener("canplaythrough",function(e){cc.Loader.getInstance().onResLoaded(),this.removeEventListener("canplaythrough",arguments.callee,!1)},!1),r.audio.addEventListener("error",function(e){cc.Loader.getInstance().onResLoadingErr(e.srcElement.src),this.removeEventListener("error",arguments.callee,!1)},!1),this._soundList[n]=r,r.audio.load()}else cc.Loader.getInstance().onResLoaded();else cc.Loader.getInstance().onResLoaded()}},playMusic:function(e,t){var n=this._getPathWithoutExt(e),r=this._getExtFromFullPath(e),i;this._soundList.hasOwnProperty(this._playingMusic)&&this._soundList[this._playingMusic].audio.pause(),this._playingMusic=n;if(this._soundList.hasOwnProperty(this._playingMusic))i=this._soundList[this._playingMusic].audio;else{var s=new cc.SFX;s.ext=r,i=s.audio=new Audio(e),s.audio.preload="auto",this._soundList[n]=s,s.audio.load()}i.addEventListener("pause",this._musicListener,!1),i.loop=t||!1,i.play(),cc.AudioEngine.isMusicPlaying=!0},_musicListener:function(e){cc.AudioEngine.isMusicPlaying=!1,this.removeEventListener("pause",arguments.callee,!1)},stopMusic:function(e){if(this._soundList.hasOwnProperty(this._playingMusic)){var t=this._soundList[this._playingMusic].audio;t.pause(),t.currentTime=t.duration,e&&delete this._soundList[this._playingMusic],cc.AudioEngine.isMusicPlaying=!1}},pauseMusic:function(){if(this._soundList.hasOwnProperty(this._playingMusic)){var e=this._soundList[this._playingMusic].audio;e.pause(),cc.AudioEngine.isMusicPlaying=!1}},resumeMusic:function(){if(this._soundList.hasOwnProperty(this._playingMusic)){var e=this._soundList[this._playingMusic].audio;e.play(),e.addEventListener("pause",this._musicListener,!1),cc.AudioEngine.isMusicPlaying=!0}},rewindMusic:function(){if(this._soundList.hasOwnProperty(this._playingMusic)){var e=this._soundList[this._playingMusic].audio;e.currentTime=0,e.play(),e.addEventListener("pause",this._musicListener,!1),cc.AudioEngine.isMusicPlaying=!0}},willPlayMusic:function(){return!1},isMusicPlaying:function(){return cc.AudioEngine.isMusicPlaying},getMusicVolume:function(){return this._soundList.hasOwnProperty(this._playingMusic)?this._soundList[this._playingMusic].audio.volume:0},setMusicVolume:function(e){if(this._soundList.hasOwnProperty(this._playingMusic)){var t=this._soundList[this._playingMusic].audio;e>1?t.volume=1:e<0?t.volume=0:t.volume=e}},playEffect:function(e,t){var n=this._getPathWithoutExt(e),r;this._soundList.hasOwnProperty(n)?r=this._soundList[n].ext:r=this._getExtFromFullPath(e);var i=this._getEffectList(n),s;if(i.length>0)for(var o=0;o<i.length;o++)if(i[o].ended){s=i[o],s.currentTime=0;break}if(!s){if(i.length>=this._maxAudioInstance)return cc.log("Error: "+e+" greater than "+this._maxAudioInstance),e;s=new Audio(n+"."+r),s.volume=this._effectsVolume,i.push(s)}return t&&(s.loop=t),s.play(),e},getEffectsVolume:function(){return this._effectsVolume},setEffectsVolume:function(e){e>1?this._effectsVolume=1:e<0?this._effectsVolume=0:this._effectsVolume=e;var t,n;for(var r in this._effectList){t=this._effectList[r];if(t.length>0)for(var i=0;i<t.length;i++)n=t[i],n.volume=this._effectsVolume}},pauseEffect:function(e){if(!e)return;var t=this._getPathWithoutExt(e);if(this._effectList.hasOwnProperty(t)){var n=this._effectList[t],r;for(var i=n.length-1;i>=0;i--)r=n[i],r.ended||r.pause()}},pauseAllEffects:function(){var e,t;for(var n in this._effectList){e=this._effectList[n];for(var r=0;r<e.length;r++)t=e[r],t.ended||t.pause()}},resumeEffect:function(e){if(!e)return;var t,n,r=this._getPathWithoutExt(e);if(this._effectList.hasOwnProperty(r)){t=this._effectList[r];if(t.length>0)for(var i=0;i<t.length;i++)n=t[i],n.ended||n.play()}},resumeAllEffects:function(){var e,t;for(var n in this._effectList){e=this._effectList[n];if(e.length>0)for(var r=0;r<e.length;r++)t=e[r],t.ended||t.play()}},stopEffect:function(e){if(!e)return;var t,n,r=this._getPathWithoutExt(e);if(this._effectList.hasOwnProperty(r)){t=this._effectList[r];if(t.length>0)for(var i=0;i<t.length;i++)n=t[i],n.ended||(n.loop=!1,n.currentTime=n.duration)}},stopAllEffects:function(){var e,t;for(var n in this._effectList){e=this._effectList[n];for(var r=0;r<e.length;r++)t=e[r],t.ended||(t.loop=!1,t.currentTime=t.duration)}},unloadEffect:function(e){if(!e)return;var t=this._getPathWithoutExt(e);this._effectList.hasOwnProperty(t)&&(this.stopEffect(e),delete this._effectList[t])},_getEffectList:function(e){return this._effectList.hasOwnProperty(e)?this._effectList[e]:(this._effectList[e]=[],this._effectList[e])},_getPathWithoutExt:function(e){if(typeof e!="string")return;var t=e.lastIndexOf(".");return t!=-1?e.substring(0,t):e},_getExtFromFullPath:function(e){var t=e.lastIndexOf(".");return t!=-1?e.substring(t+1,e.length):-1},_checkAudioFormatSupported:function(e){var t;for(var n=0;n<this._supportedFormat.length;n++){t=this._supportedFormat[n];if(t==e)return!0}return!1},_getSupportedAudioFormat:function(){if(!this._soundEnable)return;this._capabilities.ogg&&this._supportedFormat.push("ogg"),this._capabilities.mp3&&this._supportedFormat.push("mp3"),this._capabilities.wav&&this._supportedFormat.push("wav"),this._capabilities.mp4&&this._supportedFormat.push("mp4"),this._capabilities.m4a&&this._supportedFormat.push("m4a")}}),cc.AudioEngine._instance=null,cc.AudioEngine.isMusicPlaying=!1,cc.AudioEngine.getInstance=function(){return this._instance||(this._instance=new cc.AudioEngine,this._instance.init()),this._instance},cc.AudioEngine.end=function(){this._instance&&(this._instance.stopMusic(),this._instance.stopAllEffects()),this._instance=null};